<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="show">1</div>
    <script>
      ;(function () {
        const root = this

        function watch(target, func) {
          const proxy = new Proxy(target, {
            get: function (target, key, receiver) {
              return Reflect.get(target, key, receiver)
            },
            set(target, key, value, receiver) {
              func(key, value, receiver)
              return Reflect.set(target, key, value, receiver)
            },
          })

          return proxy
        }

        this.watch = watch
      })()

      // 假设这是我们维护的一套用于弹窗的数据
      const arr = [{ a: 1 }]

      const newObj = watch(arr, function (key, newvalue, receiver) {
        // 这里监听到数据更新
        // 这时候通过key去更新对应的数据
        console.log('key', key, newvalue)
        console.log('所有的数据', receiver)
      })

      // 此时更新数据
      setTimeout(() => {
        // 更改原来的数据
        newObj[0].a = 2
        // 新增数据
        newObj.push({ b: 2 })
      }, 2000)
    </script>
  </body>
</html>
