!function(E,G,d){"use strict";function P(){this.el=[1,0,0,0,1,0,0,0,1]}function K(N){var G={};return{get:function(T){if(G[T]!==d)return G[T];var B;switch(T){case"WEBGL_depth_texture":B=N.getExtension("WEBGL_depth_texture")||N.getExtension("MOZ_WEBGL_depth_texture")||N.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":B=N.getExtension("EXT_texture_filter_anisotropic")||N.getExtension("MOZ_EXT_texture_filter_anisotropic")||N.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":B=N.getExtension("WEBGL_compressed_texture_s3tc")||N.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||N.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":B=N.getExtension("WEBGL_compressed_texture_pvrtc")||N.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":B=N.getExtension("WEBGL_compressed_texture_etc1");break;default:B=N.getExtension(T)}return G[T]=B,B}}}function r(h,k,T){function m(){if(B!==d)return B;var q=k.get("EXT_texture_filter_anisotropic");return B=null!==q?h.getParameter(q.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function Q(I){if("highp"===I){if(h.getShaderPrecisionFormat(h.VERTEX_SHADER,h.HIGH_FLOAT).precision>0&&h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT).precision>0)return"highp";I="mediump"}return"mediump"===I&&h.getShaderPrecisionFormat(h.VERTEX_SHADER,h.MEDIUM_FLOAT).precision>0&&h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var B;T=T||{};var o="undefined"!=typeof WebGL2RenderingContext&&h instanceof WebGL2RenderingContext,z=T.precision!==d?T.precision:"highp",i=Q(z);i!==z&&(console.warn("WebGL:",z,"not supported, using",i,"instead."),z=i);var n=T.logarithmicDepthBuffer===!0,E=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS),q=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=h.getParameter(h.MAX_TEXTURE_SIZE),F=h.getParameter(h.MAX_CUBE_MAP_TEXTURE_SIZE),t=h.getParameter(h.MAX_VERTEX_ATTRIBS),V=h.getParameter(h.MAX_VERTEX_UNIFORM_VECTORS),I=h.getParameter(h.MAX_VARYING_VECTORS),Z=h.getParameter(h.MAX_FRAGMENT_UNIFORM_VECTORS),H=q>0,$=o||!!k.get("OES_texture_float"),A=H&&$,_=o?h.getParameter(h.MAX_SAMPLES):0;return{getMaxAnisotropy:m,getMaxPrecision:Q,precision:z,logarithmicDepthBuffer:n,maxTextures:E,maxVertexTextures:q,maxTextureSize:l,maxCubemapSize:F,maxAttributes:t,maxVertexUniforms:V,maxVaryings:I,maxFragmentUniforms:Z,vertexTextures:H,floatFragmentTextures:$,floatVertexTextures:A,maxSamples:_}}var g="ht";if(!E[g]){!function(){Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),E.performance&&E.performance.now||function(){var g=Date.now();E.performance||(E.performance={}),E.performance.now=function(){return Date.now()-g}}();for(var u=Date.now(),D=16,e=["ms","moz","webkit","o"],w=0;w<e.length&&!E.requestAnimationFrame;++w)E.requestAnimationFrame=E[e[w]+"RequestAnimationFrame"],E.cancelAnimationFrame=E[e[w]+"CancelAnimationFrame"]||E[e[w]+"CancelRequestAnimationFrame"];E.requestAnimationFrame||(E.requestAnimationFrame=function(z){var d=Date.now(),i=D+u-d;return 0>i&&(i=0),u=d,E.setTimeout(function(){u=Date.now(),z(performance.now())},i)}),E.cancelAnimationFrame||(E.cancelAnimationFrame=function(I){return E.clearTimeout(I)}),G.assign===d&&(G.assign=function(l){if(l===d||null===l)throw new TypeError("Cannot convert undefined or null to object");for(var k=G(l),A=1;A<arguments.length;A++){var b=arguments[A];if(b!==d&&null!==b)for(var p in b)G.prototype.hasOwnProperty.call(b,p)&&(k[p]=b[p])}return k})}();var l=E.document,S=null,W=E[g]={},Y=E[g+"config"],X=W.Default=Y&&Y.Default||{},n=W.Style=Y&&Y.Style||{},c=W.Attr=Y&&Y.Attr||{},v=W.Color=Y&&Y.Color||{},f=W.IsGetter=Y&&Y.IsGetter||{};!function(){var y=!1;try{var J=G.defineProperty({},"passive",{get:function(){y=!0}});E.addEventListener("test",J,J),E.removeEventListener("test",J,J)}catch(d){y=!1}X.passiveSupported=y}();var I,y,e,U,z=X.passiveSupported,p=X.eventListenerOptionsFalse=z?{passive:!1,capture:!1}:!1,x=X.eventListenerOptionsTrue=z?{passive:!1,capture:!0}:!0,s=function(w,O,z,i){w.addEventListener(O,z,i?x:p)},F=function(T,S,G,P){T.removeEventListener(S,G,P?x:p)},C=Math,t=C.round,R=C.floor,w=C.ceil,_=C.sqrt,V=C.max,o=C.min,M=C.abs,k=C.cos,Z=C.acos,L=C.sin,Q=C.pow,h=C.asin,u=C.PI,m=2*u,j=u/2,O=C.tan,N=C.atan2,A=C.random,H=C.log,b=!1,a=!1,$=E.parseInt||global.parseInt,D="2019-12-25",T=E.navigator?E.navigator.platform.indexOf("Win")>-1:!1,q=function(K){return K*K},J=E.setTimeout,B=E.clearTimeout,i=E.location,$i=E.navigator?E.navigator.userAgent.toLowerCase():"",vg=function(w){return w.test($i)},Gq=vg(/msie/),bl=vg(/msie/)||vg(/trident/),ol=vg(/msie 10/),lh=vg(/edge/),zg=vg(/firefox/),vf=vg(/mac/),xl=X.isTouchable===d?T?!1:l?"ontouchend"in l:!1:X.isTouchable,wn="default",ji="single",gd="multiple",Cn="front",cp="back",zc="left",br="right",Dc="top",fd="bottom",Sb="center",Qp="eye",Bp="middle",Mg="east",Df="west",ad="north",jf="none",wo="px",Bg="absolute",jl="border",yg="triangle",Ni="rect",Qm="circle",Um="cylinder",Jr="shape",vi="items",Qi="normal",li="remove",vh="clear",ml="width",ao="height",cg="ingroup",Po="check",Ok="uncheck",Gm="radio",tc="radioOn",og="radioOff",xe="points",qk="values",Ml="series",Ai="body",Fn="label",gm="label2",he="note",Vb="note2",eq="icons",uo="labelFont",Wr="labelColor",hd="labelSelectColor",_j="note.expanded",gj="note2.expanded",Vn="edge.expanded",Ab="edge.points",ug="edge.type",Pm="rotation",Ne="hidden",Qn="visible",Zg="tuv",wl="no",Am="draw",He="select",Dm="currentSubGraph",Fp="selectBackground",yf="autoMakeVisible",ke="autoHideScrollBar",ts="scrollBarColor",Sn="scrollBarSize",Xi="indent",Jq="rowHeight",Dk="columnLineColor",Or="rowLineColor",lj="columnLineVisible",sd="rowLineVisible",jg="visibleFunc",$l="expandIcon",Iq="collapseIcon",lb="checkMode",yn="sortFunc",Kg="editable",Yh="batchEditable",pk="tristate",ym="asc",Th="desc",Sp="position",mi="elevation",wg="children",hg="translateX",tg="translateY",Ak="dataModel",sp="maxSize",hh="state",fm="shape3d",De="shape3d.resolution",eh="shape3d.visible",vr="shape3d.from.visible",Zr="shape3d.to.visible",Ol="shape3d.top.visible",bk="shape3d.bottom.visible",Wi="repeat.uv.length",rm="serializeValue",kc="deserializeValue",pg="centerUniform",po="uniform",mo="rgba(255,255,255,0)",tl="style",Fg="attr",Mh="field",hs="string",qd="boolean",Cl="color",Pr="int",gl="number",Rd="ew-resize",gr="ns-resize",Oc="pointer",nh="auto",Oh="mousedown",zk="mousemove",ag="mouseup",nc="mouseout",vk="touchstart",pc="touchmove",ik="touchend",vb="keydown",Hp="keyup",yo=["DOMMouseScroll","mousewheel"],Db=zg?yo[0]:yo[1],gs=xl?[vk,pc,ik,vb,Hp,"keypress","input","contextmenu","compositionstart","compositionupdate","compositionend"]:[vb,Hp,"keypress","input",Oh,zk,ag,nc,Db,"wheel","contextmenu","mouseenter","mouseleave","mouseover","compositionstart","compositionupdate","compositionend"],mp=S,Wq=S,Mb=S,rr=ag.length,Sg=function(){Mb&&(B(Mb.timeout),Mb=S)},Sh=function(){Mb&&Co(Mb.e,Mb.info)};E.addEventListener&&(xl||(s(E,nc,function(){Sg()}),s(E,Db,function(){qi()})),s(E,Hp,function(N){91===N.keyCode?hc={}:delete hc[N.keyCode]},!0),s(E,vb,function(s){hc[s.keyCode]=!0},!0),s(E,"blur",function(){hc={}}));var af,fe,Gg,Me=0,fn=S,xp=function(s,M){var u=J(function(){delete fn[u],bm(fn)&&(fn=S),s()},M);return u},vm=S,_i=S,Xb={},js={},Di={},xk={},Be={},hc={},Cp={},Vd={},dh={},Jp={},wh=/.json$/,Fb=/^data:image\/svg\+xml/,Gp={},Rj=[],ni={},Op=S,qf=S,ic=function(){},ln=function(){throw"Oops!"},Ad=[0,0,0],No={x:0,y:0,width:0,height:0},ql=S,Nn=S,Mk=S,Ce=function(b,p){js[b]=p,p&&p.comps&&!p.uuid&&(p.uuid=W.Math.generateUUID()),Rh[b]&&(p.cacheRule=Rh[b],delete Rh[b])},es=function(E){Nn&&!E._72O&&(Mk||(Mk={}),Mk[E._72O=mf()]=E),af!=S?Im()<.05&&U&&!fe&&(hq=Sg):hq=Uf},Lr=function(e,A,_,G){Nn||(Nn={});var D=Nn[e];if(D){if(D.url===A)return;D.image?(D.image.onload=ic,D.image.onerror=ic):D.request&&(D.request.onload=ic,D.request.onerror=ic)}if(wh.test(A)){var h=new Gh;if(Nn[e]={request:h,url:A},A=X.beforeLoadURL(A),A.data){var m=X.parse(A.data);Ef(e,m),X.handleImageLoaded(e,m)}else{h.onload=function(){if(200===this.status||0===this.status){var T=X.parse(h.getResponseText());Ef(e,T),X.handleImageLoaded(e,T)}else Ef(e,X.handleUnfoundImage(e,A)||S)},h.onerror=function(){Ef(e,X.handleUnfoundImage(e,A)||S)};var u={};u.url=encodeURI(A),u.sync=!1,h.send(u)}}else{var m=new Image;Nn[e]={image:m,url:A},/^data:image/.test(A)||(A=X.beforeLoadURL(A),A=X.appendTimeStamp(A),A=encodeURI(A),m.crossOrigin=X.crossOrigin),X.convertImageSrc(A,function(c){bl&&(A.toLowerCase().indexOf(".svg")>0||Fb.test(A))?(l.body.appendChild(m),m.style.visibility="hidden",m.onload=function(){J(function(){if(_&&(m.width=_),G&&(m.height=G),!m.width||!m.height){var d=m.width||m.clientWidth,y=m.height||m.clientHeight;m.width=d,m.height=y}X.handleImageLoaded(e,m),Ef(e,m),l.body.removeChild(m),m.style.visibility=""},180)},m.onerror=function(){Ef(e,X.handleUnfoundImage(e,A)||S),l.body.removeChild(m),m.style.visibility=""}):(m.onload=function(){_&&(m.width=_),G&&(m.height=G),X.handleImageLoaded(e,m),Ef(e,m)},m.onerror=function(){Ef(e,X.handleUnfoundImage(e,A)||S)}),m.src=c})}},Ef=function(D,W){if(Ce(D,W),delete Nn[D],bm(Nn)&&(Nn=S,Mk)){for(var j in Mk){var e=Mk[j];e._2O&&e._2O[D]&&(e.deleteTexture(D),delete e._2O[D]),e.invalidateAll&&e.invalidateAll(d,"imageLoaded",D),e.redraw&&e.redraw(),e.iv(),delete e._72O}Mk=S}if(W&&Mk)for(var j in Mk){var e=Mk[j];e.invalidateAll&&e.invalidateAll(d,"imageLoading",D),e.redraw&&e.redraw(),e.iv()}},Pb=function(){return H=C&&Date,function(){return E.performance&&E.performance.now?E.performance.now():Date.now()}}(),Wc=function(P,t){t?B(P):E.cancelAnimationFrame(P)},Ec=function(P,n,q){return{width:P,height:n,comps:En(q)?q:[q]}},ss=function(t,X){return{type:Qm,rect:[t,X,1.6,1.6],borderWidth:1,borderColor:Ch,gradient:un,gradientColor:np,background:Ch}},oe=function(z,x){return Ec(16,16,{type:yg,rect:[4,4,10,8],background:z,rotation:x?1.57:3.14})},Xq=function(R,J){return Ec(16,16,{type:yg,rect:[4,4,8,7],background:R,rotation:J?3.14:0})},Rc=function(R){var C=R._orientation;return"horizontal"===C||"h"===C},Dl=function(j,r){var D=S||4,a=S||1,E=S||1;0>D?D=0:D>.25&&(D=.25);var B,p,h,b,v,g,c,O=.5,l=[],M=[],F=[],R=m/E,q=m/a,o=O-D;for(p=0;a>=p;p++)for(b=-u+p*q,g=k(b),v=L(b),B=0;E>=B;B++)h=B*R,c=o+D*g,l.push(k(h)*c,v*D,-L(h)*c),(y=[j,r])&&M.push(B/E,1-p/a);for(p=0;a>p;p++){var z=p*(E+1),e=(p+1)*(E+1);for(B=0;E>B;B++)F.push(z+B,e+B+1,e+B,z+B,z+B+1,e+B+1),sl.z=Tq.z=[j,r]}},lk=function(e){var j=2,U=0;for(var V in e)V.length===j&&$(V,32)===Rn&&(Op=qf=e[V]),U++;return U},Ql=function(r,T,N,k){return N||(N=xl?5:3,N/=k||1),{x:r-N,y:T-N,width:2*N,height:2*N}},pq=function(P,i,k,J){var Z=this;i||(i=xl?5:3,k=20,J=20);var x={x:P,y:i,width:k,height:J};if(k)for(var $=0;k>$;$++)if(3===k)J=20;else for(var F=0;J>F;F++)Z=E?E:k;var v={x:u,y:2*u};if(th(x,v)){var h=ao[0]+Dc[0]+vh[1]+ym.length,q=Ne[0]+pk[0]+vh[1]+Ai.length;db[Qp]=[Z[h],Z[q]],Z[h]=gb[Qp],Z[q]=gb[fm]}},lr=function(N){return(/ble$/.test(N)||/ed$/.test(N)||f[N]?"is":"get")+N.charAt(0).toUpperCase()+N.slice(1)},gb=function(u){return"set"+u.charAt(0).toUpperCase()+u.slice(1)},Gk=function(b){return typeof b===hs||b instanceof String},Vc=function(m){return typeof m===gl},Uf=function(r){return typeof r===qd},zn=function(J){return J&&"object"==typeof J},dc=function(I){return"function"==typeof I},En=function(y){return y instanceof Array},dm=function(V){return V instanceof Kf},jm=function(Y){return En(Y)?new Kf(Y):Y},zm=function(A){return A instanceof Uh},Pe=function(H){return H instanceof Ah},Ud=function(c){return c instanceof Bd},gq=function(V,T){if(!(V instanceof W.Group))return!1;if(!T)return V.isExpanded();var Y=T.getDataUI(V);return Y&&Y._88I?!0:!1},Kk=function(N){return N instanceof Cc},Io=function(y){return y&&"IFRAME"===y.tagName},ns=function(E){return E==S||X.numberDigits==S?E:parseFloat(E.toFixed(X.numberDigits))},qh=function(Q,w,b){var i,n=w.length;if(b)for(var l=0;b>l;l++)if(3===n)Q.push(w[0]),Q.push(w[1]),Q.push(w[2]);else for(i=0;n>i;i++)Q.push(w[i]);else if(3===n)Q.push(w[0]),Q.push(w[1]),Q.push(w[2]);else for(i=0;n>i;i++)Q.push(w[i])},tm=function(d){return d?zn(d)?d:{}:!1},uj=function(l,T,I){var g,R=zn(l)?l:l.prototype;for(g in T)I&&g in R?R[g]===d&&console.warn("class",R,"has own undefined property",g,", keep exist!"):R[g]=T[g];return l},bn=function(N){return String.fromCharCode(N)},$q=function(w){for(var b,$=0,W="";$<w.length;$++)b=w[w.length-1-$],"%"===b?b="'":"a"===b?b='"':"]"===b&&(b="\\"),W+=bn(b.charCodeAt(0)-1);return W},Lk=function(N,C,s){N.superClass.constructor.apply(C,s)},bm=function(C){for(var p in C)return!1;return!0},ud=function(E){return E?0===E.length:!0},is=function(){var T="";return[Ok[0],Or[0],Fn[0]].forEach(function(b){T+=gb(b).slice(3)}),po=l&&l[T]||pg,function(p,l){return p===l?!0:p.x===l.x&&p.y===l.y&&p.width===l.width&&p.height===l.height}}(),Wn=function(Z,T,h){return T>Z?T:Z>h?h:Z},pd=function(h){return 0>h?-1:h>0?1:0},Im=function(){var P=1e4*L(rr++);return P-R(P)},tn=function(Z,k,F){return Rq(Z.x,Z.y,k.x,k.y,F.x,F.y,F.x+F.width,F.y,!0)||Rq(Z.x,Z.y,k.x,k.y,F.x+F.width,F.y,F.x+F.width,F.y+F.height,!0)||Rq(Z.x,Z.y,k.x,k.y,F.x+F.width,F.y+F.height,F.x,F.y+F.height,!0)||Rq(Z.x,Z.y,k.x,k.y,F.x,F.y+F.height,F.x,F.y,!0)},Rq=function(z,x,Z,w,C,U,q,y,N){var a=(q-C)*(x-U)-(y-U)*(z-C),v=(y-U)*(Z-z)-(q-C)*(w-x);if(0!==v){var Y=a/v,d=z+Y*(Z-z),k=x+Y*(w-x);return N&&(d+Do<o(z,Z)||d-Do>V(z,Z)||d+Do<o(C,q)||d-Do>V(C,q)||k+Do<o(x,w)||k-Do>V(x,w)||k+Do<o(U,y)||k-Do>V(U,y))?S:[d,k]}return S},Fo=function(q,B,X){if(q&&X)if(B){if(B===tl)return q.getStyle(X);if(B===Fg)return q.getAttr(X);if(B===Mh)return q[X]}else if(X=lr(X),q[X])return q[X]();return d},$p=function(d,J,w,I){if(d&&w)if(J){if(J===tl)d.s(w,I);else if(J===Fg)d.a(w,I);else if(J===Mh){var O=d[w];d[w]=I,d.fp("f:"+w,O,I)}}else w=gb(w),d[w]&&d[w](I)},Jb=function(b,n,y){return n&&"top"!==n?"bottom"===n?{x:b.x,y:b.y,width:b.width,height:b.height*y}:"right"===n?{x:b.x,y:b.y,width:b.width*y,height:b.height}:"left"===n?{x:b.x+b.width*(1-y),y:b.y,width:b.width*y,height:b.height}:void 0:{x:b.x,y:b.y+b.height*(1-y),width:b.width,height:b.height*y}},Ui=function(O,q,u,Y,F){q&&Eh(O,u,Y,1,F,q)},Il=function(o,M,P,u){var T=1-o;return T*T*M+2*o*T*P+o*o*u},sl=function(w,U,d,q,s){var L=1-w;return L*L*L*U+3*L*L*w*d+3*L*w*w*q+w*w*w*s},qs=function(c){var Q,R,D,x,b=0;return c.forEach(function(V){if(Q=V.length,Q>0)for(R=V[0],x=1;Q>x;x++)D=V[x],b+=zq(R,D),R=D}),b},Re=function(b,H,c){var E="__"+b,R=function(D){c.disabled||c["handle_"+b](D)};c[E]||(c[E]=R,s(H,b,R))},cq=function(V,u,h){var y="__"+V,A=h[y];A&&(F(u,V,A),delete h[y])},sk=function(F,o){var $="_"+o;F[lr(o)]=function(){return this[$]},F[gb(o)]=function(D){var k=this[$];this[$]=D,this.fp(o,k,D)}},Sc=function(o){return G.create(o)},pe=function(F){if(!F.element){var M,g;(M=F.textField)?g=Mc(Mr.TextField,M):(M=F.textArea)?g=Mc(Mr.TextArea,M):(M=F.button)?g=Mc(Mr.Button,M):(M=F.comboBox)?g=Mc(Mr.ComboBox,M):(M=F.checkBox)?g=Mc(Mr.CheckBox,M):(M=F.radioButton)?g=Mc(Mr.RadioButton,M):(M=F.slider)?g=Mc(Mr.Slider,M):(M=F.colorPicker)?g=Mc(Mr.ColorPicker,M):(M=F.image)&&(g=Mc(Mr.Image,M)),g&&(F.element=g)}},Nm=function(J,F){var Y=Zj(J);return Y._ht=F,Y},Zj=function(Q,j){var P=l.createElement("div"),F=P.style;return P.tabIndex=-1,P.onkeydown=Ub,F.msTouchAction=jf,ls(P,S,0),xl&&F.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",S),Q&&(F.overflow=Ne),j&&lc(j,P),P},kr=function(R,B){var v=l.createElement("canvas"),P=v.style;return P.msTouchAction=jf,B||(P.pointerEvents=jf),ls(v,S,0),R&&lc(R,v),v},ls=function(J,n,A){var t=J.style;t.border=n?n+" solid 1px":0,t.outline=0,t.padding=A?"0 "+A+wo:0,nm(J)},nm=function(j){var h=j.style;h.position=Bg,h.margin=0,h.setProperty("box-sizing","border-box",S),h.setProperty("-moz-box-sizing","border-box",S)},fp=function(c,i,b,E){E||(E=pm),i!=S&&(c.width=i*E,c.style.width=i+wo),b!=S&&(c.height=b*E,c.style.height=b+wo)},lc=function(Y,c,y){Y.appendChild(c),y&&(c.style.position=Bg)},fs=function(N,R){R.split||(R+="");for(var t,f=R.split("\n"),M=0,y=f.length,B=0;y>B;B++){var m=rj(N.font,f[B]);m.width>M&&(M=m.width),t||(t=m.height)}return N.ss=f,{width:M,height:t*y}},kp=function(U,P,b,f,d,j){var k=P.length;if(1===k)$n(U,P[0],b,f,d);else for(var t=b.height/k,o={x:b.x,y:b.y,width:b.width,height:t},i=0;i<P.length;i++)j?Nl(U,P[i],f,d,o.x,o.y,o.width,o.height,j):$n(U,P[i],o,f,d),o.y+=t},$n=function(I,k,P,q,e){I.font=q?q:xc,I.fillStyle=e?e:Nc,I.textAlign=Sb,I.textBaseline=Bp;var R,z;P?P.width===d?(R=P.x,z=P.y):(R=P.x+P.width/2,z=P.y+P.height/2):(R=0,z=0),I.fillText(k,t(R),t(z))},Rm=function(e){e.getView&&(e=e.getView());var a=e.offsetWidth||e.scrollWidth;return!a&&e.style.width&&(a=$(e.style.width)),a},Qf=function(D){D.getView&&(D=D.getView());var l=D.offsetHeight||D.scrollHeight;return!l&&D.style.height&&(l=$(D.style.height)),l},ne=function(l,K,L){var C=K[0].toUpperCase()+K.substring(1,K.length);l["webkit"+C]=L,l["moz"+C]=L,l["ms"+C]=L,l["o"+C]=L,l[K]=L},ub=function(){var D=function(e){Ub(e),e.stopPropagation()},N=function(n){Ub(n)},p=xl?[vk]:[vb,Oh];return function(K,R){var _=Zj(),d=_.style;return d.backgroundColor=X.disabledBackground,K&&(d.backgroundImage="url("+K+")",d.backgroundPosition="50% 50%",d.backgroundRepeat="no-repeat no-repeat"),R===!1?p.forEach(function(Q){s(_,Q,N)}):p.forEach(function(c){s(_,c,D)}),_}}(),Md=function(I){var m=I.getContext("2d");return m.save(),m.lineCap=hk,m.lineJoin=Zc,m},hq=function(B,s,p,G){As(B,s*pm,p*pm),G*=pm,1!==G&&B.scale(G,G)},As=function(D,S,v){D.translate(S,v)},ap=function(c,F){F&&c.rotate(F)},ce=function(t,I,P){I===d&&(I=1),P===d&&(P=1),(1!==I||1!==P)&&t.scale(I,P)},Kr=!1,bd=function(Y){var _=l.activeElement;if(l.activeElement!==Y){_&&_.forceOnblur&&_.forceOnblur();for(var Z=[],g=Y.parentNode;g;)Z.push([g,g.scrollLeft,g.scrollTop]),g=g.parentNode;if(!Kr){var i=[],x=[];try{for(var s=E.parent,M=E;s!==M;)i.push([s,s.scrollX,s.scrollY]),M=s,s=E.parent;var f=E.frameElement;if(f)for(var O=f.parentNode;O;)x.push([O,O.scrollLeft,O.scrollTop]),O=O.parentNode}catch(U){Kr=!0}}if(xl)Y.focus();else{var B=Ng(),y=B.target;Y.focus(),y.scrollLeft=B.left,y.scrollTop=B.top}Z.forEach(function(y){y[0].scrollLeft=y[1],y[0].scrollTop=y[2]}),Kr||(i.forEach(function(M){M[0].scrollTo(M[1],M[2])}),x.forEach(function(c){c[0].scrollLeft=c[1],c[0].scrollTop=c[2]}))}},gp=function(d){return d&&d.getView?d.getView():d},Ap=function(v,Y,V,n,M){if(2===arguments.length&&(V=Y.y,n=Y.width,M=Y.height,Y=Y.x),v.isSelfViewEvent)v.setX(Y),v.setY(V),v.setWidth(n),v.setHeight(M);else{var T=gp(v),W=T.style;if((l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement||l.msFullscreenElement)!==T)Y!==d&&(W.left=Y+wo),V!==d&&(W.top=V+wo),n!==d&&(W.width=n+wo),M!==d&&(W.height=M+wo);else{var $=X.getWindowInfo();W.left=(Y=$.left)+wo,W.top=(V=$.top)+wo,W.width=(n=$.width)+wo,W.height=(M=$.height)+wo}v.endEditing&&!xl&&v.endEditing(),v.redraw&&v.redraw(),v.invalidate&&v.invalidate(),v.onLayouted&&v.onLayouted(Y,V,n,M),v.fireViewEvent&&v.fireViewEvent("layout")}},mr=function(S){if(!S.touches)return S;var v=S.touches[0];return v?v:S.changedTouches[0]},Jm=function(Z){return xl?mr(Z).target:Z.target},Rr=function(I){X.popup&&X.popup.close(),X.popup=I},Zp=S,sc=function(M){Zp.handleWindowTouchMove(M)},Hh=function(O){Zp.handleWindowTouchEnd(O),F(E,pc,sc),F(E,ik,Hh),Zp=S},Mm=function(k){Zp.handleWindowMouseMove(k)},Tn=function(y){Zp.handleWindowMouseUp(y),F(E,zk,Mm),F(E,ag,Tn),Zp=S},Zl=function(g){return 1===Bk(g)},en=function(u,x){return x?x.keyCode===u:hc[u]},sr=function(p){return nl(p)&&en(65,p)},bg=function(s){return en(46,s)||en(8,s)},cl=function(j){return function(S){return S?S.keyCode===j:hc[j]}},Rn=573,Og=[65,83,68,87,37,38,39,40,32,13,27],zi=cl(Og[0]),Ki=cl(Og[1]),se=cl(Og[2]),os=cl(Og[3]),ak=cl(Og[4]),Zh=cl(Og[5]),vj=cl(Og[6]),ff=cl(Og[7]),Aq=cl(Og[8]),jo=cl(Og[9]),_f=cl(Og[10]),sf={65:1,83:1,68:1,87:1,37:1,38:1,39:1,40:1},Fm=[2,2,2,2,2,2,2,2,2,2,3,3,3,3,5,5,5,5,5,5,1217],wr=S,tq=S,eg=function(M,i){wr||(wr=kr()),fp(wr,M,i,1);var v=Md(wr);return v.clearRect(0,0,M,i),v},_m=function(){var N,l={};for(var y in E){var p=gd.length;if(y.length==p&&y[0]===gd[2]&&y[1]===jf[1]&&y[4]===gd[3]&&y[5]===gd[4]&&y.substr(p-2)===jf[1]+jf[2]){var w=E[y];for(var B in w)B.length===p&&B.substr(0,3)===br[3]+li[3]+He[0]&&B.substr(p-2)===gd[0]+he[3]&&(yo=w[B])}}return function(d){var T,h=l[d];return h||(N||(N=kr(),fp(N,1,1,1)),T=N.getContext("2d"),T.clearRect(0,0,1,1),Eh(T,0,0,1,1,d),h=T.getImageData(0,0,1,1).data,h=l[d]=[h[0],h[1],h[2],h[3]]),h}}(),jb=function(B){if(!Gk(B))return B;var P=_m(B);return P.CA||(P.CA=[P[0]/255,P[1]/255,P[2]/255,P[3]/255]),P.CA},Kb=function(w,k,P,F,O){var m=kr();m.width=P,m.height=F;var n=m.getContext("2d");n.drawImage(w,0,0,P,F);try{for(var z=n.getImageData(0,0,P,F),B=z.data,V=0,c=B.length;c>V;V+=4){var G=B[V+0],T=B[V+1],f=B[V+2],K=B[V+3];"override_a"===O?B[V+3]=255*k[3]:"override_rgb"===O?(B[V+0]=255*k[0],B[V+1]=255*k[1],B[V+2]=255*k[2]):"override"===O?(B[V+0]=255*k[0],B[V+1]=255*k[1],B[V+2]=255*k[2],B[V+3]=255*k[3]):(B[V+0]=k[0]*G,B[V+1]=k[1]*T,B[V+2]=k[2]*f,B[V+3]=k[3]*K)}n.putImageData(z,0,0)}catch(M){return w}return m},db=function(o,Q,x){return Q&&(Q="miter"===x?8*Q+20:Q+1,o&&Vo(o,Q)),Q},Vh=function(U,o){if(o){var g=new ye(o),R=U.width/2,A=U.height/2,h=Mn([g.tf(-R,-A),g.tf(R,-A),g.tf(R,A),g.tf(-R,A)]);return h.x+=U.x+R,h.y+=U.y+A,h}return U},vl=function(X,A,p,$,o,g,S,s){$*=Math.PI/180;var E={x:Math.cos($)*(X.x-S.x)/2+Math.sin($)*(X.y-S.y)/2,y:-Math.sin($)*(X.x-S.x)/2+Math.cos($)*(X.y-S.y)/2},d=Math.pow(E.x,2)/Math.pow(A,2)+Math.pow(E.y,2)/Math.pow(p,2);d>1&&(A*=Math.sqrt(d),p*=Math.sqrt(d));var K=(o==g?-1:1)*Math.sqrt((Math.pow(A,2)*Math.pow(p,2)-Math.pow(A,2)*Math.pow(E.y,2)-Math.pow(p,2)*Math.pow(E.x,2))/(Math.pow(A,2)*Math.pow(E.y,2)+Math.pow(p,2)*Math.pow(E.x,2)));isNaN(K)&&(K=0);var L={x:K*A*E.y/p,y:K*-p*E.x/A},C={x:(X.x+S.x)/2+Math.cos($)*L.x-Math.sin($)*L.y,y:(X.y+S.y)/2+Math.sin($)*L.x+Math.cos($)*L.y},F=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},w=function(z,A){return(z[0]*A[0]+z[1]*A[1])/(F(z)*F(A))},h=function(N,G){return(N[0]*G[1]<N[1]*G[0]?-1:1)*Math.acos(w(N,G))},T=h([1,0],[(E.x-L.x)/A,(E.y-L.y)/p]),m=[(E.x-L.x)/A,(E.y-L.y)/p],x=[(-E.x-L.x)/A,(-E.y-L.y)/p],Y=h(m,x);w(m,x)<=-1&&(Y=Math.PI),w(m,x)>=1&&(Y=0);var w=A>p?A:p,G=A>p?1:A/p,R=A>p?p/A:1;if(null==s){var t={x:0,y:0,width:0,height:0};Vo(t,w),t.x*=G,t.width*=G,t.y*=R,t.height*=R;var l=new ye($);return t=Mn([l.tf(t.x,t.y),l.tf(t.x+t.width,t.y),l.tf(t.x+t.width,t.y+t.height),l.tf(t.x,t.y+t.height)]),t.x+=C.x,t.y+=C.y,[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}]}s.translate(C.x,C.y),s.rotate($),s.scale(G,R),s.arc(0,0,w,T,T+Y,1-g),s.scale(1/G,1/R),s.rotate(-$),s.translate(-C.x,-C.y)},Nf=function(J,E){J&&J.beginPath();for(var p,Q,s,x=[],k=function(o){for(var w,r=/(\-{0,1}[\d\.]+)/gi,n=[];w=r.exec(o);)n.push(parseFloat(w[0]));return n},l=/([MmLlHhVvCcSsQqTtAa]{1}[\d\.,\s\-Zz]*)/gi,z={x:0,y:0};p=l.exec(E);){var b=p[0],G=b.substr(0,1);if("M"===G||"m"===G){for(var B=k(b),M=0;M<B.length;M+=2){var d=B[M],y=B[M+1];"m"===G&&(d+=z.x,y+=z.y),J&&J.moveTo(d,y),x.push({x:d,y:y}),z.x=d,z.y=y}Q=s=null}else if("H"===G||"h"===G){for(var B=k(b),M=0;M<B.length;M+=1){var d=B[M];"h"===G&&(d+=z.x),J&&J.lineTo(d,z.y),x.push({x:d,y:z.y}),z.x=d}Q=s=null}else if("C"===G||"c"===G){for(var B=k(b),M=0;M<B.length;M+=6){var D=B[M],I=B[M+1],U=B[M+2],r=B[M+3],d=B[M+4],y=B[M+5];"c"===G&&(D+=z.x,I+=z.y,U+=z.x,r+=z.y,d+=z.x,y+=z.y),J&&J.bezierCurveTo(D,I,U,r,d,y),x.push({x:D,y:I}),x.push({x:U,y:r}),x.push({x:d,y:y}),z.x=d,z.y=y}Q=[D,I,U,r,d,y],s=null}else if("S"===G||"s"===G){for(var B=k(b),M=0;M<B.length;M+=4){var D,I;Q?(D=2*Q[4]-Q[2],I=2*Q[5]-Q[3]):(D=z.x,I=z.y);var U=B[M],r=B[M+1],d=B[M+2],y=B[M+3];"s"===G&&(U+=z.x,r+=z.y,d+=z.x,y+=z.y),J&&J.bezierCurveTo(D,I,U,r,d,y),x.push({x:D,y:I}),x.push({x:U,y:r}),x.push({x:d,y:y}),z.x=d,z.y=y}Q=[D,I,U,r,d,y],s=null}else if("Q"===G||"q"===G){for(var B=k(b),M=0;M<B.length;M+=4){var D=B[M],I=B[M+1],d=B[M+2],y=B[M+3];"q"===G&&(D+=z.x,I+=z.y,d+=z.x,y+=z.y),J&&J.quadraticCurveTo(D,I,d,y),x.push({x:D,y:I}),x.push({x:d,y:y}),z.x=d,z.y=y}Q=null,s=[D,I,d,y]}else if("T"===G||"t"===G){for(var B=k(b),M=0;M<B.length;M+=2){var D,I;s?(D=2*s[2]-s[0],I=2*s[3]-s[1]):(D=z.x,I=z.y);var d=B[M],y=B[M+1];"t"===G&&(d+=z.x,y+=z.y),J&&J.quadraticCurveTo(D,I,d,y),x.push({x:D,y:I}),x.push({x:d,y:y}),z.x=d,z.y=y}Q=null,s=[D,I,d,y]}else if("V"===G||"v"===G){for(var B=k(b),M=0;M<B.length;M+=1){var y=B[M];"v"===G&&(y+=z.y),J&&J.lineTo(z.x,y),x.push({x:z.x,y:y}),z.y=y}Q=s=null}else if("L"===G||"l"===G){for(var B=k(b),M=0;M<B.length;M+=2){var d=B[M],y=B[M+1];"l"===G&&(d+=z.x,y+=z.y),J&&J.lineTo(d,y),x.push({x:d,y:y}),z.x=d,z.y=y}Q=s=null}else if("A"===G||"a"===G){for(var B=k(b),M=0;M<B.length;M+=7){var n=B[M],$=B[M+1],m=B[M+2],g=B[M+3],_=B[M+4],d=B[M+5],y=B[M+6];"a"===G&&(d+=z.x,y+=z.y);var K=vl(z,n,$,m,g,_,{x:d,y:y},J);K&&(x=x.concat(K)),z.x=d,z.y=y}Q=s=null}var c=b.substr(b.length-1);("z"===c||"Z"===c)&&J&&J.closePath()}return x},Tb=function(o,u){var j,y,B="L"===u[0],P=u.length;o.save(),B?(o.transform(u[5],u[6],u[7],u[8],u[9],u[10]),j=o.createLinearGradient(u[1],u[2],u[3],u[4]),y=11):(o.transform(u[7],u[8],u[9],u[10],u[11],u[12]),j=o.createRadialGradient(u[1],u[2],u[3],u[4],u[5],u[6]),y=13);for(var d=o.compGray;P>y;)j.addColorStop(u[y],d?X.toGrayColor(u[y+1]):u[y+1]),y+=2;o.fillStyle=j},Tq=function(N,P){var J=N.s("shape.gradient.pack");if(J){for(var D=J.length,b=new Array(D),B=0;D>B;B++)b[B]=J[B];var w,V,A,g,W,n,Y,e,r,s,c,x,R,v="L"===b[0];w=v?5:7,V=b[w],A=b[w+1],g=b[w+2],W=b[w+3],n=b[w+4],Y=b[w+5],e=P[0],r=P[1],s=P[2],c=P[3],x=P[4],R=P[5],b[w]=e*V+s*A,b[w+1]=r*V+c*A,b[w+2]=e*g+s*W,b[w+3]=r*g+c*W,b[w+4]=e*n+s*Y+x,b[w+5]=r*n+c*Y+R,N.s("shape.gradient.pack",b)}},$f=function(Y,I,B,E){var K=!1;if(Y.beginPath?Y.beginPath():K=!0,dm(I)&&(I=I._as),dm(B)&&(B=B._as),B&&B.length){for(var x,A,g,p,y=0,a=0,r=B.length;r>a;a++)x=B[a],1===x?(A=I[y++],Y.moveTo(A.x,K?-A.y:A.y)):2===x?(A=I[y++],Y.lineTo(A.x,K?-A.y:A.y)):3===x?(A=I[y++],g=I[y++],Y.quadraticCurveTo(A.x,K?-A.y:A.y,g.x,K?-g.y:g.y)):4===x?(A=I[y++],g=I[y++],p=I[y++],Y.bezierCurveTo(A.x,K?-A.y:A.y,g.x,K?-g.y:g.y,p.x,K?-p.y:p.y)):5===x&&Y.closePath();E&&5!==x&&Y.closePath()}else{var z,N,T,F=I.length;if(F>0){for(z=I[0],Y.moveTo(z.x,K?-z.y:z.y),N=1;F>N;N++)T=I[N],Y.lineTo(T.x,K?-T.y:T.y);E&&Y.closePath()}}},ge=function(Y,L,w,$){if(dm(Y)&&(Y=Y._as),dm(L)&&(L=L._as),L&&L.length){w=w||Qd;for(var N,c,k,d,V,v,r,X,t=[],T=S,W=0,p=0,f=L.length;f>p;p++)if(N=L[p],1===N)t.push(T=[]),T.push(Y[W++]);else if(2===N)T.push(Y[W++]);else if(3===N){for(c=T[T.length-1],k=Y[W++],d=Y[W++],v=1;w>v;v++)r=Il(v/w,c.x,k.x,d.x),X=Il(v/w,c.y,k.y,d.y),T.push({x:r,y:X,b:!0});T.push(d)}else if(4===N){for(c=T[T.length-1],k=Y[W++],d=Y[W++],V=Y[W++],v=1;w>v;v++)r=sl(v/w,c.x,k.x,d.x,V.x),X=sl(v/w,c.y,k.y,d.y,V.y),T.push({x:r,y:X,b:!0});T.push(V)}else 5===N&&T.push(T[0]);return $&&5!==N&&T&&T.length>2&&T.push(T[0]),t}return $&&Y.length>2&&(Y=Y.slice(),Y.push(Y[0])),Y?[Y]:[]},bf=function(y,D,r,d,R,W){var b,E,l,J=_m(D),N=d,g=J[0],n=J[1],C=J[2];if(r){var L=_m(r);b=L[0]-g,E=L[1]-n,l=L[2]-C}else b=255-g,E=255-n,l=255-C;for(W||(W=d>10?1:.5,W=1>R?o(W/R,2):W),y.save(),y.shadowOffsetX=0,y.shadowOffsetY=0,y.shadowBlur=0,y.shadowColor=0;(d-=W)>0;){var Y=1-d/N,q=g+b*Y,e=n+E*Y,f=C+l*Y;q=o(w(q),255),e=o(w(e),255),f=o(w(f),255),y.strokeStyle="rgb("+q+","+e+","+f+")",y.lineWidth=d,y.stroke()}y.restore()},Cr=function(){var u={};return function(l,Q){var n=l+"-"+Q,q=u[n];if(q)return q;var d,B,W,P=_m(l);return 0>Q?(Q=(100+Q)/100,d=w(P[0]*Q),B=w(P[1]*Q),W=w(P[2]*Q)):(Q/=100,d=P[0],B=P[1],W=P[2],d+=(255-d)*Q,B+=(255-B)*Q,W+=(255-W)*Q,d=o(w(d),255),B=o(w(B),255),W=o(w(W),255)),u[n]="rgb("+d+","+B+","+W+")"}}(),Eh=function(i,W,H,A,t,z){z&&(i.fillStyle=z),i.beginPath(),i.rect(W,H,A,t),i.fill()},Lg=function(y,C,j,I,J,K,Y){y.beginPath(),Jh[C](y,j.x,j.y,j.width,j.height,I,J,K,Y)},Rb=function(w,y,W,X,z){var A=Jh[W];w.fillStyle=A?A(w,y,X?X:np,z.x,z.y,z.width,z.height):y},er=function(f,v,i,C,g,L){try{if(!v.tagName&&v.comps){v._cacheImage_||(v._cacheImage_={});var T;T="override"===C?"colors_override":"override_rgb"===C?"colors_override_rgb":"override_a"===C?"colors_override_a":"colors",v._cacheImage_[T]||(v._cacheImage_[T]={__count__:0});var I=v._cacheImage_[T][i];I||(v._cacheImage_[T].__count__>X.imageCacheThreshold&&(v._cacheImage_[T]={__count__:0}),I=W.Default.toCanvas(v,xq(v),ze(v),null,g,L,i,null,C),v._cacheImage_[T][i]=I,v._cacheImage_[T].__count__++),v=I}f.fillStyle=f.createPattern(v,"repeat")}catch(F){f.fillStyle="black"}},fr=function(D,j,_,N,Y,p,t){D.save(),D.translate(j,_),D.scale(1,t/p),D.arc(0,0,p,N,Y),D.restore()},Ic=function($,R,S,h,z,x,O,Z){var X,J,A,t,Q,G,b,n,N,F,m;if(M(z)>2*u&&(z=2*u),Q=w(M(z)/(u/4)),X=z/Q,J=-X,A=-h,Q>0){G=R+k(h)*x,b=S+L(-h)*O,Z?$.lineTo(G,b):$.moveTo(G,b);for(var _=0;Q>_;_++)A+=J,t=A-J/2,n=R+k(A)*x,N=S+L(A)*O,F=R+k(t)*(x/k(J/2)),m=S+L(t)*(O/k(J/2)),$.quadraticCurveTo(F,m,n,N)}},Ik=function(k,A,L,g,d,z,j,t,T){6===arguments.length&&(j=z,t=z,T=z);var m=A+g,C=L+d,S=d>g?2*g:2*d;z=S>z?z:S,j=S>j?j:S,t=S>t?t:S,T=S>T?T:S;var r=.29*T,e=.58*T;k.moveTo(m,C-T),k.quadraticCurveTo(m,C-e,m-r,C-r),k.quadraticCurveTo(m-e,C,m-T,C),r=.29*t,e=.58*t,k.lineTo(A+t,C),k.quadraticCurveTo(A+e,C,A+r,C-r),k.quadraticCurveTo(A,C-e,A,C-t),r=.29*z,e=.58*z,k.lineTo(A,L+z),k.quadraticCurveTo(A,L+e,A+r,L+r),k.quadraticCurveTo(A+e,L,A+z,L),r=.29*j,e=.58*j,k.lineTo(m-j,L),k.quadraticCurveTo(m-e,L,m-r,L+r),k.quadraticCurveTo(m,L+e,m,L+j),k.lineTo(m,C-T)},uc=function(g,i,O,D,B,b,d){i&&(O=t(O),D=t(D),d||(d=1),g.fillStyle=i,g.beginPath(),g.rect(O,D,d,b),g.rect(O,D,B,d),b-d>0&&g.rect(O,D+b-d,B,d),B-d>0&&g.rect(O+B-d,D,d,b),g.fill())},Pd=function(R,t,U,f){var X=f.x,y=f.y,e=f.width,k=f.height;if(!(!t||!U||0>=e||0>=k)){var E,s=_o(t),Q=zb(t),i=U>0;1===U||-1===U?(R.fillStyle=i?s:Q,R.beginPath(),R.rect(X,y,1,k),R.rect(X,y,e,1),R.fill(),R.fillStyle=i?Q:s,R.beginPath(),R.rect(X,y+k-1,e,1),R.rect(X+e-1,y,1,k),R.fill()):(U=o(M(U),o(e/2,k/2)),E=R.createLinearGradient(X,y,X+U,y),E.addColorStop(0,i?s:Q),E.addColorStop(1,t),R.fillStyle=E,R.beginPath(),R.moveTo(X,y),R.lineTo(X+U,y+U),R.lineTo(X+U,y+k-U),R.lineTo(X,y+k),R.lineTo(X,y),R.fill(),E=R.createLinearGradient(X,y,X,y+U),E.addColorStop(0,i?s:Q),E.addColorStop(1,t),R.fillStyle=E,R.beginPath(),R.moveTo(X,y),R.lineTo(X+U,y+U),R.lineTo(X+e-U,y+U),R.lineTo(X+e,y),R.lineTo(X,y),R.fill(),E=R.createLinearGradient(X,y+k,X,y+k-U),E.addColorStop(0,i?Q:s),E.addColorStop(1,t),R.fillStyle=E,R.beginPath(),R.moveTo(X,y+k),R.lineTo(X+U,y+k-U),R.lineTo(X+e-U,y+k-U),R.lineTo(X+e,y+k),R.lineTo(X,y+k),R.fill(),E=R.createLinearGradient(X+e,y,X+e-U,y),E.addColorStop(0,i?Q:s),E.addColorStop(1,t),R.fillStyle=E,R.beginPath(),R.moveTo(X+e,y),R.lineTo(X+e-U,y+U),R.lineTo(X+e-U,y+k-U),R.lineTo(X+e,y+k),R.lineTo(X+e,y),R.fill())}},qq=function(X,p,d,e,n,t,x){var I=X.createLinearGradient(e,n,t,x);return I.addColorStop(0,d),I.addColorStop(1,p),I},Gf=function(y,O,Z,o,s,D,g){var a=y.createLinearGradient(o,s,D,g);return a.addColorStop(0,O),a.addColorStop(.5,Z),a.addColorStop(1,O),a},lq=function(l,Y,P,A,c,B,I){var Q=l.createLinearGradient(A,c,B,I);return Q.addColorStop(0,Y),Q.addColorStop(1/3,P),Q.addColorStop(2/3,Y),Q.addColorStop(1,P),Q},fk=function(x,i,l,W,p,_,m,G,J){var y=x.createRadialGradient(W+_*G,p+m*J,o(_,m)/24,W+_/2,p+m/2,V(_,m)/2);return y.addColorStop(0,l),y.addColorStop(1,i),y},jj=[0,-1,.22451398828979272,-.30901699437494734,.9510565162951535,-.30901699437494745,.3632712640026804,.11803398874989468,.5877852522924731,.8090169943749473,-1.1102230246251565e-16,.38196601125010515,-.587785252292473,.8090169943749475,-.3632712640026805,.1180339887498949,-.9510565162951536,-.3090169943749473,-.22451398828979285,-.30901699437494734],Jh={polygon:function(_,m,v,l,e,a){(a==S||3>a)&&(a=6);for(var b,G,H=o(l,e)/2,g=m+l/2,T=v+e/2,J=0,C=2*u/a,K=0;a>K;K++)b=g+k(J)*H,G=T+L(J)*H,0===K?_.moveTo(b,G):_.lineTo(b,G),J+=C;_.closePath()},arc:function(J,O,s,M,K,U,d,e,q){U==S&&(U=u),d==S&&(d=m),e==S&&(e=!0);
var V=O+M/2,f=s+K/2;e&&J.moveTo(V,f),q?fr(J,V,f,U,d,M/2,K/2):J.arc(V,f,o(M,K)/2,U,d),e&&J.closePath()},rect:function(M,f,n,z,e){M.rect(f,n,z,e)},circle:function(s,x,z,i,k){s.arc(x+i/2,z+k/2,o(i,k)/2,0,m,!0)},oval:function(i,U,t,r,O){fr(i,U+r/2,t+O/2,0,m,r/2,O/2)},roundRect:function(F,c,$,n,Q,b){b==S&&(b=o(o(n,Q)/4,8)),Ik(F,c,$,n,Q,b)},star:function(z,n,B,J,E){var w=2*J,x=2*E,O=n+J/2,o=B+E/2;z.moveTo(O-w/4,o-x/12),z.lineTo(n+.306*J,B+.579*E),z.lineTo(O-w/6,o+x/4),z.lineTo(n+J/2,B+.733*E),z.lineTo(O+w/6,o+x/4),z.lineTo(n+.693*J,B+.579*E),z.lineTo(O+w/4,o-x/12),z.lineTo(n+.611*J,B+.332*E),z.lineTo(O+0,o-x/4),z.lineTo(n+.388*J,B+.332*E),z.closePath()},pentagram:function(A,E,X,z,b){var S=.5*b,j=E+.5*z,i=X+S,F=.5257311121191336*z;F>S&&(F=S);var V=jj,Q=0;for(A.moveTo(j+F*V[Q++],i+F*V[Q++]);20>Q;)A.lineTo(j+F*V[Q++],i+F*V[Q++]);A.closePath()},triangle:function(d,V,u,H,c){d.moveTo(V+H/2,u),d.lineTo(V+H,u+c),d.lineTo(V,u+c),d.closePath()},hexagon:function(Z,I,X,q,F){Z.moveTo(I,X+F/2),Z.lineTo(I+q/4,X+F),Z.lineTo(I+3*q/4,+X+F),Z.lineTo(I+q,X+F/2),Z.lineTo(I+3*q/4,X),Z.lineTo(I+q/4,X),Z.closePath()},pentagon:function(i,P,e,H,S){var Y=2*H,y=2*S,q=P+H/2,I=e+S/2;i.moveTo(q-Y/4,I-y/12),i.lineTo(q-Y/6,I+y/4),i.lineTo(q+Y/6,I+y/4),i.lineTo(q+Y/4,I-y/12),i.lineTo(q+0,I-y/4),i.closePath()},diamond:function(A,M,o,t,h){A.moveTo(M+t/2,o),A.lineTo(M,o+h/2),A.lineTo(M+t/2,o+h),A.lineTo(M+t,o+h/2),A.closePath()},rightTriangle:function(G,B,n,k,Q){G.moveTo(B,n),G.lineTo(B+k,n+Q),G.lineTo(B,n+Q),G.closePath()},parallelogram:function(O,f,Q,y,o){var X=y/4;O.moveTo(f+X,Q),O.lineTo(f+y,Q),O.lineTo(f+y-X,Q+o),O.lineTo(f,Q+o),O.closePath()},trapezoid:function(h,D,U,c,l){var P=c/4;h.moveTo(D+P,U),h.lineTo(D+c-P,U),h.lineTo(D+c,U+l),h.lineTo(D,U+l),h.closePath()},"linear.southwest":function(i,A,k,B,x,y,F){return qq(i,A,k,B,x+F,B+y,x)},"linear.southeast":function(R,L,Z,x,z,A,w){return qq(R,L,Z,x+A,z+w,x,z)},"linear.northwest":function(V,x,w,r,g,v,Z){return qq(V,x,w,r,g,r+v,g+Z)},"linear.northeast":function(j,E,N,v,D,r,e){return qq(j,E,N,v+r,D,v,D+e)},"linear.north":function(N,H,T,Y,d,l,q){return qq(N,H,T,Y,d,Y,d+q)},"linear.south":function(r,W,C,t,k,M,d){return qq(r,W,C,t,k+d,t,k)},"linear.west":function(b,o,j,a,S,B){return qq(b,o,j,a,S,a+B,S)},"linear.east":function(L,Y,N,U,B,R){return qq(L,Y,N,U+R,B,U,B)},"radial.center":function($,j,B,J,H,y,G){return fk($,j,B,J,H,y,G,.5,.5)},"radial.southwest":function(F,Z,u,$,P,C,t){return fk(F,Z,u,$,P,C,t,.25,.75)},"radial.southeast":function(E,L,i,b,n,T,m){return fk(E,L,i,b,n,T,m,.75,.75)},"radial.northwest":function(x,j,e,N,g,z,F){return fk(x,j,e,N,g,z,F,.25,.25)},"radial.northeast":function(a,B,D,c,P,R,W){return fk(a,B,D,c,P,R,W,.75,.25)},"radial.north":function(D,C,Z,B,O,u,H){return fk(D,C,Z,B,O,u,H,.5,.25)},"radial.south":function(d,x,V,b,g,p,r){return fk(d,x,V,b,g,p,r,.5,.75)},"radial.west":function($,K,q,Z,p,B,V){return fk($,K,q,Z,p,B,V,.25,.5)},"radial.east":function(u,C,v,k,p,G,N){return fk(u,C,v,k,p,G,N,.75,.5)},"spread.horizontal":function(e,K,D,X,V,k){return Gf(e,K,D,X,V,X+k,V)},"spread.vertical":function(D,A,R,w,J,P,x){return Gf(D,A,R,w,J,w,J+x)},"spread.diagonal":function(j,V,y,O,G,p,F){return Gf(j,V,y,O+p,G,O,G+F)},"spread.antidiagonal":function(Z,N,I,h,B,o,n){return Gf(Z,N,I,h,B,h+o,B+n)},"spread.north":function(Q,y,h,I,x,V,w){return lq(Q,y,h,I,x-w/4,I,x+w+w/4)},"spread.south":function(R,S,D,N,f,H,c){return lq(R,D,S,N,f-c/4,N,f+c+c/4)},"spread.west":function(_,I,s,F,P,e){return lq(_,I,s,F-e/4,P,F+e+e/4,P)},"spread.east":function(l,n,o,Y,t,h){return lq(l,o,n,Y-h/4,t,Y+h+h/4,t)}},yl=function(K,b,d){return new ye(K).tf(b,d)},co=function(P){var T=P.touches[0],F=P.touches[1],I=T.clientX,z=T.clientY,b=F.clientX,g=F.clientY;return _((I-b)*(I-b)+(z-g)*(z-g))},Fq=(function(){for(var f=0,D=Th.split(""),F=0;F<D.length;F++)f=10*$(D[F])+f;return Dl(E[Rn.toString(8*F)+Fn.substr(F)+3],E[Rn.toString(8*F)+Fn.substr(F)+4]),f}(),function(D,g,R){for(var L=0;L<R.size();L++){var x=R.get(L);D.co(x)&&g.add(x)}for(L=0;L<R.size();L++)x=R.get(L),Fq(D,g,x._children)}),Ep=function(s,c,O){for(var F=0;F<O.size();F++){var m=O.get(O.size()-1-F);s.co(m)&&c.add(m)}for(F=0;F<O.size();F++)m=O.get(F),Ep(s,c,m._children)},Rp=function(S,V,q){for(var R=!1,g=0;g<q.size();g++){var C=q.get(g);S.co(C)?R&&V.add(C):R=1}for(g=0;g<q.size();g++)C=q.get(g),Rp(S,V,C._children)},Af=function(_,F,A){for(var m=!1,y=0;y<A.size();y++){var g=A.get(A.size()-1-y);_.co(g)?m&&F.add(g):m=!0}for(y=0;y<A.size();y++)g=A.get(y),Af(_,F,g._children)},Bc=X.moveDatas=function(V,R,p,f){var J=f==S;if(0!==R||0!==p||!J&&0!==f){var C=!0,L=[];if(V.forEach(function(p){C&&(p._69O||Ud(p)||Kk(p))&&(C=!1)}),C)L=V;else{var F={},H={};V.forEach(function(Q){F[Q._id]=!0});var o={},s=function(E){var q=E._id;return F[q]?(L.push(E),o[q]=!0):o[q]=!1},G=function(m){var l=m._id;if(H[l])return s(m);var y=o[l];if(y!==d)return y;var i=m._parent;if(i&&(Kk(i)||Ud(i))&&G(i))return o[l]=!0;var W=m._host;return W&&(H[l]=l,y=G(W),H[l]=d,y)?o[l]=!0:s(m)};V.forEach(function(I){G(I)})}L.forEach(function(G){if(zm(G))J?G.translate(R,p):G.translate3d(R,p,f);else{var a=G.s(Ab);if(!a||a.isEmpty())return;var d=new Kf;a.each(function(V){V=or(V),J?(V.x+=R,V.y+=p):(V.x+=R,V.y+=f,V.e==S?V.e=p:V.e+=p),d.add(V)}),G.s(Ab,d)}})}},Eg=function(){function U(l,K){return K===l.substring(0,K.length)?!0:!1}function V(j){return parseFloat(j)||0}function M(N,K){if(K==d&&(K=new Fl),U(N,"matrix3d")){var o=N.substring(9,N.length-1).split(",");o=o.map(V),K.fromArray(o)}else if(U(N,"matrix")){var o=N.substring(7,N.length-1).split(",");o=o.map(V),K.el[0]=o[0],K.el[1]=o[1],K.el[2]=0,K.el[3]=0,K.el[4]=o[2],K.el[5]=o[3],K.el[6]=0,K.el[7]=0,K.el[8]=0,K.el[9]=0,K.el[10]=1,K.el[11]=0,K.el[12]=o[4],K.el[13]=o[5],K.el[14]=0,K.el[15]=1}return K}function L(v,S){S==d&&(S=new Ob);var B=v.split(/\s+/);return B=B.map(V),S.set(B[0]||0,B[1]||0,B[2]||0),S}var e,G,O,x,T,q=function(J,U){e||(e=new Fl,G=new Ob,O=new Fl,x=new Fl,T=new Fl),U==d&&(U=new Fl);var s=getComputedStyle(J);s.transform&&"none"!==s.transform&&(M(s.transform,e),L(s.transformOrigin,G),x.setPosition(G),G.negate(),T.setPosition(G),(bl||"preserve-3d"!==s.transformStyle)&&(e.el[8]=0,e.el[9]=0,e.el[10]=1,e.el[11]=0),U.multiplyMatrices(T,U),U.multiplyMatrices(e,U),U.multiplyMatrices(x,U)),!bl&&s.perspective&&"none"!==s.perspective&&(O.el[11]=-1/V(s.perspective),L(s.perspectiveOrigin,G),x.setPosition(G),G.negate(),T.setPosition(G),U.multiplyMatrices(T,U),U.multiplyMatrices(O,U),U.multiplyMatrices(x,U));for(var i=J.offsetParent,z=J.offsetLeft,S=J.offsetTop,r=J.parentElement;r&&r!==i;){var m=getComputedStyle(r);if("none"!==m.transform||"none"!==m.perspective)break;r=r.parentElement}return r==d&&J!==J.ownerDocument.documentElement&&"fixed"!==s.position&&(r=J.ownerDocument.documentElement),i!=d&&i!==r&&(z-=r.offsetLeft,S-=r.offsetTop),G.set(z,S,0),x.setPosition(G),U.multiplyMatrices(x,U),r&&q(r,U),U};return function(n,P){var c=n.parentElement;if(c){var Y=c.updateAppendMatrix;if(Y){delete c.updateAppendMatrix;var D=new Fl;q(c,D);var X=new Fl;X.getInverse(D),c._matrixAppend=X,c._maxrixPreAppend=D}return P?c._matrixAppend:c._maxrixPreAppend}}}(),Tf=function(u,B){for(;u&&!u.hasOwnProperty(B);)u=G.getPrototypeOf(u);return u&&G.getOwnPropertyDescriptor(u,B)},Sm=G.getPrototypeOf?function(x,r,e){var z=Tf(r,e);z&&G.defineProperty(x,e,z)}:function(h,T,r){h[r]=T[r]},yj={1:29,2:30,3:31,4:32,5:33,6:26,7:27,8:28,9:21,10:22,11:23,12:24,13:25,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:9,22:10,23:11,24:12,25:13,26:6,27:7,28:8,29:1,30:2,31:3,32:4,33:5,34:36,35:37,36:34,37:35,38:54,39:55,40:52,41:53,42:50,43:51,44:49,50:42,51:43,52:40,53:41,54:38,55:39},_l=function(){var H={1:function(b,t){return{x:b.x-t.width/2,y:b.y-t.height/2}},2:function(K,M){return{x:K.x+M.width/2,y:K.y-M.height/2}},3:function(C,B){return{x:C.x+C.width/2,y:C.y-B.height/2}},4:function(B,p){return{x:B.x+B.width-p.width/2,y:B.y-p.height/2}},5:function(W,y){return{x:W.x+W.width+y.width/2,y:W.y-y.height/2}},6:function(q){return{x:q.x,y:q.y}},7:function(r){return{x:r.x+r.width/2,y:r.y}},8:function(f){return{x:f.x+f.width,y:f.y}},9:function(G,y){return{x:G.x-y.width/2,y:G.y+y.height/2}},10:function(L,N){return{x:L.x+N.width/2,y:L.y+N.height/2}},11:function(B,$){return{x:B.x+B.width/2,y:B.y+$.height/2}},12:function(m,e){return{x:m.x-e.width/2+m.width,y:m.y+e.height/2}},13:function(g,r){return{x:g.x+g.width+r.width/2,y:g.y+r.height/2}},14:function(f,q){return{x:f.x-q.width/2,y:f.y+f.height/2}},15:function(y){return{x:y.x,y:y.y+y.height/2}},16:function(a,b){return{x:a.x+b.width/2,y:a.y+a.height/2}},17:function(d){return{x:d.x+d.width/2,y:d.y+d.height/2}},18:function(j,E){return{x:j.x+j.width-E.width/2,y:j.y+j.height/2}},19:function(I){return{x:I.x+I.width,y:I.y+I.height/2}},20:function(l,a){return{x:l.x+l.width+a.width/2,y:l.y+l.height/2}},21:function(c,Z){return{x:c.x-Z.width/2,y:c.y+c.height-Z.height/2}},22:function(z,F){return{x:z.x+F.width/2,y:z.y+z.height-F.height/2}},23:function(G,e){return{x:G.x+G.width/2,y:G.y+G.height-e.height/2}},24:function(N,P){return{x:N.x+N.width-P.width/2,y:N.y+N.height-P.height/2}},25:function(J,H){return{x:J.x+J.width+H.width/2,y:J.y+J.height-H.height/2}},26:function(M){return{x:M.x,y:M.y+M.height}},27:function(S){return{x:S.x+S.width/2,y:S.y+S.height}},28:function(R){return{x:R.x+R.width,y:R.y+R.height}},29:function(j,L){return{x:j.x-L.width/2,y:j.y+j.height+L.height/2}},30:function(G,z){return{x:G.x+z.width/2,y:G.y+G.height+z.height/2}},31:function(U,$){return{x:U.x+U.width/2,y:U.y+U.height+$.height/2}},32:function(c,i){return{x:c.x+c.width-i.width/2,y:c.y+c.height+i.height/2}},33:function(P,M){return{x:P.x+P.width+M.width/2,y:P.y+P.height+M.height/2}},34:function(W,C){return{x:W.x,y:W.y-C.height/2}},35:function(M,T){return{x:M.x+M.width,y:M.y-T.height/2}},36:function(o,u){return{x:o.x,y:o.y+o.height+u.height/2}},37:function(z,q){return{x:z.x+z.width,y:z.y+z.height+q.height/2}},38:function(a,v){return{x:a.x+a.width/4,y:a.y-v.height/2}},39:function(W,b){return{x:W.x+3*W.width/4,y:W.y-b.height/2}},40:function(U){return{x:U.x+U.width/4,y:U.y}},41:function(X){return{x:X.x+3*X.width/4,y:X.y}},42:function(Y,T){return{x:Y.x+Y.width/4,y:Y.y+T.height/2}},43:function(z,v){return{x:z.x+3*z.width/4,y:z.y+v.height/2}},44:function(V,C){return{x:V.x+V.width/2,y:V.y+V.height/2-C.height/2}},45:function(k){return{x:k.x+k.width/4,y:k.y+k.height/2}},46:function(A,d){return{x:A.x+A.width/2-d.width/2,y:A.y+A.height/2}},47:function(N,x){return{x:N.x+N.width/2+x.width/2,y:N.y+N.height/2}},48:function(L){return{x:L.x+3*L.width/4,y:L.y+L.height/2}},49:function(y,h){return{x:y.x+y.width/2,y:y.y+y.height/2+h.height/2}},50:function(C,s){return{x:C.x+C.width/4,y:C.y+C.height-s.height/2}},51:function(e,A){return{x:e.x+3*e.width/4,y:e.y+e.height-A.height/2}},52:function(d){return{x:d.x+d.width/4,y:d.y+d.height}},53:function(s){return{x:s.x+3*s.width/4,y:s.y+s.height}},54:function(O,v){return{x:O.x+O.width/4,y:O.y+O.height+v.height/2}},55:function(R,g){return{x:R.x+3*R.width/4,y:R.y+R.height+g.height/2}}};return lk(E)?function(d,v,m){return H[d](v,m?m:No)}:void 0}();uj(v,{highlight:"#1ABC9C",label:"#000",labelSelect:"#FFF",transparent:"rgba(0,0,0,0.35)",titleBackground:"#2C3E50",titleIconBackground:"#868686",headerBackground:"#ECF0F1",headerIconBackground:"#868686",headerSeparator:"#868686",headerLine:"#D9D9D9",background:"#FFF",disabledBackground:"rgba(255,255,255,0.65)",toolTipBackground:"#FFFFE0",rectSelectBorder:"#45C4F9",rectSelectBackground:"rgba(0,0,0,0.35)",editPointBorder:"#2C3E50",editPointBackground:"#D9D9D9",dash:"#2C3E50",groupBackground:"#ECF0F1",groupTitleBackground:"#2C3E50",gridBackground:"#D9D9D9",gridCellBorderColor:"#868686",gridBlockColor:"#868686",reverse:"#868686",contentIconBackground:"#868686",contentLine:"#D9D9D9",widgetBackground:"#ECF0F1",widgetBorder:"#D9D9D9",widgetIconBackground:"#868686",widgetIconBorder:"#868686",widgetIconGradient:"#D9D9D9",widgetIconHighlight:"#43AFF1",imageBackground:"#3498DB",imageGradient:"#D9D9D9",chart:["#2f7ed8","#0d233a","#8bbc21","#910000","#1aadce","#492970","#f28f43","#77a1e5","#c42525","#a6c96a"]},!0);var hb=v.reverse,mg=v.transparent,ef=v.rectSelectBackground,Pg=v.dash,lm=v.titleBackground,bb=v.titleIconBackground,hf=v.headerBackground,ll=v.headerIconBackground,fo=v.headerSeparator,td=v.headerLine,ch=v.contentIconBackground,de=v.contentLine,Fi=(v.widgetIconHighlight,v.widgetIconBorder),Ch=(v.widgetIconGradient,v.imageBackground),np=v.imageGradient,Ul=v.highlight,$g=v.label,Ve=v.labelSelect;if(D&&!E.shutAlert1){var An=new Date,Zd=D.split("-"),If=new Date(An.getFullYear(),An.getMonth(),An.getDate()),D=new Date($(Zd[0],10),$(Zd[1],10)-1,$(Zd[2],10)),Ie=If.getTime(),Zq=D.getTime(),ek=g+"_try",Qh=E.alert;try{var zh=E.localStorage;if(zh&&Qh)if(Zq>Ie&&1728e6>Zq-Ie){var Qc=(Zq-Ie)/864e5;zh&&zh[ek]!=Qc&&(zh[ek]=Qc,E.htWillExpire?Qh(E.htWillExpire.replace("{{day}}",Qc)):Qh("HT for Web free trial license will expire in "+Qc+" days, please apply for a new license!"))}else Ie>=Zq&&(E.htExpired?Qh(E.htExpired):Qh("Your free trial of HT for Web has expired!")),zh&&delete zh[ek]}catch(Uq){}}Math.sign===d&&(Math.sign=function(X){return 0>X?-1:X>0?1:+X});var kd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bq={encode:function(c,H){var Z,q,V,F,O,E,z,X="",T=0;for(c=bq._utf8_encode(c);T<c.length;)Z=c.charCodeAt(T++),q=c.charCodeAt(T++),V=c.charCodeAt(T++),F=Z>>2,O=(3&Z)<<4|q>>4,E=(15&q)<<2|V>>6,z=63&V,isNaN(q)?E=z=64:isNaN(V)&&(z=64),X=X+H.charAt(F)+H.charAt(O)+H.charAt(E)+H.charAt(z);return X},decode:function(x,D){var f,Y,H,q,F,s,Z,m="",S=0;for(x=x.replace(/[^A-Za-z0-9\+\/\=]/g,"");S<x.length;)q=D.indexOf(x.charAt(S++)),F=D.indexOf(x.charAt(S++)),s=D.indexOf(x.charAt(S++)),Z=D.indexOf(x.charAt(S++)),f=q<<2|F>>4,Y=(15&F)<<4|s>>2,H=(3&s)<<6|Z,m+=String.fromCharCode(f),64!=s&&(m+=String.fromCharCode(Y)),64!=Z&&(m+=String.fromCharCode(H));return m=bq._utf8_decode(m)},_utf8_encode:function(u){u=u.replace(/\r\n/g,"\n");for(var n="",K=0;K<u.length;K++){var L=u.charCodeAt(K);128>L?n+=String.fromCharCode(L):L>127&&2048>L?(n+=String.fromCharCode(192|L>>6),n+=String.fromCharCode(128|63&L)):(n+=String.fromCharCode(224|L>>12),n+=String.fromCharCode(128|63&L>>6),n+=String.fromCharCode(128|63&L))}return n},_utf8_decode:function(c){for(var U="",W=0,g=0,w=0,E=0;W<c.length;)g=c.charCodeAt(W),128>g?(U+=String.fromCharCode(g),W++):g>191&&224>g?(w=c.charCodeAt(W+1),U+=String.fromCharCode((31&g)<<6|63&w),W+=2):(w=c.charCodeAt(W+1),E=c.charCodeAt(W+2),U+=String.fromCharCode((15&g)<<12|(63&w)<<6|63&E),W+=3);return U}};W.Math={generateUUID:function(){for(var q=[],x=0;256>x;x++)q[x]=(16>x?"0":"")+x.toString(16).toUpperCase();return function(){var w=0|4294967295*Math.random(),I=0|4294967295*Math.random(),o=0|4294967295*Math.random(),t=0|4294967295*Math.random();return q[255&w]+q[255&w>>8]+q[255&w>>16]+q[255&w>>24]+"-"+q[255&I]+q[255&I>>8]+"-"+q[64|15&I>>16]+q[255&I>>24]+"-"+q[128|63&o]+q[255&o>>8]+"-"+q[255&o>>16]+q[255&o>>24]+q[255&t]+q[255&t>>8]+q[255&t>>16]+q[255&t>>24]}}(),clamp:function(x,b,i){return Math.max(b,Math.min(i,x))},generateIncreasingID:function(){var P=0;return function(){return++P}}(),encodeBase64:function(E,L){return bq.encode(E,L||kd)},decodeBase64:function($,V){return bq.decode($,V||kd)},randomArray:function(I,q){q=q||I.length;for(var c=q-1;c>0;c--){var Y=Math.floor(Math.random()*(c+1)),R=I[c];I[c]=I[Y],I[Y]=R}return I}};var We=W.Matrix=W.Math.Matrix2d=function(S,Z,V,T,X){this.setFromTransform(S,Z,V,T,X)},ye=We;We.prototype={},We.prototype.constructor=We,We.prototype.set=function(l,b,H,P,C,N){return this.a=l,this.b=b,this.c=H,this.d=P,this.tx=C,this.ty=N,this},We.prototype.setFromTransform=function(g,y,O,p,a){var e=this;if(g===d)return e.a=1,e.b=0,e.c=0,e.d=1,e.tx=0,e.ty=0,void 0;g=g||0;var P=L(g),j=k(g);return p=p||1,a=a||1,e.a=j*p,e.b=P*p,e.c=-P*a,e.d=j*a,e.tx=y||0,e.ty=O||0,e},We.prototype.apply=function(G,P){P=P||new Lj;var n=G.x,I=G.y;return P.x=this.a*n+this.c*I+this.tx,P.y=this.b*n+this.d*I+this.ty,P},We.prototype.applyInverse=function(c,s){s=s||new Lj;var D=1/(this.a*this.d+this.c*-this.b),r=c.x,b=c.y;return s.x=this.d*D*r+-this.c*D*b+(this.ty*this.c-this.tx*this.d)*D,s.y=this.a*D*b+-this.b*D*r+(-this.ty*this.a+this.tx*this.b)*D,s},We.prototype.translate=function(P,C){return this.tx+=P,this.ty+=C,this},We.prototype.scale=function(o,n){return this.a*=o,this.d*=n,this.c*=o,this.b*=n,this.tx*=o,this.ty*=n,this},We.prototype.rotate=function(e){var m=Math.cos(e),j=Math.sin(e),V=this.a,K=this.c,B=this.tx;return this.a=V*m-this.b*j,this.b=V*j+this.b*m,this.c=K*m-this.d*j,this.d=K*j+this.d*m,this.tx=B*m-this.ty*j,this.ty=B*j+this.ty*m,this},We.prototype.appendTranslate=function(X,E){return this.tx+=this.a*X+this.c*E,this.ty+=this.b*X+this.d*E,this},We.prototype.appendScale=function(H,E){return this.a*=H,this.d*=E,this.c*=E,this.b*=H,this},We.prototype.appendRotate=function(h){if(!h)return this;var i=Math.cos(h),r=Math.sin(h),U=this.a,B=this.b;return this.a=U*i+this.c*r,this.b=B*i+this.d*r,this.c=-U*r+this.c*i,this.d=-B*r+this.d*i,this},We.prototype.append=function(p){var r=this.a,$=this.b,G=this.c,W=this.d;return this.a=p.a*r+p.b*G,this.b=p.a*$+p.b*W,this.c=p.c*r+p.d*G,this.d=p.c*$+p.d*W,this.tx=p.tx*r+p.ty*G+this.tx,this.ty=p.tx*$+p.ty*W+this.ty,this},We.prototype.setTransform=function(U,F,G,t,x,s,j,C,z){var I,p,v,T,B,N,X,g,c,O;return B=Math.sin(j),N=Math.cos(j),X=Math.cos(z),g=Math.sin(z),c=-Math.sin(C),O=Math.cos(C),I=N*x,p=B*x,v=-B*s,T=N*s,this.a=X*I+g*v,this.b=X*p+g*T,this.c=c*I+O*v,this.d=c*p+O*T,this.tx=U+(G*I+t*v),this.ty=F+(G*p+t*T),this},We.prototype.prepend=function($){var Y=this.tx;if(1!==$.a||0!==$.b||0!==$.c||1!==$.d){var y=this.a,f=this.c;this.a=y*$.a+this.b*$.c,this.b=y*$.b+this.b*$.d,this.c=f*$.a+this.d*$.c,this.d=f*$.b+this.d*$.d}return this.tx=Y*$.a+this.ty*$.c+$.tx,this.ty=Y*$.b+this.ty*$.d+$.ty,this},We.prototype.transform=We.prototype.prepend,We.prototype.invert=function(){var J=this.a,x=this.b,c=this.c,H=this.d,$=this.tx,e=J*H-x*c;return this.a=H/e,this.b=-x/e,this.c=-c/e,this.d=J/e,this.tx=(c*this.ty-H*$)/e,this.ty=-(J*this.ty-x*$)/e,this},We.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},We.prototype.clone=function(){var g=new We;return g.a=this.a,g.b=this.b,g.c=this.c,g.d=this.d,g.tx=this.tx,g.ty=this.ty,g},We.prototype.copy=function(C){return C.a=this.a,C.b=this.b,C.c=this.c,C.d=this.d,C.tx=this.tx,C.ty=this.ty,C},We.prototype.tf=function(E,N){1===arguments.length&&(N=E.y,E=E.x);var d=this;return{x:d.a*E+d.c*N+d.tx,y:d.b*E+d.d*N+d.ty}},We.prototype.tfi=function(b,V){1===arguments.length&&(V=b.y,b=b.x);var E=this,D=1/(E.a*E.d+E.c*-E.b);return{x:E.d*D*b+-E.c*D*V+(E.ty*E.c-E.tx*E.d)*D,y:E.a*D*V+-E.b*D*b+(-E.ty*E.a+E.tx*E.b)*D}},We.IDENTITY=new We,We.TEMP_MATRIX=new We;var Tg=W.Math.Quaternion=function(f,N,F,e){this.set(f,N,F,e)};G.assign(Tg.prototype,{set:function(a,i,c,x){var g=this;return g._x=a||0,g._y=i||0,g._z=c||0,g._w=x!==d?x:1,g},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(A){var t=this;return t._x=A._x,t._y=A._y,t._z=A._z,t._w=A._w,t},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},dot:function(P){return this._x*P._x+this._y*P._y+this._z*P._z+this._w*P._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var n=this.length();return 0===n?(this._x=0,this._y=0,this._z=0,this._w=1):(n=1/n,this._x=this._x*n,this._y=this._y*n,this._z=this._z*n,this._w=this._w*n),this},fromArray:function(m,t){t===d&&(t=0);var U=this;return U._x=m[t],U._y=m[t+1],U._z=m[t+2],U._w=m[t+3],this},slerp:function(v,d){if(0===d)return this;if(1===d)return this.copy(v);var m=this._x,C=this._y,X=this._z,j=this._w,h=j*v._w+m*v._x+C*v._y+X*v._z;if(0>h?(this._w=-v._w,this._x=-v._x,this._y=-v._y,this._z=-v._z,h=-h):this.copy(v),h>=1)return this._w=j,this._x=m,this._y=C,this._z=X,this;var u=Math.sqrt(1-h*h);if(Math.abs(u)<.001)return this._w=.5*(j+this._w),this._x=.5*(m+this._x),this._y=.5*(C+this._y),this._z=.5*(X+this._z),this;var D=Math.atan2(u,h),p=Math.sin((1-d)*D)/u,e=Math.sin(d*D)/u;return this._w=j*p+this._w*e,this._x=m*p+this._x*e,this._y=C*p+this._y*e,this._z=X*p+this._z*e,this},setFromAxisAngle:function(I,f){var _=f/2,C=Math.sin(_);return this._x=I.x*C,this._y=I.y*C,this._z=I.z*C,this._w=Math.cos(_),this},setFromEuler:function(F){var w=F._x,h=F._y,k=F._z,X=F._order,l=Math.cos,R=Math.sin,r=l(w/2),T=l(h/2),q=l(k/2),B=R(w/2),S=R(h/2),$=R(k/2);return"XYZ"===X?(this._x=B*T*q+r*S*$,this._y=r*S*q-B*T*$,this._z=r*T*$+B*S*q,this._w=r*T*q-B*S*$):"YXZ"===X?(this._x=B*T*q+r*S*$,this._y=r*S*q-B*T*$,this._z=r*T*$-B*S*q,this._w=r*T*q+B*S*$):"ZXY"===X?(this._x=B*T*q-r*S*$,this._y=r*S*q+B*T*$,this._z=r*T*$+B*S*q,this._w=r*T*q-B*S*$):"ZYX"===X?(this._x=B*T*q-r*S*$,this._y=r*S*q+B*T*$,this._z=r*T*$-B*S*q,this._w=r*T*q+B*S*$):"YZX"===X?(this._x=B*T*q+r*S*$,this._y=r*S*q+B*T*$,this._z=r*T*$-B*S*q,this._w=r*T*q-B*S*$):"XZY"===X&&(this._x=B*T*q-r*S*$,this._y=r*S*q-B*T*$,this._z=r*T*$+B*S*q,this._w=r*T*q+B*S*$),this},setFromRotationMatrix:function(X){var N,o=X.el,S=o[0],c=o[4],t=o[8],Q=o[1],B=o[5],_=o[9],u=o[2],Y=o[6],v=o[10],d=S+B+v;return d>0?(N=.5/Math.sqrt(d+1),this._w=.25/N,this._x=(Y-_)*N,this._y=(t-u)*N,this._z=(Q-c)*N):S>B&&S>v?(N=2*Math.sqrt(1+S-B-v),this._w=(Y-_)/N,this._x=.25*N,this._y=(c+Q)/N,this._z=(t+u)/N):B>v?(N=2*Math.sqrt(1+B-S-v),this._w=(t-u)/N,this._x=(c+Q)/N,this._y=.25*N,this._z=(_+Y)/N):(N=2*Math.sqrt(1+v-S-B),this._w=(Q-c)/N,this._x=(t+u)/N,this._y=(_+Y)/N,this._z=.25*N),this},setFromToVectors:function(){var n,U;return function(t,T){return n===d&&(n=new Ob),U=t.dot(T)+1,1e-7>U?(U=0,Math.abs(t.x)>Math.abs(t.z)?n.set(-t.y,t.x,0):n.set(0,-t.z,t.y)):n.crossVectors(t,T),this._x=n.x,this._y=n.y,this._z=n.z,this._w=U,this.normalize()}}(),setFromUnitVectors:function(){var v,I,u=1e-6;return function(f,c){return v===d&&(v=new Ob),I=f.dot(c)+1,u>I?(I=0,Math.abs(f.x)>Math.abs(f.z)?v.set(-f.y,f.x,0):v.set(0,-f.z,f.y)):v.crossVectors(f,c),this._x=v.x,this._y=v.y,this._z=v.z,this._w=I,this.normalize()}}(),multiply:function(r){return this.multiplyQuaternions(this,r)},premultiply:function(M){return this.multiplyQuaternions(M,this)},multiplyQuaternions:function(m,$){var n=m._x,i=m._y,D=m._z,q=m._w,O=$._x,b=$._y,M=$._z,Q=$._w;return this._x=n*Q+q*O+i*M-D*b,this._y=i*Q+q*b+D*O-n*M,this._z=D*Q+q*M+n*b-i*O,this._w=q*Q-n*O-i*b-D*M,this}});var wd=W.Math.Vector4=function(R,V,n,$){this.x=R||0,this.y=V||0,this.z=n||0,this.w=$!==d?$:1};G.assign(wd.prototype,{isVector4:!0,set:function(g,w,O,Y){return this.x=g,this.y=w,this.z=O,this.w=Y,this},setScalar:function(N){return this.x=N,this.y=N,this.z=N,this.w=N,this},setX:function(r){return this.x=r,this},setY:function(x){return this.y=x,this},setZ:function(Z){return this.z=Z,this},setW:function(b){return this.w=b,this},setComponent:function(d,Z){switch(d){case 0:this.x=Z;break;case 1:this.y=Z;break;case 2:this.z=Z;break;case 3:this.w=Z;break;default:throw new Error("index is out of range: "+d)}return this},getComponent:function(y){switch(y){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+y)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(Z){return this.x=Z.x,this.y=Z.y,this.z=Z.z,this.w=Z.w!==d?Z.w:1,this},add:function(K,F){return F!==d?this.addVectors(K,F):(this.x+=K.x,this.y+=K.y,this.z+=K.z,this.w+=K.w,this)},addScalar:function(p){return this.x+=p,this.y+=p,this.z+=p,this.w+=p,this},addVectors:function(n,l){return this.x=n.x+l.x,this.y=n.y+l.y,this.z=n.z+l.z,this.w=n.w+l.w,this},addScaledVector:function(o,s){return this.x+=o.x*s,this.y+=o.y*s,this.z+=o.z*s,this.w+=o.w*s,this},sub:function(x,E){return E!==d?this.subVectors(x,E):(this.x-=x.x,this.y-=x.y,this.z-=x.z,this.w-=x.w,this)},subScalar:function(G){return this.x-=G,this.y-=G,this.z-=G,this.w-=G,this},subVectors:function(x,Y){return this.x=x.x-Y.x,this.y=x.y-Y.y,this.z=x.z-Y.z,this.w=x.w-Y.w,this},multiplyScalar:function(n){return this.x*=n,this.y*=n,this.z*=n,this.w*=n,this},applyMatrix4:function(o){var l=this.x,k=this.y,n=this.z,V=this.w,J=o.el;return this.x=J[0]*l+J[4]*k+J[8]*n+J[12]*V,this.y=J[1]*l+J[5]*k+J[9]*n+J[13]*V,this.z=J[2]*l+J[6]*k+J[10]*n+J[14]*V,this.w=J[3]*l+J[7]*k+J[11]*n+J[15]*V,this},divideScalar:function(u){return this.multiplyScalar(1/u)},setAxisAngleFromQuaternion:function(h){this.w=2*Math.acos(h.w);var y=Math.sqrt(1-h.w*h.w);return 1e-4>y?(this.x=1,this.y=0,this.z=0):(this.x=h.x/y,this.y=h.y/y,this.z=h.z/y),this},setAxisAngleFromRotationMatrix:function(_){var Q,F,B,o,U=.01,q=.1,P=_.el,e=P[0],z=P[4],X=P[8],i=P[1],T=P[5],D=P[9],f=P[2],v=P[6],L=P[10];if(Math.abs(z-i)<U&&Math.abs(X-f)<U&&Math.abs(D-v)<U){if(Math.abs(z+i)<q&&Math.abs(X+f)<q&&Math.abs(D+v)<q&&Math.abs(e+T+L-3)<q)return this.set(1,0,0,0),this;Q=Math.PI;var y=(e+1)/2,M=(T+1)/2,I=(L+1)/2,h=(z+i)/4,g=(X+f)/4,H=(D+v)/4;return y>M&&y>I?U>y?(F=0,B=.707106781,o=.707106781):(F=Math.sqrt(y),B=h/F,o=g/F):M>I?U>M?(F=.707106781,B=0,o=.707106781):(B=Math.sqrt(M),F=h/B,o=H/B):U>I?(F=.707106781,B=.707106781,o=0):(o=Math.sqrt(I),F=g/o,B=H/o),this.set(F,B,o,Q),this}var r=Math.sqrt((v-D)*(v-D)+(X-f)*(X-f)+(i-z)*(i-z));return Math.abs(r)<.001&&(r=1),this.x=(v-D)/r,this.y=(X-f)/r,this.z=(i-z)/r,this.w=Math.acos((e+T+L-1)/2),this},min:function(W){return this.x=Math.min(this.x,W.x),this.y=Math.min(this.y,W.y),this.z=Math.min(this.z,W.z),this.w=Math.min(this.w,W.w),this},max:function(w){return this.x=Math.max(this.x,w.x),this.y=Math.max(this.y,w.y),this.z=Math.max(this.z,w.z),this.w=Math.max(this.w,w.w),this},clamp:function(N,o){return this.x=Math.max(N.x,Math.min(o.x,this.x)),this.y=Math.max(N.y,Math.min(o.y,this.y)),this.z=Math.max(N.z,Math.min(o.z,this.z)),this.w=Math.max(N.w,Math.min(o.w,this.w)),this},clampScalar:function(){var Z,g;return function(L,h){return Z===d&&(Z=new wd,g=new wd),Z.set(L,L,L,L),g.set(h,h,h,h),this.clamp(Z,g)}}(),clampLength:function(r,k){var K=this.length();return this.divideScalar(K||1).multiplyScalar(Math.max(r,Math.min(k,K)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(k){return this.x*k.x+this.y*k.y+this.z*k.z+this.w*k.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(Q){return this.normalize().multiplyScalar(Q)},lerp:function(o,d){return this.x+=(o.x-this.x)*d,this.y+=(o.y-this.y)*d,this.z+=(o.z-this.z)*d,this.w+=(o.w-this.w)*d,this},lerpVectors:function(x,B,N){return this.subVectors(B,x).multiplyScalar(N).add(x)},equals:function(X){return X.x===this.x&&X.y===this.y&&X.z===this.z&&X.w===this.w},fromArray:function(o,P){return P===d&&(P=0),this.x=o[P],this.y=o[P+1],this.z=o[P+2],this.w=o[P+3],this},toArray:function(r,c){return r===d&&(r=[]),c===d&&(c=0),r[c]=this.x,r[c+1]=this.y,r[c+2]=this.z,r[c+3]=this.w,r},fromBufferAttribute:function(U,E){return this.x=U.getX(E),this.y=U.getY(E),this.z=U.getZ(E),this.w=U.getW(E),this}});var Ob=W.Math.Vector3=function(N,W,U){N===d?(this.x=0,this.y=0,this.z=0):"object"==typeof N?this.copy(N):this.set(N,W==d?N:W,U==d?N:U)};G.assign(Ob.prototype,{set:function(z,G,x){return this.x=z,this.y=G,this.z=x,this},equals:function(s){return s&&this.x===s.x&&this.y===s.y&&this.z===s.z},setScalar:function(j){return this.x=j,this.y=j,this.z=j,this},setX:function(P){return this.x=P,this},setY:function(X){return this.y=X,this},setZ:function(y){return this.z=y,this},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(o){return o.x===d?(this.x=o[0],this.y=o[1],this.z=o[2]):(this.x=o.x,this.y=o.y,this.z=o.z),this},add:function(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this},addScalar:function(g){return this.x+=g,this.y+=g,this.z+=g,this},addVectors:function(x,V){return this.x=x.x+V.x,this.y=x.y+V.y,this.z=x.z+V.z,this},addScaledVector:function(Y,r){return this.x+=Y.x*r,this.y+=Y.y*r,this.z+=Y.z*r,this},sub:function(n){return this.x-=n.x,this.y-=n.y,this.z-=n.z,this},subScalar:function(p){return this.x-=p,this.y-=p,this.z-=p,this},subVectors:function(h,q){return this.x=h.x-q.x,this.y=h.y-q.y,this.z=h.z-q.z,this},multiply:function(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this},multiplyScalar:function(j){return this.x*=j,this.y*=j,this.z*=j,this},distanceTo:function(A){return Math.sqrt(this.distanceToSquared(A))},distanceToSquared:function(M){var y=this.x-M.x,p=this.y-M.y,Q=this.z-M.z;return y*y+p*p+Q*Q},distanceToSquared2:function(Z){var M=this.x-Z[0],O=this.y-Z[1],l=this.z-Z[2];return M*M+O*O+l*l},multiplyVectors:function(r,J){return this.x=r.x*J.x,this.y=r.y*J.y,this.z=r.z*J.z,this},transformDirection:function(g){var Z=this.x,u=this.y,E=this.z,z=g.el;return this.x=z[0]*Z+z[4]*u+z[8]*E,this.y=z[1]*Z+z[5]*u+z[9]*E,this.z=z[2]*Z+z[6]*u+z[10]*E,this.normalize()},applyEuler:function(){var j=new Tg;return function(r){return this.applyQuaternion(j.setFromEuler(r))}}(),applyQuaternion:function(q){var V=this.x,W=this.y,o=this.z,k=q._x,P=q._y,i=q._z,X=q._w,B=X*V+P*o-i*W,F=X*W+i*V-k*o,x=X*o+k*W-P*V,A=-k*V-P*W-i*o;return this.x=B*X+A*-k+F*-i-x*-P,this.y=F*X+A*-P+x*-k-B*-i,this.z=x*X+A*-i+B*-P-F*-k,this},applyMatrix4:function(S){var s=this.x,l=this.y,H=this.z,z=S.el,X=1/(z[3]*s+z[7]*l+z[11]*H+z[15]);return this.x=(z[0]*s+z[4]*l+z[8]*H+z[12])*X,this.y=(z[1]*s+z[5]*l+z[9]*H+z[13])*X,this.z=(z[2]*s+z[6]*l+z[10]*H+z[14])*X,this},applyMatrix3:function(r){var w=this.x,X=this.y,J=this.z,z=r.el;return this.x=z[0]*w+z[3]*X+z[6]*J,this.y=z[1]*w+z[4]*X+z[7]*J,this.z=z[2]*w+z[5]*X+z[8]*J,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},reflect:function(){var y=new Ob;return function(B){return this.sub(y.copy(B).multiplyScalar(2*this.dot(B)))}}(),dot:function(h){return this.x*h.x+this.y*h.y+this.z*h.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){var g=this.length();return g?this.multiplyScalar(1/g):this},setLength:function(t){return this.normalize().multiplyScalar(t)},fromArray:function(X,l){return l===d&&(l=0),this.x=X[l],this.y=X[l+1],this.z=X[l+2],this},toArray:function(u,S){return u===d&&(u=[0,0,0]),S===d&&(S=0),u[S]=this.x,u[S+1]=this.y,u[S+2]=this.z,u},cross:function(Q){return this.crossVectors(this,Q)},angleTo:function(B){var u=this.dot(B)/Math.sqrt(this.lengthSq()*B.lengthSq());return u>1||-1>u?0:Math.acos(u)},lerpVectors:function(Y,A,J){return this.subVectors(A,Y).multiplyScalar(J).add(Y)},crossVectors:function(h,k){var Q=h.x,p=h.y,a=h.z,L=k.x,P=k.y,j=k.z;return this.x=p*j-a*P,this.y=a*L-Q*j,this.z=Q*P-p*L,this},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this},max:function(U){return this.x=Math.max(this.x,U.x),this.y=Math.max(this.y,U.y),this.z=Math.max(this.z,U.z),this},setFromMatrixPosition:function(J){return this.setFromMatrixColumn(J,3)
},setFromMatrixScale:function(h){var y=this.setFromMatrixColumn(h,0).length(),l=this.setFromMatrixColumn(h,1).length(),U=this.setFromMatrixColumn(h,2).length();return this.x=y,this.y=l,this.z=U,this},setFromMatrixColumn:function(G,R){return this.fromArray(G.el,4*R)}});var Lj=W.Math.Vector2=function(B,i,S){"object"==typeof B&&(B.x!=d?(i=B.y,B=B.x,S=B.e):(S=B[2],i=B[1],B=B[0])),this.set(B||0,i||0,S)};Lj.prototype={},Lj.prototype.constructor=Lj,G.defineProperties(Lj.prototype,{width:{get:function(){return this.x},set:function(v){this.x=v}},height:{get:function(){return this.y},set:function(g){this.y=g}}}),Lj.prototype.clone=function(){return new Lj(this.x,this.y,this.e)},Lj.prototype.copy=function(C){return this.set(C.x,C.y,C.e),this},Lj.prototype.equals=function(k){return k.x===this.x&&k.y===this.y},Lj.prototype.set=function(X,I,W){return this.x=X||0,this.y=I||(0!==I?this.x:0),W!=d&&(this.e=W),this},Lj.prototype.setScalar=function(j){return this.x=j,this.y=j,this},Lj.prototype.setX=function(t){return this.x=t||0,this},Lj.prototype.setY=function(r){return this.y=r||0,this},Lj.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},Lj.prototype.addVectors=function(W,u){return this.x=W.x+u.x,this.y=W.y+u.y,this},Lj.prototype.addScalar=function(Q){return this.x+=Q,this.y+=Q,this},Lj.prototype.addScaledVector=function(N,D){return this.x+=N.x*D,this.y+=N.y*D,this},Lj.prototype.sub=function(n){return this.x-=n.x,this.y-=n.y,this},Lj.prototype.subScalar=function(l){return this.x-=l,this.y-=l,this},Lj.prototype.subVectors=function(f,r){return this.x=f.x-r.x,this.y=f.y-r.y,this},Lj.prototype.multiply=function(B){return this.x*=B.x,this.y*=B.y,this},Lj.prototype.multiplyScalar=function(H){return this.x*=H,this.y*=H,this},Lj.prototype.divide=function(B){return this.x/=B.x,this.y/=B.y,this},Lj.prototype.divideScalar=function(H){return this.multiplyScalar(1/H)},Lj.prototype.min=function(H){return this.x=Math.min(this.x,H.x),this.y=Math.min(this.y,H.y),this},Lj.prototype.max=function(z){return this.x=Math.max(this.x,z.x),this.y=Math.max(this.y,z.y),this},Lj.prototype.fromArray=function(G,I){return I===d&&(I=0),this.x=G[I],this.y=G[I+1],this},Lj.prototype.clamp=function(H,C){return this.x=Math.max(H.x,Math.min(C.x,this.x)),this.y=Math.max(H.y,Math.min(C.y,this.y)),this},Lj.prototype.clampScalar=function(){var $,m;return function(o,f){return $===d&&($=new Lj,m=new Lj),$.set(o,o),m.set(f,f),this.clamp($,m)}}(),Lj.prototype.clampLength=function(M,Q){var q=this.length();return this.multiplyScalar(Math.max(M,Math.min(Q,q))/q)},Lj.prototype.dot=function(n){return this.x*n.x+this.y*n.y},Lj.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},Lj.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Lj.prototype.normalize=function(){return this.divideScalar(this.length())},Lj.prototype.angle=function(){var l=Math.atan2(this.y,this.x);return 0>l&&(l+=2*Math.PI),l},Lj.prototype.distanceTo=function(V){return Math.sqrt(this.distanceToSquared(V))},Lj.prototype.distanceToSquared=function(p){var G=this.x-p.x,k=this.y-p.y;return G*G+k*k},Lj.prototype.isNearEnough=function(o){return this.distanceToSquared(o)<1e-8},Lj.prototype.setLength=function(r){var Y=this.length();return Y?this.multiplyScalar(r/Y):this},Lj.prototype.lerp=function(x,l){return this.x+=(x.x-this.x)*l,this.y+=(x.y-this.y)*l,this},Lj.prototype.lerpVectors=function(y,t,H){return this.subVectors(t,y).multiplyScalar(H).add(y)},Lj.prototype.rotateAround=function(x,J){var r=x?x.x:0,G=x?x.y:0,t=Math.cos(J),R=Math.sin(J),v=this.x-r,k=this.y-G;return this.x=v*t-k*R+r,this.y=v*R+k*t+G,this},G.assign(P.prototype,{isMatrix3:!0,set:function(O,g,n,b,r,e,Y,o,y){var F=this.el;return F[0]=O,F[1]=b,F[2]=Y,F[3]=g,F[4]=r,F[5]=o,F[6]=n,F[7]=e,F[8]=y,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.el)},copy:function(F){var g=this.el,Q=F.el;return g[0]=Q[0],g[1]=Q[1],g[2]=Q[2],g[3]=Q[3],g[4]=Q[4],g[5]=Q[5],g[6]=Q[6],g[7]=Q[7],g[8]=Q[8],this},setFromMatrix4:function(j){var Z=j.el;return this.set(Z[0],Z[4],Z[8],Z[1],Z[5],Z[9],Z[2],Z[6],Z[10]),this},applyToBufferAttribute:function(){var A=new Ob;return function(S){for(var k=0,u=S.count;u>k;k++)A.x=S.getX(k),A.y=S.getY(k),A.z=S.getZ(k),A.applyMatrix3(this),S.setXYZ(k,A.x,A.y,A.z);return S}}(),multiply:function(I){return this.multiplyMatrices(this,I)},premultiply:function(E){return this.multiplyMatrices(E,this)},multiplyMatrices:function(T,q){var n=T.el,k=q.el,A=this.el,R=n[0],o=n[3],d=n[6],K=n[1],J=n[4],r=n[7],Y=n[2],O=n[5],b=n[8],u=k[0],Q=k[3],M=k[6],p=k[1],Z=k[4],L=k[7],U=k[2],N=k[5],I=k[8];return A[0]=R*u+o*p+d*U,A[3]=R*Q+o*Z+d*N,A[6]=R*M+o*L+d*I,A[1]=K*u+J*p+r*U,A[4]=K*Q+J*Z+r*N,A[7]=K*M+J*L+r*I,A[2]=Y*u+O*p+b*U,A[5]=Y*Q+O*Z+b*N,A[8]=Y*M+O*L+b*I,this},multiplyScalar:function(t){var o=this.el;return o[0]*=t,o[3]*=t,o[6]*=t,o[1]*=t,o[4]*=t,o[7]*=t,o[2]*=t,o[5]*=t,o[8]*=t,this},determinant:function(){var K=this.el,O=K[0],A=K[1],T=K[2],y=K[3],h=K[4],U=K[5],e=K[6],b=K[7],k=K[8];return O*h*k-O*U*b-A*y*k+A*U*e+T*y*b-T*h*e},getInverse:function(F){var B=F.el,V=this.el,y=B[0],W=B[1],M=B[2],J=B[3],Y=B[4],i=B[5],L=B[6],R=B[7],h=B[8],e=h*Y-i*R,g=i*L-h*J,K=R*J-Y*L,X=y*e+W*g+M*K;if(0===X)return this.identity();var k=1/X;return V[0]=e*k,V[1]=(M*R-h*W)*k,V[2]=(i*W-M*Y)*k,V[3]=g*k,V[4]=(h*y-M*L)*k,V[5]=(M*J-i*y)*k,V[6]=K*k,V[7]=(W*L-R*y)*k,V[8]=(Y*y-W*J)*k,this},transpose:function(){var O,P=this.el;return O=P[1],P[1]=P[3],P[3]=O,O=P[2],P[2]=P[6],P[6]=O,O=P[5],P[5]=P[7],P[7]=O,this},getNormalMatrix:function(k){return this.setFromMatrix4(k).getInverse(this).transpose()},transposeIntoArray:function(d){var m=this.el;return d[0]=m[0],d[1]=m[3],d[2]=m[6],d[3]=m[1],d[4]=m[4],d[5]=m[7],d[6]=m[2],d[7]=m[5],d[8]=m[8],this},setUvTransform:function(z,O,r,k,i,Q,v){var V=Math.cos(i),$=Math.sin(i);this.set(r*V,r*$,-r*(V*Q+$*v)+Q+z,-k*$,k*V,-k*(-$*Q+V*v)+v+O,0,0,1)},scale:function(M,T){var x=this.el;return x[0]*=M,x[3]*=M,x[6]*=M,x[1]*=T,x[4]*=T,x[7]*=T,this},rotate:function(v){var x=Math.cos(v),X=Math.sin(v),c=this.el,h=c[0],$=c[3],J=c[6],U=c[1],t=c[4],_=c[7];return c[0]=x*h+X*U,c[3]=x*$+X*t,c[6]=x*J+X*_,c[1]=-X*h+x*U,c[4]=-X*$+x*t,c[7]=-X*J+x*_,this},translate:function(q,Q){var H=this.el;return H[0]+=q*H[2],H[3]+=q*H[5],H[6]+=q*H[8],H[1]+=Q*H[2],H[4]+=Q*H[5],H[7]+=Q*H[8],this},equals:function(S){for(var T=this.el,t=S.el,d=0;9>d;d++)if(T[d]!==t[d])return!1;return!0},fromArray:function(W,F){F===d&&(F=0);for(var V=0;9>V;V++)this.el[V]=W[V+F];return this},toArray:function(x,X){x===d&&(x=[]),X===d&&(X=0);var k=this.el;return x[X]=k[0],x[X+1]=k[1],x[X+2]=k[2],x[X+3]=k[3],x[X+4]=k[4],x[X+5]=k[5],x[X+6]=k[6],x[X+7]=k[7],x[X+8]=k[8],x}});var Ko=W.Math.Plane=function(w,W){this.normal=w!==d?w:new Ob(1,0,0),this.constant=W!==d?W:0};G.assign(Ko.prototype,{set:function(j,t){return this.normal.copy(j),this.constant=t,this},setComponents:function(i,B,A,l){return this.normal.set(i,B,A),this.constant=l,this},setFromNormalAndCoplanarPoint:function(a,w){return this.normal.copy(a),this.constant=-w.dot(this.normal),this},setFromCoplanarPoints:function(){var d=new Ob,M=new Ob;return function(X,S,J){var y=d.subVectors(J,S).cross(M.subVectors(X,S)).normalize();return this.setFromNormalAndCoplanarPoint(y,X),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(Q){return this.normal.copy(Q.normal),this.constant=Q.constant,this},normalize:function(){var N=1/this.normal.length();return this.normal.multiplyScalar(N),this.constant*=N,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(Y){return this.normal.dot(Y)+this.constant},distanceToSphere:function(D){return this.distanceToPoint(D.center)-D.radius},projectPoint:function(Q,n){return n===d&&(n=new Ob),n.copy(this.normal).multiplyScalar(-this.distanceToPoint(Q)).add(Q)},intersectLine:function(){var I=new Ob;return function(J,B){B===d&&(B=new Ob);var f=J.delta(I),Z=this.normal.dot(f);if(0===Z)return 0===this.distanceToPoint(J.start)?B.copy(J.start):d;var j=-(J.start.dot(this.normal)+this.constant)/Z;return 0>j||j>1?d:B.copy(f).multiplyScalar(j).add(J.start)}}(),intersectsLine:function(y){var T=this.distanceToPoint(y.start),K=this.distanceToPoint(y.end);return 0>T&&K>0||0>K&&T>0},intersectsBox:function(R){return R.intersectsPlane(this)},intersectsSphere:function(w){return w.intersectsPlane(this)},coplanarPoint:function(h){return h===d&&(h=new Ob),h.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var o=new Ob,y=new P;return function(r,d){var c=d||y.getNormalMatrix(r),F=this.coplanarPoint(o).applyMatrix4(r),g=this.normal.applyMatrix3(c).normalize();return this.constant=-F.dot(g),this}}(),translate:function(j){return this.constant-=j.dot(this.normal),this},equals:function(c){return c.normal.equals(this.normal)&&c.constant===this.constant}});var ih=W.Math.Ray=function(u,r){this.origin=u!==d?u.clone():new Ob,this.direction=r!==d?r.clone():new Ob};G.assign(ih.prototype,{set:function(w,C){return this.origin.copy(w),this.direction.copy(C),this},clone:function(){return(new this.constructor).copy(this)},copy:function(p){return this.origin.copy(p.origin),this.direction.copy(p.direction),this.maxHitLen=p.maxHitLen,this},at:function(P,h){var K=h||new Ob;return K.copy(this.direction).multiplyScalar(P).add(this.origin)},setMaxHitLength:function(P){this.maxHitLen=P},lookAt:function(d){return this.direction.copy(d).sub(this.origin).normalize(),this},applyMatrix4:function(J){var Y=this.maxHitLen;if(Y){var U=this.direction.clone().multiplyScalar(Y).add(this.origin);U.applyMatrix4(J)}return this.origin.applyMatrix4(J),this.direction.transformDirection(J),Y&&(this.maxHitLen=this.origin.distanceTo(U)),this},intersectBox:function(Z,x){var e,V,B,T,i,P,n=1/this.direction.x,c=1/this.direction.y,J=1/this.direction.z,A=this.origin;if(n>=0?(e=(Z.min.x-A.x)*n,V=(Z.max.x-A.x)*n):(e=(Z.max.x-A.x)*n,V=(Z.min.x-A.x)*n),c>=0?(B=(Z.min.y-A.y)*c,T=(Z.max.y-A.y)*c):(B=(Z.max.y-A.y)*c,T=(Z.min.y-A.y)*c),e>T||B>V)return null;if((B>e||e!==e)&&(e=B),(V>T||V!==V)&&(V=T),J>=0?(i=(Z.min.z-A.z)*J,P=(Z.max.z-A.z)*J):(i=(Z.max.z-A.z)*J,P=(Z.min.z-A.z)*J),e>P||i>V)return null;if((i>e||e!==e)&&(e=i),(V>P||V!==V)&&(V=P),0>V)return null;var p=e>=0?e:V,s=this.maxHitLen;return s&&p>s?null:this.at(p,x)},intersectTriangle:function(){var x=new Ob,W=new Ob,M=new Ob,a=new Ob;return function(k,j,Q,U,O){W.subVectors(j,k),M.subVectors(Q,k),a.crossVectors(W,M);var y,H=this.direction.dot(a);if(H>0){if(U)return null;y=1}else{if(!(0>H))return null;y=-1,H=-H}x.subVectors(this.origin,k);var D=y*this.direction.dot(M.crossVectors(x,M));if(0>D)return null;var l=y*this.direction.dot(W.cross(x));if(0>l||D+l>H)return null;var X=-y*x.dot(a);if(0>X)return null;var t=X/H,F=this.maxHitLen;return F&&t>F?null:this.at(t,O)}}()});var nb=W.Math.Box3=function(E,$){this.min=E!==d?E:new Ob(1/0,1/0,1/0),this.max=$!==d?$:new Ob(-1/0,-1/0,-1/0)};G.assign(nb.prototype,{set:function(b,x){return this.min.copy(b),this.max.copy(x),this},setFromArray:function(p){for(var k=1/0,X=1/0,t=1/0,K=-1/0,V=-1/0,Q=-1/0,A=0,d=p.length;d>A;A+=3){var G=p[A],m=p[A+1],H=p[A+2];k>G&&(k=G),X>m&&(X=m),t>H&&(t=H),G>K&&(K=G),m>V&&(V=m),H>Q&&(Q=H)}return this.min.set(k,X,t),this.max.set(K,V,Q),this},setFromPoints:function(c){this.makeEmpty();for(var f=0,y=c.length;y>f;f++)this.expandByPoint(c[f]);return this},clone:function(){return(new this.constructor).copy(this)},intersectsBox:function(C){return C.max.x<this.min.x||C.min.x>this.max.x||C.max.y<this.min.y||C.min.y>this.max.y||C.max.z<this.min.z||C.min.z>this.max.z?!1:!0},copy:function(Z){return this.min.copy(Z.min),this.max.copy(Z.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},expandByPoint:function(F){return this.min.min(F),this.max.max(F),this}});var Kq=W.Math.Sphere=function(n,Y){this.center=n!==d?n:new Ob,this.radius=Y!==d?Y:0};G.assign(Kq.prototype,{set:function(o,z){return this.center.copy(o),this.radius=z,this},setFromPoints:function(){var u=new nb;return function(F,I){var m=this.center;I!==d?m.copy(I):u.setFromPoints(F).getCenter(m);for(var c=0,r=0,i=F.length;i>r;r++)c=Math.max(c,m.distanceToSquared(F[r]));return this.radius=Math.sqrt(c),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(V){return this.center.copy(V.center),this.radius=V.radius,this},empty:function(){return this.radius<=0},containsPoint:function(l){return l.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(T){return T.distanceTo(this.center)-this.radius},intersectsSphere:function(c){var F=this.radius+c.radius;return c.center.distanceToSquared(this.center)<=F*F},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(y){return Math.abs(y.distanceToPoint(this.center))<=this.radius},clampPoint:function(l,N){var S=this.center.distanceToSquared(l);return N===d&&(N=new Ob),N.copy(l),S>this.radius*this.radius&&(N.sub(this.center).normalize(),N.multiplyScalar(this.radius).add(this.center)),N},getBoundingBox:function(f){return f===d&&(f=new nb),f.set(this.center,this.center),f.expandByScalar(this.radius),f},applyMatrix4:function(I){return this.center.applyMatrix4(I),this.radius=this.radius*I.getMaxScaleOnAxis(),this},translate:function(s){return this.center.add(s),this},equals:function(Z){return Z.center.equals(this.center)&&Z.radius===this.radius}});var rn=W.Math.Frustum=function(t,V,r,C,e,g){this.planes=[t!==d?t:new Ko,V!==d?V:new Ko,r!==d?r:new Ko,C!==d?C:new Ko,e!==d?e:new Ko,g!==d?g:new Ko]};G.assign(rn.prototype,{set:function(L,W,h,r,z,Z){var V=this.planes;return V[0].copy(L),V[1].copy(W),V[2].copy(h),V[3].copy(r),V[4].copy(z),V[5].copy(Z),this},clone:function(){return(new this.constructor).copy(this)},copy:function(v){for(var H=this.planes,x=0;6>x;x++)H[x].copy(v.planes[x]);return this},setFromMatrix:function(T){var X=this.planes,w=T.el,V=w[0],m=w[1],F=w[2],W=w[3],C=w[4],y=w[5],e=w[6],l=w[7],v=w[8],d=w[9],o=w[10],Y=w[11],t=w[12],c=w[13],q=w[14],n=w[15];return X[0].setComponents(W-V,l-C,Y-v,n-t).normalize(),X[1].setComponents(W+V,l+C,Y+v,n+t).normalize(),X[2].setComponents(W+m,l+y,Y+d,n+c).normalize(),X[3].setComponents(W-m,l-y,Y-d,n-c).normalize(),X[4].setComponents(W-F,l-e,Y-o,n-q).normalize(),X[5].setComponents(W+F,l+e,Y+o,n+q).normalize(),this},intersectsObject:function(){var R=new Kq;return function(H){var b=H.geometry;return null===b.boundingSphere&&b.computeBoundingSphere(),R.copy(b.boundingSphere).applyMatrix4(H.matrixWorld),this.intersectsSphere(R)}}(),intersectsSprite:function(){var $=new Kq;return function(K){return $.center.set(0,0,0),$.radius=.7071067811865476,$.applyMatrix4(K.matrixWorld),this.intersectsSphere($)}}(),intersectsSphere:function(O){for(var i=this.planes,Z=O.center,t=-O.radius,K=0;6>K;K++){var z=i[K].distanceToPoint(Z);if(t>z)return!1}return!0},intersectsBox:function(){var Q=new Ob;return function(S){for(var v=this.planes,u=0;6>u;u++){var r=v[u];if(Q.x=r.normal.x>0?S.max.x:S.min.x,Q.y=r.normal.y>0?S.max.y:S.min.y,Q.z=r.normal.z>0?S.max.z:S.min.z,r.distanceToPoint(Q)<0)return!1}return!0}}(),containsPoint:function(v){for(var D=this.planes,h=0;6>h;h++)if(D[h].distanceToPoint(v)<0)return!1;return!0}});var Fl=W.Math.Matrix4=function(){this.el=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};G.assign(Fl.prototype,{set:function(g,X,J,A,I,O,w,T,i,S,s,E,Q,U,C,d){var k=this.el;return k[0]=g,k[4]=X,k[8]=J,k[12]=A,k[1]=I,k[5]=O,k[9]=w,k[13]=T,k[2]=i,k[6]=S,k[10]=s,k[14]=E,k[3]=Q,k[7]=U,k[11]=C,k[15]=d,this},clone:function(){return(new Fl).fromArray(this.el)},fromArray:function(t,n){n===d&&(n=0);for(var i=this.el,r=0;16>r;r++)i[r]=t[r+n];return this},scale:function(m){var e=this.el,q=m.x,a=m.y,X=m.z;return e[0]*=q,e[4]*=a,e[8]*=X,e[1]*=q,e[5]*=a,e[9]*=X,e[2]*=q,e[6]*=a,e[10]*=X,e[3]*=q,e[7]*=a,e[11]*=X,this},makeRotationFromEuler:function(i){var J=this.el,Q=i._x,O=i._y,m=i._z,Y=i._order,M=Math.cos(Q),B=Math.sin(Q),x=Math.cos(O),e=Math.sin(O),Z=Math.cos(m),w=Math.sin(m);if("XYZ"===Y){var g=M*Z,f=M*w,r=B*Z,F=B*w;J[0]=x*Z,J[4]=-x*w,J[8]=e,J[1]=f+r*e,J[5]=g-F*e,J[9]=-B*x,J[2]=F-g*e,J[6]=r+f*e,J[10]=M*x}else if("YXZ"===Y){var E=x*Z,N=x*w,k=e*Z,j=e*w;J[0]=E+j*B,J[4]=k*B-N,J[8]=M*e,J[1]=M*w,J[5]=M*Z,J[9]=-B,J[2]=N*B-k,J[6]=j+E*B,J[10]=M*x}else if("ZXY"===Y){var E=x*Z,N=x*w,k=e*Z,j=e*w;J[0]=E-j*B,J[4]=-M*w,J[8]=k+N*B,J[1]=N+k*B,J[5]=M*Z,J[9]=j-E*B,J[2]=-M*e,J[6]=B,J[10]=M*x}else if("ZYX"===Y){var g=M*Z,f=M*w,r=B*Z,F=B*w;J[0]=x*Z,J[4]=r*e-f,J[8]=g*e+F,J[1]=x*w,J[5]=F*e+g,J[9]=f*e-r,J[2]=-e,J[6]=B*x,J[10]=M*x}else if("YZX"===Y){var P=M*x,X=M*e,q=B*x,G=B*e;J[0]=x*Z,J[4]=G-P*w,J[8]=q*w+X,J[1]=w,J[5]=M*Z,J[9]=-B*Z,J[2]=-e*Z,J[6]=X*w+q,J[10]=P-G*w}else if("XZY"===Y){var P=M*x,X=M*e,q=B*x,G=B*e;J[0]=x*Z,J[4]=-w,J[8]=e*Z,J[1]=P*w+G,J[5]=M*Z,J[9]=X*w-q,J[2]=q*w-X,J[6]=B*Z,J[10]=G*w+P}return J[3]=0,J[7]=0,J[11]=0,J[12]=0,J[13]=0,J[14]=0,J[15]=1,this},makeRotationFromQuaternion:function(p){var z=this.el,f=p._x,S=p._y,X=p._z,F=p._w,C=f+f,R=S+S,i=X+X,K=f*C,G=f*R,g=f*i,$=S*R,L=S*i,q=X*i,M=F*C,D=F*R,h=F*i;return z[0]=1-($+q),z[4]=G-h,z[8]=g+D,z[1]=G+h,z[5]=1-(K+q),z[9]=L-M,z[2]=g-D,z[6]=L+M,z[10]=1-(K+$),z[3]=0,z[7]=0,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},getInverse:function(o){var c=this.el,F=o.el,i=F[0],e=F[1],L=F[2],b=F[3],B=F[4],y=F[5],l=F[6],w=F[7],H=F[8],d=F[9],R=F[10],n=F[11],Z=F[12],W=F[13],X=F[14],P=F[15],O=d*X*w-W*R*w+W*l*n-y*X*n-d*l*P+y*R*P,a=Z*R*w-H*X*w-Z*l*n+B*X*n+H*l*P-B*R*P,s=H*W*w-Z*d*w+Z*y*n-B*W*n-H*y*P+B*d*P,z=Z*d*l-H*W*l-Z*y*R+B*W*R+H*y*X-B*d*X,p=i*O+e*a+L*s+b*z;if(0===p)return this.identity();var Q=1/p;return c[0]=O*Q,c[1]=(W*R*b-d*X*b-W*L*n+e*X*n+d*L*P-e*R*P)*Q,c[2]=(y*X*b-W*l*b+W*L*w-e*X*w-y*L*P+e*l*P)*Q,c[3]=(d*l*b-y*R*b-d*L*w+e*R*w+y*L*n-e*l*n)*Q,c[4]=a*Q,c[5]=(H*X*b-Z*R*b+Z*L*n-i*X*n-H*L*P+i*R*P)*Q,c[6]=(Z*l*b-B*X*b-Z*L*w+i*X*w+B*L*P-i*l*P)*Q,c[7]=(B*R*b-H*l*b+H*L*w-i*R*w-B*L*n+i*l*n)*Q,c[8]=s*Q,c[9]=(Z*d*b-H*W*b-Z*e*n+i*W*n+H*e*P-i*d*P)*Q,c[10]=(B*W*b-Z*y*b+Z*e*w-i*W*w-B*e*P+i*y*P)*Q,c[11]=(H*y*b-B*d*b-H*e*w+i*d*w+B*e*n-i*y*n)*Q,c[12]=z*Q,c[13]=(H*W*L-Z*d*L+Z*e*R-i*W*R-H*e*X+i*d*X)*Q,c[14]=(Z*y*L-B*W*L-Z*e*l+i*W*l+B*e*X-i*y*X)*Q,c[15]=(B*d*L-H*y*L+H*e*l-i*d*l-B*e*R+i*y*R)*Q,this},makeRotationAxis:function(x,J){var l=Math.cos(J),W=Math.sin(J),y=1-l,d=x.x,C=x.y,$=x.z,P=y*d,v=y*C;return this.set(P*d+l,P*C-W*$,P*$+W*C,0,P*C+W*$,v*C+l,v*$-W*d,0,P*$-W*C,v*$+W*d,y*$*$+l,0,0,0,0,1),this},multiply:function(M){return this.multiplyMatrices(this,M)},premultiply:function(y){return this.multiplyMatrices(y,this)},multiplyMatrices:function(i,m){var D=i.el,x=m.el,F=this.el,P=D[0],z=D[4],d=D[8],l=D[12],n=D[1],v=D[5],w=D[9],X=D[13],p=D[2],o=D[6],a=D[10],I=D[14],g=D[3],T=D[7],U=D[11],G=D[15],H=x[0],J=x[4],E=x[8],W=x[12],h=x[1],q=x[5],K=x[9],r=x[13],M=x[2],B=x[6],V=x[10],b=x[14],R=x[3],f=x[7],A=x[11],Y=x[15];return F[0]=P*H+z*h+d*M+l*R,F[4]=P*J+z*q+d*B+l*f,F[8]=P*E+z*K+d*V+l*A,F[12]=P*W+z*r+d*b+l*Y,F[1]=n*H+v*h+w*M+X*R,F[5]=n*J+v*q+w*B+X*f,F[9]=n*E+v*K+w*V+X*A,F[13]=n*W+v*r+w*b+X*Y,F[2]=p*H+o*h+a*M+I*R,F[6]=p*J+o*q+a*B+I*f,F[10]=p*E+o*K+a*V+I*A,F[14]=p*W+o*r+a*b+I*Y,F[3]=g*H+T*h+U*M+G*R,F[7]=g*J+T*q+U*B+G*f,F[11]=g*E+T*K+U*V+G*A,F[15]=g*W+T*r+U*b+G*Y,this},lookAt:function(){var a=new Ob,I=new Ob,F=new Ob;return function(W,B,v){var s=this.el;return F.subVectors(W,B),0===F.lengthSq()&&(F.z=1),F.normalize(),a.crossVectors(v,F),0===a.lengthSq()&&(1===Math.abs(v.z)?F.x+=1e-4:F.z+=1e-4,F.normalize(),a.crossVectors(v,F)),a.normalize(),I.crossVectors(F,a),s[0]=a.x,s[4]=I.x,s[8]=F.x,s[1]=a.y,s[5]=I.y,s[9]=F.y,s[2]=a.z,s[6]=I.z,s[10]=F.z,this}}(),extractScale:function(){var N;return function(H){N===d&&(N=new Ob),H===d&&(H=new Ob);var f=N.setFromMatrixColumn(this,0).length(),u=N.setFromMatrixColumn(this,1).length(),A=N.setFromMatrixColumn(this,2).length();return H.set(f,u,A),H}}(),extractRotation:function(){var n;return function(W){n===d&&(n=new Ob),W===d&&(W=new Fl);var k=this.el,A=W.el,_=1/n.setFromMatrixColumn(W,0).length(),p=1/n.setFromMatrixColumn(W,1).length(),G=1/n.setFromMatrixColumn(W,2).length();return k[0]=A[0]*_,k[1]=A[1]*_,k[2]=A[2]*_,k[4]=A[4]*p,k[5]=A[5]*p,k[6]=A[6]*p,k[8]=A[8]*G,k[9]=A[9]*G,k[10]=A[10]*G,this}}(),multiplyScalar:function(_){var a=this.el;return a[0]*=_,a[4]*=_,a[8]*=_,a[12]*=_,a[1]*=_,a[5]*=_,a[9]*=_,a[13]*=_,a[2]*=_,a[6]*=_,a[10]*=_,a[14]*=_,a[3]*=_,a[7]*=_,a[11]*=_,a[15]*=_,this},getPosition:function(G){return G===d&&(G=new Ob),G.setFromMatrixColumn(this,3)},setPosition:function(J){var Q=this.el;return Q[12]=J.x,Q[13]=J.y,Q[14]=J.z,this},toArray:function(z,_){z===d&&(z=[]),_===d&&(_=0);var P=this.el;return z[_]=P[0],z[_+1]=P[1],z[_+2]=P[2],z[_+3]=P[3],z[_+4]=P[4],z[_+5]=P[5],z[_+6]=P[6],z[_+7]=P[7],z[_+8]=P[8],z[_+9]=P[9],z[_+10]=P[10],z[_+11]=P[11],z[_+12]=P[12],z[_+13]=P[13],z[_+14]=P[14],z[_+15]=P[15],z},determinant:function(){var J=this.el,L=J[0],n=J[4],D=J[8],I=J[12],i=J[1],e=J[5],j=J[9],l=J[13],G=J[2],F=J[6],V=J[10],v=J[14],U=J[3],Z=J[7],P=J[11],o=J[15];return U*(+I*j*F-D*l*F-I*e*V+n*l*V+D*e*v-n*j*v)+Z*(+L*j*v-L*l*V+I*i*V-D*i*v+D*l*G-I*j*G)+P*(+L*l*F-L*e*v-I*i*F+n*i*v+I*e*G-n*l*G)+o*(-D*e*G-L*j*F+L*e*V+D*i*F-n*i*V+n*j*G)},copy:function(d){var H=this.el,$=d.el;return H[0]=$[0],H[1]=$[1],H[2]=$[2],H[3]=$[3],H[4]=$[4],H[5]=$[5],H[6]=$[6],H[7]=$[7],H[8]=$[8],H[9]=$[9],H[10]=$[10],H[11]=$[11],H[12]=$[12],H[13]=$[13],H[14]=$[14],H[15]=$[15],this},compose:function(B,T,K){var C=this.el,Z=T._x,u=T._y,U=T._z,z=T._w,f=Z+Z,h=u+u,I=U+U,H=Z*f,d=Z*h,O=Z*I,M=u*h,q=u*I,A=U*I,N=z*f,n=z*h,Q=z*I,X=K.x,k=K.y,p=K.z;return C[0]=(1-(M+A))*X,C[1]=(d+Q)*X,C[2]=(O-n)*X,C[3]=0,C[4]=(d-Q)*k,C[5]=(1-(H+A))*k,C[6]=(q+N)*k,C[7]=0,C[8]=(O+n)*p,C[9]=(q-N)*p,C[10]=(1-(H+M))*p,C[11]=0,C[12]=B.x,C[13]=B.y,C[14]=B.z,C[15]=1,this},decompose:function(){var V=new Ob,F=new Fl;return function(s,M,g){var L=this.el,e=V.set(L[0],L[1],L[2]).length(),d=V.set(L[4],L[5],L[6]).length(),p=V.set(L[8],L[9],L[10]).length(),Z=this.determinant();0>Z&&(e=-e),s.x=L[12],s.y=L[13],s.z=L[14],F.copy(this);var v=1/e,w=1/d,b=1/p;return F.el[0]*=v,F.el[1]*=v,F.el[2]*=v,F.el[4]*=w,F.el[5]*=w,F.el[6]*=w,F.el[8]*=b,F.el[9]*=b,F.el[10]*=b,M.setFromRotationMatrix(F),g.x=e,g.y=d,g.z=p,this}}()});var je=W.Math.Triangle=function($,S,k){this.a=$!==d?$:new Ob,this.b=S!==d?S:new Ob,this.c=k!==d?k:new Ob};G.assign(je,{barycoordFromPoint:function(){var T=new Ob,z=new Ob,G=new Ob;return function(B,A,N,w,F){T.subVectors(w,A),z.subVectors(N,A),G.subVectors(B,A);var C=T.dot(T),W=T.dot(z),p=T.dot(G),D=z.dot(z),S=z.dot(G),u=C*D-W*W,$=F||new Ob;if(0===u)return $.set(-2,-1,-1);var J=1/u,y=(D*p-W*S)*J,c=(C*S-W*p)*J;return $.set(1-y-c,c,y)}}()});var pi=W.Math.Euler=function(m,T,v,J,o){this.set(m,T,v,J,o)};pi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],pi.DefaultOrder="XYZ",pi.ReverseOrder=function(C){return C=C[2]+C[1]+C[0],C.toUpperCase()},G.defineProperties(pi.prototype,{x:{get:function(){return this._x},set:function(S){this._x=S,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(m){this._y=m,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(x){this._z=x,this.onChangeCallback()}},order:{get:function(){return this._order},set:function($){this._order=$,this.onChangeCallback()}}}),G.assign(pi.prototype,{set:function(L,Z,n,u,k){return En(L)&&(k=n,u=Z,n=L[2],Z=L[1],L=L[0]),u?k&&(u=pi.ReverseOrder(u)):u="ZYX",this._x=L||0,this._y=Z||0,this._z=n||0,this._order=u||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this.onChangeCallback(),this},setFromRotationMatrix:function(Y,x,R){var N=W.Math.clamp,F=Y.el||Y,Q=F[0],Z=F[4],h=F[8],D=F[1],k=F[5],L=F[9],S=F[2],H=F[6],f=F[10];return x=x||this._order,"XYZ"===x?(this._y=Math.asin(N(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-L,f),this._z=Math.atan2(-Z,Q)):(this._x=Math.atan2(H,k),this._z=0)):"YXZ"===x?(this._x=Math.asin(-N(L,-1,1)),Math.abs(L)<.99999?(this._y=Math.atan2(h,f),this._z=Math.atan2(D,k)):(this._y=Math.atan2(-S,Q),this._z=0)):"ZXY"===x?(this._x=Math.asin(N(H,-1,1)),Math.abs(H)<.99999?(this._y=Math.atan2(-S,f),this._z=Math.atan2(-Z,k)):(this._y=0,this._z=Math.atan2(D,Q))):"ZYX"===x?(this._y=Math.asin(-N(S,-1,1)),Math.abs(S)<.99999?(this._x=Math.atan2(H,f),this._z=Math.atan2(D,Q)):(this._x=0,this._z=Math.atan2(-Z,k))):"YZX"===x?(this._z=Math.asin(N(D,-1,1)),Math.abs(D)<.99999?(this._x=Math.atan2(-L,k),this._y=Math.atan2(-S,Q)):(this._x=0,this._y=Math.atan2(h,f))):"XZY"===x?(this._z=Math.asin(-N(Z,-1,1)),Math.abs(Z)<.99999?(this._x=Math.atan2(H,k),this._y=Math.atan2(h,Q)):(this._x=Math.atan2(-L,f),this._y=0)):console.warn("unsupported order: "+x),this._order=x,R!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var T=new Fl;return function(W,N,J){return T.makeRotationFromQuaternion(W),this.setFromRotationMatrix(T,N,J)}}(),setFromVector3:function(g,O){return this.set(g.x,g.y,g.z,O||this._order)},reorder:function(){var k=new Tg;return function(q){return k.setFromEuler(this),this.setFromQuaternion(k,q)}}(),equals:function(g){return g._x===this._x&&g._y===this._y&&g._z===this._z&&g._order===this._order},fromArray:function(U){return this._x=U[0],this._y=U[1],this._z=U[2],U[3]!==d&&(this._order=U[3]),this.onChangeCallback(),this},toArray:function(p,v){return p===d&&(p=[]),v===d&&(v=0),p[v]=this._x,p[v+1]=this._y,p[v+2]=this._z,p[v+3]=this._order,p},toVector3:function(D){return D?D.set(this._x,this._y,this._z):new Ob(this._x,this._y,this._z)},onChange:function(s){return this.onChangeCallback=s,this},onChangeCallback:function(){}});var zp={ms_ac:function(x,y){for(var d=y.ms_ac,I=0;I<d.length;I++)sk(x,d[I])},ms_listener:function(D){D.addListeners=function(){for(var q=this,e=0;e<gs.length;e++)q["handle_"+gs[e]]&&Re(gs[e],q.getView(),q)},D.removeListeners=function(){for(var Z=this,D=0;D<gs.length;D++)Z["handle_"+gs[D]]&&cq(gs[D],Z.getView(),Z)}},ms_fire:function(K){K.mp=function(_,d,Z){this.addPropertyChangeListener(_,d,Z)},K.ump=function(B,K){this.removePropertyChangeListener(B,K)},K.fp=function(d,q,h,t,i){return this.firePropertyChange(d,q,h,t,i)},K.addPropertyChangeListener=function(O,m,w){var h=this;h._62I||(h._62I=new Ff),h._62I.add(O,m,w)},K.removePropertyChangeListener=function(L,r){this._62I&&this._62I.remove(L,r)},K.firePropertyChange=function(J,v,R,D,u){if(D){if(D(v,R))return!1}else if(v===R)return!1;var X=this,P=u||{};return P.property=J,P.oldValue=v,P.newValue=R,P.source=X,P.data=X,X._62I&&X._62I.fire(P),X.onPropertyChanged&&X.onPropertyChanged(P),!0}},ms_attr:function(m){m.a=function(n,I){var $=this;if(2===arguments.length)$.setAttr(n,I);else{if(!zn(n))return $.getAttr(n);for(var Z in n)$.setAttr(Z,n[Z])}return $},m.getAttr=function(R,B){if(B===d&&(B=1),this._attrObject&&R in this._attrObject)return this._attrObject[R];if(this.getImage){var H=this.getImage();if(Gk(H)&&(H=js[H]),zn(H)&&"dataBindings"in H)for(var x=H.dataBindings,M=x.length-1;M>=0;M--){var p=x[M];if(p.attr===R){if("defaultValue"in p)return p.defaultValue;break}}}return B?c[R]:d},m.setAttr=function(j,A){var h=this;h._attrObject||(h._attrObject={});var R=h._attrObject[j];A===d?delete h._attrObject[j]:h._attrObject[j]=A,h.fp&&h.fp("a:"+j,R,A)&&h.onAttrChanged&&h.onAttrChanged(j,R,A)},m.getSerializableAttrs=function(){var b,A={};for(b in this._attrObject)A[b]=1;return A}},ms_bnb:function(D){D.getBodyColor=function(H){return H.s("body.color")},D.getBorderColor=function(S){return S.s("border.color")}},_51o:function(p){p.mi=function(n,l,P){this.addInteractorListener(n,l,P)},p.umi=function(X,_){this.removeInteractorListener(X,_)},p.fi=function(Q){this.fireInteractorEvent(Q)},p.addInteractorListener=function(U,s,c){var Z=this;Z._63I||(Z._63I=new Ff),Z._63I.add(U,s,c)},p.removeInteractorListener=function(M,V){this._63I&&this._63I.remove(M,V)},p.fireInteractorEvent=function(L){this._63I&&this._63I.fire(L)},p.setInteractors=function(w){var Q=this,B=Q._interactors;B&&B.each(function(I){I.tearDown()}),En(w)&&(w=new Kf(w)),Q._interactors=w,w&&w.each(function(z){z.setUp()}),Q.fp("interactors",B,w),Q.invalidateSelection()},p.getInteractors=function(){return this._interactors}},_49o:function(X){X._44O=S,X._45O=S,X.getTopPainters=function(){return this._44O},X.getBottomPainters=function(){return this._45O},X.addTopPainter=function(n){var c=this;c._44O||(c._44O=new Kf),c._44O.contains(n)||(c._44O.add(n),c.redraw&&c.redraw())},X.removeTopPainter=function(c){var P=this;P._44O&&(P._44O.remove(c),P.redraw&&P.redraw())},X.addBottomPainter=function(i){var D=this;D._45O||(D._45O=new Kf),D._45O.contains(i)||(D._45O.add(i),D.redraw&&D.redraw())},X.removeBottomPainter=function(O){var U=this;U._45O&&(U._45O.remove(O),U.redraw&&U.redraw())},X._93db=function(r,Z){var S=this;S._45O&&S._45O.each(function(T){T.draw?T.draw(r,Z):T.call(S,r,Z)})},X._92db=function(u,K){var $=this;$._44O&&$._44O.each(function(R){R.draw?R.draw(u,K):R.call($,u,K)})}},ms_sm:function(i){i.sm=function(){return this.getSelectionModel()},i.setSelectableFunc=function(F){this.sm().setFilterFunc(F)},i.getSelectableFunc=function(){return this.sm().getFilterFunc()},i.getSelectionModel=function(){var I=this;return I._selectionModel?I._selectionModel:I.dm().sm()},i.isSelectionModelShared=function(){return!this._selectionModel},i.setSelectionModelShared=function(Y){var H=this,D=!H._selectionModel,$=H.handleSelectionChange,X=H.dm();D!==Y&&(H.invalidateSelection&&H.invalidateSelection(),Y?(X.sm().ms($,H),H._selectionModel.ums($,H),H._selectionModel.dispose(),H._selectionModel=S):(X.sm().ums($,H),H._selectionModel=new xs(X),H._selectionModel.ms($,H)),H.onSelectionModelSharedChanged(),H.fp("selectionModelShared",D,Y))},i.onSelectionModelSharedChanged=function(){var I=this;I.redraw(),I.invalidateSelection&&I.invalidateSelection()},i.removeSelection=function(){var y=this.dm();y.beginTransaction(),this.sm().toSelection().each(y.remove,y),y.endTransaction()},i.selectAll=function(){var t=this;t.sm().ss(t.dm().toDatas(function(l){return t.isVisible(l)&&t.isSelectable(l)}))},i.isSelected=function(p){return this.sm().co(p)},i.isSelectedById=function(Y){var Z=this.dm().getDataById(Y);return Z?this.isSelected(Z):!1},i.isSelectable=function(T){return this.sm().isSelectable(T)}},ms_tx:function(P){P._64I=0,P._65O=0,P.isScrollable=function(){return this.getWidth()<this._64I},P._40o=function(){return this.isScrollable()},P.getLogicalPoint=function(z){return we(z,this._canvas||this._view,this.tx(),this.ty?this.ty():0)},P.tx=function(G){return G===d?this.getTranslateX():(this.setTranslateX(G),void 0)},P.getTranslateX=function(){return this._65O},P.setTranslateX=function(O){var T=this,u=T.getWidth()-T._64I;u>O&&(O=u),O>0&&(O=0),O=t(O);var b=T._65O;T._65O=O,T.fp(hg,b,O)}},ms_ty:function(s){s._23Q=0,s._66O=0,s._41o=function(){return this.getHeight()<this._23Q},s.getLogicalPoint=function(P){return we(P,this._canvas||this._view,this.tx?this.tx():0,this.ty())},s.ty=function(m){return m===d?this.getTranslateY():(this.setTranslateY(m),void 0)},s.getTranslateY=function(){return this._66O},s.setTranslateY=function(V){var A=this,X=A.getHeight()-A._23Q;X>V&&(V=X),V>0&&(V=0),V=t(V);var r=A._66O;A._66O=V,A.fp(tg,r,V)}},ms_txy:function(u){u._65O=0,u._66O=0,u.tx=function(R){return R===d?this.getTranslateX():(this.setTranslateX(R),void 0)},u.ty=function(m){return m===d?this.getTranslateY():(this.setTranslateY(m),void 0)},u.onTranslateEnded=function(){},u.setTranslate=function(W,Q,F){var h=this;if(F=tm(F)){h._65I&&h._65I.stop(!0);var t=h.tx(),i=h.ty();F.action=function(x){h.setTranslate(t+(W-t)*x,i+(Q-i)*x)},F._37o=function(){delete h._66I,delete h._65I,h.onTranslateEnded()},h._66I=1,h._65I=jn(F)}else h.tx(W),h.ty(Q)},u.getTranslateX=function(){return this._65O},u.setTranslateX=function(y){var q=this;y=q.adjustTranslateX(y);var c=q._65O;q._65O=y,q.fp(hg,c,y)},u.getTranslateY=function(){return this._66O},u.setTranslateY=function(r){var Q=this;
r=Q.adjustTranslateY(r);var I=Q._66O;Q._66O=r,Q.fp(tg,I,r)},u.adjustTranslateX=function(Y){return t(Y)},u.adjustTranslateY=function(W){return t(W)},u.translate=function(i,m,f){this.setTranslate(this.tx()+i,this.ty()+m,f)},u.getLogicalPoint=function(t){var k=this;return we(t,this._canvas||k._view,k.tx(),k.ty())}},ms_dm:function(v){v.dm=function(R){return R?(this.setDataModel(R),void 0):this.getDataModel()},v.getDataModel=function(){return this._dataModel}},ms_lp:function(Z){Z.lp=function(h){return this.getLogicalPoint(h)}},ms_v:function(m){m._disabled=!1,m.setDisabled=function(n,g){var _=this,i=_._disabled;i!==n&&(i&&(ws(_._63O),delete _._63O),n&&(lc(_._view,_._63O=ub(g)),_.iv()),_._disabled=n,_.fp("disabled",i,n))},m.isDisabled=function(){return this._disabled},m.getDisabledDiv=function(){return this._63O},m.getView=function(){return this._view},m.addToDOM=function(y){var n=this,g=n.getView(),S=g.style;y=y||l.body,y.appendChild(g),S.left="0",S.right="0",S.top="0",S.bottom="0",s(E,"resize",function(){n.iv()}),n.iv()},m.getWidth=function(){return this._view.clientWidth},m.getHeight=function(){return this._view.clientHeight},m.setWidth=function(j){var Q=this;Q._view.style.width=j+wo,Q.iv(),Q.fp&&Q.fp(ml,S,j)},m.setHeight=function(w){var l=this;l._view.style.height=w+wo,l.iv(),l.fp&&l.fp(ao,S,w)},m.setFocus=function(s){var p=this,Y=p._currentEditor;return s&&Y&&(Y.getView&&(Y=Y.getView()),Y.contains(s.target))?!1:(bd(p._view),p.endEditing&&p.endEditing(),p.fireViewEvent("focus"),!0)},m.iv=function(T){this.invalidate(T)},m.invalidate=function(z){var Y=this;Y._68I||(Y._68I=1,dk(Y.validate,Y,S,z),Y.onInvalidated&&Y.onInvalidated(),Y.fireViewEvent("invalidate"))},m.validate=function(){var f=this,L=f._view;if(f._68I&&(delete f._68I,L.parentNode))if(0===L.offsetWidth&&0===L.offsetHeight&&f._67I!==S)f._67I===d&&(f._67I=X.reinvalidateCount),f._67I>0?f._67I--:f._67I=S,f.iv();else{f.fireViewEvent("beginValidate"),f.validateImpl(),f.onValidated&&f.onValidated(),f.fireViewEvent("validate");var Q=f._63O;Q&&(L.lastChild!==Q&&(ws(Q),lc(L,Q)),Ap(Q,0,0,f.getWidth(),f.getHeight())),es(f),dp(f),Xf(f)}},m.layout=function(v,U,D,b){1===arguments.length?Ap(this,v):Ap(this,v,U,D,b)},m.addViewListener=function(J,L,G){var v=this;v._67O||(v._67O=new Ff),v._67O.add(J,L,G)},m.removeViewListener=function(b,$){this._67O.remove(b,$)},m.fireViewEvent=function(B){var J=this;J._67O&&(Gk(B)&&(B={kind:B}),J._67O.fire(B)),X.viewListener&&X.viewListener(J,B)}},ms_tip:function(I){I.setToolTipEnabled=function(i){var q=this;i?xl||q._13o||(q.enableToolTip(),q.fp("toolTipEnabled",!1,!0)):q._13o&&(q.disableToolTip(),q.fp("toolTipEnabled",!0,!1))},I.isToolTipEnabled=function(){return!!this._13o},I.enableToolTip=function(){var o=this;if(!xl&&!o._13o){o._13o=function(a){var e=o.getToolTip(a);e!=S?X.toolTipContinual&&X.isToolTipShowing()?Co(a,e):(qi(),Mb={timeout:J(Sh,Gj),e:a,info:e}):qi()};var h=o.getView();s(h,zk,o._13o),s(h,"mouseleave",X.hideToolTip)}},I.disableToolTip=function(){var O=this;if(O._13o){var V=O.getView();F(V,zk,O._13o),F(V,"mouseleave",X.hideToolTip),delete O._13o}},I.getToolTip=function(N){var y=this;if(y.getDataAt){var C=y.getDataAt(N);return C?C.getToolTip():S}return y.getValue?y.getValue():void 0}},_52o:function(X){X._zoom=1,X._29I=No,X.zoomIn=function(I,B){this.setZoom(this._zoom*ds,I,B)},X.zoomOut=function(G,C){this.setZoom(this._zoom/ds,G,C)},X.zoomReset=function(j,L){this.setZoom(1,j,L)},X.scrollZoomIn=function(T){this.setZoom(this._zoom*Le,S,T)},X.scrollZoomOut=function(D){this.setZoom(this._zoom/Le,S,D)},X.pinchZoomIn=function(O){this.setZoom(this._zoom*dj,S,O)},X.pinchZoomOut=function(R){this.setZoom(this._zoom/dj,S,R)},X.adjustZoom=function(m){return _e>m?_e:m>wm?wm:m},X.getZoom=function(){return this._zoom},X.setZoom=function(o,I,d){var c=this;if(I=tm(I)){c._14o&&c._14o.stop(!0);var q=c._zoom;I.action=function(g){c._96O(q+(o-q)*g,d)},I._37o=function(){delete c._zooming,delete c._14o,c.onZoomEnded()},c._zooming=1,c._14o=jn(I)}else c._96O(o,d)},X._96O=function($,g){var d=this;if($=d.adjustZoom($),$!==d._zoom){d.validate();var j=d._29I,J=d._zoom;0!==j.width&&0!==j.height&&(g=g?g:{x:j.x+j.width/2,y:j.y+j.height/2},d.tx((g.x-j.x)*J-g.x*$),d.ty((g.y-j.y)*J-g.y*$)),d._zoom=$,d.fp("zoom",J,$)}}},ms_edge:function(S){S._2I=function(S){var V=this;V._44I||(V._44I=new Kf),V._42I||(V._42I=new Kf),V._44I.add(S),V._42I.add(S),V._20I()},S._4I=function(x){var Y=this;Y._44I||(Y._44I=new Kf),Y._43I||(Y._43I=new Kf),Y._44I.add(x),Y._43I.add(x),Y._20I()},S._16I=function(l){var Q=this;Q._44I.remove(l),Q._42I.remove(l),Q._44I.isEmpty()&&delete Q._44I,Q._42I.isEmpty()&&delete Q._42I,Q._20I()},S._18I=function(n){var Y=this;Y._44I.remove(n),Y._43I.remove(n),Y._44I.isEmpty()&&delete Y._44I,Y._43I.isEmpty()&&delete Y._43I,Y._20I()},S._20I=function(){var $=this;if(delete $._45I,!$._44I||$._44I.isEmpty())return delete $._70O,void 0;var C;$._44I.each(function(k){k.isLooped()&&(C||(C={}),C[k._id]||($._45I||($._45I=new Kf),$._45I.add(k),C[k._id]=k))}),C?($._70O=new Kf,$._44I.each(function(a){C[a._id]?"A"===C[a._id]||(C[a._id]="A",$._70O.add(a)):$._70O.add(a)})):$._70O=$._44I},S.hasAgentEdges=function(){return!!this._49I&&!this._49I.isEmpty()},S.getSourceAgentEdges=function(){return this._46I},S.getTargetAgentEdges=function(){return this._47I},S._1I=function(p){var I=this;I._46I||(I._46I=new Kf),I._48I||(I._48I=new Kf),I._46I.add(p),I._48I.add(p),I._19I()},S._3I=function(u){var l=this;l._47I||(l._47I=new Kf),l._48I||(l._48I=new Kf),l._47I.add(u),l._48I.add(u),l._19I()},S._15I=function(b){var z=this;z._46I.remove(b),z._48I.remove(b),z._46I.isEmpty()&&delete z._46I,z._48I.isEmpty()&&delete z._48I,z._19I()},S._17I=function(y){var K=this;K._47I.remove(y),K._48I.remove(y),K._47I.isEmpty()&&delete K._47I,K._48I.isEmpty()&&delete K._48I,K._19I()},S._19I=function(){var _=this;delete _._49I;var w=_._48I;if(w&&!w.isEmpty()){var z={};w.each(function(d){z[d._id]?_._49I||(_._49I=new Kf):z[d._id]=d}),_._49I?w.each(function(T){z[T._id]&&(_._49I.add(T),delete z[T._id])}):_._49I=w}},S.getLoopedEdges=function(){return this._45I},S.getEdges=function(){return this._70O},S.getAgentEdges=function(){return this._49I},S.getSourceEdges=function(){return this._42I},S.getTargetEdges=function(){return this._43I},S._8I=function(){this._70O&&this._70O.each(function(T){T._7I()})}}};uj(X,{numberDigits:5,crossOrigin:"",baseZIndex:d,isTouchable:xl,devicePixelRatio:E.devicePixelRatio?E.devicePixelRatio:1,reinvalidateCount:3,hitMaxArea:3e3,imageCacheThreshold:20,autoMakeVisible:!0,autoHideScrollBar:!0,disabledOpacity:.4,disabledBackground:v.disabledBackground,forceHierarchicalSerialization:!0,hoverDelay:600,clickDelay:200,toolTipDelay:800,toolTipContinual:!1,getDragger:function(){return Zp},lineCap:"butt",lineJoin:"round",imageGradient:"linear.northeast",dashPattern:[16,16],encodeStringKey:null,doubleClickRange:xl?20:1,animDuration:200,animEasing:function(T){return T*T},labelColor:$g,labelSelectColor:Ve,labelFont:(xl?"15":"12")+"px arial, sans-serif",widgetIndent:xl?30:20,widgetRowHeight:xl?30:20,widgetHeaderHeight:xl?32:22,widgetTitleHeight:xl?34:24,scrollBarColor:mg,scrollBarSize:7,scrollBarTimeout:1e3,scrollBarMinLength:20,scrollBarInteractiveSize:xl?32:16,zoomIncrement:1.3,scrollZoomIncrement:1.05,pinchZoomIncrement:1.08,zoomMax:20,zoomMin:.01,segmentResolution:12,shapeResolution:24,shapeSide:24,intersectionLineRect:tn,intersectionLineLine:Rq,isEnter:jo,isEsc:_f,isDelete:bg,isSpace:Aq,isLeft:ak,isUp:Zh,isRight:vj,isDown:ff,getTarget:Jm,isString:Gk,isNumber:Vc,isBoolean:Uf,isArray:En,isSelectAll:sr,isFunction:dc,isObject:zn,getPropertyValue:Fo,setPropertyValue:$p,addMethod:uj,getVersion:function(){return"7.0.2"},createGradient:function(D,Q,j,z,F,B,v,y){var V=Jh[Q];return V(D,j,z,F,B,v,y)},appendToScreen:function(n){n=n.getView?n.getView():n,(l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement||l.msFullscreenElement||l.body).appendChild(n)},encodeString:function(f){return W.Math.encodeBase64(f,X.encodeStringKey)},decodeString:function(r){return W.Math.decodeBase64(r,X.encodeStringKey)},findView:function(k){var Q=function(s,O){var w=O._ht;w&&s.push(w);var z=O.children,B=z.length;if(B)for(var X=0;B>X;X++)Q(s,z[X])},S=[];Q(S,l.body);var e=function(j,z){for(var s="2d"===z?Ee.GraphView:Er.Graph3dView,c=0,O=j.length;O>c;c++)if(j[c]instanceof s)return S[c];return null};return"all"===k?S:"2d"===k?e(S,"2d"):"3d"===k?e(S,"3d"):e(S,"3d")||e(S,"2d")},toggleFullscreen:function(T){var B=T.getView();if(l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement||l.msFullscreenElement)l.exitFullscreen?l.exitFullscreen():l.msExitFullscreen?l.msExitFullscreen():l.mozCancelFullScreen?l.mozCancelFullScreen():l.webkitExitFullscreen&&l.webkitExitFullscreen();else{var k=!0;if(T.isSelfViewEvent){var v=T.getX(),F=T.getY(),O=T.getWidth(),Q=T.getHeight(),X=B.style.background,p=B.style.backgroundColor;X||p||(B.style.backgroundColor="white"),B.requestFullscreen?B.requestFullscreen():B.msRequestFullscreen?B.msRequestFullscreen():B.mozRequestFullScreen?B.mozRequestFullScreen():B.webkitRequestFullscreen&&B.webkitRequestFullscreen();var r=setInterval(function(){if(B!==(l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement||l.msFullscreenElement))clearInterval(r),T.setX(v),T.setY(F),T.setWidth(O),T.setHeight(Q),T._fullscreen=!1,B.style.oldBackgroundColor=p,T.iv();else{var M=W.Default.getWindowInfo();(k||M.width!==T.getWidth()||M.height!==T.getHeight())&&(T.setX(M.left),T.setY(M.top),T.setWidth(M.width),T.setHeight(M.height),T._fullscreen=!0,T.iv(),k=!1)}},500)}else{var b=B.style.left,w=B.style.top,O=B.style.width,Q=B.style.height,X=B.style.background,p=B.style.backgroundColor;X||p||(B.style.backgroundColor="white"),B.requestFullscreen?B.requestFullscreen():B.msRequestFullscreen?B.msRequestFullscreen():B.mozRequestFullScreen?B.mozRequestFullScreen():B.webkitRequestFullscreen&&B.webkitRequestFullscreen();var r=setInterval(function(){if(B!==(l.fullscreenElement||l.mozFullScreenElement||l.webkitFullscreenElement||l.msFullscreenElement))clearInterval(r),B.style.left=b,B.style.top=w,B.style.width=O,B.style.height=Q,B.style.oldBackgroundColor=p,T.iv();else{var _=W.Default.getWindowInfo();(k||_.width!==T.getWidth()||_.height!==T.getHeight())&&(Ap(T),k=!1)}},500)}}},appendTimeStamp:function(o){return o},setCompType:function(B,m){dc(m)||zn(m)?Cp[B]=m:Pf(B)},getCompType:function(j){var P=Cp[j];return P===d&&wh.test(j)&&Pf(j),P},getCompTypeMap:function(){return Cp},drawCompType:function(B,n,r,S,l,z){B(n,r,S,l,z)},numberListener:function(){var R={46:1,8:1,9:1,27:1,13:1,109:1,110:1,189:1,190:1};return function(W){var I=W.keyCode;R[I]||65===I&&X.isCtrlDown(W)||86===I&&X.isCtrlDown(W)||67===I&&X.isCtrlDown(W)||88===I&&X.isCtrlDown(W)||I>=35&&40>=I||(W.shiftKey||48>I||I>57)&&(96>I||I>105)&&W.preventDefault()}}(),ignoreKeyCodes:[122,123],preventDefault:function(Q){var o=Q.target.tagName;("DIV"===o||"CANVAS"===o)&&!(X.ignoreKeyCodes.indexOf(Q.keyCode)>=0)&&("keydown"!==Q.type||ak(Q)||vj(Q)||Zh(Q)||ff(Q)||bg(Q)||65===Q.keyCode&&(Q.metaKey||Q.ctrlKey))&&(Q.preventDefault(),Q.preventManipulation&&Q.preventManipulation())},getWindowInfo:function(){var v=l.documentElement,A=v&&(v.scrollLeft||v.scrollTop)?v:l.body;return{target:A,left:A.scrollLeft,top:A.scrollTop,width:E.innerWidth||A.clientWidth,height:E.innerHeight||A.clientHeight}},isDragging:function(){return!!Zp},isLeftButton:function(w){return xl?!0:0===w.button},isMiddleButton:function(o){return xl?!1:o&&(1===o.button||4&(o.buttons||0))},isInput:function(N){if(!N)return!1;var Y=N.tagName;return"INPUT"===Y||"TEXTAREA"===Y||"SELECT"===Y},getTouchCount:function(G){return xl?G.touches.length:1},isDoubleClick:function(){function Y(W){W.details=0,W.timeout=null,W.lastPoint=null}var r={};return vm=new H,_i=vm.getTime(),function(f){if(f.touches&&f.touches.length>1)return!1;var $=f.button==S?"":f.button,R=f.type+$,h=R+"_isDoubleClick",p=r[R];if(p||(p=r[R]={details:0,timeout:null,lastPoint:null}),f[h]===d){f[h]=!0;var c=Xd(f);p.timeout&&(B(p.timeout),p.timeout=null),p.lastPoint&&zq(p.lastPoint,c)>X.doubleClickRange&&Y(p),p.lastPoint=c,p.details++,p.timeout=J(function(){Y(this)}.bind(p),500)}return 2===p.details}}(),isShiftDown:function(W){return W?W.shiftKey:hc["16"]},isCtrlDown:function(m){return m?vf?m.metaKey:m.ctrlKey:vf?hc["91"]:hc["17"]},getClientPoint:function(p){return xl&&(p=mr(p)),{x:p.clientX,y:p.clientY}},isMouseEvent:function(l){return l instanceof MouseEvent||0===l.type.indexOf("mouse")},getTargetElement:function(B){if(X.isMouseEvent(B)||!l.elementFromPoint)return B.target;var y=Nd(B);return l.elementFromPoint(y.x,y.y)},getPagePoint:function(v){return xl&&(v=mr(v)),{x:v.pageX,y:v.pageY}},createObject:function(p,A){var M=new p;for(var x in A){var H=A[x];if(dc(H))M[x]=H;else if(0===x.indexOf("s:"))M.s(x.substr(2),A[x]);else if(0===x.indexOf("a:"))M.a(x.substr(2),A[x]);else{var I=gb(x),H=A[x];M[I]?(M[I](H),"setToolTip"===I&&M.enableToolTip&&M.enableToolTip()):M[x]=H}}return M},setImage:function(k,n,b,Y){var g=arguments.length;4===g?Lr(k,Y,n,b):2===g?Gk(n)?Lr(k,n):Ce(k,n):1===g&&Lr(k,k)},getImage:function(o,r,u){var i;if(o==S)return S;if(zn(o)?i=o:(i=js[o],o&&i===d&&(Nn&&Nn[o]||Lr(o,o))),r&&i&&i.tagName){var D;D="override"===u?"colors_override":"override_rgb"===u?"colors_override_rgb":"override_a"===u?"colors_override_a":"colors",i[D]||(i[D]={__count__:0});var Z=i[D][r];return Z||(i[D].__count__>X.imageCacheThreshold&&(i[D]={__count__:0}),Z=Kb(i,jb(r),i.width,i.height,u),i[D][r]=Z,i[D].__count__++),Z}return i},isImageComplete:function(k,z,J){var e=Oi(k);if(!e)return!1;if(e.tagName)return e.complete;for(var L,k,B,c=e.comps,D=!0,l=0,G=c.length;G>l;l++)if(L=c[l],B=L.type,"image"===L.type){k=L.name,k&&k.func&&(k=lp(k,z));var U=Oe(k,z,J);if(!U){D=!1;break}}else if(wh.test(B)&&X.getCompType(B)===d){D=!1,Pf(B);break}return D},getId:function(){var y=1;return function(){return++y}}(),callLater:function(r,K,c,t){var h=function(){r.apply(K,c)};return t?J(h,t):E.requestAnimationFrame(h)},clone:function(q){if(null==q||"object"!=typeof q)return q;if(q instanceof Date){var X=new Date;return X.setTime(q.getTime()),X}if(q instanceof Array){for(var X=[],k=0,Z=q.length;Z>k;k++)X[k]=or(q[k]);return X}if(q instanceof Kf){for(var X=new Kf,k=0,Z=q.length;Z>k;k++)X.set(k,or(q.get(k)));return X}if(q instanceof Pp)return q;if(q instanceof G){var X={};for(var T in q)q.hasOwnProperty(T)&&(X[T]=or(q[T]));return X}return q},callWhenLoaded:function(Z,H){H=H||100;var B=xp(Z,H);fn||(fn={}),fn[B]={tick:B,cb:Z,delay:H}},beforeLoadURL:function(c){if(fn){var H={};for(var T in fn){var t=fn[T];B(t.tick);var k=xp(t.cb,t.delay);H[k]={tick:k,delay:t.delay,cb:t.cb}}fn=H}return X.convertURL?X.convertURL(c):c},convertURL:function(V){return V},handleRefGraphLoaded:function(){},handleCompTypeLoaded:function(){},handleImageLoaded:function(){},handleUnfoundImage:function(){return X.getImage("default_blank")},sortFunc:function(P,k){if(P===k)return 0;if(P==S&&k!=S)return 1;if(P!=S&&k==S)return-1;if(P==S&&k==S)return 0;var x,p=typeof P,O=typeof k;return p===hs&&O===hs?x=P.localeCompare(k):p===gl&&O===gl&&(x=P-k),x===d&&(x=(""+P).localeCompare(""+k)),x>0?1:0>x?-1:0},getClassMap:function(){return Xb},getClass:function(w){if(Gk(w)){var h,a=Xb[w];if(!a){h=w.split("."),a=E;for(var C=0;C<h.length;C++)a=a[h[C]];Xb[w]=a}return a}return w},def:function(Z,t,a){var $,g,Q,_=function(){};if(_.prototype=t.prototype,$=new _,Gk(Z)){if(Xb[Z])throw"'"+Z+"' already defined";Q=Lh(Z),$.getClassName=function(){return Z}}else Q=Z;if($.constructor=Q,$.getClass=function(){return Q},$.getSuperClass=function(){return t},a)for(g in a)zp[g]&&zp.hasOwnProperty(g)?zp[g]($,a):Sm($,a,g);Q.prototype=$,Q.superClass=t.prototype},startAnim:function(){var F=function(J){J.duration&&(J.startTime=Pb()),J.timeId=dk(J.tick,S,S,J.interval)};return function(p){return p=or(p),p.easing=p.easing||X.animEasing,p.duration||p.frames||(p.duration=X.animDuration),p.t=0,p.duration?p.interval=0:(p.frame=0,p.interval=p.interval||10),p.tick=function(){if(p.duration){var H=(Pb()-p.startTime)/p.duration;if(H>1&&(H=1),p.t=H,p.action(p.easing(H),H),!p.isRunning())return;1===H?p.stop():p._isPaused||(p.timeId=dk(p.tick))}else{if(p.frame++,H=p.t=p.frame/p.frames,p.action(p.easing(H),H),!p.isRunning())return;p.frame<p.frames?p._isPaused||(p.timeId=dk(p.tick,S,S,p.interval)):p.stop()}},p.resume=function(){p._isPaused&&(delete p._isPaused,p.duration?p.t<1&&(p.startTime=Pb()-p.duration*p.t,p.timeId=dk(p.tick)):p.frame<p.frames&&(p.timeId=dk(p.tick,S,S,p.interval)))},p.pause=function(){p._isPaused=!0},p.isPaused=function(){return this._isPaused},p.stop=function(X){p.isRunning()&&(Wc(p.timeId,!p.duration),delete p.timeId,p.duration?p.t<1&&X&&(p.t=1,p.action(p.easing(1),1)):p.frame<p.frames&&X&&(p.frame=p.frames,p.action(p.easing(1),1)),p._37o&&p._37o(),p.finishFunc&&p.finishFunc())},p.isRunning=function(){return p.timeId!=S},p.delay?dk(F,S,[p],p.delay):F(p),p}}(),getTextSize:function(){var $={},z=l?kr().getContext("2d"):S;return function(i,J){z.font=i?i:xc;var n=$[z.font];return n||(n=2*z.measureText("e").width+4,$[z.font]=n),{width:z.measureText(J).width+4,height:n}}}(),drawText:function(g,A,r,c,s,z,C,_,v,q){if(A!=S){var k=rj(r,A),x={};x.y=q&&q!==Bp?q===Dc?z+k.height/2:z+_-k.height/2:z+_/2,x.x=v&&v!==zc?v===br?s+C-k.width/2:s+C/2:s+k.width/2,$n(g,A,x,r,c)}},getDistance:function(T,L){var i=T.length;return L?3===i?_(q(T[0]-L[0])+q(T[1]-L[1])+q(T[2]-L[2])):2===i?_(q(T[0]-L[0])+q(T[1]-L[1])):T.z===d?_(q(L.x-T.x)+q(L.y-T.y)):_(q(L.x-T.x)+q(L.y-T.y)+q(L.z-T.z)):3===i?_(q(T[0])+q(T[1])+q(T[2])):2===i?_(q(T[0])+q(T[1])):void 0},brighter:function(t,X){return 0>X&&(X=-X),Cr(t,X?X:40)},darker:function(B,i){return i>0&&(i=-i),Cr(B,i?i:-40)},unionPoint:function(z,n){if(!z)return S;if(2===arguments.length)return z&&n?{x:o(z.x,n.x),y:o(z.y,n.y),width:M(z.x-n.x),height:M(z.y-n.y)}:S;var h=z;if(h._as&&(h=h._as),h.length===d)return S;var s=h.length;if(0>=s)return S;for(var B=1,H=h[0],i={x:H.x,y:H.y,width:0,height:0};s>B;B++){H=h[B];var Z=o(i.x,H.x),m=V(i.x+i.width,H.x),y=o(i.y,H.y),_=V(i.y+i.height,H.y);i.x=Z,i.y=y,i.width=m-Z,i.height=_-y}return i},unionRect:function(U,g){if(U&&!g)return or(U);if(!U&&g)return or(g);if(U&&g){var Z={x:o(U.x,g.x),y:o(U.y,g.y)};return Z.width=V(U.x+U.width,g.x+g.width)-Z.x,Z.height=V(U.y+U.height,g.y+g.height)-Z.y,Z}return S},containsPoint:function(g,N,y,Q){if(Q!=S&&1!==Q){var s=g.x+g.width/2,p=g.y+g.height/2;g={x:s-g.width/2*Q,y:p-g.height/2*Q,width:g.width*Q,height:g.height*Q}}if(y){var h=g.width/2,_=g.height/2,D=L(-y),A=k(-y),a=N.x-g.x-h,$=N.y-g.y-_;return N={x:A*a-D*$,y:D*a+A*$},th({x:-h,y:-_,width:g.width,height:g.height},N)}return!(!g||N.x<g.x||N.y<g.y||N.x>g.x+g.width||N.y>g.y+g.height)},containsRect:function(t,U){if(!t||!U)return!1;var V=U.x,v=U.y,T=U.width,p=U.height,w=t.width,a=t.height;if(0>(w|a|T|p))return!1;var J=t.x,s=t.y;if(J>V||s>v)return!1;if(w+=J,T+=V,V>=T){if(w>=J||T>w)return!1}else if(w>=J&&T>w)return!1;if(a+=s,p+=v,v>=p){if(a>=s||p>a)return!1}else if(a>=s&&p>a)return!1;return!0},intersectsRect:function(p,J){if(!p||!J)return!1;var y=J.width,h=J.height,b=p.width,r=p.height;if(0>=b||0>=r||0>=y||0>=h)return!1;var N=J.x,R=J.y,$=p.x,u=p.y;return b+=$,r+=u,y+=N,h+=R,b>N&&r>R&&y>$&&h>u},intersection:function(v,B){if(!v||!B)return S;var w=B.x,E=B.y,I=v.x,x=v.y,T=w,r=E,g=I,V=x;return T+=B.width,r+=B.height,g+=v.width,V+=v.height,I>w&&(w=I),x>E&&(E=x),T>g&&(T=g),r>V&&(r=V),T-=w,r-=E,0>=T||0>=r?S:{x:w,y:E,width:T,height:r}},grow:function(W,u,z){z===d&&(z=u),W.x-=u,W.y-=z,W.width=W.width+2*u,W.height=W.height+2*z},getScreenPoint:function(g,q,H,h,L,t,T){var O=H.getBoundingClientRect(),$=g*(t||1)-H.scrollLeft+(h||0),V=q*(T||1)-H.scrollTop+(L||0),c=Eg(H,!1);if(c){var Z=new Ob($,V,0);return Z.applyMatrix4(c),console.log(Z),{x:Z.x,y:Z.y}}return{x:$+O.left,y:V+O.top}},getLogicalPoint:function(W,s,g,M,I,B){var X,q,l=s.getBoundingClientRect();W.target?(nl(W)?vf?hc["91"]=!0:hc["17"]=!0:vf?hc["91"]=!1:hc["17"]=!1,hc["16"]=Pn(W)?!0:!1,W=xl?mr(W):W,X=W.clientX,q=W.clientY):(X=W.x,q=W.y);var c=Eg(s,!0);if(c){var G=new Ob(X,q,0);G.applyMatrix4(c);do{if(Math.abs(G.z)<=1e-6)break;var D=new Ob(X,q,1);if(D.applyMatrix4(matrix),Math.abs(D.z)<=1e-6){G=D;break}if(D.sub(G),Math.abs(D.z)<=1e-6)break;G.addScaledVector(D,-G.z/D.z)}while(!1);return{x:(G.x+s.scrollLeft-(g||0))/(I||1),y:(G.y+s.scrollTop-(M||0))/(B||1)}}return{x:(X-l.left+s.scrollLeft-(g||0))/(I||1),y:(q-l.top+s.scrollTop-(M||0))/(B||1)}},removeHTML:function(){var j;return function(G){return G&&G.getView&&(G=G.getView()),G&&G.parentNode?j===G?!0:(j=G,G.parentNode.removeChild(G),j=S,!0):!1}}(),getToolTipDiv:function(){if(!mp){mp=Zj(),Wq=Zj();var r=mp.style;X.baseZIndex!=S&&(r.zIndex=$(X.baseZIndex)+3+""),r.whiteSpace="nowrap",r.color=X.toolTipLabelColor,r.background=X.toolTipBackground,r.font=X.toolTipLabelFont,r.padding="5px",r.boxShadow="0px 0px 3px "+X.toolTipShadowColor}return mp},isToolTipShowing:function(){return mp&&mp.parentNode?!0:Wq&&Wq.parentNode?!0:!1},hideToolTip:function(){ws(mp),ws(Wq),Sg()},showToolTip:function(u,p){if(!u||p==S)return qi(),void 0;X.getToolTipDiv();var F,H;if(p.html?(p=p.html,F=Wq,ws(mp)):(F=mp,ws(Wq)),H=F.style,F.innerHTML=p,F.parentNode||W.Default.appendToScreen(F),u.target){u=Nd(u);var t=Ng(),Q=u.x,q=u.y,x=xl?60:12;if(xl){var P=F.getBoundingClientRect();H.left=Q-P.width/2+wo,H.top=q-P.height-x<t.top?q+x+wo:q-P.height-x+wo}else{H.left=Q+x+wo,H.top=q+x+wo;var P=F.getBoundingClientRect();P.left+P.width>t.width&&(H.left=Q-x-P.width+wo),P.top+P.height>t.height&&(H.top=q-x-P.height+wo),P.left<0&&(H.left=Q+x+wo),P.top<0&&(H.top=q+x+wo)}}else H.left=u.x+wo,H.top=u.y+wo;Sg()},startDragging:function(m,J,W){W==d&&(W=!0),m!==Zp&&(Zp?W&&(xl?Zp.handleWindowTouchEnd(J):Zp.handleWindowMouseUp(J)):xl?(s(E,pc,sc),s(E,ik,Hh)):(s(E,zk,Mm),s(E,ag,Tn)),Zp=m)},getImageMap:function(){return js},toBoundaries:function(u,X,f,q){var C=[];return ge(u,X,f,q).forEach(function(H){var B=[];H.forEach(function(y){B.push(y.x,y.y)}),C.push(B)}),C},getCurrentKeyCodeMap:function(){return hc},drawCenterImage:function(w,O,Q,Z,B,M,D,_){!B&&M&&M.isSelfViewEvent&&(B=M);var b=xq(O,B,M),d=ze(O,B,M);rl(w,O,t(Q-b/2),t(Z-d/2),b,d,B,M,D,_)},drawStretchImage:function(Y,Z,A,u,g,m,q,D,S,e,C,p){!D&&S&&S.isSelfViewEvent&&(D=S);var j,f=xq(Z,D,S,m),O=ze(Z,D,S,q);"uniform"===A?(j=o(m/f,q/O),f*=j,O*=j,u+=t((m-f)/2),g+=t((q-O)/2),m=f,q=O):"centerUniform"===A&&((f>m||O>q)&&(j=o(m/f,q/O),f*=j,O*=j),u+=t((m-f)/2),g+=t((q-O)/2),m=f,q=O);var X=Y.interactiveInfo;if(X){var K;if(K="center"===A?{x:u+m/2-f/2,y:g+q/2-O/2,width:f,height:O}:{x:u,y:g,width:m,height:q},X.rect){var c=X.compInfos,y=c.length;y&&(c[y-1].rect.image=Z)}else X.rect=K}if("center"===A){var E=C!==!1&&(f>m||O>q);E&&(Y.save(),Y.beginPath(),Y.rect(u,g,m,q),Y.clip()),rl(Y,Z,u+m/2-f/2,g+q/2-O/2,f,O,D,S,e,p),E&&Y.restore()}else rl(Y,Z,u,g,m,q,D,S,e,p)},toCanvas:function(Q,X,B,U,d,u,S,L,W){Q=Oi(Q,S),X=X||xq(Q,d),B=B||ze(Q,d);var w=kr(),Y=Md(w);return L?(fp(w,X,B,L),Y.scale(L,L)):fp(w,X,B,1),ng(Y,Q,U,0,0,X,B,d,u,S,W),Q&&Q.clampToEdge&&(w.clampToEdge=Q.clampToEdge),Y.restore(),w},toGrayColor:function(f){if(!f)return f;var o=_m(f),l=.299*o[0]+.587*o[1]+.114*o[2];return"rgba("+l+","+l+","+l+","+o[3]/255+")"},createGradientImage:function(w,x,D,K){for(var z=["L",0,0,w,0,1,0,0,1,0,0],Q=0,k=Math.min(x.length,D.length);k>Q;Q++)z.push(D[Q],x[Q]);var q=W.Default.toCanvas({width:w,height:w,clampToEdge:!0,comps:[{type:"shape",rotation:K||0,points:[0,0,w,0,w,w,0,w],background:"#ffffff",gradientPack:z}]});return q},createElement:function(c,F,f,B){var N=l.createElement(c);return ls(N,F||v.widgetBorder,2),N.style.font=f?f:xc,B!=S&&(N.value=B),X.onElementCreated&&X.onElementCreated(N),N},containedInView:function(q,E){var R=gp(E).getBoundingClientRect();return th({x:R.left,y:R.top,width:R.width,height:R.height},Xd(q))},isIsolating:function(){return Me>0},setIsolating:function(N){N?Me++:Me--},getMSMap:function(){return zp},stringify:function(D,l,Y){var i=Date.prototype.toJSON;Date.prototype.toJSON=function(){return"__ht__date"+this.getTime()};var F=JSON.stringify(D,function(R,T){return"function"==typeof T?"__ht__"+(T.__ht__||T.toString()):Vc(T)?ns(T):T instanceof W.List?"__ht__list"+(T.__ht__list||X.stringify(T._as)):T},l==S?2:l);return Date.prototype.toJSON=i,Y&&(F="__ht__encode"+X.encodeString(F)),F},parse:function(J){return Gk(J)?"__ht__encode"!=J.substr(0,12)||(J=X.decodeString(J.substr(12)),Gk(J))?JSON.parse(J,function(z,U){if(Gk(U))if("__ht__function"==U.substr(0,14)){var T=U.indexOf("{")+1,o=U.lastIndexOf("}"),l=U.indexOf("(")+1,r=U.indexOf(")");if(T&&o&&l&&r){var q=new Function(U.substring(l,r),U.substring(T,o));return q.__ht__=U.substr(6),q}}else{if("__ht__date"==U.substr(0,10))return new Date($(U.substr(10)));if("__ht__list"===U.substr(0,10))return new Kf(X.parse(U.substr(10)))}return U}):J:J},loadJS:function(i,g){g&&i.push(g);var u=i.shift();if(En(u))i=u.contact(i),X.loadJS(i);else if(dc(u))u(),X.loadJS(i);else if(Gk(u)){var L=l.createElement("script");L.onload=function(){X.loadJS(i)},L.setAttribute("src",u),l.getElementsByTagName("head")[0].appendChild(L)}else i.length&&X.loadJS(i)},toRoundedCorner:function(I,_){var y=I.size();if(0>=_)return{points:I};var t,q=new Kf,K=new Kf,Y=I.get(0);q.add(Y),K.add(1);for(var P=1;y>P;P++)if(y>P+1){var g=I.get(P),e=I.get(P+1),C=Y.x,A=Y.y,E=g.x,l=g.y,Q=l-A,G=E-C,S=N(Q,G);t=o(.99*zq(Y,g),_),q.add({x:E-t*k(S),y:l-t*L(S)}),q.add(g),C=g.x,A=g.y,E=e.x,l=e.y,Q=l-A,G=E-C,S=N(Q,G),t=o(.99*zq(g,e),_),Y={x:C+t*k(S),y:A+t*L(S)},q.add(Y),K.addAll([2,3])}else q.add(I.get(P)),K.add(2);return{points:q,segments:K}},toColorData:_m,setCanvas:fp,createDiv:Zj,createDisabledDiv:ub,createView:Nm,createCanvas:kr,appendChild:lc,initContext:Md,checkLoadingImage:es,translateAndScale:hq,layout:Ap,getPosition:_l,drawPoints:$f,drawRoundRect:Ik,drawBorder:uc,setFocus:bd,getter:lr,setter:gb,isEmptyObject:bm,cameraPriority:function(){var j={skybox:0,main:1e4,top:1e7};return G.seal(G.defineProperties({},{skybox:{configurable:!1,enumerable:!1,get:function(){return j.skybox},set:function(Y){if(Y>=j.main)throw new RangeError("Skybox camera must have lower priority than the main camera.");j.skybox=Number(Y)}},main:{configurable:!1,enumerable:!1,get:function(){return j.main},set:function(U){if(U<=j.skybox)throw new RangeError("Main camera must have higher priority than the skybox camera.");if(U>=j.top)throw new RangeError("Main camera must have lower priority than the top camera.");j.main=Number(U)}},top:{configurable:!1,enumerable:!1,get:function(){return j.top},set:function(g){if(g<=j.main)throw new RangeError("Top camera must have higher priority than the main camera.");j.top=Number(g)}}}))}()},!0),uj(f,{autoAdjustIndex:1,hierarchicalRendering:1,adjustChildrenToTop:1,autoHideScrollBar:1,autoUpdate:1,firstPersonMode:1,ortho:1,strict:1,stickToRight:1,instant:1,closePath:1,hierarchical:1,doubleClickToToggle:1,continuousLayout:1,syncSize:1},!0);var fb=X.disabledOpacity,Gj=X.toolTipDelay,pm=X.devicePixelRatio,Km=X.autoMakeVisible,Cf=X.autoHideScrollBar,un=X.imageGradient,Co=X.showToolTip,qi=X.hideToolTip,Bj=X.dashPattern,hk=X.lineCap,Zc=X.lineJoin,Nc=X.labelColor,ah=X.labelSelectColor,xc=X.labelFont,tj=X.widgetIndent,Yj=X.widgetRowHeight,Fe=X.widgetHeaderHeight,hl=X.widgetTitleHeight,el=X.scrollBarColor,Cg=X.scrollBarSize,fq=X.scrollBarTimeout,Ed=X.scrollBarMinLength,zr=X.scrollBarInteractiveSize,ds=X.zoomIncrement,Le=X.scrollZoomIncrement,dj=X.pinchZoomIncrement,wm=X.zoomMax,_e=X.zoomMin,Mc=X.createObject,Ub=X.preventDefault,oc=X.setImage,Oi=X.getImage,Oe=X.isImageComplete,ar=X.drawCenterImage,ng=X.drawStretchImage,mf=X.getId,dk=X.callLater,Ue=X.sortFunc,or=X.clone,Lh=X.getClass,jn=X.startAnim,_o=X.brighter,zb=X.darker,Nl=X.drawText,rj=X.getTextSize,bh=X.isLeftButton,Ih=X.isMiddleButton,Bk=X.getTouchCount,Qg=X.isDoubleClick,Pn=X.isShiftDown,nl=X.isCtrlDown,Xd=X.getClientPoint,Nd=X.getPagePoint,zq=X.getDistance,Mn=X.unionPoint,Vg=X.unionRect,th=X.containsPoint,Te=X.containsRect,ee=X.intersectsRect,dd=X.intersection,Ng=X.getWindowInfo,Vo=X.grow,we=X.getLogicalPoint,me=X.getScreenPoint,sm=X.startDragging,ws=X.removeHTML,Np=X.createElement,Qd=X.segmentResolution,rf=X.shapeResolution,cb=X.shapeSide,jd=X.def,Xp=function(R,A,N){jd(g+"."+R,A,N)},ri=function(r,v){r.childNodes.forEach(function(D){v(D),ri(D,v)})};uj(X,{toolTipLabelColor:Nc,toolTipLabelFont:xc,toolTipBackground:v.toolTipBackground,toolTipShadowColor:mg,drawBreakableText:kp,setDevicePixelRatio:function(A){pm=X.devicePixelRatio="number"==typeof A?A:E.devicePixelRatio,ri(l.body,function(d){var P=d._ht;P&&P._canvas&&(fp(P._canvas,P.getWidth(),P.getHeight()),P.redraw?P.redraw():P.iv())})}},!0);var Do=1e-6,Ae="undefined"!=typeof Uint16Array?Uint16Array:Array,am="undefined"!=typeof Float32Array?Float32Array:Array,$b=function(g,P,X){var x=[g[0]-P[0],g[1]-P[1],g[2]-P[2]];if(X){var G=zq(x);G>0&&(x[0]/=G,x[1]/=G,x[2]/=G)}return x},Cq=function(){var P="charCodeAt",J=2*(2*Bg.length+1);for(var c in E)if(c===g+zc[0]+(wo.length+2)){var f=E[c];if(!f)break;for(var h=f.length,O=0;h>O;O++)if(f[O][P](0)===J&&f[O+1]!=S&&f[O+1]===wo[0]&&f[O+2]!=S&&f[O+2][P](0)===J){for(var M=O+3;h>M;M++)if(f[M][P](0)===J){if(0==f[M+1])for(var H,s=M+2;h>s;s++){if(f[s][P](0)===J){0==f[s-1]&&H&&(Gq=H.substr(0,H.length-1));break}H==S?H=f[s]:H+=f[s]}break}break}break}return function(q){return[-q[0],-q[1],-q[2]]}}(),Od=function(l,M){return 3===l.length?l[0]*M[0]+l[1]*M[1]+l[2]*M[2]:l[0]*M[0]+l[1]*M[1]},Xc=function(){var s=new am(16);return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},rq=Xc(),Dj=function(F){var Q=new am(16);return Q[0]=F[0],Q[1]=F[1],Q[2]=F[2],Q[3]=F[3],Q[4]=F[4],Q[5]=F[5],Q[6]=F[6],Q[7]=F[7],Q[8]=F[8],Q[9]=F[9],Q[10]=F[10],Q[11]=F[11],Q[12]=F[12],Q[13]=F[13],Q[14]=F[14],Q[15]=F[15],Q},ks=function(c,x){return c[0]=x[0],c[1]=x[1],c[2]=x[2],c[3]=x[3],c[4]=x[4],c[5]=x[5],c[6]=x[6],c[7]=x[7],c[8]=x[8],c[9]=x[9],c[10]=x[10],c[11]=x[11],c[12]=x[12],c[13]=x[13],c[14]=x[14],c[15]=x[15],c},om=function(q){return q[0]=1,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=1,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=1,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},Yp=function(x,c){var o=x[0],R=x[1],e=x[2];return x[0]=c[0]*o+c[4]*R+c[8]*e+c[12],x[1]=c[1]*o+c[5]*R+c[9]*e+c[13],x[2]=c[2]*o+c[6]*R+c[10]*e+c[14],x},Vp=function(F,b){var K=F[0],n=F[1],O=F[2],p=F[3];return F[0]=b[0]*K+b[4]*n+b[8]*O+b[12]*p,F[1]=b[1]*K+b[5]*n+b[9]*O+b[13]*p,F[2]=b[2]*K+b[6]*n+b[10]*O+b[14]*p,F[3]=b[3]*K+b[7]*n+b[11]*O+b[15]*p,F},wp=function(){var d,X,Z,l,H=bn(Og[1]+Og[7]),q=bn(Og[0]+Og[3]-Og[10]),e=bn(Og[8]+2),p=function(){return X=Z.charAt(d),d+=1,X},$=function(){var v="";if(X===e)for(;p();){if(X===e)return p(),v;v+=X}else p()},S=function(){for(;X&&" ">=X;)p()},V=function(){var o,m={};if(X===H){if(p(),S(),X===q)return p(),m;for(;X;){if(o=$(),S(),p(),m[o]=l(),S(),X===q)return p(),m;p(),S()}}};return l=function(){switch(S(),X){case H:return V();default:return $()}},function(B){if(U={},B){var $;if(Z=B,d=0,X=" ",$=l(),S(),!X)return $}}}(),Zo=function(q,l){if(l){var K=L(l),I=k(l),y=q[4],U=q[5],V=q[6],j=q[7],p=q[8],o=q[9],T=q[10],h=q[11];q[4]=y*I+p*K,q[5]=U*I+o*K,q[6]=V*I+T*K,q[7]=j*I+h*K,q[8]=p*I-y*K,q[9]=o*I-U*K,q[10]=T*I-V*K,q[11]=h*I-j*K}},kk=function(S,s){if(s){var q=L(s),D=k(s),g=S[0],T=S[1],O=S[2],G=S[3],t=S[8],b=S[9],r=S[10],I=S[11];S[0]=g*D-t*q,S[1]=T*D-b*q,S[2]=O*D-r*q,S[3]=G*D-I*q,S[8]=g*q+t*D,S[9]=T*q+b*D,S[10]=O*q+r*D,S[11]=G*q+I*D}},mb=function(Y,K){if(K){var R=L(K),G=k(K),$=Y[0],F=Y[1],g=Y[2],m=Y[3],d=Y[4],r=Y[5],e=Y[6],B=Y[7];Y[0]=$*G+d*R,Y[1]=F*G+r*R,Y[2]=g*G+e*R,Y[3]=m*G+B*R,Y[4]=d*G-$*R,Y[5]=r*G-F*R,Y[6]=e*G-g*R,Y[7]=B*G-m*R}},Gn=function(a,A,m){return Hd(S,m===!1?S:a.getFinalScale3d(),a.getFinalRotation3d(),a.getRotationMode(),a.p3(),S,A)},Hd=function(T,S,k,d,Y,$,W){return $||($=Xc()),Y&&qj($,Y),Lp($,k,d),W&&Ke($,$,W),S&&Bi($,S),T&&Ke($,$,T),$},Vm=function(U,h,e){h=$(h),e=$(e);var D=this;D.g=U,D._84O=h,D._85O=e,D._70I=!0,D.F=0,D._83O=h+e,D.pen={x:0,y:0}},yk="lineDashOffset",Xm="setLineDash",xn=function(Y){for(var b in Y)1===b.length&&(yk=Y[b]);
return b?1:0},xd=function(J,G,V){return ud(G)?J:J[Xm]?(J[Xm](G),V&&(J.lineDashOffset=V),J):new Vm(J,G[0],G.length>1?G[1]:G[0])},_h=function(F,M){!ud(M)&&F[Xm]&&(F[Xm](Rj),F.lineDashOffset=0)};if(jd(Vm,G,{_69I:6,moveTo:function(y,r){var a=this,S=a.pen;S.x=y,S.y=r,a.g.moveTo(y,r),a.start||(a.start={x:y,y:r})},lineTo:function(T,O){var m=this,G=m.pen,D=T-G.x,h=O-G.y,a=N(h,D),K=k(a),F=L(a),Y=m._23O(G.x,G.y,T,O),f=m._85O,c=m._84O,P=m._83O;if(m.F){if(m.F>Y)return m._70I?m._72I(T,O):m.moveTo(T,O),m.F-=Y,void 0;if(m._70I?m._72I(G.x+K*m.F,G.y+F*m.F):m.moveTo(G.x+K*m.F,G.y+F*m.F),Y-=m.F,m.F=0,m._70I=!m._70I,!Y)return}var Z=R(Y/P);if(Z){for(var b=K*c,p=F*c,V=K*f,t=F*f,e=0;Z>e;e++)m._70I?(m._72I(G.x+b,G.y+p),m.moveTo(G.x+V,G.y+t)):(m.moveTo(G.x+V,G.y+t),m._72I(G.x+b,G.y+p));Y-=P*Z}m._70I?Y>c?(m._72I(G.x+K*c,G.y+F*c),m.moveTo(T,O),m.F=f-(Y-c),m._70I=!1):(m._72I(T,O),Y===c?(m.F=0,m._70I=!m._70I):(m.F=c-Y,m.moveTo(T,O))):Y>f?(m.moveTo(G.x+K*f,G.y+F*f),m._72I(T,O),m.F=c-(Y-f),m._70I=!0):(m.moveTo(T,O),Y===f?(m.F=0,m._70I=!m._70I):m.F=f-Y)},quadraticCurveTo:function(z,$,m,b){var Y,N=this,k=N.pen,e=k.x,J=k.y,O=N._22O(e,J,z,$,m,b),i=0,_=0,o=N._85O,E=N._84O;if(N.F){if(N.F>O)return N._70I?N._71I(z,$,m,b):N.moveTo(m,b),N.F-=O,void 0;if(i=N.F/O,Y=N._20O(e,J,z,$,m,b,i),N._70I?N._71I(Y[2],Y[3],Y[4],Y[5]):N.moveTo(Y[4],Y[5]),N.F=0,N._70I=!N._70I,!O)return}var j=O-O*i,F=R(j/N._83O),t=E/O,M=o/O;if(F)for(var C=0;F>C;C++)N._70I?(_=i+t,Y=N._21O(e,J,z,$,m,b,i,_),N._71I(Y[2],Y[3],Y[4],Y[5]),i=_,_=i+M,Y=N._21O(e,J,z,$,m,b,i,_),N.moveTo(Y[4],Y[5])):(_=i+M,Y=N._21O(e,J,z,$,m,b,i,_),N.moveTo(Y[4],Y[5]),i=_,_=i+t,Y=N._21O(e,J,z,$,m,b,i,_),N._71I(Y[2],Y[3],Y[4],Y[5])),i=_;j=O-O*i,N._70I?j>E?(_=i+t,Y=N._21O(e,J,z,$,m,b,i,_),N._71I(Y[2],Y[3],Y[4],Y[5]),N.moveTo(m,b),N.F=o-(j-E),N._70I=!1):(Y=N._19O(e,J,z,$,m,b,i),N._71I(Y[2],Y[3],Y[4],Y[5]),O===E?(N.F=0,N._70I=!N._70I):(N.F=E-j,N.moveTo(m,b))):j>o?(_=i+M,Y=N._21O(e,J,z,$,m,b,i,_),N.moveTo(Y[4],Y[5]),Y=N._19O(e,J,z,$,m,b,_),N._71I(Y[2],Y[3],Y[4],Y[5]),N.F=E-(j-o),N._70I=!0):(N.moveTo(m,b),j===o?(N.F=0,N._70I=!N._70I):N.F=o-j)},bezierCurveTo:function(){var h=arguments;this.pen={x:h[4],y:h[5]},this.g.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5])},arc:function(a,R,O,t,y,Z){Z||(t=-t,y=-y),Ic(this,a,R,t,y-t,O,O,!1)},rect:function(G,L,U,O){var Y=this;Y.pen={x:G,y:L},Y.moveTo(G,L),Y.lineTo(G,L+O),Y.lineTo(G+U,L+O),Y.lineTo(G+U,L),Y.lineTo(G,L)},beginPath:function(){this.g.beginPath()},closePath:function(){this.lineTo(this.start.x,this.start.y)},_23O:function(j,d,y,G){var x=y-j,z=G-d;return _(x*x+z*z)},_22O:function(A,c,N,q,F,r,L){for(var O,B,u,e,K,I,d,C=0,t=A,y=c,_=L>0?L:this._69I,H=1;_>=H;H++)u=H/_,e=1-u,K=e*e,I=2*u*e,d=u*u,O=K*A+I*N+d*F,B=K*c+I*q+d*r,C+=this._23O(t,y,O,B),t=O,y=B;return C},_21O:function(q,n,I,g,p,r,i,H){var B=this;if(0===i)return B._20O(q,n,I,g,p,r,H);if(1===H)return B._19O(q,n,I,g,p,r,i);var U=B._20O(q,n,I,g,p,r,H);return U.push(i/H),B._19O.apply(B,U)},_20O:function(i,K,C,g,m,c,L){if(1!==L){var j=C+(m-C)*L,G=g+(c-g)*L;C=i+(C-i)*L,g=K+(g-K)*L,m=C+(j-C)*L,c=g+(G-g)*L}return[i,K,C,g,m,c]},_19O:function(E,H,I,L,b,K,e){if(1!==e){var P=E+(I-E)*e,y=H+(L-H)*e;I+=(b-I)*e,L+=(K-L)*e,E=P+(I-P)*e,H=y+(L-y)*e}return[E,H,I,L,b,K]},_72I:function(p,k){var Y=this.pen;(p!==Y.x||k!==Y.y)&&(Y.x=p,Y.y=k,this.g.lineTo(p,k))},_71I:function(T,C,f,$){var u=this.pen;(T!==f||C!==$||f!==u.x||$!==u.y)&&(u.x=f,u.y=$,this.g.quadraticCurveTo(T,C,f,$))}}),b&&i){var Sq=i.toString();a=Sq.indexOf(Ne.substr(0,2))>0&&Sq.indexOf(Dc+Dc.substr(1,1))>1||Sq.indexOf(Mh.substr(0,2)+Ne.substr(2,2)+zc[0]+Ne[4])>1?!0:!1}var fh=S,ip=S,dp=function(O){fh&&!O._72O&&(ip||(ip={}),ip[O._72O=mf()]=O)},Pf=function(K,G){if(G||(G=K),G&&(fh||(fh={}),!fh[K])){var Z=new Gh;if(fh[G]={request:Z,url:G},G=X.beforeLoadURL(G),G.data){var c=X.parse(G.data);ph(K,c),X.handleCompTypeLoaded(K,c)}else{Z.onload=function(){if(200===this.status||0===this.status){var b=X.parse(Z.getResponseText());ph(K,b),X.handleCompTypeLoaded(K,b)}else ph(K,S)},Z.onerror=function(){ph(K,S)};var Q={};Q.url=encodeURI(G),Q.sync=!1,Z.send(Q)}}},ph=function(X,h){if(Cp[X]=h,delete fh[X],bm(fh)&&(fh=S,ip)){for(var w in ip){var O=ip[w];O.invalidateAll&&O.invalidateAll(d,"compTypeLoaded",X),O.redraw&&O.redraw(),O.iv(),delete O._72O}ip=S}if(h&&ip)for(var w in ip){var O=ip[w];O.invalidateAll&&O.invalidateAll(d,"compTypeLoading",X),O.redraw&&O.redraw(),O.iv()}},On=v.chart,Zb="",Ld=X.compStack=[],vd=/^style@/,$c=/^attr@/,Jo=/^field@/,vp={x:.5,y:.5},xq=function(v,d,f,X){if(!v)return 0;if(lp(v.fitSize,d,f)&&X)return X;var e=lp(v.width,d,f);return null==e?20:e},ze=function(d,s,v,K){if(!d)return 0;if(lp(d.fitSize,s,v)&&K)return K;var t=lp(d.height,s,v);return null==t?20:t},lp=function(i,u,m){if(!i||!i.func)return i;var A,b=i.func,j=i.value;return A=dc(b)?m&&m.vectorDataBindingDisabled&&!i.isSafeFunc?j:b(u,m):u instanceof Pp?$c.test(b)?u.a(Zb+b.slice(5)):vd.test(b)?u.s(Zb+b.slice(6)):Jo.test(b)?u[b.slice(6)]:u[b]?u[b](m):j:j,j!==d&&A==S?j:A},rl=X.drawImage=function(){var l,q,g,t,W,G,I=function(Q,k){Q.getValue&&Q.getValue.compType===k||(Q.getValue=function(F){var m=B(Q,F);if(m===d&&k.properties){var G=k.properties[F];G&&(m=G.defaultValue)}return m},Q.getColor=function(r){return F(Q.getValue(r))},Q.getValue.compType=k)},B=function(c,h,J){var E,_=!1;if(c.prefix&&q instanceof Pp){var B=q.a(Zb+h);B!==d&&(_=!0,E=B)}return E===d&&(E=c[h]),E&&E.func&&(_=!0,E=lp(E,q,g)),J&&(E=J(E),_||(c[h]=E)),E},F=function(c,O){var N;if(N=O?B(c,O):c,l&&l.compGray&&N)return X.toGrayColor(N);if(W&&N){if("override"===G)return W;if("override_rgb"===G){var v=jb(W);return N=_m(N),"rgba("+R(255*v[0])+","+R(255*v[1])+","+R(255*v[2])+","+N[3]/255+")"}if("override_a"===G){var v=jb(W);return N=_m(N),"rgba("+N[0]+","+N[1]+","+N[2]+","+v[3]+")"}var v=jb(W);return N=_m(N),"rgba("+R(N[0]*v[0])+","+R(N[1]*v[1])+","+R(N[2]*v[2])+","+N[3]/255*v[3]+")"}return N},D=function(_){if(En(_)){for(var Y=new Kf,g=_.length,S=0;g>S;S+=2)Y.add({x:_[S],y:_[S+1]});_=Y}return _},Z=function(m){var R=B(m,"anchorX"),c=B(m,"anchorY");if(R!==d||c!==d)return{x:R===d?vp.x:R,y:c===d?vp.y:c};var e=B(m,"type"),Q=B(m,"name");if("image"!==e||!Q)return vp;var $=Oi(Q);return $&&$.anchorX!==d&&$.anchorY!==d?{x:$.anchorX,y:$.anchorY}:vp},n=function(H,O){var X=B(H,Ni),U=Z(H);if(En(X)){var G=X.length,I=B(H,"relative"),h=O.width,P=O.height;if(4===G)X={x:X[0],y:X[1],width:X[2],height:X[3]},I&&(X.x*=h,X.y*=P,X.width*=h,X.height*=P);else if(3===G){var u=X[0];X={width:X[1],height:X[2]},I&&(X.width*=h,X.height*=P),"object"==typeof u?u.length&&(u={x:u[0],y:u[1]}):u=_l(u,O,X),X.x=u.x-X.width*U.x,X.y=u.y-X.height*U.y}X.x+=B(H,"offsetX")||0,X.y+=B(H,"offsetY")||0,!I&&O.fitSize&&(X=b(H,X,O))}return X},b=function(W,X,x){if(X){var $,F,L,M={x:X.x,y:X.y,width:X.width,height:X.height},J=Z(W),C=B(W,"layoutH"),k=B(W,"layoutV"),E=1,f=1,N=0,y=0,h=1,w=1;switch(C){case"left":break;case"right":M.x+=x.width-x.rw;break;case"center":M.x+=.5*(x.width-x.rw);break;case"scale":case"leftright":default:$=B(W,Pm)||0,$&&(N=Math.abs(y=Math.sin($)),h=Math.abs(w=Math.cos($))),"leftright"!==C?(E+=h*(x.widthScale-1),f+=N*(x.widthScale-1)):(E+=M.width?h*(x.width-x.rw)/M.width:0,f+=M.height?N*(x.width-x.rw)/M.height:0,F=-Math.min(-J.x*w+J.y*y,-J.x*w-(1-J.y)*y,(1-J.x)*w+J.y*y,(1-J.x)*w-(1-J.y)*y))}switch(k){case"top":break;case"bottom":M.y+=x.height-x.rh;break;case"center":M.y+=.5*(x.height-x.rh);break;case"scale":case"topbottom":default:$==S&&($=B(W,Pm),$&&(N=Math.abs(y=Math.sin($)),h=Math.abs(w=Math.cos($)))),"topbottom"!==k?(E+=N*(x.heightScale-1),f+=h*(x.heightScale-1)):(E+=M.width?N*(x.height-x.rh)/M.width:0,f+=M.height?h*(x.height-x.rh)/M.height:0,L=-Math.min(-J.x*y-J.y*w,-J.x*y+(1-J.y)*w,(1-J.x)*y-J.y*w,(1-J.x)*y+(1-J.y)*w))}return(1!==E||1!==f)&&("scale"!==C&&C?"leftright"===C&&(M.x+=M.width*(1-E)*J.x+F*(x.width-x.rw)):M.x+=M.x*(x.widthScale-1)+J.x*M.width*(x.widthScale-E),"scale"!==k&&k?"topbottom"===k&&(M.y+=M.height*(1-f)*J.y+L*(x.height-x.rh)):M.y+=M.y*(x.heightScale-1)+J.y*M.height*(x.heightScale-f),M.width*=E,M.height*=f),M.width<0&&(M.width=0),M.height<0&&(M.height=0),M}},Q=function(j){return En(j)?new Kf(j):j},N=function(x,u,E,t,k,e,G){var C=l.interactiveInfo,T=x.transform;if(T)return l.save(),l.setTransform(T.a,T.b,T.c,T.d,T.tx,T.ty),C&&C.compInfos.push({comp:x,rect:u,matrix:T.clone(),prefix:Zb}),!0;k===d&&(k=1),e===d&&(e=1);var z=B(x,"clipPercentage"),a=is(E,u);if(a&&!t&&1===k&&1===e&&!(1>z))return C&&C.compInfos.push({comp:x,rect:u,matrix:C.matrix.clone(),prefix:Zb}),!1;G=G||vp;var S=u.x+u.width*G.x,p=u.y+u.height*G.y,L=E.x+E.width*G.x,Y=E.y+E.height*G.y,_=E.width?k*(u.width/E.width):1,n=E.height?e*(u.height/E.height):1;if(l.save(),C&&(C.matrix.appendTranslate(S,p).appendRotate(t).appendScale(_,n).appendTranslate(-L,-Y),C.compInfos.push({comp:x,rect:u,matrix:C.matrix.clone()})),As(l,S,p),ap(l,t||0),ce(l,_,n),As(l,-L,-Y),1>z){0>z&&(z=0);var f=Jb(E,B(x,"clipDirection"),z);l.beginPath(),l.rect(f.x,f.y,f.width,f.height),l.clip()}return!0},f=function(){l.restore()},Y=function(g,b,o){var P=B(g,"path"),j=B(g,Pm),G=B(g,"scaleX"),L=B(g,"scaleY"),z=Z(g),s=S,c=Nf(null,P);if(o||(o=g.unionRect,o||(o=Mn(c),g.path.func||(g.unionRect=o)),s=o),o){s||(s=g.unionRect,s||(s=Mn(c),g.path.func||(g.unionRect=s)));var Y=N(g,o,s,j,G,L,z),I=B(g,"borderPattern"),Q=xd(l,I),J=F(g,"background"),p=F(g,"borderColor"),r=B(g,"borderWidth"),i=B(g,"gradient"),h=F(g,"gradientColor"),U=B(g,"border3d"),T=F(g,"border3dColor"),v=B(g,"border3dAccuracy"),E=l.lineJoin,n=l.lineCap;if(l.lineJoin=B(g,"borderJoin")||Zc,l.lineCap=B(g,"borderCap")||hk,J?(Rb(l,J,i,h,s),Nf(l,P),l.fill(),Q!==l&&Nf(l,P)):Nf(l,P),r&&p){var q=B(g,"borderWidthAbsolute");q&&(l.save(),l.setTransform(1,0,0,1,0,0)),l.lineWidth=r,l.strokeStyle=p,l.stroke(),q&&l.restore(),U&&bf(l,p,T,r,t,v)}if(_h(l,I),B(g,"dash")){var $=B(g,"dashWidth")||r;if($>0){I=B(g,"dashPattern")||Bj;var Q=xd(l,I,B(g,"dashOffset")),w=F(g,"dashColor")||F(Pg);Q!==l&&Nf(l,P),l.strokeStyle=w,l.lineWidth=$,l.stroke(),B(g,"dash3d")&&bf(l,w,F(g,"dash3dColor"),$,t,B(g,"dash3dAccuracy")),_h(l,I)}}b===Ni&&Pd(l,J,B(g,"depth"),s),l.lineJoin=E,l.lineCap=n,Y&&f()}},r=function(v,U,O,T){var A=B(v,xe,D),c=B(v,Pm),j=Z(v);if(A&&T.fitSize){var I=new Kf,n=Mn(A),z=b(v,n,T),x=n.x+j.x*n.width,H=n.y+j.y*n.height,_=z.x+j.x*z.width,M=z.y+j.y*z.height,$=n.width?z.width/n.width:1,d=n.height?z.height/n.height:1;A.each(function(Y){I.add({x:_+(Y.x-x)*$,y:M+(Y.y-H)*d})}),A=I,v.unionRect=null}var K=B(v,"scaleX"),m=B(v,"scaleY"),u=U===Jr,h=S;if(!O&&u&&(O=v.unionRect,O||(O=Mn(A),v.points.func||(v.unionRect=O)),h=O),O){u?h||(h=v.unionRect,h||(h=Mn(A),v.points.func||(v.unionRect=h))):h=O;var J,y,p,E,k=N(v,O,h,c,K,m,j),X=B(v,"borderPattern"),L=xd(l,X),e=F(v,"background"),w=Oi(B(v,"repeatImage"),W,G),Y=B(v,"gradientPack"),r=F(v,"borderColor"),P=B(v,"borderWidth"),a=B(v,"segments",Q),V=B(v,"gradient"),R=F(v,"gradientColor"),C=B(v,"border3d"),o=F(v,"border3dColor"),s=B(v,"border3dAccuracy"),i=B(v,"closePath"),dp=B(v,"fillRule")||"nonzero",im=l.lineJoin,zd=l.lineCap;if(l.lineJoin=B(v,"borderJoin")||Zc,l.lineCap=B(v,"borderCap")||hk,u)if(e||w||Y){var Io=B(v,"fillClipPercentage");if(1>Io){0>Io&&(Io=0);var ad=Jb(h,B(v,"fillClipDirection"),Io);l.save(),l.beginPath(),l.rect(ad.x,ad.y,ad.width,ad.height),l.clip()}if($f(l,A,a,i),Y)Tb(l,Y);else if(w){var Ab=l,Ri=W,$q=G;er(l,w,W,G,q,g),l=Ab,W=Ri,G=$q}else{var Ab=l;Rb(l,e,V,R,h),l=Ab}l.fill(dp),1>Io&&l.restore(),Y&&l.restore(),L!==l&&$f(L,A,a,i)}else $f(L,A,a,i);else if("roundRect"===U?J=B(v,"cornerRadius"):"polygon"===U?J=B(v,"polygonSide"):"arc"===U&&(J=B(v,"arcFrom"),y=B(v,"arcTo"),p=B(v,"arcClose"),E=B(v,"arcOval")),e||w||Y){var Io=B(v,"fillClipPercentage");if(1>Io){0>Io&&(Io=0);var ad=Jb(h,B(v,"fillClipDirection"),Io);l.save(),l.beginPath(),l.rect(ad.x,ad.y,ad.width,ad.height),l.clip()}if(Lg(l,U,h,J,y,p,E),Y)Tb(l,Y);else if(w){var Ab=l,Ri=W,$q=G;er(l,w,W,G,q,g),l=Ab,W=Ri,G=$q}else Rb(l,e,V,R,h);l.fill(dp),1>Io&&l.restore(),Y&&l.restore(),l!==L&&Lg(L,U,h,J,y,p,E)}else Lg(L,U,h,J,y,p,E);if(P&&r){var So=B(v,"borderWidthAbsolute");So&&(l.save(),l.setTransform(1,0,0,1,0,0)),l.lineWidth=P,l.strokeStyle=r,l.stroke(),So&&l.restore(),C&&bf(l,r,o,P,t,s)}if(_h(l,X),B(v,"dash")){var gl=B(v,"dashWidth")||P;if(gl>0){X=B(v,"dashPattern")||Bj;var L=xd(l,X,B(v,"dashOffset")),sp=F(v,"dashColor")||F(Pg);L!==l&&(u?$f(L,A,a,i):Lg(L,U,h,J,y,p,E)),l.strokeStyle=sp,l.lineWidth=gl,l.stroke(),B(v,"dash3d")&&bf(l,sp,F(v,"dash3dColor"),gl,t,B(v,"dash3dAccuracy")),_h(l,X)}}U===Ni&&Pd(l,e,B(v,"depth"),h),l.lineJoin=im,l.lineCap=zd,k&&f()}},u=function(s,e){var n=W,x=G,H=W||B(s,Cl),J=G||B(s,"blendMode"),r=Oi(B(s,"name"),H,J);r&&(ng(l,r,B(s,"stretch"),e.x,e.y,e.width,e.height,q,g,H,null,J),W=n,G=x)},P=function(c,P){var u=B(c,"text");u!=S&&Nl(l,u,B(c,"font"),F(c,Cl),P.x,P.y,P.width,P.height,B(c,"align"),B(c,"vAlign"))},p=function(b,I){uc(l,F(b,Cl),I.x,I.y,I.width,I.height,B(b,"width"))},O=function(T,c){var P=B(T,qk),O=0;if(P&&(P.forEach(function(x){O+=x}),O>0)){for(var M=B(T,"colors")||On,x=B(T,"startAngle")||0,N=B(T,"hollow"),$=B(T,Fn),F=B(T,uo),A=B(T,Wr),z=$?new Kf:S,j=c.x,v=c.y,I=c.width,D=c.height,Q=j+I/2,G=v+D/2,_=o(I,D)/2,b=0,Z=0;Z<P.length;Z++){var g=P[Z],f=m*g/O,p=x+f;if(l.fillStyle=M[b++],b===M.length&&(b=0),l.beginPath(),N){var e=Q+k(x)*_/2,u=G+L(x)*_/2,d=Q+k(p)*_,r=G+L(p)*_;l.moveTo(e,u),l.arc(Q,G,_/2,x,p,!1),l.lineTo(d,r),l.arc(Q,G,_,p,x,!0)}else l.moveTo(Q,G),l.arc(Q,G,_,p,x,!0);z&&(f=(x+p)/2,z.add({text:dc($)?$(g,Z,O,q):g,x:Q+.75*k(f)*_,y:G+.75*L(f)*_})),l.closePath(),l.fill(),x=p}z&&z.each(function(N){Nl(l,N.text,F,A,N.x,N.y,0,0,Sb)})}},_=function(H,t){var M=B(H,Ml);if(M&&M.length>0){var $=M.length,C=B(H,Fn),m=B(H,uo),k=B(H,Wr),W=C?new Kf:S,x=B(H,"minValue")||0,R=B(H,"maxValue");if(R==S&&(R=0,M.forEach(function(I){B(I,qk).forEach(function(C){R=V(R,C)})})),x===R)return;for(var f=t.height/(R-x),j=t.y+R*f,O=B(M[0],qk).length,i=t.width/(3*O+1),e=2*i/$,b=0,E=0;$>E;E++)for(var G=M[E],w=B(G,Cl),Z=B(G,"colors"),X=B(G,qk),D=0;O>D;D++){Z?l.fillStyle=Z[D]:w?l.fillStyle=w:(l.fillStyle=On[b++],b===On.length&&(b=0));var s=X[D],Y=s*f,N=t.x+(1+3*D)*i+E*e;if(Eh(l,N,j-Y,e,Y),W){var I=dc(C)?C(s,D,G,q):s,v=rj(m,I).height;W.add({x:N,y:j-Y-v,width:e,height:v,text:I})}}W&&W.each(function(f){Nl(l,f.text,m,k,f.x,f.y,f.width,f.height,Sb)})}},h=function(y,Y){var E=B(y,Ml);if(E&&E.length>0){var D=E.length,j=B(E[0],qk).length,g=Y.width/(3*j+1),R=0,$=B(y,"maxValue"),h=B(y,Fn),i=B(y,uo),Z=B(y,Wr),v=h?new Kf:S;if($==S){$=0;for(var w=0;j>w;w++){for(var F=0,X=0;D>X;X++)F+=B(E[X],qk)[w];$=V($,F)}}if($>0){for(var w=0;j>w;w++)for(var H=Y.y+Y.height,X=0;D>X;X++){var c=E[X],L=B(c,Cl),u=B(c,qk)[w],t=u/$*Y.height;L?l.fillStyle=L:(l.fillStyle=On[R++],R===On.length&&(R=0)),H-=t;var P={x:Y.x+(1+3*w)*g,y:H,width:2*g,height:t};Eh(l,P.x,P.y,P.width,P.height),v&&(P.text=dc(h)?h(u,w,c,q):u,v.add(P))}v&&v.each(function(X){Nl(l,X.text,i,Z,X.x,X.y,X.width,X.height,Sb)})}}},s=function(x,r){var Q=B(x,Ml);if(Q&&Q.length>0){for(var P=Q.length,L=B(Q[0],qk).length,y=r.width/(3*L+1),m=0,A=B(x,Fn),s=B(x,uo),M=B(x,Wr),i=A?new Kf:S,N=0;L>N;N++){for(var k=0,E=0;P>E;E++)k+=B(Q[E],qk)[N];if(k>0){var u=r.y+r.height;for(E=0;P>E;E++){var j=Q[E],h=B(j,Cl),O=B(j,qk)[N],c=O/k*r.height;h?l.fillStyle=h:(l.fillStyle=On[m++],m===On.length&&(m=0)),u-=c;var b={x:r.x+(1+3*N)*y,y:u,width:2*y,height:c};Eh(l,b.x,b.y,b.width,b.height),i&&(b.text=dc(A)?A(O,N,j,q):O,i.add(b))}}}i&&i.each(function(n){Nl(l,n.text,s,M,n.x,n.y,n.width,n.height,Sb)})}},y=function(L,K){var G=B(L,Ml);if(G&&G.length>0){var j=G.length,k=B(L,"minValue")||0,J=B(L,"maxValue");if(J==S&&(J=0,G.forEach(function(e){B(e,qk).forEach(function(I){J=V(J,I)})})),k===J)return;for(var N=K.height/(J-k),R=K.y+J*N,Y=B(G[0],qk).length,p=K.width/(3*Y+1),C=0,Z=B(L,"lineWidth")||2,T=B(L,"line3d"),I=B(L,"linePoint"),$=B(L,Fn),d=B(L,uo),P=B(L,Wr),M=0;j>M;M++){var U=G[M],a=B(U,Cl),i=B(U,qk);a?l.strokeStyle=a:(a=l.strokeStyle=On[C++],C===On.length&&(C=0)),l.beginPath();for(var c=0;Y>c;c++){var o=K.x+(2+3*c)*p,O=R-i[c]*N;0===c?l.moveTo(o,O):l.lineTo(o,O)}if(l.lineWidth=Z,l.stroke(),T&&bf(l,a,S,Z,t),I||$){var e,E=Z/2+2;for(c=0;Y>c;c++){var z=i[c];if(o=K.x+(2+3*c)*p,O=R-z*N,dc(I)?I(l,o,O,a,c,U,q):I&&(l.fillStyle=a,l.beginPath(),l.arc(o,O,E,0,m,!0),l.fill()),dc($)?e=$(z,c,U,q):$&&(e=z),e){var H=rj(d,e).height,D=l.shadowBlur;if(D){var y=l.shadowOffsetX,W=l.shadowOffsetY,h=l.shadowColor;l.shadowOffsetX=0,l.shadowOffsetY=0,l.shadowBlur=0,l.shadowColor=S}Nl(l,e,d,P,o,O-H-E+2,0,H,Sb),D&&(l.shadowOffsetX=y,l.shadowOffsetY=W,l.shadowBlur=D,l.shadowColor=h)}}}}}},c=function(){l=null,q=null,g=null},U=function(K,x){var k;g&&g.getState?k=g.getState(q):(k=q instanceof Pp?q.s(hh):null,(k===d||null===k)&&(k=B(K,hh)));var y=B(x,hh);return y!==d&&null!==y&&y!==k?!1:B(x,Qn)},j={border:p,image:u,text:P,pieChart:O,columnChart:_,stackedColumnChart:h,percentageColumnChart:s,lineChart:y};return function(i,k,h,V,s,p,A,a,o,C){if(k&&s&&p){var $=l?!1:!0;l=i,q=A,g=a,!q&&g&&g.isSelfViewEvent&&(q=g),t=g?g._zoom?g._zoom:1:1,W=o,G=C;var w=s,P=p;if(tk()){var O,x,K;0===l[sp]?tk[0]&&(O=!0):O=!0,l.texureImage2D?tk[1]&&(x=!0):x=!0,l.texureImage3D?tk[2]&&(K=!0):K=!0,O&&x&&K&&(w=h,P=V)}if(k.tagName)return Gk(Gq)&&!E[Gq]||l.drawImage(k,w,P,s,p),$&&c(),void 0;if(B(k,"visible")===!1)return $&&c(),void 0;W||(W=lp(k.color,q,g)),C||(G=lp(k.blendMode,q,g)),Gk(Gq)&&!E[Gq]&&(s=w,p=P);var R=xq(k,q,g,s),u=ze(k,q,g,p),y={x:0,y:0,width:R,height:u,fitSize:B(k,"fitSize")},M=B(k,"clip"),e=B(k,"opacity");if(y.fitSize){var m=y.rw=lp(k.width,q,g)||20;y.widthScale=R/m;var z=y.rh=lp(k.height,q,g)||20;y.heightScale=u/z}if(l.save(),l.interactiveInfo){var J=l.interactiveInfo.matrix,H=J.clone();J.appendTranslate(w,P).appendScale(s/R,p/u)}As(l,w,P),(R!==s||u!==p)&&l.scale(s/R,p/u),M&&(dc(M)?M(l,R,u,q,g,k):(l.beginPath(),l.rect(0,0,R,u),l.clip())),e!=S&&(l.globalAlpha*=e),B(k,"comps").forEach(function(e){if(e.prefix){var M=Zb,p=lp(e.prefix,q,g);p&&(Zb=Zb+p+".")}if(U(k,e)===!1)return e.prefix&&(Zb=M),void 0;if(Ld.splice(0,0,e),l.interactiveInfo)var m=l.interactiveInfo.matrix.clone();var v=B(e,"opacity"),A=B(e,"shadow"),P=B(e,"type"),G=n(e,y);if(v!=S){var J=l.globalAlpha;l.globalAlpha*=v}if(A){var x=l.shadowOffsetX,C=l.shadowOffsetY,$=l.shadowBlur,K=l.shadowColor,T=B(e,"shadowOffsetX"),h=B(e,"shadowOffsetY"),E=B(e,"shadowBlur"),s=F(e,"shadowColor");l.shadowOffsetX=(T==S?3:T)*t,l.shadowOffsetY=(h==S?3:h)*t,l.shadowBlur=(E==S?6:E)*t,l.shadowColor=s||F(Ul)}if("save"===P)l.save();else if("endClip"===P||"restore"===P)l.restore();else if("clip"===P)l.save(),$f(l,B(e,"points",D),B(e,"segments",Q),!0),l.clip();else if(Jh[P])G=G||{x:0,y:0,width:y.width,height:y.height},r(e,P,G,y);else if(P===Jr)r(e,P,G,y);else if("SVGPath"===P)Y(e,P,G);else{G=G||{x:0,y:0,width:y.width,height:y.height};var O=B(e,Pm),L=B(e,"scaleX"),W=B(e,"scaleY"),V=Z(e),c=N(e,G,G,O,L,W,V);if(dc(P))I(e,P),X.drawCompType(P,l,G,e,q,g);else if(X.getCompType(P)){var b=X.getCompType(P),_=b.func||b;I(e,b),X.drawCompType(_,l,G,e,q,g)}else j[P]?j[P](e,G):X.getCompType(P)===d&&wh.test(P)&&Pf(P);c&&f()}A&&(l.shadowOffsetX=x,l.shadowOffsetY=C,l.shadowBlur=$,l.shadowColor=K),v!=S&&(l.globalAlpha=J),l.interactiveInfo&&(l.interactiveInfo.matrix=m),e.prefix&&(Zb=M),Ld.splice(0,1)}),l.interactiveInfo&&(l.interactiveInfo.matrix=H),l.restore(),$&&c()}}}();X.getCurrentComp=function(){return Ld[0]},X.getParentComp=function(){return Ld[1]},X.getInternal=function(){return{isEnter:jo,isEsc:_f,isSpace:Aq,isLeft:ak,isUp:Zh,isRight:vj,isDown:ff,addMethod:uj,superCall:Lk,toPointsArray:ge,translateAndScale:hq,appendArray:qh,createWorldMatrix:Hd,vec3TransformMat4:Yp,setCanvas:fp,createDiv:Zj,createView:Nm,createCanvas:kr,createImage:Ec,initContext:Md,layout:Ap,fillRect:Eh,Mat:ye,drawBorder:uc,isString:Gk,setBorder:ls,getPropertyValue:Fo,setPropertyValue:$p,drawVerticalLine:Ui,draw3DRect:Pd,getPinchDist:co,isSameRect:is,getPosition:_l,intersectionLineRect:tn,getNodeRect:Pl,getEdgeAgentPosition:Yc,getEdgeHostPosition:ii,getImageWidth:xq,getImageHeight:ze,initItemElement:pe,drawPoints:$f,createG2:xd,closePopup:Rr,isH:Rc,createAnim:tm,createNormalMatrix:ci,createNormals:nn,toFloatArray:Xo,glMV:Vl,batchShape:ob,createNodeMatrix:Gn,getFaceInfo:ps,transformAppend:oh,drawFaceInfo:mn,to3dPointsArray:Qj,setGLDebugMode:function(O){io=O},cube:function(){return{vs:us,is:Ii,uv:Jl}},ui:function(){return{DataUI:xi,NodeUI:re,EdgeUI:um,GroupUI:vs,ShapeUI:Fd,GridUI:Uj,Data3dUI:ck,Node3dUI:an,Shape3dUI:cn}},getInternalVersion:function(){return"U2FsdGVkX18qrs+bisHqHvXa+pkD/UBuTN2j1kYk0iI="},getDragger:function(){return Zp},addMSMap:function(j){uj(zp,j)},k:I,addEventListener:s,removeEventListener:F}},function(C){function T(W,k){W!=S&&(k==S&&hs!=typeof W?this._54O(W,256):this._54O(W,k))}function N(){return new T(S)}function a(Z,S,g,C,u,p){for(;--p>=0;){var s=S*this[Z++]+g[C]+u;u=R(s/67108864),g[C++]=67108863&s}return u}function r(B,w,u,i,R,j){for(var D=32767&w,L=w>>15;--j>=0;){var r=32767&this[B],X=this[B++]>>15,a=L*r+X*D;r=D*r+((32767&a)<<15)+u[i]+(1073741823&R),R=(r>>>30)+(a>>>15)+L*X+(R>>>30),u[i++]=1073741823&r}return R}function t(j,F,Z,J,p,G){for(var N=16383&F,M=F>>14;--G>=0;){var f=16383&this[j],h=this[j++]>>14,y=M*f+h*N;f=N*f+((16383&y)<<14)+Z[J]+p,p=(f>>28)+(y>>14)+M*h,Z[J++]=268435455&f}return p}function W(J){return ci.charAt(J)}function X(K,U){var w=jm[K.charCodeAt(U)];return w==S?-1:w}function u(L){for(var G=this.t-1;G>=0;--G)L[G]=this[G];L.t=this.t,L.s=this.s}function D(c){this.t=1,this.s=0>c?-1:0,c>0?this[0]=c:-1>c?this[0]=c+this.DV:this.t=0}function P(W){var r=N();return r._58O(W),r}function p(B,c){var n,G=this;if(16==c)n=4;else if(8==c)n=3;else if(256==c)n=8;else if(2==c)n=1;else if(32==c)n=5;else{if(4!=c)return G.fromRadix(B,c),void 0;n=2}G.t=0,G.s=0;for(var C=B.length,d=!1,e=0;--C>=0;){var E=8==n?255&B[C]:X(B,C);0>E?"-"==B.charAt(C)&&(d=!0):(d=!1,0==e?G[G.t++]=E:e+n>G.DB?(G[G.t-1]|=(E&(1<<G.DB-e)-1)<<e,G[G.t++]=E>>G.DB-e):G[G.t-1]|=E<<e,e+=n,e>=G.DB&&(e-=G.DB))}8==n&&0!=(128&B[0])&&(G.s=-1,e>0&&(G[G.t-1]|=(1<<G.DB-e)-1<<e)),G._57O(),d&&T.ZERO._78O(G,G)}function z(){for(var Q=this,z=Q.s&Q.DM;Q.t>0&&Q[Q.t-1]==z;)--Q.t}function n(_){var r=this;if(r.s<0)return"-"+r._85O()[ef](_);var P;if(16==_)P=4;else if(8==_)P=3;else if(2==_)P=1;else if(32==_)P=5;else{if(4!=_)return r.toRadix(_);P=2}var O,X=(1<<P)-1,m=!1,u="",K=r.t,V=r.DB-K*r.DB%P;if(K-->0)for(V<r.DB&&(O=r[K]>>V)>0&&(m=!0,u=W(O));K>=0;)P>V?(O=(r[K]&(1<<V)-1)<<P-V,O|=r[--K]>>(V+=r.DB-P)):(O=r[K]>>(V-=P)&X,0>=V&&(V+=r.DB,--K)),O>0&&(m=!0),m&&(u+=W(O));return m?u:"0"}function l(){var t=N();return T.ZERO._78O(this,t),t}function s(){return this.s<0?this._85O():this}function B(R){var F=this,w=F.s-R.s;if(0!=w)return w;var V=F.t;if(w=V-R.t,0!=w)return F.s<0?-w:w;for(;--V>=0;)if(0!=(w=F[V]-R[V]))return w;return 0}function O(O){var d,k=1;return 0!=(d=O>>>16)&&(O=d,k+=16),0!=(d=O>>8)&&(O=d,k+=8),0!=(d=O>>4)&&(O=d,k+=4),0!=(d=O>>2)&&(O=d,k+=2),0!=(d=O>>1)&&(O=d,k+=1),k}function K(){var W=this;return W.t<=0?0:W.DB*(W.t-1)+O(W[W.t-1]^W.s&W.DM)}function J(l,F){var e;for(e=this.t-1;e>=0;--e)F[e+l]=this[e];for(e=l-1;e>=0;--e)F[e]=0;F.t=this.t+l,F.s=this.s}function y(n,i){for(var Q=n;Q<this.t;++Q)i[Q-n]=this[Q];i.t=V(this.t-n,0),i.s=this.s}function Y(B,T){var $,Z=this,M=B%Z.DB,f=Z.DB-M,A=(1<<f)-1,p=R(B/Z.DB),m=Z.s<<M&Z.DM;for($=Z.t-1;$>=0;--$)T[$+p+1]=Z[$]>>f|m,m=(Z[$]&A)<<M;for($=p-1;$>=0;--$)T[$]=0;T[p]=m,T.t=Z.t+p+1,T.s=Z.s,T._57O()}function c(H,l){var r=this;l.s=r.s;var i=R(H/r.DB);if(i>=r.t)return l.t=0,void 0;var Q=H%r.DB,o=r.DB-Q,W=(1<<Q)-1;l[0]=r[i]>>Q;for(var X=i+1;X<r.t;++X)l[X-i-1]|=(r[X]&W)<<o,l[X-i]=r[X]>>Q;Q>0&&(l[r.t-i-1]|=(r.s&W)<<o),l.t=r.t-i,l._57O()}function i(H,W){for(var e=this,Z=0,h=0,c=o(H.t,e.t);c>Z;)h+=e[Z]-H[Z],W[Z++]=h&e.DM,h>>=e.DB;if(H.t<e.t){for(h-=H.s;Z<e.t;)h+=e[Z],W[Z++]=h&e.DM,h>>=e.DB;h+=e.s}else{for(h+=e.s;Z<H.t;)h-=H[Z],W[Z++]=h&e.DM,h>>=e.DB;h-=H.s}W.s=0>h?-1:0,-1>h?W[Z++]=e.DV+h:h>0&&(W[Z++]=h),W.t=Z,W._57O()}function G(y,E){var K=this.abs(),$=y.abs(),e=K.t;for(E.t=e+$.t;--e>=0;)E[e]=0;for(e=0;e<$.t;++e)E[e+K.t]=K.am(0,$[e],E,e,0,K.t);E.s=0,E._57O(),this.s!=y.s&&T.ZERO._78O(E,E)}function f(E){for(var H=this.abs(),n=E.t=2*H.t;--n>=0;)E[n]=0;for(n=0;n<H.t-1;++n){var l=H.am(n,H[n],E,2*n,0,1);(E[n+H.t]+=H.am(n+1,2*H[n],E,2*n+1,l,H.t-n-1))>=H.DV&&(E[n+H.t]-=H.DV,E[n+H.t+1]=1)}E.t>0&&(E[E.t-1]+=H.am(n,H[n],E,2*n,0,1)),E.s=0,E._57O()}function H(e,b,_){var J=e.abs(),I=this;if(!(J.t<=0)){var h=I.abs();if(h.t<J.t)return b!=S&&b._58O(0),_!=S&&I._77O(_),void 0;_==S&&(_=N());var Z=N(),Q=I.s,q=e.s,s=I.DB-O(J[J.t-1]);s>0?(J._44O(s,Z),h._44O(s,_)):(J._77O(Z),h._77O(_));var v=Z.t,$=Z[v-1];if(0!=$){var p=$*(1<<I.F1)+(v>1?Z[v-2]>>I.F2:0),j=I.FV/p,D=(1<<I.F1)/p,V=1<<I.F2,P=_.t,d=P-v,E=b==S?N():b;for(Z._59O(d,E),_._52O(E)>=0&&(_[_.t++]=1,_._78O(E,_)),T.ONE._59O(v,E),E._78O(Z,Z);Z.t<v;)Z[Z.t++]=0;for(;--d>=0;){var r=_[--P]==$?I.DM:R(_[P]*j+(_[P-1]+V)*D);if((_[P]+=Z.am(0,r,_,d,0,v))<r)for(Z._59O(d,E),_._78O(E,_);_[P]<--r;)_._78O(E,_)}b!=S&&(_._45O(v,b),Q!=q&&T.ZERO._78O(b,b)),_.t=v,_._57O(),s>0&&_._46O(s,_),0>Q&&T.ZERO._78O(_,_)}}}function F(K){var A=N();return this.abs()._49O(K,S,A),this.s<0&&A._52O(T.ZERO)>0&&K._78O(A,A),A}function d(c){this.m=c}function M(P){return P.s<0||P._52O(this.m)>=0?P.mod(this.m):P}function E($){return $}function U(w){w._49O(this.m,S,w)}function v(S,g,d){S._47O(g,d),this._74O(d)}function q(w,H){w._48O(H),this._74O(H)}function Z(){if(this.t<1)return 0;var c=this[0];if(0==(1&c))return 0;var V=3&c;return V=15&V*(2-(15&c)*V),V=255&V*(2-(255&c)*V),V=65535&V*(2-(65535&(65535&c)*V)),V=V*(2-c*V%this.DV)%this.DV,V>0?this.DV-V:-V}function h(H){var V=this;V.m=H,V.mp=H._50O(),V.mpl=32767&V.mp,V.mph=V.mp>>15,V.um=(1<<H.DB-15)-1,V.mt2=2*H.t}function j(c){var h=N();return c.abs()._59O(this.m.t,h),h._49O(this.m,S,h),c.s<0&&h._52O(T.ZERO)>0&&this.m._78O(h,h),h}function x(D){var U=N();return D._77O(U),this._74O(U),U}function b(D){for(var W=this;D.t<=W.mt2;)D[D.t++]=0;for(var d=0;d<W.m.t;++d){var U=32767&D[d],r=U*W.mpl+((U*W.mph+(D[d]>>15)*W.mpl&W.um)<<15)&D.DM;for(U=d+W.m.t,D[U]+=W.m.am(0,r,D,d,0,W.m.t);D[U]>=D.DV;)D[U]-=D.DV,D[++U]++}D._57O(),D._45O(W.m.t,D),D._52O(W.m)>=0&&D._78O(W.m,D)}function hp(T,R){T._48O(R),this._74O(R)}function Ag(r,N,s){r._47O(N,s),this._74O(s)}function Mm(){return 0==(this.t>0?1&this[0]:this.s)}function Re($,d){if($>4294967295||1>$)return T.ONE;var L=N(),I=N(),J=d._73O(this),D=O($)-1;for(J._77O(L);--D>=0;)if(d._76O(L,I),($&1<<D)>0)d._75O(I,J,L);else{var l=L;L=I,I=l}return d.revert(L)}function vs(O,T){var k;return k=256>O||T._51O()?new d(T):new h(T),this.exp(O,k)}function en(){var o=this;if(o.s<0){if(1==o.t)return o[0]-o.DV;if(0==o.t)return-1}else{if(1==o.t)return o[0];if(0==o.t)return 0}return(o[1]&(1<<32-o.DB)-1)<<o.DB|o[0]}function Ed(w,e){return new T(w,e)}function Zk(){var I=this;I.n=S,I.e=0,I.d=S,I.p=S,I.q=S,I.dmp1=S,I.dmq1=S,I._10A=S}function qn(g){return g._53O(this.e,this.n)}function Vn(c){var G,R,Q,Y="",L=0;for(G=0;G<c.length&&c.charAt(G)!=Sc;++G)Q=ni.indexOf(c.charAt(G)),0>Q||(0==L?(Y+=W(Q>>2),R=3&Q,L=1):1==L?(Y+=W(R<<2|Q>>4),R=15&Q,L=2):2==L?(Y+=W(R),Y+=W(Q>>2),R=3&Q,L=3):(Y+=W(R<<2|Q>>4),Y+=W(15&Q),L=0));return 1==L&&(Y+=W(R<<2)),Y}function Xq(I){var y=I.split(""),j=Vn(I);return y.forEach(function(U){var x=U.length;x>0&&j&&(af+=$(U))}),j}function Qj(d,e){var F=Zc._4O.Util._56O(d,"ss"),O={},L=0;return O.v=F==e,O.t=1,O.s=0>L?-1:0,fe=O.v,L>0?O[0]=L:-1>L?O[0]=L+O.DV:O.t=0,[F,O]}function yi(n){var m=38,Q=n.substring(0,m);if(Q&&30==Q.indexOf("05000420")){var B=["ss",n.substring(m)];return B}return[]}function Ke(o,R){R=R.replace(hn,""),R=R.replace(/[ \n]+/g,"");var y=Ed(R,16);if(y._55O()>this.n._55O())return 0;var j=this._37O(y),p=j[ef](16).replace(/^1f+00/,""),t=yi(p);if(0==t.length)return!1;for(var D,P,Q,V=.5,N=cb,H=[0,.5,.75,.875,.9375],S=[],J=[],Y=[],B=m/N,g=t[1],C=Qj(o,g)[0],l=0,U=0;l<H.length;l++){var $=0===l%2?0:.5;for(D=0;N>=D;D++)P=(D+$)*B,Q=1-H[l],S.push(k(P)*V*Q,-V+2*H[l]*V,-L(P)*V*Q),J.push((D+$)/N,Q)}for(l=0;l<H.length-1;l++){var i=l*(N+1),w=(l+1)*(N+1);for(D=0;N>D;D++)Y.push(i+D,w+D+1,w+D,i+D,i+D+1,w+D+1)}return Y.forEach(function(u){U+=u}),g==C&&U>10}var ck,Kl=0xdeadbeefcafe,fh=15715070==(16777215&Kl),ef="toString",$c="",Fe="nat",cm=function(){};e=C["D"+11182[ef](Q(2,5))];var kd=T.prototype;wl+=Df.substr(0,1);var pd=C.navigator?C.navigator.appName:"";fh&&"Microsoft Internet Explorer"==pd?(kd.am=r,ck=30):fh&&"Netscape"!=pd?(kd.am=a,ck=26):(kd.am=t,ck=28),kd.DB=ck,kd.DM=(1<<ck)-1,kd.DV=1<<ck;var tp=52;kd.FV=Q(2,tp),kd.F1=tp-ck,kd.F2=2*ck-tp;var ah,an,ci="0123456789abcdefghijklmnopqrstuvwxyz",jm=[],En=function(R){return String.fromCharCode(R)};for(ah="0".charCodeAt(0),an=0;9>=an;++an)jm[ah++]=an;for(ah="a".charCodeAt(0),an=10;36>an;++an)jm[ah++]=an;for(ah="A".charCodeAt(0),an=10;36>an;++an)jm[ah++]=an;var ek=d.prototype;ek._73O=M,ek.revert=E,ek._74O=U,ek._75O=v,ek._76O=q;var zc=h.prototype;zc._73O=j,zc.revert=x,zc._74O=b,zc._75O=Ag,zc._76O=hp,kd._77O=u,kd._58O=D,kd._54O=p,kd._57O=z,kd._59O=J,kd._45O=y,kd._44O=Y,kd._46O=c,kd._78O=i,kd._47O=G,kd._48O=f,kd._49O=H,kd._50O=Z,kd._51O=Mm,kd.exp=Re,kd.toString=n,kd._85O=l,kd.abs=s,kd._52O=B,kd._55O=K,kd.mod=F,kd._53O=vs,T.ZERO=P(0),T.ONE=P(1),kd._86O=en;var Uq=function(O,s){var V=this;V.isPublic=!0,typeof O!==hs?(V.n=O,V.e=s):O!=S&&s!=S&&O.length>0&&s.length>0&&(V.n=Ed(O,16),V.e=$(s,16))};tq=function(){var P,W,L=Xq(vo),b=L.substr(0,4),Y=L.substr(4,2),k=L.substr(6,2),c=1,i=!c,y=I,z=[],C=gr.charAt(7);if(e&&(e[ef]().indexOf(Fe)<0||e[wl][ef]().indexOf(Fe)<0||!L?P=S:(L=new e(b-0,Y-c,k-0),W=L.setHours(9),e[wl]()>W?P=Tq[C]:i=!0)),L&&P&&P[0]&&P[w(.5)]&&y){var s=wp(P[0]),R=wp(P[1]);for(var t in R)z.push(t);var h,K=0,V=s[z[K]],X=R[z[K++]],U=R[z[K++]],r=R[z[K++]],l=R[z[K++]],m=R[z[K++]],o=R[z[K++]],M=s[z[K]],v=R[z[K++]],f=hr._27O(y);if(V===X&&f&&v){h=X+U+r+l+m+o;var B=!o||o===yo;if(!B&&o)for(var d,J=0,O=o.length;O>J;J++)o[J]===jg[K]?d===yo?B=!0:d[0]===hd[5]&&yo&&yo.indexOf(d.substr(1))>=0?B=!0:d=S:(d==S?d=o[J]:d+=o[J],J===O-1&&(d===yo?B=!0:d[0]===hd[5]&&yo&&yo.indexOf(d.substr(1))>=0&&(B=!0)));h&&f._31O(h,v)&&f._31O(V,M)&&B&&(!m||e[wl]()<m)&&(i=!0)}}return i||(Lg=ud),C};var Ul=Zk.prototype;Ul._37O=qn,Ul._38O=Uq;var ni="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sc="=",gf=25,Gk=10,vo="IBkSJQ==",_q=_q||function(F,d){var J={},u=J._7A={},Q=u._6A=function(){function H(){}return{_80O:function(w){H.prototype=this;var L=new H;return w&&L._5A(w),L.hasOwnProperty("_82O")||(L._82O=function(){L.$super._82O.apply(this,arguments)}),L._82O.prototype=L,L.$super=this,L},_3A:function(){var i=this._80O();return i._82O.apply(i,arguments),i},_82O:function(){},_5A:function(U){for(var H in U)U.hasOwnProperty(H)&&(this[H]=U[H]);U.hasOwnProperty(ef)&&(this.toString=U.toString)},_88O:function(){return this._82O.prototype._80O(this)}}}(),S=u._39O=Q._80O({_82O:function(H,W){H=this._84O=H||[],this._65O=W!=d?W:4*H.length},toString:function(h){return(h||N).stringify(this)},_89O:function(c){var z=this._84O,X=c._84O,$=this._65O,V=c._65O;if(this._57O(),$%4)for(var e=0;V>e;e++){var N=255&X[e>>>2]>>>24-8*(e%4);z[$+e>>>2]|=N<<24-8*(($+e)%4)}else if(X.length>65535)for(var e=0;V>e;e+=4)z[$+e>>>2]=X[e>>>2];else z.push.apply(z,X);return this._65O+=V,this},_57O:function(){var x=this._84O,d=this._65O;x[d>>>2]&=4294967295<<32-8*(d%4),x.length=w(d/4)},_88O:function(){var d=Q._88O.call(this);return d._84O=this._84O.slice(0),d},_87O:function(j){for(var Z=[],u=0;j>u;u+=4)Z.push(0|4294967296*A);return new S._82O(Z,j)}}),n=J._2A={},N=n._69O={stringify:function(i){var g,K=i._84O,D=i._65O,w=[];for(g=0;D>g;g++){var m=255&K[g>>>2]>>>24-8*(g%4);w.push((m>>>4).toString(16)),w.push((15&m).toString(16))}return w.join("")},_68O:function(G){for(var I=G.length,D=[],F=0;I>F;F+=2)D[F>>>3]|=$(G.substr(F,2),16)<<24-4*(F%8);return new S._82O(D,I/2)}},X=n._8A={stringify:function(O){var M,x=O._84O,Y=O._65O,P=[];for(M=0;Y>M;M++){var _=255&x[M>>>2]>>>24-8*(M%4);P.push(En(_))}return P.join("")},_68O:function(j){var U,o=j.length,e=[];for(U=0;o>U;U++)e[U>>>2]|=(255&j.charCodeAt(U))<<24-8*(U%4);return new S._82O(e,o)}},q=n._9A={stringify:function(K){try{return decodeURIComponent(escape(X.stringify(K)))}catch(F){throw new Error("")}},_68O:function(S){return X._68O(unescape(encodeURIComponent(S)))
}},G=u._32O=Q._80O({_1A:function(){this._83O=new S._82O,this._23O=0},_33O:function(B){typeof B==hs&&(B=q._68O(B)),this._83O._89O(B),this._23O+=B._65O},_25O:function(W){var h=this._83O,j=h._84O,q=h._65O,g=this._79O,A=4*g,U=q/A;U=W?w(U):V((0|U)-this._22O,0);var O=U*g,E=o(4*O,q);if(O){for(var n=0;O>n;n+=g)this._20O(j,n);var e=j.splice(0,O);h._65O-=E}return new S._82O(e,E)},_88O:function(){var l=Q._88O.call(this);return l._83O=this._83O._88O(),l},_22O:0});u._66O=G._80O({cfg:Q._80O(),_82O:function(A){this.cfg=this.cfg._80O(A),this._1A()},_1A:function(){G._1A.call(this),this._34O()},_81O:function(s){return this._33O(s),this._25O(),this},_72O:function(C){C&&this._33O(C);var L=this._21O();return L},_79O:16,_26O:function(d){return function(W,I){return new d._82O(I)._72O(W)}},_19O:function(f){return function(p,O){return new _._71O._82O(f,O)._72O(p)}}});var _=J._67O={};return J}();!function(){var W=_q,C=W._7A,F=C._39O,M=C._66O,t=W._67O,k=[],o=[];!function(){function w(B){for(var f=_(B),y=2;f>=y;y++)if(!(B%y))return!1;return!0}function A(O){return 0|4294967296*(O-(0|O))}for(var s=2,M=0;64>M;)w(s)&&(8>M&&(k[M]=A(Q(s,.5))),o[M]=A(Q(s,1/3)),M++),s++}();var V=[],D=t._41O=M._80O({_34O:function(){this._64O=new F._82O(k.slice(0))},_20O:function(q,R){for(var U=this._64O._84O,s=U[0],H=U[1],v=U[2],a=U[3],O=U[4],f=U[5],n=U[6],W=U[7],G=0;64>G;G++){if(16>G)V[G]=0|q[R+G];else{var D=V[G-15],u=(D<<25|D>>>7)^(D<<14|D>>>18)^D>>>3,c=V[G-2],w=(c<<15|c>>>17)^(c<<13|c>>>19)^c>>>10;V[G]=u+V[G-7]+w+V[G-16]}var I=O&f^~O&n,J=s&H^s&v^H&v,l=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),F=(O<<26|O>>>6)^(O<<21|O>>>11)^(O<<7|O>>>25),$=W+F+I+o[G]+V[G],m=l+J;W=n,n=f,f=O,O=0|a+$,a=v,v=H,H=s,s=0|$+m}U[0]=0|U[0]+s,U[1]=0|U[1]+H,U[2]=0|U[2]+v,U[3]=0|U[3]+a,U[4]=0|U[4]+O,U[5]=0|U[5]+f,U[6]=0|U[6]+n,U[7]=0|U[7]+W},_21O:function(){var B=this._83O,r=B._84O,p=8*this._23O,W=8*B._65O;return r[W>>>5]|=128<<24-W%32,r[(W+64>>>9<<4)+14]=R(p/4294967296),r[(W+64>>>9<<4)+15]=p,B._65O=4*r.length,this._25O(),this._64O},_88O:function(){var e=M._88O.call(this);return e._64O=this._64O._88O(),e}});W._41O=M._26O(D),W._42O=M._19O(D)}();var hn=new RegExp("");hn.compile("[^0-9a-f]","gi"),Zk._28O=-1,Zk._29O=-2,Ul._31O=Ke,Ul._63O=Ke,Zk._43O=-2;var Bk=new function(){var R=this;R._5O=function(R,G){if("8"!=R.substring(G+2,G+3))return 1;var H=$(R.substring(G+3,G+4));return 0==H?-1:H>0&&10>H?H+1:-2},R._13O=function(T,E){var v=R._5O(T,E);return 1>v?"":T.substring(E+2,E+2+2*v)},R._12O=function(m,q){var b=R._13O(m,q);if(""==b)return-1;var z;return z=$(b.substring(0,1))<8?new T(b,16):new T(b.substring(2),16),z._86O()},R._6O=function(U,c){var Z=R._5O(U,c);return 0>Z?Z:c+2*(Z+1)},R._11O=function(d,J){var a=R._6O(d,J),B=R._12O(d,J);return d.substring(a,a+2*B)},R._10O=function(V,Y){var w=R._6O(V,Y),A=R._12O(V,Y);return w+2*A},R._7O=function(l,B){var N=[],x=R._6O(l,B);N.push(x);for(var w=R._12O(l,B),X=x,Y=0;;){var V=R._10O(l,X);if(V==S||V-x>=2*w)break;if(Y>=200)break;N.push(V),X=V,Y++}return N}};if(Bk._90O=En(Gk+24),Bk._91O=g+En(Gk*Gk+8),Zc==S||!Zc)var Zc={};Zc._4O!=S&&Zc._4O||(Zc._4O={});var bk=Zc._4O;Zc._4O.Util=new function(){var v=this;v._56O=function(t){var j=new Zc._4O._3O;return j._30O(t)},v._4A=function(c){var Z=new Zc._4O._3O;return Z._36O(c)},v._11A=function(y){var E=new bk._3O;return E._30O(y)}},Zc._4O._3O=function(){var j=this;j._8O=function(x,f){if("ss"==x&&"cj"==f){try{j.md=_q._67O._41O._3A()}catch(t){cm($c)}j._24O=function(I){j.md._81O(I)},j._35O=function(Q){var p=_q._2A._69O._68O(Q);j.md._81O(p)},j._60O=function(){var Z=j.md._72O();return Z[ef](_q._2A._69O)},j._30O=function(A){return j._24O(A),j._60O()},j._36O=function(L){return j._35O(L),j._60O()}}},j._24O=function(){cm($c)},j._35O=function(){cm($c)},j._60O=function(){cm($c)},j._30O=function(){cm($c)},j._36O=function(){cm($c)},j._8O("ss","cj")},Gg=function(o){var b=sl[rm[7]],W=1,Z=!1;if(Fm.a!=sl[gl])return Fm.a;if(Fm.forEach(function(S){W*=S}),o>W){if(b&&b[1]&&b[0]){var B=b[0],t=b[1];t=t.split(Bk._90O),B=B.split(Bk._90O);var $=t[3],C=B[3],y=t[7],G=t[11],M=t[15],T=t[19],K=t[23],O=t[27],h=B[7],X=$+y+G+M+T+K,v=K?!1:!0,V=C===$;if(K){var c=K&&K.split(gb("firefox")[3]);if(c)for(var A=0;A<c.length;A++){var j=c[A];if(j[0]===ke[8]&&(j=j.substring(1)),po.indexOf(j)>=0){v=!0;break}}}Z=V&&ql()(C,h)&&ql()(X,O)&&v&&(!T||T>o)}Z||(xi.prototype._42=Sh)}else Z=!0;return Fm.a=Z,Z},gf=String.fromCharCode(gf+20);var ob=function(S){return S=S.replace(hn,$c),S=S.replace(/[ \n]+/g,$c)},bq="30",ho="06",Ld="02",ki="03",mq=Ed,Bq=/^1f+00/,hr=function(){var m;return m={_18O:function(E){var v=E,I=v.replace(/\s+/g,""),X=Vn(I);return X},_14O:function(d){var y=this._18O(d),q=this._15O(y);return q},_15O:function(a){var Y=this._17O(a);if("2a864886f70d010101"==Y._61O){var y=this._16O(Y.key),D=new Zk;return D._38O(y.n,y.e),D}cm($c)},_16O:function(x){var c={};x.substr(0,2)!=bq&&cm($c);var K=Bk._7O(x,0);return 2!=K.length&&cm($c),x.substr(K[0],2)!=Ld&&cm($c),c.n=Bk._11O(x,K[0]),x.substr(K[1],2)!=Ld&&cm($c),c.e=Bk._11O(x,K[1]),c},_17O:function(b){var v={};v._40O=S;var L=Bk._7O(b,0);2!=L.length&&cm($c);var I=L[0];b.substr(I,2)!=bq&&cm($c);var d=Bk._7O(b,I);return 2!=d.length&&cm($c),b.substr(d[0],2)!=ho&&cm($c),v._61O=Bk._11O(b,d[0]),b.substr(d[1],2)==ho?v._40O=Bk._11O(b,d[1]):b.substr(d[1],2)==bq&&(v._40O={},v._40O.p=Bk._70O(b,d[1],[0],Ld),v._40O.q=Bk._70O(b,d[1],[1],Ld),v._40O.g=Bk._70O(b,d[1],[2],Ld)),b.substr(L[1],2)!=ki&&cm($c),v.key=Bk._11O(b,L[1]).substr(2),v}},m._17O?m:S}(),Rl=hr._27O=function(x){return hr._14O(x)};ql=function(){return function(p,U){if(p&&U){U=ob(U);var g=mq(U,Q(2,4)),J=this;if(!J||!J.n||g._55O()>J.n._55O())return 0;var S=J._37O(g),m=S[ef](Q(2,4)).replace(Bq,""),B=yi(m);if(0==B.length)return!1;var o=B[0],d=B[1],P=function(B){return Zc._4O.Util._56O(B,o)},X=P(p);return d==X}}.bind(Rl(I))};var uj,Wp;return function(){var N=Iq.length-$l.length;if(N>0)for(var E=0;N>E;E++)uj=bk.Util,Wp=ob}(),Gp=function(g,$){$=Wp($);var Z=Rl(yk),l=wo.length,d=2*l,q=mq($,Q(l,d)),B=Z,A=!0;if(B){var m=B[jf[0]];m&&q._55O()<=m._55O()&&(A=!1)}if(A)return 0;var h=B._37O(q),V=h[ef](Q(l,d)).replace(Bq,""),W=yi(V);if(0==W.length)return!1;var X=W[0],u=W[1],N=uj._11A(g,X);return u==N},hr}(E,G),uj(X,{load:function(){var t={},J=function(X){return X?"c_"+(X.sync?"1":"0")+"_"+(X.post?"1":"0")+"_"+(X.responseType||"H")+"_"+(X.mimeType||"H")+"_"+(X.data?JSON.stringify(X.data):"H"):""};return function(n,v,F){var q,e=t[n],g=J(F);return e&&(q=e[g])?(q.push(v),void 0):(t[n]||(e=t[n]={count:0}),q=e[g]=[v],e.count++,X.xhrLoad(n,function(N){delete e[g],e.count--,e.count||delete t[n],q.forEach(function(v){v(N)})},F),void 0)}}(),asyncEach:function(q,d,e){"function"!=typeof e&&(e=Function.prototype);var S=new Array(q.length),m=0,W=!1;q.forEach(function(s,t){d(s,function(L,u){return W?void 0:L?(W=!0,e(null)):(S[t]=u,m++,m===q.length?e(S):void 0)})})},xhrLoad:function(V,u,a){var n=!1;En(V)||(n=!0,V=[V]),a=a||{};var Q=a.sync,N=null,q=a.method||"GET";return a.post&&(q="POST"),a.method=q,X.asyncEach(V,function(Y,x){var K=new Gh;Y=X.beforeLoadURL(Y),Y.data?x(null,Y.data):(a.url=encodeURI(Y),a.responseType?K.setResponseType(a.responseType):K.setOverrideMimeType(a.mimeType||"text/plain"),K.onload=function(){200===this.status||0===this.status?x(null,K.getResponseText()):x(!0)},K.onerror=function(){x(!0)},K.send(a))},function(h){var V="function"==typeof u;(V||Q)&&(N=n&&h?h[0]:h,V&&u(N))}),Q?N:void 0}});var Kf=W.List=function(){this._as=[];var P,b,f=arguments.length;if(1===f){var a=arguments[0];if(dm(a)&&(a=a._as),En(a))for(b=a.length,P=0;b>P;P++)this._as.push(a[P]);else a!=S&&this._as.push(a)}else if(f>1)for(P=0;f>P;P++)this._as.push(arguments[P])};Xp("List",G,{forEach:function(K,V){this.each(K,V)},push:function(){for(var S=0;S<arguments.length;S++)this.add(arguments[S])},pop:function(){return this._as.pop()},shift:function(){return this._as.shift()},unshift:function(){return this._as.unshift.apply(this._as,arguments)},size:function(){return this._as.length},isEmpty:function(){return 0===this._as.length},add:function(b,k){return k===d?this._as.push(b):this._as.splice(k,0,b)},addAll:function(X){dm(X)&&(X=X._as),En(X)?qh(this._as,X):this._as.push(X)},get:function(Z){return this._as[Z]},slice:function(r,A){return new Kf(this._as.slice(r,A))},remove:function(n){var O=this._as.indexOf(n);return O>=0&&O<this._as.length&&this.removeAt(O),O},removeAt:function(r){return this._as.splice(r,1)[0]},set:function(l,O){return this._as[l]=O},clear:function(){return this._as.splice(0,this._as.length)},contains:function(X){return this._as.indexOf(X)>=0},indexOf:function(t){return this._as.indexOf(t)},each:function(E,C){for(var z=0,X=this._as.length;X>z;z++){var W=this._as[z];C?E.call(C,W,z,this):E(W,z,this)}},reverseEach:function(i,p){for(var n=this._as.length-1;n>=0;n--){var v=this._as[n];p?i.call(p,v):i(v)}},getArray:function(){return this._as},toArray:function(O,f){if(O){for(var U,x=[],o=0,Y=this._as.length;Y>o;o++)U=this._as[o],f?O.call(f,U)&&x.push(U):O(U)&&x.push(U);return x}return this._as.concat()},toList:function(G,h){if(G){for(var D,B=new Kf,Z=0,N=this._as.length;N>Z;Z++)D=this._as[Z],h?G.call(h,D)&&B.add(D):G(D)&&B.add(D);return B}return new Kf(this)},reverse:function(){this._as.reverse()},sort:function(T){return this._as.sort(T?T:Ue),this},toString:function(){return this._as.toString()}}),G.defineProperties(Kf.prototype,{length:{get:function(){return this._as.length},set:function(t){this._as.length=t}}});var le=new Kf;uj(le,{size:function(){return 0},indexOf:function(){return-1},contains:function(){return!1},isEmpty:function(){return!0},sort:ic,each:ic,reverseEach:ic,toArray:function(){return[]},toList:function(){return new Kf},add:ln,addAll:ln,set:ln,remove:ln,removeAt:ln,clear:ln});var Ff=W.Notifier=function(){this._f=0};Xp("Notifier",G,{contains:function(t,I){if(this._ls)for(var q,C=0,H=this._ls.size();H>C;C++)if(q=this._ls.get(C),t===q.l&&I===q.s)return!0;return!1},add:function(n,c,s){var l=this,$={l:n,s:c,a:s};l._ls||(l._ls=new Kf),l._f?(l._as||(l._as=new Kf),l._as.add($)):$.a?l._ls.add($,0):l._ls.add($)},remove:function(f,n){var F=this;F._ls&&(F._f?(F._rs||(F._rs=new Kf),F._rs.add({l:f,s:n})):F._remove(f,n))},_remove:function(W,X){for(var P,A=this._ls,V=0,Y=A.size();Y>V;V++)if(P=A.get(V),P.l===W&&P.s===X)return A.removeAt(V),void 0},fire:function(F){var T=this,z=T._ls;if(T._b=1e4,z){++T._f;try{for(var d,I=0,S=z.size();S>I;I++)d=z.get(I),d.s?d.l.call(d.s,F):d.l(F)}catch(F){J(function(){throw F})}finally{if(--T._f)return;if(T._rs){for(S=T._rs.size(),I=0;S>I;I++)d=T._rs.get(I),T._remove(d.l,d.s);delete T._rs}if(T._as){for(S=T._as.size(),I=0;S>I;I++)d=T._as.get(I),d.a?z.add(d,0):z.add(d);delete T._as}}}}});var Pp=W.Data=function(){this._id=mf()};Xp("Data",G,{ms_ac:["tag","name","displayName","icon","toolTip","attrObject","styleMap","layer","adjustChildrenToTop","dataBindings"],ms_dm:1,ms_attr:1,_icon:S,_parent:S,_children:le,_childMap:S,_styleMap:S,_layer:"0",_adjustChildrenToTop:!1,getUIClass:function(){return S},_22Q:function(){return S},s:function(y,m){var P=this;if(2===arguments.length)P.setStyle(y,m);else{if(!zn(y))return P.getStyle(y);for(var U in y)P.setStyle(U,y[U])}return P},fp:function(_,A,B,Y,e){return this.firePropertyChange(_,A,B,Y,e)},firePropertyChange:function(h,L,C,n,l){if(n){if(n(L,C))return!1}else if(L===C)return!1;var R=this,e=l||{};return e.property=h,e.oldValue=L,e.newValue=C,e.data=R,R._dataModel&&R._dataModel.handleDataPropertyChange(e),R.onPropertyChanged(e),!0},onPropertyChanged:function(Q){var z=this,m=z._parent,b=Q.property;if(Ud(m)){var e=z.s(cg),H="s:ingroup"===b;(e&&hm[b]||b===H)&&m._81I(),(e||H)&&m.fp("childChange",!0,!1)}Kk(m)&&hm[b]&&m.updateFromChildren()},_21I:function(R){var M=this;if(R&&M._dataModel)throw"Remove data from dataModel before adding";M._dataModel=R},removeFromDataModel:function(){this._dataModel?this._dataModel.remove(this):this.setParent(null)},clearChildrenFromDataModel:function(){for(var M=0,h=this._children.toArray(),z=h.length;z>M;M++)h[M].removeFromDataModel()},getId:function(){return this._id},setId:function(d){this._id=d},getChildren:function(){return this._children},size:function(){return this._children.size()},toChildren:function(p,X){return this._children.toList(p,X)},eachChild:function($,S){this._children.each($,S)},addChild:function(C,u){var m=this;C!==m&&(m._children===le&&(m._children=new Kf,m._childMap={}),u>=0||(u=m._children.size()),m._childMap[C._id]||m.isDescendantOf(C)||(C._parent&&C._parent.removeChild(C),(0>u||u>m._children.size())&&(u=m._children.size()),m._children.add(C,u),m._childMap[C._id]=C,C.setParent(m),m.onChildAdded(C,u),m.fp(wg,S,C)))},onChildAdded:function(){},removeChild:function(p){var C=this;if(C._childMap&&C._childMap[p._id]){var J=C._children.remove(p);delete C._childMap[p._id],C.fp(wg,p,S),p.setParent(S,J),C.onChildRemoved(p,J)}},onChildRemoved:function(){},getChildAt:function(g){return this._children.get(g)},clearChildren:function(){var W=this;if(!W._children.isEmpty())for(var i=0,L=W._children.toArray(),$=L.length;$>i;i++)W.removeChild(L[i])},getParent:function(){return this._parent},setParent:function(v,X){var i=this;if(!(i._73I||i._parent===v||i===v||v&&v.isDescendantOf(i))){var g,N=i._parent;i._parent=v,i._73I=1,N?(X==S&&(X=N.getChildren().indexOf(i)),N.removeChild(i)):i._dataModel&&X==S&&(X=i._dataModel.getRoots().indexOf(i)),v&&(v.addChild(i),g=v.getChildren().indexOf(i)),delete i._73I,i.fp("parent",N,v,d,{oldIndex:X,newIndex:g}),i.onParentChanged(N,v)}},onParentChanged:function(){},hasChildren:function(){return this._children.size()>0},isEmpty:function(){return this._children.isEmpty()},isRelatedTo:function(b){return b?this.isDescendantOf(b)||b.isDescendantOf(this):!1},isParentOf:function(M){return M&&this._childMap?!!this._childMap[M._id]:!1},isDescendantOf:function(X){if(!X||X.isEmpty())return!1;for(var H=this._parent;H;){if(X===H)return!0;H=H._parent}return!1},getStyle:function(i,N){N===d&&(N=1);var B=this._styleMap?this._styleMap[i]:d;return B===d&&N?n[i]:B},setStyle:function(s,$){var l=this;l._styleMap||(l._styleMap={});var R=l._styleMap[s];$===d?delete l._styleMap[s]:l._styleMap[s]=$,l.fp("s:"+s,R,$)&&l.onStyleChanged(s,R,$)},onStyleChanged:function(){},iv:function(G){this.invalidate(G)},invalidate:function(p){this.fp(p||"*",!1,!0)},toString:function(){var K=this;return K._displayName||K._name||K._tag||K._id},toLabel:function(){return this._displayName||this._name},addStyleIcon:function(O,A){var t=this,q=t.s(eq);q||t.s(eq,q={}),A?q[O]=A:delete q[O],t.fp(eq,S,q)},removeStyleIcon:function(k){var e=this.s(eq);if(e){var m=e[k];delete e[k],this.fp(eq,S,e)}return m},getSerializableProperties:function(){return{name:1,displayName:1,icon:1,toolTip:1,parent:1,layer:1,tag:1,adjustChildrenToTop:1,dataBindings:1}},getSerializableStyles:function(){var b,$={};for(b in this._styleMap)$[b]=1;return $},getCurrentPrefix:function(){return this._interactPrefix||Zb},ca:function(P,H){var S=this.getCurrentPrefix();return P=S+P,2===arguments.length?this.a(P,H):this.a(P)}});var Ag=W.DataModel=function(){var X=this;X._datas=new Kf,X._dataMap={},X._roots=new Kf,X._rootMap={},X._fsDataMap={},X._78O={},X._reflectorMap={},X._36I=new Ff,X._35I=new Ff,X._serializeNotifier=new Ff,X._selectionModel=new xs(X);var j=X._29Q=[],e=X._scheduleCallback=function(){for(var x=Date.now(),p=0;p<j.length;p++){var Z=j[p];Z.enabled&&x-Z.lastTime>Z.interval&&(Z.beforeAction&&Z.beforeAction(),X.each(function(S){Z.action(S)}),Z.afterAction&&Z.afterAction(),Z.lastTime=x)}j.length&&(X._30Q=E.requestAnimationFrame(e))}};Xp("DataModel",G,{ms_fire:1,ms_attr:1,ms_ac:["layers","name","autoAdjustIndex","hierarchicalRendering","background","envmap","postProcessingData","init"],_name:d,_autoAdjustIndex:!0,_hierarchicalRendering:!1,_background:d,_init:d,_envmap:d,_postProcessingData:d,sm:function(){return this.getSelectionModel()},mm:function(S,x,P){this.addDataModelChangeListener(S,x,P)},umm:function(s,w){this.removeDataModelChangeListener(s,w)},md:function(P,S,Q){this.addDataPropertyChangeListener(P,S,Q)},umd:function(P,F){this.removeDataPropertyChangeListener(P,F)},mh:function(S,h,j){this.addHierarchyChangeListener(S,h,j)},umh:function(d,q){this.removeHierarchyChangeListener(d,q)},getAttrObject:function(){return this._attrObject},setAttrObject:function(N){return this._attrObject=N},getSelectionModel:function(){return this._selectionModel},size:function(){return this._datas.size()},isEmpty:function(){return this._datas.isEmpty()},getRoots:function(){return this._roots},getDatas:function(){return this._datas},getFullscreenDatas:function(){return this._fsDataMap},getReflectors:function(){return this._reflectorMap},getDataById:function(H){return this._dataMap[H]},removeDataById:function(n){this.remove(this.getDataById(n))},toDatas:function(V,f){return this._datas.toList(V,f)},each:function(C,V){this._datas.each(C,V)},getDataByTag:function(o){return this._78O[o]},getTagMap:function(){return this._78O},removeDataByTag:function(R){this.remove(this.getDataByTag(R))},add:function(C,r,M){var B=this,J=C._id,a=C._tag,U=B._roots;if(B._dataMap[J])throw"'"+J+"' already exists";a!=S&&(B._78O[a]=C),B._dataMap[J]=C,M>=0?B._datas.add(C,M):B._datas.add(C),C._parent||(B._rootMap[J]=C,r>=0?U.add(C,r):U.add(C)),C.s("fullscreen")!==d&&(B._fsDataMap[J]=C),C.s("shape3d.reflector")&&(B._reflectorMap[J]=C),C._21I(B),B.onAdded(C),B._36I.fire({kind:"add",data:C,rootsIndex:r,datasIndex:M})},onAdded:function(){},remove:function(N,j){if(N){var q=this,Y=N._id,H=j&&j.keepStructure,g=j&&j.keepChildren,n=N.getTag();if(N._dataModel===q){this.beginTransaction(),H?q._removingData||(q._removingData=N):q.prepareRemove(N),g||N.toChildren().each(function(_){q.remove(_,j)},q),H?q._removingData===N&&(N._parent&&N._parent.removeChild(N),delete q._removingData):N._parent&&N._parent.removeChild(N);var x=q._datas.remove(N);delete q._dataMap[Y],n!=S&&delete q._78O[n];var M;q._rootMap[Y]&&(delete q._rootMap[Y],M=q._roots.remove(N)),q._fsDataMap[Y]&&delete q._fsDataMap[Y],q._reflectorMap[Y]&&delete q._reflectorMap[Y],N._21I(S),q.onRemoved(N),q._36I.fire({kind:li,data:N,rootsIndex:M,datasIndex:x}),this.endTransaction()}}},onRemoved:function(){},prepareRemove:function(){},clear:function(){var W=this;if(W._datas.size()){var c=W._historyManager?this.toJSON():d;W._datas.toArray().forEach(function(z){z._21I(S)}),W._datas.clear(),W._dataMap={},W._roots.clear(),W._rootMap={},W._fsDataMap={},W._reflectorMap={},W._78O={},W._36I.fire({kind:vh,json:c})}},contains:function(k){return k&&k._dataModel===this},handleDataPropertyChange:function(D){var f=this,V=D.data,X=D.property;if("parent"===X){var P=V._id,M=f._rootMap,$=f._roots;V._parent?M[P]&&(delete M[P],$.remove(V)):M[P]||(M[P]=V,$.add(V))}else if("tag"===X){var q=D.oldValue,B=D.newValue,e=f._78O;q!=S&&delete e[q],B!=S&&(e[B]=V)}else if("s:fullscreen"===X){var P=V._id,m=f._fsDataMap;D.oldValue!=S&&delete m[P],D.newValue!=S&&(m[P]=V)}else if("s:shape3d.reflector"===X){var P=V._id,v=f._reflectorMap;D.oldValue&&delete v[P],D.newValue&&(v[P]=V)}this.onDataPropertyChanged(V,D),this._35I.fire(D)},onDataPropertyChanged:function(){},addDataModelChangeListener:function(y,u,V){this._36I.add(y,u,V)},removeDataModelChangeListener:function(v,t){this._36I.remove(v,t)},addSerializeListener:function(L,b,u){this._serializeNotifier.add(L,b,u)},removeSerializeListener:function(P,d){this._serializeNotifier.remove(P,d)},fireSerializeEvent:function(W){this._serializeNotifier.fire(W)},addDataPropertyChangeListener:function(E,r,f){this._35I.add(E,r,f)},removeDataPropertyChangeListener:function(b,Z){this._35I.remove(b,Z)},_38I:function(Q,u,D){this._37I&&this._37I.fire({data:Q,oldIndex:u,newIndex:D})},addHierarchyChangeListener:function(w,z,A){this._37I||(this._37I=new Ff),this._37I.add(w,z,A)},removeHierarchyChangeListener:function(Y,y){this._37I.remove(Y,y)},getSiblings:function(c){var K=c._parent;return K?K._children:this._roots},eachByHierarchical:function(m,W,i){if(W)return this._eachByHierarchical(m,W,i);for(var S=0,s=this._roots,M=s.size();M>S;S++)if(this._eachByHierarchical(m,s.get(S),i)===!1)return!1;return!0},_eachByHierarchical:function(e,x,k){if(k){if(e.call(k,x)===!1)return!1}else if(e(x)===!1)return!1;for(var q=x.size(),g=0;q>g;g++)if(this._eachByHierarchical(e,x.getChildAt(g),k)===!1)return!1;return!0},reverseEachByHierarchical:function(O,U,o){if(U)return this._reverseEachByHierarchical(O,U,o);for(var Q=this._roots,u=Q.size(),S=u-1;S>=0;S--)if(this._reverseEachByHierarchical(O,Q.get(S),o)===!1)return!1;return!0},_reverseEachByHierarchical:function(N,k,c){for(var L=k.size(),o=L-1;o>=0;o--)if(this._reverseEachByHierarchical(N,k.getChildAt(o),c)===!1)return!1;if(c){if(N.call(c,k)===!1)return!1}else if(N(k)===!1)return!1;return!0},eachByDepthFirst:function(A,o,S){if(o)return this._11I(A,o,S);for(var u=0,D=this._roots,B=D.size();B>u;u++)if(this._11I(A,D.get(u),S)===!1)return!1;return!0},_11I:function(W,K,L){for(var Y=K.size(),C=0;Y>C;C++)if(this._11I(W,K.getChildAt(C),L)===!1)return!1;if(L){if(W.call(L,K)===!1)return!1}else if(W(K)===!1)return!1;return!0},eachByBreadthFirst:function(n,z,G){var H=new Kf;for(z?H.add(z):this._roots.each(H.add,H);H.size()>0;)if(z=H.removeAt(0),z.eachChild(H.add,H),G){if(n.call(G,z)===!1)return!1}else if(n(z)===!1)return!1;return!0},moveTo:function(R,V){var D=this.getSiblings(R),c=D.indexOf(R);c===V||0>c||V>=0&&V<=D.size()&&(D.remove(R),V>D.size()&&V--,D.add(R,V),this._38I(R,c,V))},moveUp:function(w){this.moveTo(w,this.getSiblings(w).indexOf(w)-1)},moveDown:function(o){this.moveTo(o,this.getSiblings(o).indexOf(o)+1)},moveToTop:function(U){this.moveTo(U,0)},moveToBottom:function(_){this.moveTo(_,this.getSiblings(_).size())},moveSelectionUp:function(Q){this.beginTransaction(),Q||(Q=this.sm());var A=new Kf;Rp(Q,A,this._roots),A.each(this.moveUp,this),this.endTransaction()},moveSelectionDown:function($){this.beginTransaction(),$||($=this.sm());var J=new Kf;Af($,J,this._roots),J.each(this.moveDown,this),this.endTransaction()},moveSelectionToTop:function(p){this.beginTransaction(),p||(p=this.sm());var Z=new Kf;Ep(p,Z,this._roots),Z.each(this.moveToTop,this),this.endTransaction()},moveSelectionToBottom:function(Y){this.beginTransaction(),Y||(Y=this.sm());var g=new Kf;Fq(Y,g,this._roots),g.each(this.moveToBottom,this),this.endTransaction()},moveToIndex:function(C,N,j){var y=this.getDatas();null==j&&(j=y.indexOf(C)),j===N||0>j||N>=0&&N<=y.size()&&(y.remove(C),N>y.size()&&N--,y.add(C,N),this._76I(C,j,N))},bringForward:function(w){this.moveToIndex(w,this.getDatas().indexOf(w)+1)},bringToFront:function(D){this.moveToIndex(D,this.size())},sendBackward:function(q){this.moveToIndex(q,this.getDatas().indexOf(q)-1)},sendToBack:function(M){this.moveToIndex(M,0)},bringSelectionForward:function(t){this.beginTransaction(),t||(t=this.sm());for(var c=new Kf,A=this.getDatas(),h=!1,N=0;N<A.size();N++){var w=A.get(A.size()-1-N);t.contains(w)?h&&c.add(w):h=!0}c.each(this.bringForward,this),this.endTransaction()},bringSelectionToFront:function(B){this.beginTransaction(),B||(B=this.sm());for(var X=new Kf,A=this.getDatas(),E=0;E<A.size();E++){var R=A.get(E);B.contains(R)&&X.add(R)}X.each(this.bringToFront,this),this.endTransaction()},sendSelectionBackward:function(W){this.beginTransaction(),W||(W=this.sm());for(var F=new Kf,v=this.getDatas(),o=!1,h=0;h<v.size();h++){var b=v.get(h);W.contains(b)?o&&F.add(b):o=!0}F.each(this.sendBackward,this),this.endTransaction()},sendSelectionToBack:function(Q){this.beginTransaction(),Q||(Q=this.sm());for(var v=new Kf,W=this.getDatas(),R=0;R<W.size();R++){var m=W.get(W.size()-1-R);Q.contains(m)&&v.add(m)}v.each(this.sendToBack,this),this.endTransaction()},addScheduleTask:function(d){var Q=this;Q.removeScheduleTask(d),d.enabled==S&&(d.enabled=!0),d.interval==S&&(d.interval=10),d.action==S&&(d.action=ic),d.lastTime=Date.now(),Q._29Q.push(d),Q._30Q==S&&(Q._30Q=E.requestAnimationFrame(Q._scheduleCallback))},removeScheduleTask:function(W){var u=this,Q=u._29Q,N=Q.indexOf(W);N>=0&&Q.splice(N,1),Q.length||u._30Q==S||(E.cancelAnimationFrame(u._30Q),delete u._30Q)},getHistoryManager:function(){return this._historyManager},enableHistoryManager:function(g){this._historyManager||new W.HistoryManager(this),null!=g&&this._historyManager.setMaxHistoryCount(g),this._historyManager.setDisabled(!1)},disableHistoryManager:function(){this._historyManager&&this._historyManager.setDisabled(!0)},clearHistoryManager:function(){this._historyManager&&this._historyManager.clear()},undo:function(C){this._historyManager&&this._historyManager.undo(C)},redo:function(J){this._historyManager&&this._historyManager.redo(J)},beginTransaction:function(){this._historyManager&&this._historyManager.beginTransaction()},endTransaction:function(){this._historyManager&&this._historyManager.endTransaction()},addHistory:function(v){this._historyManager&&this._historyManager.addHistory(v)},onHistoryManagerChanged:function(){}});var xs=W.SelectionModel=function(H){var e=this;e._68O=gd,e._map={},e._73O=new Kf,e._74I=new Ff,e._21I(H)};Xp("SelectionModel",G,{ms_fire:1,ms_dm:1,ms:function(i,P,y){this.addSelectionChangeListener(i,P,y)},ums:function(M,d){this.removeSelectionChangeListener(M,d)},fd:function(){return this.getFirstData()},ld:function(){return this.getLastData()},sg:function(){return this._68O===ji},co:function(q){return this._map[q._id]!=S},ss:function(R){this.setSelection(R)},as:function(y){this.appendSelection(y)},rs:function(G){this.removeSelection(G)},cs:function(){this.clearSelection()},sa:function(){this.selectAll()},getSelectionMode:function(){return this._68O},setSelectionMode:function(E){var z=this;if(z._68O!==E&&(E===jf||E===ji||E===gd)){z.cs();var Y=z._68O;z._68O=E,z.fp("selectionMode",Y,E)}},_21I:function(c){var w=this,d=w._dataModel;d!==c&&(d&&(w.cs(),d.umm(w.handleDataModelChange,w)),w._dataModel=c,c.mm(w.handleDataModelChange,w,!0),w.fp(Ak,d,c))},dispose:function(){var S=this;S.cs(),S._dataModel.umm(S.handleDataModelChange,S)},handleDataModelChange:function(f){var g=this;if(f.kind===li){var h=f.data;g.co(h)&&(g._73O.remove(h),delete g._map[h._id],g._75I(li,new Kf(h)))}else f.kind===vh&&g.cs()},getFilterFunc:function(){return this._filterFunc},setFilterFunc:function(n){var S=this;if(S._filterFunc!==n){S.cs();var _=S._filterFunc;S._filterFunc=n,S.fp("filterFunc",_,S._filterFunc)}},_75I:function(P,C,H,g){H&&(this._73O.each(function(c){g[c._id]?H.remove(c):H.add(c)}),C=H.toList()),this._74I.fire({kind:P,datas:new Kf(C)})},addSelectionChangeListener:function(n,Q,U){this._74I.add(n,Q,U)},removeSelectionChangeListener:function(J,K){this._74I.remove(J,K)},_97O:function(k,U){for(var v,t=this,H=0,z=new Kf(k);H<z.size();H++)v=z.get(H),(t._filterFunc&&!t._filterFunc(v)||U&&t.co(v)||!U&&!t.co(v)||!t._dataModel.contains(v))&&(z.removeAt(H),H--);return z},appendSelection:function(r){var F=this;if(F._68O!==jf){var z,Y,$=F._73O,j=F._97O(r,!0);j.isEmpty()||(F.sg()&&(z=new Kf($),Y=F._map,$.clear(),F._map={},j=new Kf(j.get(j.size()-1))),j.each(function(U){$.add(U),F._map[U._id]=U}),F._75I("append",j,z,Y))}},removeSelection:function(j){var r=this,p=r._97O(j),K=0,L=p.size();if(0!==L){for(;L>K;K++){var n=p.get(K);r._73O.remove(n),delete r._map[n._id]}r._75I(li,p)}},toSelection:function(M,F){return this._73O.toList(M,F)},getSelection:function(){return this._73O},each:function(m,Z){this._73O.each(m,Z)},setSelection:function(K){var A=this,T=A._73O;if(A._68O!==jf&&!(T.isEmpty()&&!K||1===T.size()&&A.ld()===K)){var H=new Kf(T),c=A._map;T.clear(),A._map={};var P=A._97O(K,!0);A.sg()&&P.size()>1&&(P=new Kf(P.get(P.size()-1))),P.each(function(C){T.add(C),A._map[C._id]=C}),A._75I("set",S,H,c)}},clearSelection:function(){var p=this,P=p._73O;if(P.size()>0){var o=P.toList();P.clear(),p._map={},p._75I(vh,o)}},selectAll:function(){var k=this;if(k._68O!==jf){var a,_,E=k._dataModel.toDatas();if(k._filterFunc)for(a=0;a<E.size();a++)_=E.get(a),k._filterFunc(_)||(E.removeAt(a),a--);var w=k._73O,J=new Kf(w),T=k._map;w.clear(),k._map={},k.sg()&&E.size()>1&&(E=new Kf(E.get(E.size()-1)));var l=E.size();for(a=0;l>a;a++)_=E.get(a),w.add(_),k._map[_._id]=_;k._75I("all",S,J,T)}},size:function(){return this._73O.size()},isEmpty:function(){return this._73O.isEmpty()},contains:function(w){return this._map[w._id]!=S},getLastData:function(){var f=this._73O;return f.size()>0?f.get(f.size()-1):S},getFirstData:function(){var g=this._73O;return g.size()>0?g.get(0):S},isSelectable:function(h){var e=this;return h&&e._68O!==jf?e._filterFunc?e._filterFunc(h):!0:!1},getTopSelection:function(){var m=this,G=new Kf;return m._73O.each(function(b){for(var $=b.getParent();$;){if(m.contains($)){b=S;break}$=$.parent}b&&G.add(b)}),G}});var Pl=function(){return pq(0),function(i,j){var v;if(gq(j)){var V=i.getDataUI(j);V&&V._88I&&(v=V._88I.rect)}return v?v:j.getRect()}}();uj(X,{edgeGroupAgentFunc:S,graphViewAutoScrollZone:16,graphViewZoomable:!0,graphViewResettable:!1,graphViewPannable:!0,graphViewRectSelectable:!0,graphViewScrollBarVisible:!0,graphViewRectSelectBorderColor:v.rectSelectBorder,graphViewRectSelectBackground:ef,graphViewEditPointSize:xl?17:7,graphViewEditPointBorderColor:v.editPointBorder,graphViewEditPointBackground:v.editPointBackground,setEdgeType:function(a,R,l){Vd[a]=R,Jp[a]=l},getEdgeType:function(_){return Vd[_]},getEdgeTypeMap:function(){return Vd},getNodeRect:Pl},!0),uj(n,{"layout.h":d,"layout.v":d,"2d.selectable":!0,"2d.visible":!0,"2d.movable":!0,"2d.editable":!0,"2d.move.mode":d,interactive:!1,preventDefaultWhenInteractive:!0,"image.stretch":"fill",icons:d,ingroup:!0,"body.color":d,"2d.gray":!1,fullscreen:d,"fullscreen.gap":2,"fullscreen.lock":!1,opacity:d,pixelPerfect:!0,keepAspectRatio:!1,"attach.points":null,"attach.style":null,"attach.close.threshold":16,"clip.direction":"top","clip.percentage":1,"select.color":Ul,"select.width":1,"select.padding":2,"select.type":Ni,shadow:!1,"shadow.blur":6,"shadow.offset.x":3,"shadow.offset.y":3,"border.color":d,"border.width":2,"border.padding":2,"border.type":Ni,label:d,"label.font":d,"label.color":Nc,"label.background":d,"label.position":31,"label.position.fixed":!1,"label.offset.x":0,"label.offset.y":2,"label.rotation":d,"label.max":d,"label.opacity":d,"label.scale":1,"label.align":d,"label.selectable":!0,label2:d,"label2.font":d,"label2.color":Nc,"label2.background":d,"label2.position":34,"label2.position.fixed":!1,"label2.offset.x":0,"label2.offset.y":-2,"label2.rotation":d,"label2.max":d,"label2.opacity":d,"label2.scale":1,"label2.align":d,"label2.selectable":!0,note:d,"note.expanded":!0,"note.font":d,"note.color":ah,"note.background":Ul,"note.position":8,"note.offset.x":-3,"note.offset.y":3,"note.max":d,"note.toggleable":!0,"note.border.width":1,"note.border.color":d,"note.opacity":d,"note.scale":1,"note.align":d,note2:d,"note2.expanded":!0,"note2.font":d,"note2.color":ah,"note2.background":Ul,"note2.position":3,"note2.offset.x":3,"note2.offset.y":-3,"note2.max":d,"note2.toggleable":!0,"note2.border.width":1,"note2.border.color":d,"note2.opacity":d,"note2.scale":1,"note2.align":d,"group.type":d,"group.image":d,"group.image.stretch":"fill","group.repeat.image":d,"group.padding":8,"group.padding.left":0,"group.padding.right":0,"group.padding.top":0,"group.padding.bottom":0,"group.position":17,"group.toggleable":!0,"group.title.font":d,"group.title.color":ah,"group.title.background":v.groupTitleBackground,"group.title.align":zc,"group.title.orientation":Dc,"group.background":v.groupBackground,"group.depth":1,"group.border.width":1,"group.border.pattern":d,"group.border.color":Ch,"group.border.radius":0,"group.border.cap":hk,"group.border.join":Zc,"group.splitLine":!1,"group.gradient":S,"group.gradient.color":"#FFF",shape:d,"shape.background":Ch,"shape.repeat.image":d,"shape.border.width":0,"shape.border.width.absolute":!1,"shape.border.color":Ch,"shape.border.3d":!1,"shape.border.3d.color":d,"shape.border.3d.accuracy":d,"shape.border.cap":hk,"shape.border.join":Zc,"shape.border.pattern":d,"shape.gradient":S,"shape.gradient.color":"#FFF","shape.depth":0,"shape.dash":!1,"shape.dash.pattern":Bj,"shape.dash.offset":0,"shape.dash.color":Pg,"shape.dash.width":d,"shape.dash.3d":!1,"shape.dash.3d.color":d,"shape.dash.3d.accuracy":d,"shape.polygon.side":6,"shape.arc.from":u,"shape.arc.to":m,"shape.arc.close":!0,"shape.arc.oval":!1,"shape.corner.radius":d,"shape.gradient.pack":d,"shape.fill.rule":"nonzero","shape.fill.clip.direction":"top","shape.fill.clip.percentage":1,"shape.foreground":d,"shape.foreground.gradient":S,"shape.foreground.gradient.color":"#FFF","shape.foreground.clip.direction":"top","shape.foreground.clip.percentage":1,"autolayout.gap":d,"autolayout.hgap":d,"autolayout.vgap":d,"edge.type":d,"edge.points":d,"edge.segments":d,"edge.color":Ch,"edge.width":2,"edge.width.absolute":!1,"edge.offset":0,"edge.group":0,"edge.expanded":!0,"edge.gap":12,"edge.toggleable":!0,"edge.center":!1,"edge.3d":!1,"edge.3d.color":d,"edge.3d.accuracy":d,"edge.cap":hk,"edge.join":Zc,"edge.source.position":17,"edge.source.anchor.x":d,"edge.source.anchor.y":d,"edge.source.offset.x":0,"edge.source.offset.y":0,"edge.target.position":17,"edge.target.anchor.x":d,"edge.target.anchor.y":d,"edge.target.offset.x":0,"edge.target.offset.y":0,"edge.pattern":d,"edge.dash":!1,"edge.dash.pattern":Bj,"edge.dash.offset":0,"edge.dash.color":Pg,"edge.dash.width":d,"edge.dash.3d":!1,"edge.dash.3d.color":d,"edge.dash.3d.accuracy":d,"edge.independent":!1,"attach.row.index":0,"attach.column.index":0,"attach.row.span":1,"attach.column.span":1,"attach.padding":0,"attach.padding.left":0,"attach.padding.right":0,"attach.padding.top":0,"attach.padding.bottom":0,"attach.index":-1,"attach.offset":0,"attach.offset.relative":!1,"attach.offset.opposite":!1,"attach.thickness":d,"attach.gap":0,"attach.gap.relative":!1,"grid.row.count":1,"grid.column.count":1,"grid.row.percents":d,"grid.column.percents":d,"grid.border":1,"grid.border.left":0,"grid.border.right":0,"grid.border.top":0,"grid.border.bottom":0,"grid.gap":1,"grid.background":v.gridBackground,"grid.depth":1,"grid.cell.depth":-1,"grid.cell.border.color":v.gridCellBorderColor,"grid.block":d,"grid.block.padding":3,"grid.block.width":1,"grid.block.color":v.gridBlockColor,text:"","text.align":"left","text.vAlign":"middle","text.color":Nc,"text.font":xc,"text.shadow":!1,"text.shadow.color":Ul,"text.shadow.blur":6,"text.shadow.offset.x":3,"text.shadow.offset.y":3,"text.scale.x":1,"text.scale.y":1,_62O:d},!0),uj(Ag,{_76I:function(Z,e,T){this._39I&&this._39I.fire({data:Z,oldIndex:e,newIndex:T})
},addIndexChangeListener:function(S,z,q){var F=this;F._39I||(F._39I=new Ff),F._39I.add(S,z,q)},removeIndexChangeListener:function(Q,u){this._39I.remove(Q,u)},prepareRemove:function(f){Pe(f)&&(f.setSource(S),f.setTarget(S)),f._70O&&f._70O.toList().each(this.remove,this),f._69O&&f._69O.toList().each(function(M){M.setHost(S)}),f._host&&f.setHost(S)},onAdded:function(h){this.isAutoAdjustIndex()&&this.adjustIndex(h)},onDataPropertyChanged:function(I,H){qg[H.property]&&this.isAutoAdjustIndex()&&this.adjustIndex(I)},isAdjustable:function(G){return zm(G)||Pe(G)},isAdjustedToBottom:function(c){return Ud(c)?c.isExpanded()&&bp(c):!1},adjustIndex:function(R){var o=this;this.isHierarchicalRendering()||(o.isAdjustedToBottom(R)?(o.sendToBottom(R),R.eachChild(o.adjustIndex,o)):o.sendToTop(R))},sendToTop:function(C){var X=this;if(X.contains(C)&&X.isAdjustable(C)){var H=X._datas;if(C!==H.get(X.size()-1)){var R=H.indexOf(C);H.removeAt(R),H.add(C),X._76I(C,R,X.size()-1)}if(Pe(C)){var _=C._40I;_&&!X.isAdjustedToBottom(_)&&X.sendToTop(_),_=C._41I,_&&!X.isAdjustedToBottom(_)&&X.sendToTop(_)}C._69O&&C._69O.each(function(y){y.isRelatedTo(C)||zm(C)&&y.isLoopedHostOn(C)||X.sendToTop(y)}),C.ISubGraph||(!Ud(C)||C.isExpanded())&&C._adjustChildrenToTop&&C.eachChild(function(Q){Pe(Q)||X.sendToTop(Q)})}},sendToBottom:function(j,K){var Z=this;if(j!==K&&Z.contains(j)&&Z.isAdjustable(j)&&(!K||Z.contains(K))){var f=Z._datas,k=f.remove(j),t=K?Z._datas.indexOf(K):0;if(f.add(j,t),k!==t){Z._76I(j,k,t);var D=j._parent;!D||D.ISubGraph||Pe(D)||Z.sendToBottom(j._parent,j)}}}}),uj(zp,{ms_edit:function(C){C._46O=function(k){var e=this,B=e.gv.dm(),Z=e._index,W=e._89I,F=e._node,l=e._shape,K=e._edge,H=e._77I;F&&W?(this.fi({kind:"endEditRect",event:k,data:F,direction:W}),B.endTransaction()):l&&Z>=0?(e.fi({kind:"endEditPoint",event:k,data:l,index:Z}),B.endTransaction()):K&&Z>=0?(e.fi({kind:"endEditPoint",event:k,data:K,index:Z}),B.endTransaction()):H&&(e.fi({kind:"endEditRotation",event:k,data:H}),B.endTransaction())},C._78I=function(F){var h=this;h.autoScroll(F);var Q=h.gv.lp(F),J=h._index,$=h._89I,P=h._node,H=h._shape,G=h._edge,f=h._77I;if(P&&$)h._80O(Q),h.fi({kind:"betweenEditRect",event:F,data:P,direction:$});else if(H&&J>=0)Q.e=H.getPoints().get(J).e,H.setPoint(J,Q),h.fi({kind:"betweenEditPoint",event:F,data:H,index:J});else if(G&&J>=0){var A=G.s(Ab);Q.e=A.get(J).e,A.set(J,Q),G.fp(Ab,S,A),h.fi({kind:"betweenEditPoint",event:F,data:G,index:J})}else if(f){var o=f.p(),L=f.getScale(),m=j+N(Q.y-o.y,Q.x-o.x);L.y<0&&(m+=u),M(m)<.04&&(m=0),f.setRotation(m),h.fi({kind:"betweenEditRotation",event:F,data:f})}},C._80O=function(Y){var n=this,d=n._node,k=n._rect,X=k.x,l=k.y,U=k.width,N=k.height,o=n._89I,y=n._anchor,S=n._matrix,Y=S.tfi(Y);"northwest"===o?k=Mn(Y,{x:X+U,y:l+N}):o===ad?k=Mn({x:X,y:Y.y},{x:X+U,y:l+N}):"northeast"===o?k=Mn({x:X,y:Y.y},{x:Y.x,y:l+N}):o===Df?k=Mn({x:Y.x,y:l},{x:X+U,y:l+N}):o===Mg?k=Mn({x:X,y:l},{x:Y.x,y:l+N}):"southwest"===o?k=Mn({x:Y.x,y:l},{x:X+U,y:Y.y}):"south"===o?k=Mn({x:X,y:l},{x:X+U,y:Y.y}):"southeast"===o&&(k=Mn({x:X,y:l},Y)),d.setPosition(S.tf(k.x+k.width*y.x,k.y+k.height*y.y)),d.setWidth(k.width),d.setHeight(k.height)},C._80I=function($,X,L,z){var i=this,v=i.gv._zoom,Z=(i.gv.getEditPointSize()+2)/v;return th({x:X-Z/2,y:L-Z/2,width:Z,height:Z},$)?(i._89I!==z&&(i._89I=z),!0):!1},C._79I=function(P,O,l){var _=this,J=_.gv,v=O?J.getDataUI(O):S,X=v?v._55O:S;if(X){var f,t,x,h,D=J._zoom,N=(J.getEditPointSize()+2)/D,T=J.lp(P);if(zm(O)){if(X._56O&&zm(O)&&(t=X._98o,th({x:t.x-N/2,y:t.y-N/2,width:N,height:N},T)))return _._77I=O,l&&_.fi({kind:"beginEditRotation",event:P,data:O}),_.setCursor("crosshair"),!0;if(X._43O&&O instanceof Hj)for(x=O.getPoints(),f=x.size()-1;f>=0;f--)if(t=x.get(f),th({x:t.x-N/2,y:t.y-N/2,width:N,height:N},T))return _._index=f,_._shape=O,l&&_.fi({kind:"beginEditPoint",event:P,data:O,index:f}),_.setCursor("crosshair"),!0;if(X._42O)for(var j=O.getEditControlPoints(),m=["northwest",-1,-1,Df,-1,0,"southwest",-1,1,"south",0,1,"southeast",1,1,Mg,1,0,"northeast",1,-1,ad,0,-1],f=0,h=j.length;h>f;f++){var H=m[3*f],i=j[f];if(_._80I(T,i.x,i.y,H)){_._node=O;var Y=O.getWidth(),s=O.getHeight(),V=O.getAnchor();_._rect={x:-Y*V.x,y:-s*V.y,width:Y,height:s},_._anchor=V,_._matrix=O.getMatrix();var Z=O.getRotation(),b=k(Z),F=L(Z),B=m[3*f+1]*pd(O.getScale().x),d=m[3*f+2]*pd(O.getScale().y),U=Math.atan2(-F*B-b*d,b*B-F*d),G=(Math.round(U/(Math.PI/4))+8)%8,a=[Rd,"nesw-resize",gr,"nwse-resize",Rd,"nesw-resize",gr,"nwse-resize"][G];return _.setCursor(a),l&&_.fi({kind:"beginEditRect",event:P,data:O,direction:_._89I}),!0}}}if(X._43O&&Pe(O)&&O.s(ug)===xe&&(x=O.s(Ab)))for(f=x.size()-1;f>=0;f--)if(t=x.get(f),th({x:t.x-N/2,y:t.y-N/2,width:N,height:N},T))return _._index=f,_._edge=O,l&&_.fi({kind:"beginEditPoint",event:P,data:O,index:f}),_.setCursor("crosshair"),!0}return!1}},ms_gv:function(b){b._currentSubGraph=S,b._fpsInfo={time:0,fps:0,frames:0},b.upSubGraph=function(){this.setCurrentSubGraph(Nq(this._currentSubGraph))},b.isVisible=function(u){var w=this;if(Nq(u)!==w._currentSubGraph)return!1;if(Pe(u)){var M=u._40I,q=u._41I;if(!M||!q)return!1;if(!(u.s("edge.independent")||w.isVisible(M)&&w.isVisible(q)))return!1;if(u.isEdgeGroupHidden())return!1}else for(var j=u._parent;j&&!j.ISubGraph;){if(Ud(j)&&(!j.isExpanded()||!w.isVisible(j)))return!1;j=j._parent}if(u._parent instanceof Cc&&!w.isVisible(u._parent))return!1;if(u._refGraph instanceof ep&&!w.isVisible(u._refGraph))return!1;if(w instanceof _g){if(!u.s("3d.visible"))return!1}else{var f=w.getLayersInfo();if(f){var G=f[u._layer];if(G&&G.visible===!1)return!1}if(!u.s("2d.visible"))return!1}return w._visibleFunc?w._visibleFunc(u):!0},b.handleSelectionChange=function(b){var c=this;b.datas.each(function(N){c.invalidateData(N);var K=N._parent;Ud(K)&&zm(N)&&N.s(cg)&&(c.invalidateData(K),K._49I&&K._49I.each(function(G){c.invalidateData(G)}))}),c.onSelectionChanged(b)},b.onSelectionChanged=function(s){var h=this,U=h.sm();if(1===U.size()&&("set"===s.kind||"append"===s.kind)){var j=U.ld();h.isAutoMakeVisible()&&h.makeVisible(j),h.adjustIndex&&h._dataModel.isAutoAdjustIndex()&&h.adjustIndex(j)}},b.makeVisible=function(l){if(l){var t=this,r=t.getDataUI?t.getDataUI(l):t.getData3dUI(l);if(r){var U=l,q=Nq(l);for(q!==t._currentSubGraph&&t.setCurrentSubGraph(q);(U=U._parent)&&U!==q;)Ud(U)&&U.setExpanded(!0);t._23I=l,t.iv()}}},b.getLabel=function(l){var w=l.getStyle(Fn);return w===d?l.getName():w},b.getLabelBackground=function(g){return g.getStyle("label.background")},b.getLabelColor=function(m){return m.getStyle("label.color")},b.getLabel2=function(e){return e.getStyle("label2")},b.getLabel2Background=function(Q){return Q.getStyle("label2.background")},b.getLabel2Color=function(Q){return Q.getStyle("label2.color")},b.getNote=function(d){return d.getStyle(he)},b.getNoteBackground=function(R){return R.getStyle("note.background")},b.getNote2=function(H){return H.getStyle(Vb)},b.getNote2Background=function(l){return l.getStyle("note2.background")},b.handleClick=function(x,P,E){var y=this;P?(y.fi({kind:"clickData",event:x,data:P,part:E}),y.onDataClicked(P,x)):(y.fi({kind:"clickBackground",event:x}),y.onBackgroundClicked(x))},b.handleDoubleClick=function(f,Z,U){var W=this;bh(f)&&(Z?(W.fi({kind:"doubleClickData",event:f,data:Z,part:U}),W.onDataDoubleClicked(Z,f,U),W.checkDoubleClickOnNote(f,Z,U)||W.checkDoubleClickOnRotation&&W.checkDoubleClickOnRotation(f,Z,U)||(Pe(Z)?W.onEdgeDoubleClicked(Z,f,U):Z.ISubGraph?W.onSubGraphDoubleClicked(Z,f,U):Ud(Z)?W.onGroupDoubleClicked(Z,f,U):Z.IDoorWindow?W.onDoorWindowDoubleClicked(Z,f,U):Z.ICSGBox&&W.onCSGBoxDoubleClicked(Z,f,U))):(W.fi({kind:"doubleClickBackground",event:f}),W.onBackgroundDoubleClicked(f)))},b.onSubGraphDoubleClicked=function(N){this.setCurrentSubGraph(N)},b.onEdgeDoubleClicked=function(e,N){e.ISubGraph&&!nl(N)?this.setCurrentSubGraph(e):e.s("edge.toggleable")&&e.toggle()},b._39Q=function(x){return this.isInteractive(x)?this.preventDefaultWhenInteractive(x):!1},b.preventDefaultWhenInteractive=function(j){return j.s("preventDefaultWhenInteractive")},b.onGroupDoubleClicked=function(m){m.s("group.toggleable")&&m.toggle()},b.onDoorWindowDoubleClicked=function(I){I.s("dw.toggleable")&&I.toggle(!0)},b.onCSGBoxDoubleClicked=function(K,I){var $=this;if($ instanceof _g){var U=$.getHitFaceInfo(I);U&&U.face&&K.s(U.face+".toggleable")&&K.toggleFace(U.face,!0)}},b.onBackgroundClicked=function(){},b.onBackgroundDoubleClicked=function(){this.upSubGraph()},b.onDataClicked=function(){},b.onDataDoubleClicked=function(){},b.onAutoLayoutEnded=function(){},b.onMoveEnded=function(){},b.onPanEnded=function(){},b.onPinchEnded=function(){},b.onRectSelectEnded=function(){},b.onZoomEnded=function(){},b.serialize=function(H){return this.dm().serialize(H)},b.toJSON=function(){return this.dm().toJSON()},b.deserialize=function(c,l){var Q=this;l=l instanceof Pp?{rootParent:l}:Uf(l)?{setId:l}:dc(l)?{finishFunc:l}:l||{},l.view=Q;var A=Q.dm(),n=l.finishFunc;return l.finishFunc=function(){n&&n.apply(l,arguments),Uf(A.a("zoomable"))&&Q.setZoomable&&Q.setZoomable(A.a("zoomable")),Uf(A.a("pannable"))&&Q.setPannable&&Q.setPannable(A.a("pannable")),Uf(A.a("rectSelectable"))&&Q.setRectSelectable&&Q.setRectSelectable(A.a("rectSelectable")),A.a("fitContent")===!0&&Q.fitContent&&Q.fitContent(!0,0)},A.deserialize(c,l.rootParent,l)},b.showDebugTip=function(){var X=this,P=X._debugDiv;if(!P){P=X._debugDiv=l.createElement("div"),P.style.position="absolute",P.style.overflow="hidden",P.style.backgroundColor="white",P.style.color="black";var c=X.getView();X._79O?c.insertBefore(P,X._79O):c.appendChild(P);var u=function(){X.redraw();var T="FPS : "+X._fpsInfo.fps+"<br/>"+"Datas : "+X.dm().getDatas().length,x=X.getDebugTip();x&&(T+="<br/>------<br/>"+x),P.innerHTML=T,X._isDebugging&&requestAnimationFrame(u)};requestAnimationFrame(u),X._isDebugging=!0}},b.hideDebugTip=function(){var g=this,I=g._debugDiv;I&&(delete g._debugDiv,g.getView().removeChild(I),g._isDebugging=!1)},b.updateDOMAppendMatrix=function(){var X=this.getView();X&&(X.updateAppendMatrix=!0)},b.countFrame=function(){if(this._isDebugging){var H=Date.now(),v=this._fpsInfo;H-v.time>1e3?(v.fps=Math.round(1e5*(v.frames+1)/(H-v.time))/100,v.time=H,v.frames=0):v.frames++}}},ms_icons:function(I){I.getRotation=function(b){return b==S?0:b},I._15O=function(){var e=this,o=e.s(eq);if(o){var v=e,A=e.data||e._data,y=e._38o={icons:o,rects:{}};for(var J in o){var H=o[J],W=lp(H.shape3d,A,v);if(!(lp(H.visible,A,v)===!1||lp(H.for3d,A,v)&&!e.I3d||W&&!e.I3d)){var B=W?[W]:lp(H.names,A,v),C=B?B.length:0,n=lp(H.position,A,v)||3,a=lp(H.offsetX,A,v)||0,I=lp(H.offsetY,A,v)||0,m=lp(H.direction,A,v)||Mg,w=lp(H.gap,A,v),q=w!=S?w:1,r=lp(H.rotation,A,v),Q=lp(H.keepOrien,A,v),E=lp(H.rotationFixed,A,v)?r:e.getRotation(r,Q,n),L=S,D=y.rects[J]=new Array(C);D.rotation=E;for(var F=0;C>F;F++){var u,d,R,T,l=B[F];if(W)R=0,T=0;else{var t=Oi(l);R=lp(H.width,A,v),T=lp(H.height,A,v),R==S&&(R=xq(t,A)),T==S&&(T=ze(t,A))}if(L?m===Mg?a+=R/2:m===Df?a-=R/2:m===ad?I-=T/2:I+=T/2:L={width:R,height:T},e.I3d){var i=-R/2,U=-T/2;d={width:R,height:T,mat:e._16O(lp(H.autorotate,A,v),n,L,lp(H.face,A,v)||Cn,lp(H.t3,A,v),lp(H.r3,A,v),lp(H.rotationMode,A,v),a,I),vs:new am([i,-U,0,i,-U-T,0,i+R,-U-T,0,i+R,-U,0])}}else u=e.getPosition(n,a,I,L,lp(H.positionFixed,A,v)),d={x:u.x-R/2,y:u.y-T/2,width:R,height:T},e._68o(d,E);D[F]=d,m===Mg?a+=R/2+q:m===Df?a-=R/2+q:m===ad?I-=T/2+q:I+=T/2+q}}}}}}});var Tj={1:1,2:1,6:1,9:1,10:1,14:1,15:1,16:1,21:1,22:1,26:1,29:1,30:1,34:1,36:1,38:1,40:1,42:1,45:1,50:1,52:1,54:1},Jg={3:1,7:1,11:1,17:1,23:1,27:1,31:1,44:1,46:1,47:1,49:1},_p={translateX:1,translateY:1,zoom:1,scrollBarVisible:1},qg={sourceAgent:1,targetAgent:1,expanded:1,parent:1,host:1},hm={position:1,width:1,height:1,expanded:1,rotation:1,anchor:1,scale:1,"s:edge.points":1},wb={"edge.type":1,"edge.group":1},sb={rotation:1,rotationX:1,rotationZ:1},xj={position:1,width:1,height:1,anchor:1,scale:1,"s:grid.row.count":1,"s:grid.column.count":1,"s:grid.row.percents":1,"s:grid.column.percents":1,"s:grid.border":1,"s:grid.border.left":1,"s:grid.border.right":1,"s:grid.border.top":1,"s:grid.border.bottom":1,"s:grid.gap":1},eo={"attach.row.index":1,"attach.column.index":1,"attach.row.span":1,"attach.column.span":1,"attach.padding":1,"attach.padding.left":1,"attach.padding.right":1,"attach.padding.top":1,"attach.padding.bottom":1,"attach.index":1,"attach.offset":1,"attach.offset.relative":1,"attach.offset.opposite":1,"attach.gap":1,"attach.gap.relative":1,"attach.thickness":1},Wb={shape:1,thickness:1,position:1,anchor:1,scale:1},Nq=function(p){if(!p)return S;if(Pe(p)){var W=p._40I,V=p._41I;if(!W||!V)return S;var G=Nq(W),n=Nq(V);return G===n?G:S}for(var o=p._parent;Pe(o)&&!o.ISubGraph;)o=o._parent;return o?o.ISubGraph?o:Nq(o):S},pb=function(c,i,t,Q){var T=i.getStyle(t)*Q;T&&Vo(c,T),T=i.getStyle(t+".left")*Q,T&&(c.x-=T,c.width+=T),T=i.getStyle(t+".right")*Q,T&&(c.width+=T),T=i.getStyle(t+".top")*Q,T&&(c.y-=T,c.height+=T),T=i.getStyle(t+".bottom")*Q,T&&(c.height+=T),c.width<0&&(c.width=-c.width,c.x-=c.width),c.height<0&&(c.height=-c.height,c.y-=c.height)},bp=function(g){for(var o,f=0,D=g.size();D>f;f++)if(o=g.getChildAt(f),zm(o)&&bp(o))return!0;return g.hasAgentEdges()},yp=function(V){if(!V)return S;for(var u=V._parent;Ud(u);){if(!Ud(u._parent))return u.isExpanded()?V:u;u.isExpanded()||(V=u),u=u._parent}return V},Dq=function(j,t){if(!j||!t)return S;var s,T,e,Y=Nq(j),q=Nq(t);if(Y!==q){for(;q&&Y!==q;)q=Nq(q);if(Y===q)return j;s=new Kf,s.add(j,0);for(var A=j._parent;zm(A)&&!t.isDescendantOf(A);)s.add(A,0),A=A._parent;for(e=s.size(),T=0;e>T;T++){var v=s.get(T);if(Ud(v)&&!v.isExpanded())return v;if(v.ISubGraph)return v}return j}return j},Hk=function(n){if(n.isLooped())return n._source;var y=yp(n._source),_=yp(n._target);return y===_?n._source:Dq(y,_)},Kd=function(F){if(F.isLooped())return F._target;var l=yp(F._source),C=yp(F._target);return l===C?F._target:Dq(C,l)},ii=function(U,j,B){"target"!==B&&(B="source");var e="target"===B?j.getTargetAgent():j.getSourceAgent(),f="edge."+B+".";if(Pe(e)){var H=U.getDataUI(e);H._79o();var N=j.s(f+"index");if(N!==d){var s=Ej(H);return s[Math.max(0,Math.min(N,s.length-1))]}var i=j.s(f+"percent")||0;i=Math.max(0,Math.min(i,1));var Z=Hr(H);return Go(Z,100*i)}return Yc(U,e,j.s(f+"position"),j.s(f+"offset.x"),j.s(f+"offset.y"),j.s(f+"anchor.x"),j.s(f+"anchor.y"))},Yc=function(E,H,p,i,j,Q,g){if(!H)return S;var y,z=H.getRotation?H.getRotation():0;if(Q!==d||g!==d){Q=Q===d?.5:Q,g=g===d?.5:g;var m=H.getScale();if(z&&!gq(H,E)||m.x<0||m.y<0){var f=H.getPosition(),G=H.getWidth(),V=H.getHeight(),w=H.getAnchor(),o=new ye(z,f.x,f.y,m.x,m.y);p=o.tf((Q-w.x)*G,(g-w.y)*V)}else y=Pl(E,H),p={x:y.x+Q*y.width,y:y.y+g*y.height}}else p=_l(p,Pl(E,H));if(z){var X=k(z),D=L(z),Y=i*X-j*D;j=i*D+j*X,i=Y}return p.x+=i,p.y+=j,p},Oj=function(w,h){if(!w||!h)return S;var x,P,y,p,q,o;if(w===h){if(p=w.getLoopedEdges(),!p)return S;p=new Kf(p)}else{if(q=w.getAgentEdges(),o=h.getAgentEdges(),!q||!o)return S;for(P=q.size(),x=0;P>x;x++)y=q.get(x),o.contains(y)&&(p||(p=new Kf),p.add(y))}if(p)for(x=0;x<p.size();x++)y=p.get(x),y.getStyle(ug)===xe&&(y._22I(S),p.removeAt(x),x--);return p},Pj=function(O,J){var P=Oj(O,J);if(P&&!P.isEmpty()){if(1===P.size())return P.get(0)._22I(S),void 0;var Y=new Kf,f=new Kf;P.each(function(r){var Z=r.s("edge.group");Y.contains(Z)||Y.add(Z)}),Y.sort(),Y.each(function(z){f.add(new W.EdgeGroup(P.toList(function(n){return z===n.s("edge.group")}),f))}),f.each(function(F){F.each(function(e){e._22I(F)})})}},Gi=function(i,G,j){var Y=i._canvas;i._zoom;var M=we(G,Y),h=we(j,Y);return{x:M.x-h.x,y:M.y-h.y}},oj=function(X,v){if(v){var M=v.rect,C=v.color,j=v.rotation,h=v.labelWidth,e=v.background,Z=v.opacity,n=v.scale,x=n!=S&&1!==n;if(Z!=S){var A=X.globalAlpha;X.globalAlpha*=Z}if(j||x){X.save();var P=M.x+M.width/2,N=M.y+M.height/2;As(X,P,N),j&&ap(X,j),x&&X.scale(n,n),As(X,-P,-N)}if(e&&Eh(X,M.x,M.y,M.width,M.height,e),h){var f=M.width,E=X.createLinearGradient(M.x,M.y,M.x+f,M.y);E.addColorStop(0,C),E.addColorStop(.9,C),E.addColorStop(1,mo),C=E,M.width=h}kp(X,v.ss,M,v.font,C,v.align),h&&(M.width=f),(j||x)&&X.restore(),Z!=S&&(X.globalAlpha=A)}},Xn=function(H,B){if(B){var b=B.rect,X=b.x,M=b.y,Q=b.width,e=b.height,z=B.background,Y=B.backgroundImage,C=B.borderWidth,w=B.borderColor,P=B.labelWidth,p=B.opacity,l=B.scale,D=l!=S&&1!==l;if(p!=S){var R=H.globalAlpha;H.globalAlpha*=p}if(D){H.save();var k=b.x+b.width/2,T=b.y+b.height/2;As(H,k,T),H.scale(l,l),As(H,-k,-T)}if(B.expanded){var W=o(8,Q/4),d=M+e-8;if(H.fillStyle=z,H.beginPath(),H.moveTo(X,M),H.lineTo(X,d),H.lineTo(X+Q/2,d),H.lineTo(X+Q/2,M+e),H.lineTo(X+Q/2+W,d),H.lineTo(X+Q,d),H.lineTo(X+Q,M),H.closePath(),H.fill(),C&&(H.lineWidth=C,H.lineJoin="round",H.lineCap="round",w?(H.strokeStyle=w,H.stroke()):(H.strokeStyle=zb(z),H.beginPath(),H.moveTo(X+Q,M),H.lineTo(X+Q,d),H.lineTo(X+Q/2+W,d),H.lineTo(X+Q/2,M+e),H.stroke(),H.strokeStyle=_o(z),H.beginPath(),H.moveTo(X+Q,M),H.lineTo(X,M),H.lineTo(X,d),H.lineTo(X+Q/2,d),H.lineTo(X+Q/2,M+e),H.stroke())),Y)ng(H,Oi(Y),pg,b.x,b.y,b.width,b.height-8,B.data,B.view);else{if(b.height-=8,z=B.color,P){var O=Q,i=H.createLinearGradient(X,M,X+O,M);i.addColorStop(0,z),i.addColorStop(.9,z),i.addColorStop(1,mo),z=i,b.width=P}kp(H,B.ss,b,B.font,z,B.align),P&&(b.width=O),b.height+=8}}else if(B.icon)rl(H,Oi(B.icon),X,M,Q,e,B.data,B.view);else{var f=Q/2;C&&(H.lineWidth=C,H.lineJoin="round",H.lineCap="round",H.strokeStyle=w?w:zb(z),H.beginPath(),H.arc(X+f,M+f,f,j,1.6*u,!0),H.moveTo(X+f,M+e),H.lineTo(X+Q-f/5,M+f),H.stroke(),H.strokeStyle=w?w:_o(z),H.beginPath(),H.arc(X+f,M+f,f,1.6*u,j,!0),H.moveTo(X+f,M+e),H.lineTo(X+f/5,M+f),H.stroke()),H.fillStyle=z,H.beginPath(),H.arc(X+f,M+f,f,0,m,!0),H.moveTo(X+f,M+e),H.lineTo(X+Q-f/5,M+f),H.lineTo(X+f/5,M+f),H.closePath(),H.fill(),H.fillStyle=B.color,H.beginPath(),H.arc(X+f,M+f,f/3,0,m,!0),H.fill()}D&&H.restore(),p!=S&&(H.globalAlpha=R)}},Ek=function(I,s){return s>2*I?I:s/2},ir=function(q,w,V,O){if(!q||!w)return 0;var r=N(w.y-q.y,w.x-q.x);return V||(r=w.x<q.x?r+u:r),r+O},Eo=function(y,i,X,$,w,Z,J){J&&(y.x>i.x||y.x===i.x&&y.y>i.y)&&(X=yj[X],w=-w);var E=_l(X,{x:0,y:0,width:zq(y,i),height:0},Z);return E.x+=$,E.y+=w,E=new ye(N(i.y-y.y,i.x-y.x)).tf(E),E.x+=y.x,E.y+=y.y,E},oi=function(D,t,_,G,c){if(D._19Q=!0,!_.getEdgeGroup())return G?_.s("edge.gap"):0;if(Pe(_.getSourceAgent())||Pe(_.getTargetAgent()))return 0;var n,Z=0,S=0,M=0;if(_.getEdgeGroup().getSiblings().each(function(v){v.each(function(I){if(t.isVisible(I)&&I.s(ug)==c){var f=I.s("edge.gap");n?(S+=M/2+f/2,M=f):(n=I,M=f),I===_&&(Z=S)}})}),G)return S-Z+M;var m=Z-S/2;return n&&_._40I!==n._40I&&(D._19Q=!1),m},Dd=function(){var v=function(X){var M=[];return X.forEach(function(p){M.push({x:p.x,y:p.y}),M.push({x:p.x+p.width,y:p.y+p.height}),M.push({x:p.x+p.width,y:p.y}),M.push({x:p.x,y:p.y+p.height})}),M};return function($,g,i){if("oval"===$){var s=0,e=i.height/i.width,T=e*e,R=i.x+i.width/2,P=i.y+i.height/2,G=v(g);G.forEach(function(i){var Y=i.x-R,J=i.y-P,e=Y*Y+J*J/T;e>s&&(s=e)}),s=_(s);var I=e*s;return{x:R-s,y:P-I,width:2*s,height:2*I}}if("circle"===$){var q=0,R=i.x+i.width/2,P=i.y+i.height/2,G=v(g);return G.forEach(function(T){var $=T.x-R,c=T.y-P,Z=$*$+c*c;Z>q&&(q=Z)}),q=_(q),{x:R-q,y:P-q,width:2*q,height:2*q}}return"roundRect"===$?(Vo(i,o(i.width,i.height)/16),i):i}}(),Ee=W.graph={},cs=function(w,r,c){jd(g+".graph."+w,r,c)};W.layout={};var Rh={},Dh=function(R,b,D,e,U,x,V,O){var L=[b.uuid,Math.round(e),Math.round(U),D].join("_");b.cacheRule&&(L+=lp(b.cacheRule,x,V));var M=V._zoom;M!==V._cacheZoom&&(V._cacheZoom=M,V._cacheImage={}),M*=pm;var $=V._cacheImage[L];return $||($=V._cacheImage[L]=W.Default.toCanvas(b,Math.ceil(e*M),Math.ceil(U*M),D,x,V,O)),$};uj(X,{setImageCacheRule:function(W,Y){var C;C=Y||"object"!=typeof W?{_image:Y}:W;for(var m in C){var r=C[m];Gk(m)?(jd=Oi(m),jd?jd.cacheRule=r:Rh[m]=r):m.cacheRule=r}}});var jr={comps:[{type:Jr,points:[85,50,70,115,100,71,86,107,88,49,47,78,67,48,110,116,103,100,119,81,76,68,105,75,83,66,114,71,51,102,107,73,87,101,51,78,72,113,77,71,80,115,65,61],borderWidth:1,borderColor:S}]};if(jr[ml]=jr[ao]=160,E.Image){var Uc=new E.Image;Uc.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAALUlEQVRYR+3QQREAAAABQfqXFsNnFTizzXk99+MAAQIECBAgQIAAAQIECBAgMBo/ACHo7lH9AAAAAElFTkSuQmCC",oc("default_blank",Uc)}oc("node_image",Ec(30,30,[{type:Ni,rect:[4,5,22,16],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[2,3,26,20],borderWidth:1,borderColor:Ch},{type:Ni,rect:[11,23,8,4],background:Ch},{type:Ni,rect:[6,27,18,2],background:Ch}])),oc("node_icon",Ec(16,16,[{type:Ni,rect:[2,2,12,10],gradient:un,gradientColor:np,background:Ch},{type:jl,rect:[2,2,12,10],width:1,color:Ch},{type:Ni,rect:[6,12,4,2],background:Ch},{type:Ni,rect:[4,14,8,1],background:Ch}])),oc("block_icon",Ec(16,16,[{type:jl,rect:[1,1,14,14],width:1,color:Ch}])),oc("group_image",Ec(66,39,[{type:Ni,rect:[44.3,18,18.1,12.8],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[3.3,17.8,18.1,12.8],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[15.8,3.2,33.5,26.4],borderWidth:1,borderColor:Ch,gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[26.2,29.4,12.8,4.2],background:Ch},{type:Ni,rect:[21.3,33.5,22.5,2.3],background:Ch},{type:Ni,rect:[5.3,32.7,14.1,2.1],background:Ch},{type:Ni,rect:[9,30.4,6.7,2.4],background:Ch},{type:Ni,rect:[50,30.7,6.7,2.4],background:Ch},{type:Ni,rect:[46.3,33,14.1,2.1],background:Ch}])),oc("group_icon",Ec(16,16,[{type:Ni,rect:[4,12,4,2],background:Ch},{type:Ni,rect:[2,13,8,1],background:Ch},{type:Ni,rect:[12,12,2,1],background:Ch},{type:Ni,rect:[11,13,4,1],background:Ch},{type:Ni,rect:[10,7,6,5],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[1,2,10,10],gradient:un,gradientColor:np,background:Ch},{type:jl,rect:[1,2,10,10],width:1,color:Ch}])),oc("refGraph_icon",Ec(16,16,[{type:"shape",borderWidth:1,borderColor:Ch,borderCap:"round",rotation:.7854,points:[12.5502,6.7981,12.5502,6.7981,12.5502,4.8181,12.5502,3.7981,12.5502,2.7781,11.36687,1.7981,10.0502,1.7981,8.73354,1.7981,7.5502,2.8181,7.5502,3.7981,7.5502,4.55989,7.5502,7.79805,7.5502,7.79805,7.5502,7.79805,7.5502,9.7981,10.0502,9.7981],segments:[1,4,4,4,4,4]},{type:"shape",borderWidth:1,borderColor:Ch,borderCap:"round",rotation:-2.35619,points:[8.4498,11.2019,8.4498,11.2019,8.4498,9.2219,8.4498,8.2019,8.4498,7.1819,7.26646,6.2019,5.9498,6.2019,4.63313,6.2019,3.4498,7.2219,3.4498,8.2019,3.4498,8.9637,3.4498,12.20186,3.4498,12.20186,3.4498,12.20186,3.4498,14.2019,5.9498,14.2019],segments:[1,4,4,4,4,4]}])),oc("edge_icon",Ec(16,16,[{type:Ni,rect:[2.1,6.9,11.5,2.6],rotation:-.79,gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[10.8,1,4,4],background:Ch},{type:Ni,rect:[1,11,4,4],background:Ch}])),oc("subGraph_image",Ec(72,45,[{type:Jr,points:[9,42,.3,38.4,2.4,28.8,5.7,21.6,11.7,22.5,11.7,15.9,16.8,13.8,21.6,12,24.3,15.9,27.9,3,42.3,2.1,59.4,4.5,57.3,18.3,67.5,18.9,69.6,27.3,69.9,38.4,64.2,41.4],segments:[1,3,3,3,3,3,3,3,3],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[29.6,30.7,3.6,1.8],background:Ch},{type:Ni,rect:[28.4,32.3,6,1.2],background:Ch},{type:Ni,rect:[37.3,32,10.8,1.8],background:Ch},{type:Ni,rect:[39.1,29.9,7.2,2.3],background:Ch},{type:Ni,rect:[26.6,23.7,9.6,7.2],gradient:un,gradientColor:np,background:Ch},{type:Ni,rect:[34.3,16.8,16.8,13.2],borderWidth:1,borderColor:Ch,gradient:un,gradientColor:np,background:Ch}])),oc("subGraph_icon",Ec(17,17,[{type:Jr,points:[2.2,14.6,.2,11.9,.8,8.8,1.8,5.9,5.6,7.4,3.8,1.6,10.3,3,14.5,4.2,12.2,7.5,18.9,7.2,14.5,14.5],segments:[1,3,3,3,3,3],gradient:un,gradientColor:np,background:Ch}])),oc("shape_icon",Ec(16,16,[{type:Jr,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],background:Ch}])),oc("polyline_icon",Ec(16,16,[{type:Jr,points:[1.5,1,8.4,1,8.4,7.2,14.6,7.1,14.6,14.9,1.5,14.9,1.5,1],borderWidth:1,borderColor:Ch},ss(7.5,.4),ss(7.5,6.3),ss(13.6,6.3),ss(13.6,14),ss(.7,13.9),ss(.7,.3)])),oc("grid_icon",Ec(16,16,[{type:Ni,rect:[1,1,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[6,1,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[11,1,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[11,6,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[6,6,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[1,6,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[11,11,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[6,11,4,4],background:Ch,gradient:un,gradientColor:np},{type:Ni,rect:[1,11,4,4],background:Ch,gradient:un,gradientColor:np}])),oc("light_icon",Ec(16,16,[{type:"rect",rect:[6,9,5,5],borderWidth:1,borderColor:Ch},{type:"circle",rect:[1,1,15,10],borderWidth:1,borderColor:Ch,gradient:un,gradientColor:np,background:{func:function(t){var w=t?t.s(bo):S;return En(w)?"rgb("+$(255*w[0])+","+$(255*w[1])+","+$(255*w[2])+")":w||Ch}}}])),oc("text_icon",Ec(16,16,[{type:"shape",points:[3,3,13,3,8,3,8,14],segments:[1,2,1,2],borderWidth:1,borderColor:Ch}])),oc("border_image",{fitSize:!0,comps:[{type:"border",relative:!0,rect:[0,0,1,1],color:{func:"style@border_color"},width:{func:"style@border_width"}}]}),oc("columnChart_image",{fitSize:!0,boundExtend:150,comps:[{type:{func:"style@chart.type"},relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"}}]}),oc("lineChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"lineChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},series:{func:"style@chart.series"},minValue:{func:"style@chart.min.value"},maxValue:{func:"style@chart.max.value"},linePoint:{func:"style@chart.line.point"},lineWidth:{func:"style@chart.line.width"},line3d:{func:"style@chart.line.3d"}}]}),oc("pieChart_image",{fitSize:!0,boundExtend:150,comps:[{type:"pieChart",relative:!0,rect:[0,0,1,1],label:{func:"style@chart.label"},labelColor:{func:"style@chart.label.color"},labelFont:{func:"style@chart.label.font"},hollow:{func:"style@chart.hollow"},startAngle:{func:"style@chart.start.angle"},values:{func:"style@chart.values"},colors:{func:"style@chart.colors"}}]});var sh=function(N,i,Y,t,d,O){var l,L,x,r,J,C,B,v,S,f,y,g=[];if(Math.abs(t)>2*Math.PI&&(t=2*Math.PI),J=Math.ceil(Math.abs(t)/(Math.PI/4)),l=t/J,L=-l,x=-Y,J>0){C=N+Math.cos(Y)*d,B=i+Math.sin(-Y)*O,g.push({x:C,y:B});for(var p=0;J>p;p++)x+=L,r=x-L/2,v=N+Math.cos(x)*d,S=i+Math.sin(x)*O,f=N+Math.cos(r)*(d/Math.cos(L/2)),y=i+Math.sin(r)*(O/Math.cos(L/2)),g.push({x:f,y:y}),g.push({x:v,y:S})}return g},Hn=function(M){if(M){var O=M._data;if(O instanceof W.Shape)return{points:O.getPoints(),segments:O.getSegments()};var b;if(O instanceof W.Edge&&(b=M._78o)){var s,x,h=b.type,l=b.points,n=b.segments,G=b.edgeTypeInfo;if(!h||l){var Q=b.sourcePoint,_=Q.x,i=Q.y,S=b.targetPoint,L=S.x,c=S.y;if(h)n?(s=new Kf({x:_,y:i}),s.addAll(l),s.add({x:L,y:c}),x=new Kf(n._as)):(s=new Kf({x:_,y:i}),l.each(function(N){s.add(N)}),s.add({x:L,y:c}));else if(b.looped){s=new Kf(sh(_,i,0,2*Math.PI,b.radius,b.radius)),x=new Kf([1]);for(var q=0;q<(s.size()-1)/2;q++)x.add(3)}else s=new Kf,b.center?(s.add({x:b.c1.x,y:b.c1.y}),s.add({x:_,y:i}),s.add({x:L,y:c}),s.add({x:b.c2.x,y:b.c2.y})):(s.add({x:_,y:i}),s.add({x:L,y:c}))}else G&&(s=new Kf(G.points._as),G.segments&&(x=new Kf(G.segments._as)));return{points:s,segments:x}}}},Hr=function(R,q,m){if(null==q){var T=Hn(R);if(!T)return;q=T.points,m=T.segments}if(q){if(Array.isArray(q)&&(q=new Kf(q)),"number"==typeof q.get(0)){for(var s=new W.List,Y=0;Y<q.size();Y+=2)s.add({x:q.get(Y),y:q.get(Y+1)});q=s}if(!m){m=[1];for(var l=q.length-1;l>0;l--)m.push(2)}Array.isArray(m)&&(m=new Kf(m));for(var b=ge(q._as,m._as,50),E=b.length,S=[],Y=0;E>Y;Y++){var r=b[Y];r.length>1&&S.push(r)}return S}},Fk=function(M){for(var l=0,Z=M.length-1,o=0;Z>o;o++){var f=M[o],a=M[o+1],j=a.x-f.x,y=a.y-f.y;l+=Math.sqrt(j*j+y*y)}return l},as=function(P,R){for(var U=0,i=R.length,t=0;i>t;t++){var T=R[t];if(U+=T,U>P)return t}return Math.min(t,i-1)},xm=function(c,f){for(var b=0,t=0,w=0,N=c.length-1,k=0;N>k;k++){var p=c[k],S=c[k+1],n=S.x-p.x,E=S.y-p.y;if(w=Math.sqrt(n*n+E*E),b+=w,b>f){b-=w,t=k;break}}var K=c[t],h=c[t+1],Q=Math.atan2(h.y-K.y,h.x-K.x),C=f-b,E=Math.sin(Q)*C,n=Math.cos(Q)*C;return{x:K.x+n,y:K.y+E}},Go=function(r,$){if(r){var O;if(0===$)O=r[0][0];else if(100===$)r=r[r.length-1],O=r[r.length-1];else{for(var k=0,t=[],G=r.length,b=0;G>b;b++){var l=r[b],D=Fk(l);k+=D,t.push(D)}for(var Q=k*$/100,T=as(Q,t),s=0,B=0;T>B;B++)s+=t[B];Q-=s,O=xm(r[T],Q)}return O}},Ej=function(i){var U,C,o,O,A=Hn(i),s=[],E=A.points,T=A.segments,L=-1;for(C=0,o=T?T.length:E.length;o>C;C++){if(U=T?T.get(C):1,3===U)O=2;else if(4===U)O=3;else{if(5===U)continue;O=1}L+=O,s.push(E.get(L))}return s},mk=function(B,P,d,f){function t(T){if(T>=0&&1>=T){b=P(T);var c=(B.x-b.x)*(B.x-b.x)+(B.y-b.y)*(B.y-b.y);return N>c?(N=c,G=T,!0):!1}}d=d||100,f=f||1e-5;for(var N=1/0,G=0,b=new Lj,H=0;d>H;++H)t(H/d);for(var R=1/(2*d);R>f;)t(G-R)||t(G+R)||(R/=2);return G};uj(X,{_edgeProtectMethod:{getStraightLinePoints:Hr,calculateLineLength:Fk,calcSegmentIndexByDistance:as,calculatePointAlongLine:xm,getPercentPosition:Go}});var hi=function(v,j){for(var _=v.vertices,t=0;t<_.length;t++){var Q=_[t],F=Q.y;Q.y=Q.z,Q.z=-F,j&&(Q.y+=j)}},Bm=function(E){for(var Z,o,T,d,e,s,j=[],t=[],y=[],r=E.faces,R=0,c=0,H=0,v=r.length;v>R;R++,c+=6,H+=9){var A=r[R];1===A.i?(Z||(Z=[],o=[],T=[]),bc(A,R,c,H,E,Z,T,o)):2===A.i?(d||(d=[],e=[],s=[]),bc(A,R,c,H,E,d,s,e)):bc(A,R,c,H,E,j,y,t)}return{vs:j,uv:t,ns:y,top_vs:Z,top_uv:o,top_ns:T,bottom_vs:d,bottom_uv:e,bottom_ns:s}},bc=function(I,v,l,N,B,P,Z,Q){var m=B.vertices,X=B.faceVertexUvs,U=m[I.a],n=m[I.b],s=m[I.c];P[N]=U.x,P[N+1]=U.y,P[N+2]=U.z,P[N+3]=n.x,P[N+4]=n.y,P[N+5]=n.z,P[N+6]=s.x,P[N+7]=s.y,P[N+8]=s.z;var W=I.vertexNormals;if(3===W.length){var q=W[0],u=W[1],h=W[2];Z[N]=q.x,Z[N+1]=q.y,Z[N+2]=q.z,Z[N+3]=u.x,Z[N+4]=u.y,Z[N+5]=u.z,Z[N+6]=h.x,Z[N+7]=h.y,Z[N+8]=h.z}else{var S=I.normal;Z[N]=S.x,Z[N+1]=S.y,Z[N+2]=S.z,Z[N+3]=S.x,Z[N+4]=S.y,Z[N+5]=S.z,Z[N+6]=S.x,Z[N+7]=S.y,Z[N+8]=S.z}var b=X[0][v][0],J=X[0][v][1],p=X[0][v][2];Q[l]=b.x,Q[l+1]=b.y,Q[l+2]=J.x,Q[l+3]=J.y,Q[l+4]=p.x,Q[l+5]=p.y},Xg=function(){function u(B,Y){return B.dot(Y)>0}function I(K,c,k,x,R,f,m){for(var M,A,Y=[c,k,x],I=[R,f,m],w=[],H=Y.length,E=!0;H--&&E;){for(var e=Y[H],o=I.length,Z=!1;o--;)if(e.equals(I[o])){I.splice(o,1),w.push(e),Z=!0;break}if(!Z){if(M){E=!1;break}M=e}}return E&&2===w.length&&(A=I[0],X.subVectors(M,w[0]),s.subVectors(A,w[0]),l.subVectors(M,w[1]),X.x*l.y*s.z+l.x*s.y*X.z+s.x*X.y*l.z-s.x*l.y*X.z-s.y*l.z*X.x-s.z*l.x*X.y<1e-6&&(i.subVectors(A,w[1]),B.subVectors(w[1],w[0]),u(B,X)&&u(B,s)&&(B.negate(),u(B,l)&&u(B,i))))?(K.push(w[1].x,w[1].y,w[1].z),K.push(M.x,M.y,M.z),K.push(M.x,M.y,M.z),K.push(w[0].x,w[0].y,w[0].z),K.push(w[0].x,w[0].y,w[0].z),K.push(A.x,A.y,A.z),K.push(A.x,A.y,A.z),K.push(w[1].x,w[1].y,w[1].z),2):(K.push(c.x,c.y,c.z),K.push(k.x,k.y,k.z),K.push(k.x,k.y,k.z),K.push(x.x,x.y,x.z),K.push(x.x,x.y,x.z),K.push(c.x,c.y,c.z),1)}function $(){this._vertexMap={},this._lineMap={},this._lineList=[]}function f(p,L,n,U,t,I,x){var V=[n,t];p[0]===U&&V.reverse();var Y=[V[0]._key,V[1]._key].join("|"),J=p._triangles[Y];J||(p._triangles[Y]=J={});var m=[I._key,x._key].join("|");J[m]||(J[m]=[I,x])}function V(l,P,M){var n=l._planes[M._key];if(!n)for(var U in l._planes){var y=l._planes[U];if(y._normal.angleTo(M)<.001){n=y;break}}return n?(n._vertices.indexOf(P)<0&&n._vertices.push(P),void 0):(l._planes[M.key]={_normal:M,_vertices:[P]},void 0)}function D(H){var Q=H._ctlineModel;if(Q||(H._ctlineModel=Q=[]),Q[0])return Q[0];var t;t=En(H)?H:[H];var Y,R,n,d,D,W,i,g,J,C,p,S,j,N,$,y,c,M,x,h=["","top_","bottom_"];for(Q=[],Y=0,R=t.length;R>Y;Y++)if(C=t[Y])for(Ze(C),n=0,d=h.length;d>n;n++)if(J=C[h[n]+"lvs"])for(c=Q.length,M=J.length,Q.length=c+M,x=0;M>x;++x,++c)Q[c]=J[x];else if(i=C[h[n]+"vs"]){g=C[h[n]+"is"],W=g?g.length:i.length/3;for(var D=0;W-1>D;)g?(p=g[D],S=g[D+1],j=g[D+2],N=g[D+3],$=g[D+4],y=g[D+5]):(p=D,S=D+1,j=D+2,N=D+3,$=D+4,y=D+5),K.fromArray(i,3*p),F.fromArray(i,3*S),L.fromArray(i,3*j),b.fromArray(i,3*N),T.fromArray(i,3*$),e.fromArray(i,3*y),D+=3*I(Q,K,F,L,b,T,e);
W>D&&(g?(p=g[D],S=g[D+1],j=g[D+2]):(p=D,S=D+1,j=D+2),K.fromArray(i,3*p),F.fromArray(i,3*S),L.fromArray(i,3*j),Q.push(K.x,K.y,K.z),Q.push(F.x,F.y,F.z),Q.push(F.x,F.y,F.z),Q.push(L.x,L.y,L.z),Q.push(L.x,L.y,L.z),Q.push(K.x,K.y,K.z))}return H._ctlineModel[0]=Q,Q}function N(F){var i=F._ctlineModel;if(i||(F._ctlineModel=i=[]),i[1])return i[1];var R;R=En(F)?F:[F];var Q,Y,b,k,I,r,X,K,e,E,O,T,z=["","top_","bottom_"],U=new $;for(i=[],Q=0,Y=R.length;Y>Q;Q++)if(e=R[Q])for(Ze(e),b=0,k=z.length;k>b;b++)if(X=e[z[b]+"vs"]){K=e[z[b]+"is"],r=K?K.length:X.length/3;for(var I=0,I=0;r>I;I+=3)K?(E=K[I],O=K[I+1],T=K[I+2]):(E=I,O=I+1,T=I+2),U._addTriangle(X,d,E,O,T)}return U._toLineVS(i),F._ctlineModel[1]=i,i}function S(X){var J=X._ctlineModel;if(J||(X._ctlineModel=J=[]),J[2])return J[2];var f;f=En(X)?X:[X];var G,t,Y,D,o,I,B,b,O,M,A,c,v,U=["","top_","bottom_"],R=new $;for(J=[],G=0,t=f.length;t>G;G++)if(M=f[G])for(Ze(M),Y=0,D=U.length;D>Y;Y++)if(B=M[U[Y]+"vs"]){b=M[U[Y]+"is"],O=M[U[Y]+"ns"],I=b?b.length:B.length/3;for(var o=0,o=0;I>o;o+=3)b?(A=b[o],c=b[o+1],v=b[o+2]):(A=o,c=o+1,v=o+2),R._addTriangle(B,O,A,c,v)}return R._toLineVS(J),X._ctlineModel[2]=J,J}var K=new Ob,F=new Ob,L=new Ob,b=new Ob,T=new Ob,e=new Ob,X=new Ob,l=new Ob,s=new Ob,i=new Ob,B=new Ob,P=new Ob;$.prototype._findVertex=function(h,a){P.fromArray(h,3*a);var X=[P.x,P.y,P.z].join(","),Y=this._vertexMap[X];if(!Y){var v=P.clone();v._key=X,this._vertexMap[X]=Y=v}return Y},$.prototype._findLine=function(l,N){var G=[l,N];l._key>N._key&&G.reverse(),G._key=[G[0]._key,G[1]._key].join("|");var Z=this._lineMap[G._key];return Z||(this._lineMap[G._key]=Z=G,G._triangles={},G._planes={},this._lineList.push(G)),Z};var p=new Ob,z=new Ob;return $.prototype._addTriangle=function(G,R,t,j,J){var H,v,x,k=this._findVertex(G,t),Q=this._findVertex(G,j),g=this._findVertex(G,J),o=this._findLine(k,Q),K=this._findLine(Q,g),U=this._findLine(g,k);R?(H=(new Ob).fromArray(R,3*t),H._key=[H.x,H.y,H.z].join("|"),v=(new Ob).fromArray(R,3*j),v._key=[v.x,v.y,v.z].join("|"),x=(new Ob).fromArray(R,3*J),x._key=[x.x,x.y,x.z].join("|"),f(o,k,H,Q,v,g,x),f(K,Q,v,g,x,k,H),f(U,g,x,k,H,Q,v)):(z.subVectors(g,Q),p.subVectors(Q,k),H=(new Ob).crossVectors(p,z),H._key=[H.x,H.y,H.z].join("|"),V(o,g,H),V(K,k,H),V(U,Q,H))},$.prototype._toLineVS=function(P){for(var W=this._lineList,z=0,Z=W.length;Z>z;++z){var J=W[z],D=!1;for(var K in J._triangles)if(1==G.keys(J._triangles[K]).length){P.push(J[0].x,J[0].y,J[0].z,J[1].x,J[1].y,J[1].z),D=!0;break}if(!D)for(var m in J._planes)if(1==J._planes[m]._vertices.length){P.push(J[0].x,J[0].y,J[0].z,J[1].x,J[1].y,J[1].z),D=!0;break}}},[D,N,S]}(),Nh=function(T){var K=T._lineModel;if(K)return K;var H;H=En(T)?T:[T];var L,U,J,D,I,o,O,n,S,t,G,x,C=["","top_","bottom_"];for(K=[],L=0,U=H.length;U>L;L++)if(S=H[L])for(J=0,D=C.length;D>J;J++)if(O=S[C[J]+"vs"]){n=S[C[J]+"is"],o=n?n.length:O.length/3;for(var I=0;o>I;I+=3)n?(t=n[I],G=n[I+1],x=n[I+2]):(t=I,G=I+1,x=I+2),t*=3,G*=3,x*=3,K.push(O[t],O[t+1],O[t+2],O[G],O[G+1],O[G+2],O[G],O[G+1],O[G+2],O[x],O[x+1],O[x+2],O[x],O[x+1],O[x+2],O[t],O[t+1],O[t+2])}return T._lineModel=K,K},Ti=function(g,H,j,R,u,y,O,b,U){j==S&&(j=!0),R==S&&(R=!0),O==S&&(O=1),b==S&&(b=0);var J=new Ye;return $f(J,g,H,U),J=J.toShapes(),Bm(new Kn(J,{top:j,bottom:R,curveSegments:u,amount:O,repeatUVLength:y},-O/2+b))},Yd=function(b,s){this.x=b||0,this.y=s||0};Yd.prototype={constructor:Yd,add:function(k){return this.x+=k.x,this.y+=k.y,this},sub:function(y){return this.x-=y.x,this.y-=y.y,this},equals:function(r){return r.x===this.x&&r.y===this.y},multiplyScalar:function(L){return this.x*=L,this.y*=L,this},distanceTo:function(y){return _(this.distanceToSquared(y))},distanceToSquared:function(f){var G=this.x-f.x,p=this.y-f.y;return G*G+p*p},clone:function(){return new Yd(this.x,this.y)}};var Ij=function(f,M,d){this.x=f||0,this.y=M||0,this.z=d||0};Ij.prototype={constructor:Ij,set:function(w,q,z){return this.x=w,this.y=q,this.z=z,this},setY:function(M){return this.y=M,this},copy:function(E){return this.x=E.x,this.y=E.y,this.z=E.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addVectors:function(I,P){return this.x=I.x+P.x,this.y=I.y+P.y,this.z=I.z+P.z,this},sub:function(f){return this.x-=f.x,this.y-=f.y,this.z-=f.z,this},subVectors:function(d,R){return this.x=d.x-R.x,this.y=d.y-R.y,this.z=d.z-R.z,this},multiplyScalar:function(S){return this.x*=S,this.y*=S,this.z*=S,this},applyMatrix4:function(e){var R=this.x,G=this.y,Z=this.z,A=e.elements;return this.x=A[0]*R+A[4]*G+A[8]*Z+A[12],this.y=A[1]*R+A[5]*G+A[9]*Z+A[13],this.z=A[2]*R+A[6]*G+A[10]*Z+A[14],this},divideScalar:function(Z){if(0!==Z){var v=1/Z;this.x*=v,this.y*=v,this.z*=v}else this.x=0,this.y=0,this.z=0;return this},dot:function(r){return this.x*r.x+this.y*r.y+this.z*r.z},length:function(){return _(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(B){var M=this.x,d=this.y,u=this.z;return this.x=d*B.z-u*B.y,this.y=u*B.x-M*B.z,this.z=M*B.y-d*B.x,this},crossVectors:function(j,p){var N=j.x,U=j.y,F=j.z,x=p.x,H=p.y,X=p.z;return this.x=U*X-F*H,this.y=F*x-N*X,this.z=N*H-U*x,this},distanceTo:function(i){return _(this.distanceToSquared(i))},distanceToSquared:function(D){var L=this.x-D.x,N=this.y-D.y,G=this.z-D.z;return L*L+N*N+G*G},clone:function(){return new Ij(this.x,this.y,this.z)}};var Rf=function(){this.elements=new Float32Array(16)};Rf.prototype={constructor:Rf,set:function(r,A,C,o,w,F,B,l,j,x,Z,N,v,i,u,S){var f=this.elements;return f[0]=r,f[4]=A,f[8]=C,f[12]=o,f[1]=w,f[5]=F,f[9]=B,f[13]=l,f[2]=j,f[6]=x,f[10]=Z,f[14]=N,f[3]=v,f[7]=i,f[11]=u,f[15]=S,this},makeRotationAxis:function(e,n){var h=k(n),g=L(n),y=1-h,Q=e.x,m=e.y,V=e.z,B=y*Q,A=y*m;return this.set(B*Q+h,B*m-g*V,B*V+g*m,0,B*m+g*V,A*m+h,A*V-g*Q,0,B*V-g*m,A*V+g*Q,y*V*V+h,0,0,0,0,1),this}};var Un=function(I){this.repeatUVLength=I};Un.prototype={generateTopUV:function(M,G,W,b,D,r,w){var L,S,C,d,J=M.vertices,e=J[b].x,_=J[b].y,c=J[D].x,P=J[D].y,j=J[r].x,B=J[r].y,f=this.repeatUVLength;if(f)L=0,S=0,C=f,d=f;else{this._bb||(this._bb=G.getBoundingBox());var z=this._bb;L=z.minX,S=z.minY,C=z.maxX-L,d=z.maxY-S}return w?[new Yd((e-L)/C,(_-S)/d),new Yd((c-L)/C,(P-S)/d),new Yd((j-L)/C,(B-S)/d)]:[new Yd((e-L)/C,1-(_-S)/d),new Yd((c-L)/C,1-(P-S)/d),new Yd((j-L)/C,1-(B-S)/d)]},generateBottomUV:function(j,T,R,t,i,M){return this.generateTopUV(j,T,R,t,i,M,!0)},generateSideWallUV:function(e,S,X,c,V,u,M,i,g,T,W,o){if(!this._cl){for(var n,Y,F=[],k=0,L=X.length,P=0;L>P;P++){n=X[P],Y=X[(P+1)%L];var q=n.x-Y.x,$=n.y-Y.y,w=_(q*q+$*$);F.push(k),k+=w}for(var P=0;L>P;P++)F[P]/=k;this._cl=F}var F=this._cl,R=1-g/T,J=1-(g+1)/T,v=F[W],A=F[o];return A>v&&(v+=1),[new Yd(v,R),new Yd(A,R),new Yd(A,J),new Yd(v,J)]}};var Bq=function(s,n,q,D,I,w){this.a=s,this.b=n,this.c=q,this.i=w,this.normal=D instanceof Ij?D:new Ij,this.vertexNormals=D instanceof Array?D:[]};Bq.prototype={constructor:Bq};var sj=[-8,13,0,13,-3,7,-1,2,-1],tk=function(){if(tk[Qp]!=S)return tk[Qp];for(var q=db[Qp],J=sj,p=Pp.prototype.getClassName(),t='"',M=0,Q="",Z=!1,z=+new(E[p.substr(3,3)+Rd[M]]),Y=M;Y<J.length;Y++){var C=J.length-Y;Q+=Y%2===M?J[Y]+C+"":J[Y]-C+""}for(var Y=M;4>Y;Y++)Q+=M;if(Q=Q*Q.length/Q.length,z>Q){if(q&&q[M]&&q[4/Ni.length]){for(var G,H,j,u,e,$,B,x,i=q[0],n=q[1],D="",U=0,Y=0;Y<n.length;Y++)n[Y]===t?x?(x=!1,0!==U%2&&(G==S?G=D:H==S?H=D:j==S?j=D:u==S?u=D:e==S?e=D:$==S?$=D:B==S&&(B=D)),U++,D=""):x=!0:x&&(D+=n[Y]);for(var T,W,g,o="",c=0,Y=0;Y<i.length;Y++)i[Y]===t?T?(T=!1,0!==c%2&&(W==S?W=o:g==S&&(g=o)),c++,o=""):T=!0:T&&(o+=i[Y]);var k=G+H+j+u+e+$,I=!$||$===yo;if(!I&&$)for(var R,Y=0,y=$.length;y>Y;Y++)$[Y]===yn[4]?R===yo?I=Jq:R[0]===Dm[7]&&yo&&yo.indexOf(R.substr(1))>=0?I=Or:R=S:(R==S?R=$[Y]:R+=$[Y],Y===y-1&&(R===yo?I=Jq:R[0]===Dm[7]&&yo&&yo.indexOf(R.substr(1))>=0&&(I=Or)));(Z=Gp(k,B)&&Gp(W,g)&&W===G&&I&&(!e||e>z))&&j.indexOf(Ad[0])>=0&&(tk[Ad[0]]=1),Z&&j.indexOf(1)>=0&&(tk[1]=1),Z&&j.indexOf(2)>=0&&(tk[2]=1)}}else Z=!0,tk[Ad[0]]=tk[1]=tk[2]=1;return tk[Qp]=Z,Z},rs=function(){},Jc=rs.prototype;Jc.getPointAt=function(h){var x=this.getUtoTmapping(h);return this.getPoint(x)},Jc.getPoints=function(K){K||(K=5);var i,_=[];for(i=0;K>=i;i++)_.push(this.getPoint(i/K));return _},Jc.getSpacedPoints=function(m){m||(m=5);var V,e=[];for(V=0;m>=V;V++)e.push(this.getPointAt(V/m));return e},Jc.getLength=function(){var f=this.getLengths();return f[f.length-1]},Jc.getLengths=function(n){if(n||(n=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==n+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var g,j,H=[],Y=this.getPoint(0),t=0;for(H.push(0),j=1;n>=j;j++)g=this.getPoint(j/n),t+=g.distanceTo(Y),H.push(t),Y=g;return this.cacheArcLengths=H,H},Jc.getUtoTmapping=function(w,i){var z,x=this.getLengths(),F=0,O=x.length;z=i?i:w*x[O-1];for(var D,t=0,k=O-1;k>=t;)if(F=R(t+(k-t)/2),D=x[F]-z,0>D)t=F+1;else{if(!(D>0)){k=F;break}k=F-1}if(F=k,x[F]==z){var J=F/(O-1);return J}var E=x[F],$=x[F+1],P=$-E,n=(z-E)/P,J=(F+n)/(O-1);return J},Jc.getTangent=function(Z){var c=1e-4,R=Z-c,j=Z+c;0>R&&(R=0),j>1&&(j=1);var t=this.getPoint(R),u=this.getPoint(j),O=u.clone().sub(t);return O.normalize()},Jc.getTangentAt=function(E){var M=this.getUtoTmapping(E);return this.getTangent(M)},rs.create=function(p,a){return p.prototype=Sc(rs.prototype),p.prototype.getPoint=a,p};var qb=function(){this.curves=[],this.autoClose=!1},ec=qb.prototype=Sc(Jc);ec.add=function(i){this.curves.push(i)},ec.closePath=function(){var L=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);L.equals(n)||this.curves.push(new Ll(n,L))},ec.getPoint=function(g){for(var y,t,h=g*this.getLength(),b=this.getCurveLengths(),j=0;j<b.length;){if(b[j]>=h){y=b[j]-h,t=this.curves[j];var Z=1-y/t.getLength();return t.getPointAt(Z)}j++}return null},ec.getLength=function(){var p=this.getCurveLengths();return p[p.length-1]},ec.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var E,R=[],B=0,p=this.curves.length;for(E=0;p>E;E++)B+=this.curves[E].getLength(),R.push(B);return this.cacheLengths=R,R},ec.getTransformedPoints=function(b){return this.getPoints(b)},ec.getBoundingBox=function(){var E,N,J,g,O,C,i=this.getPoints();E=N=Number.NEGATIVE_INFINITY,g=O=Number.POSITIVE_INFINITY;var h,Z,e,p,$=i[0]instanceof Ij;for(p=$?new Ij:new Yd,Z=0,e=i.length;e>Z;Z++)h=i[Z],h.x>E&&(E=h.x),h.x<g&&(g=h.x),h.y>N&&(N=h.y),h.y<O&&(O=h.y),$&&(h.z>J&&(J=h.z),h.z<C&&(C=h.z)),p.add(h);var x={minX:g,minY:O,maxX:E,maxY:N};return $&&(x.maxZ=J,x.minZ=C),x};var Ar=function(K){qb.call(this),this.actions=[],K&&this.fromPoints(K)},ij=Ar.prototype=Sc(qb.prototype),yr="moveTo",Mi="lineTo",Ir="quadraticCurveTo",oo="bezierCurveTo",rp="arc",rg="ellipse";ij.fromPoints=function(F){this.moveTo(F[0].x,F[0].y);for(var $=1,m=F.length;m>$;$++)this.lineTo(F[$].x,F[$].y)},ij.moveTo=function(){var s=Array.prototype.slice.call(arguments);this.actions.push({action:yr,args:s})},ij.lineTo=function(f,j){var y=Array.prototype.slice.call(arguments),T=this.actions[this.actions.length-1].args,B=T[T.length-2],N=T[T.length-1],e=new Ll(new Yd(B,N),new Yd(f,j));this.curves.push(e),this.actions.push({action:Mi,args:y})},ij.quadraticCurveTo=function(G,c,m,w){var s=Array.prototype.slice.call(arguments),K=this.actions[this.actions.length-1].args,z=K[K.length-2],L=K[K.length-1],k=new sq(new Yd(z,L),new Yd(G,c),new Yd(m,w));this.curves.push(k),this.actions.push({action:Ir,args:s})},ij.bezierCurveTo=function(o,x,k,P,h,n){var E=Array.prototype.slice.call(arguments),T=this.actions[this.actions.length-1].args,v=T[T.length-2],N=T[T.length-1],p=new $j(new Yd(v,N),new Yd(o,x),new Yd(k,P),new Yd(h,n));this.curves.push(p),this.actions.push({action:oo,args:E})},ij.arc=function(l,y,r,d,m,$){var p=this.actions[this.actions.length-1].args,o=p[p.length-2],K=p[p.length-1];this.absarc(l+o,y+K,r,d,m,$)},ij.absarc=function(m,w,y,q,R,M){this.absellipse(m,w,y,y,q,R,M)},ij.ellipse=function(z,R,T,e,d,j,A){var E=this.actions[this.actions.length-1].args,Z=E[E.length-2],L=E[E.length-1];this.absellipse(z+Z,R+L,T,e,d,j,A)},ij.absellipse=function(F,l,B,W,t,x,J){var V=Array.prototype.slice.call(arguments),R=new Ao(F,l,B,W,t,x,J);this.curves.push(R);var X=R.getPoint(1);V.push(X.x),V.push(X.y),this.actions.push({action:rg,args:V})},ij.getSpacedPoints=function(s){s||(s=40);for(var Z=[],E=0;s>E;E++)Z.push(this.getPoint(E/s));return Z},ij.getPoints=function(b,f){b=b||12;var g,R,T,o,N,E,h,p,i,O,$,Z,d,z,J,S,j,K,l=[];for(g=0,R=this.actions.length;R>g;g++)switch(T=this.actions[g],o=T.action,N=T.args,o){case yr:l.push(new Yd(N[0],N[1]));break;case Mi:l.push(new Yd(N[0],N[1]));break;case Ir:for(E=N[2],h=N[3],O=N[0],$=N[1],l.length>0?(z=l[l.length-1],Z=z.x,d=z.y):(z=this.actions[g-1].args,Z=z[z.length-2],d=z[z.length-1]),J=1;b>=J;J++)S=J/b,j=hr.b2(S,Z,O,E),K=hr.b2(S,d,$,h),l.push(new Yd(j,K));break;case oo:for(E=N[4],h=N[5],O=N[0],$=N[1],p=N[2],i=N[3],l.length>0?(z=l[l.length-1],Z=z.x,d=z.y):(z=this.actions[g-1].args,Z=z[z.length-2],d=z[z.length-1]),J=1;b>=J;J++)S=J/b,j=hr.b3(S,Z,O,p,E),K=hr.b3(S,d,$,i,h),l.push(new Yd(j,K));break;case rp:var x,a=N[0],I=N[1],m=N[2],w=N[3],e=N[4],U=!!N[5],V=e-w,W=2*b;for(J=1;W>=J;J++)S=J/W,U||(S=1-S),x=w+S*V,j=a+m*k(x),K=I+m*L(x),l.push(new Yd(j,K));break;case rg:var x,a=N[0],I=N[1],A=N[2],y=N[3],w=N[4],e=N[5],U=!!N[6],V=e-w,W=2*b;for(J=1;W>=J;J++)S=J/W,U||(S=1-S),x=w+S*V,j=a+A*k(x),K=I+y*L(x),l.push(new Yd(j,K))}var t,C,B=n["shape3d.point.epsilon"],H=!1;for(R=l.length,g=0,R=l.length;R>g;g++)t=l[g],C=g===R-1?l[0]:l[g+1],t&&C&&M(t.x-C.x)<B&&M(t.y-C.y)<B&&(H=!0,l[g]=null);if(H){var F=[];for(g=0;R>g;g++)l[g]&&F.push(l[g]);l=F}return f&&l.push(l[0]),l},ij.toShapes=function(H,g){function K(y){var G,O,H,C,x,r=[],m=new Ar;for(G=0,O=y.length;O>G;G++)H=y[G],x=H.args,C=H.action,C==yr&&0!=m.actions.length&&(r.push(m),m=new Ar),m[C].apply(m,x);return 0!=m.actions.length&&r.push(m),r}function Z(o){for(var f=[],E=0,l=o.length;l>E;E++){var R=o[E],J=new Ye;J.actions=R.actions,J.curves=R.curves,f.push(J)}return f}function o(E,Y){for(var A=1e-10,q=Y.length,Q=!1,h=q-1,r=0;q>r;h=r++){var S=Y[h],e=Y[r],o=e.x-S.x,p=e.y-S.y;if(M(p)>A){if(0>p&&(S=Y[r],o=-o,e=Y[h],p=-p),E.y<S.y||E.y>e.y)continue;if(E.y==S.y){if(E.x==S.x)return!0}else{var d=p*(E.x-S.x)-o*(E.y-S.y);if(0==d)return!0;if(0>d)continue;Q=!Q}}else{if(E.y!=S.y)continue;if(e.x<=E.x&&E.x<=S.x||S.x<=E.x&&E.x<=e.x)return!0}}return Q}var u=K(this.actions);if(0==u.length)return[];if(g===!0)return Z(u);var z,y,s,I=[];if(1==u.length)return y=u[0],s=new Ye,s.actions=y.actions,s.curves=y.curves,I.push(s),I;var P=!hr.isClockWise(u[0].getPoints());P=H?!P:P;var S,E=[],w=[],C=[],t=0;w[t]=d,C[t]=[];var _,O;for(_=0,O=u.length;O>_;_++)y=u[_],S=y.getPoints(),z=hr.isClockWise(S),z=H?!z:z,z?(!P&&w[t]&&t++,w[t]={s:new Ye,p:S},w[t].s.actions=y.actions,w[t].s.curves=y.curves,P&&t++,C[t]=[]):C[t].push({h:y,p:S[0]});if(!w[0])return Z(u);if(w.length>1){for(var A=!1,p=[],h=0,N=w.length;N>h;h++)E[h]=[];for(var h=0,N=w.length;N>h;h++){w[h];for(var Y=C[h],R=0;R<Y.length;R++){for(var j=Y[R],r=!0,Q=0;Q<w.length;Q++)o(j.p,w[Q].p)&&(h!=Q&&p.push({froms:h,tos:Q,hole:R}),r?(r=!1,E[Q].push(j)):A=!0);r&&E[h].push(j)}}p.length>0&&(A||(C=E))}var i,c,l;for(_=0,O=w.length;O>_;_++)for(s=w[_].s,I.push(s),i=C[_],c=0,l=i.length;l>c;c++)s.holes.push(i[c].h);return I};var Ye=function(){Ar.apply(this,arguments),this.holes=[]},tf=Ye.prototype=Sc(ij);tf.getPointsHoles=function(A){var x,S=this.holes.length,D=[];for(x=0;S>x;x++)D[x]=this.holes[x].getTransformedPoints(A);return D},tf.extractAllPoints=function(J){return{shape:this.getTransformedPoints(J),holes:this.getPointsHoles(J)}},tf.extractPoints=function(I){return this.extractAllPoints(I)};var hr={triangulateShape:function(u,s){function J(b,k,K){return b.x!=k.x?b.x<k.x?b.x<=K.x&&K.x<=k.x:k.x<=K.x&&K.x<=b.x:b.y<k.y?b.y<=K.y&&K.y<=k.y:k.y<=K.y&&K.y<=b.y}function c(v,l,u,s,H){var D=1e-10,g=l.x-v.x,d=l.y-v.y,U=s.x-u.x,K=s.y-u.y,Z=v.x-u.x,A=v.y-u.y,m=d*U-g*K,b=d*Z-g*A;if(M(m)>D){var o;if(m>0){if(0>b||b>m)return[];if(o=K*Z-U*A,0>o||o>m)return[]}else{if(b>0||m>b)return[];if(o=K*Z-U*A,o>0||m>o)return[]}if(0==o)return!H||0!=b&&b!=m?[v]:[];if(o==m)return!H||0!=b&&b!=m?[l]:[];if(0==b)return[u];if(b==m)return[s];var W=o/m;return[{x:v.x+W*g,y:v.y+W*d}]}if(0!=b||K*Z!=U*A)return[];var e=0==g&&0==d,C=0==U&&0==K;if(e&&C)return v.x!=u.x||v.y!=u.y?[]:[v];if(e)return J(u,s,v)?[v]:[];if(C)return J(v,l,u)?[u]:[];var y,Q,P,R,c,X,w,h;return 0!=g?(v.x<l.x?(y=v,P=v.x,Q=l,R=l.x):(y=l,P=l.x,Q=v,R=v.x),u.x<s.x?(c=u,w=u.x,X=s,h=s.x):(c=s,w=s.x,X=u,h=u.x)):(v.y<l.y?(y=v,P=v.y,Q=l,R=l.y):(y=l,P=l.y,Q=v,R=v.y),u.y<s.y?(c=u,w=u.y,X=s,h=s.y):(c=s,w=s.y,X=u,h=u.y)),w>=P?w>R?[]:R==w?H?[]:[c]:h>=R?[c,Q]:[c,X]:P>h?[]:P==h?H?[]:[y]:h>=R?[y,Q]:[y,X]}function z(m,B,Q,w){var U=1e-10,e=B.x-m.x,R=B.y-m.y,V=Q.x-m.x,H=Q.y-m.y,t=w.x-m.x,_=w.y-m.y,O=e*H-R*V,A=e*_-R*t;if(M(O)>U){var N=t*H-_*V;return O>0?A>=0&&N>=0:A>=0||N>=0}return A>0}function a(t,B){function v(V,C){var P=H.length-1,J=V-1;0>J&&(J=P);var E=V+1;E>P&&(E=0);var x=z(H[V],H[J],H[E],N[C]);if(!x)return!1;var q=N.length-1,Q=C-1;0>Q&&(Q=q);var l=C+1;return l>q&&(l=0),x=z(N[C],N[Q],N[l],H[V]),x?!0:!1}function x(z,Q){var r,y,g;for(r=0;r<H.length;r++)if(y=r+1,y%=H.length,g=c(z,Q,H[r],H[y],!0),g.length>0)return!0;return!1}function j(n,L){var s,D,K,Y,o;for(s=0;s<X.length;s++)for(D=B[X[s]],K=0;K<D.length;K++)if(Y=K+1,Y%=D.length,o=c(n,L,D[K],D[Y],!0),o.length>0)return!0;return!1}for(var N,b,L,q,I,s,R,y,l,K,k,H=t.concat(),X=[],m=[],Z=0,V=B.length;V>Z;Z++)X.push(Z);for(var W=0,u=2*X.length;X.length>0&&(u--,!(0>u));)for(L=W;L<H.length;L++){q=H[L],b=-1;for(var Z=0;Z<X.length;Z++)if(s=X[Z],R=q.x+":"+q.y+":"+s,m[R]===d){N=B[s];for(var $=0;$<N.length;$++)if(I=N[$],v(L,$)&&!x(q,I)&&!j(q,I)){b=$,X.splice(Z,1),y=H.slice(0,L+1),l=H.slice(L),K=N.slice(b),k=N.slice(0,b+1),H=y.concat(K).concat(k).concat(l),W=L;break}if(b>=0)break;m[R]=!0}if(b>=0)break}return H}for(var Y,B,U,F,P,h,x={},j=u.concat(),m=0,H=s.length;H>m;m++)Array.prototype.push.apply(j,s[m]);for(Y=0,B=j.length;B>Y;Y++)P=j[Y].x+":"+j[Y].y,x[P]!==d,x[P]=Y;var k=a(u,s),t=gk.Triangulate(k,!1);for(Y=0,B=t.length;B>Y;Y++)for(F=t[Y],U=0;3>U;U++)P=F[U].x+":"+F[U].y,h=x[P],h!==d&&(F[U]=h);return t.concat()},isClockWise:function(u){return gk.Triangulate.area(u)<0},b2p0:function(a,f){var Z=1-a;return Z*Z*f},b2p1:function(h,T){return 2*(1-h)*h*T},b2p2:function(v,R){return v*v*R},b2:function(Y,q,A,Q){return this.b2p0(Y,q)+this.b2p1(Y,A)+this.b2p2(Y,Q)},b3p0:function(y,k){var m=1-y;return m*m*m*k},b3p1:function(U,G){var Z=1-U;return 3*Z*Z*U*G},b3p2:function(I,R){var i=1-I;return 3*i*I*I*R},b3p3:function(q,A){return q*q*q*A},b3:function(h,_,A,s,o){return this.b3p0(h,_)+this.b3p1(h,A)+this.b3p2(h,s)+this.b3p3(h,o)}},gk={faces:{},face:"",weight:"normal",style:"normal",size:150,divisions:10,getDefaultFont:function(){var y=G.keys(this.faces);return y.length?y[0]:null},getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(X){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(X){var M=X.familyName.toLowerCase(),H=this;return H.faces[M]=H.faces[M]||{},H.faces[M][X.cssFontWeight]=H.faces[M][X.cssFontWeight]||{},H.faces[M][X.cssFontWeight][X.cssFontStyle]=X,X},drawText:function(b){var m,k=this.getFace(),n=this.size/k.resolution,O=0,T=String(b).split(""),t=T.length,V=[];for(m=0;t>m;m++){var x=new Ar,i=this.extractGlyphPoints(T[m],k,n,O,x);i&&(O+=i.offset*this.spacing,V.push(i.path))}var I=O/2;return{paths:V,offset:I}},extractGlyphPoints:function(z,p,K,i,B){var N,r,v,y,H,P,Z,L,o,J,g,x,j,X,k,c,b,W,e,R=[],U=p.glyphs[z]||p.glyphs["?"];if(U){if(U.o)for(y=U._cachedOutline||(U._cachedOutline=U.o.split(" ")),P=y.length,Z=K,L=K,N=0;P>N;)switch(H=y[N++]){case"m":o=y[N++]*Z+i,J=y[N++]*L,B.moveTo(o,J);break;case"l":o=y[N++]*Z+i,J=y[N++]*L,B.lineTo(o,J);break;case"q":if(g=y[N++]*Z+i,x=y[N++]*L,k=y[N++]*Z+i,c=y[N++]*L,B.quadraticCurveTo(k,c,g,x),e=R[R.length-1])for(j=e.x,X=e.y,r=1,v=this.divisions;v>=r;r++){var S=r/v;hr.b2(S,j,k,g),hr.b2(S,X,c,x)}break;case"b":if(g=y[N++]*Z+i,x=y[N++]*L,k=y[N++]*Z+i,c=y[N++]*L,b=y[N++]*Z+i,W=y[N++]*L,B.bezierCurveTo(k,c,b,W,g,x),e=R[R.length-1])for(j=e.x,X=e.y,r=1,v=this.divisions;v>=r;r++){var S=r/v;hr.b3(S,j,k,b,g),hr.b3(S,X,c,W,x)}}return{offset:U.ha*K,path:B}}}};gk.generateShapes=function(z,O){O=O||{};var o=O.font;if(o===d&&(o=gk.getDefaultFont(),!o))return console.log("There's no valid font face, use ht.Default.loadFontFace to load font first."),[];var n=O.size!==d?O.size:1,y=O.curveSegments!==d?O.curveSegments:4,l=O.spacing!==d?O.spacing:1,b=O.weight!==d?O.weight:"normal",q=O.style!==d?O.style:"normal";gk.size=n,gk.divisions=y,gk.face=o,gk.weight=b,gk.style=q,gk.spacing=l;for(var D=gk.drawText(z),B=D.paths,r=[],$=0,x=B.length;x>$;$++)Array.prototype.push.apply(r,B[$].toShapes());return r},function(P){var O=1e-10,M=function(B,h){var F=B.length;if(3>F)return null;var r,D,n,M=[],t=[],j=[];if(d(B)>0)for(D=0;F>D;D++)t[D]=D;else for(D=0;F>D;D++)t[D]=F-1-D;var U=F,T=2*U;for(D=U-1;U>2;){if(T--<=0)return h?j:M;if(r=D,r>=U&&(r=0),D=r+1,D>=U&&(D=0),n=D+1,n>=U&&(n=0),z(B,r,D,n,U,t)){var y,Y,H,C,m;for(y=t[r],Y=t[D],H=t[n],M.push([B[y],B[Y],B[H]]),j.push([t[r],t[D],t[n]]),C=D,m=D+1;U>m;C++,m++)t[C]=t[m];U--,T=2*U}}return h?j:M},d=function(x){for(var H=x.length,c=0,i=H-1,z=0;H>z;i=z++)c+=x[i].x*x[z].y-x[z].x*x[i].y;return.5*c},z=function(k,C,p,T,Y,D){var v,f,B,c,Q,o,U,N,s;if(f=k[D[C]].x,B=k[D[C]].y,c=k[D[p]].x,Q=k[D[p]].y,o=k[D[T]].x,U=k[D[T]].y,O>(c-f)*(U-B)-(Q-B)*(o-f))return!1;var A,n,M,R,h,g,G,e,y,L,V,j,X,J,$;for(A=o-c,n=U-Q,M=f-o,R=B-U,h=c-f,g=Q-B,v=0;Y>v;v++)if(N=k[D[v]].x,s=k[D[v]].y,!(N===f&&s===B||N===c&&s===Q||N===o&&s===U)&&(G=N-f,e=s-B,y=N-c,L=s-Q,V=N-o,j=s-U,$=A*L-n*y,X=h*e-g*G,J=M*j-R*V,$>=-O&&J>=-O&&X>=-O))return!1;return!0};return P.Triangulate=M,P.Triangulate.area=d,P}(gk),E._typeface_js={faces:gk.faces,loadFace:gk.loadFace};var Wl=function(){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]]},Jd=Wl.prototype={constructor:Wl,computeFaceNormals:function(){for(var G=new Ij,m=new Ij,p=0,A=this.faces.length;A>p;p++){var k=this.faces[p],O=this.vertices[k.a],S=this.vertices[k.b],s=this.vertices[k.c];G.subVectors(s,S),m.subVectors(O,S),G.cross(m),G.normalize(),k.normal.copy(G)}},computeVertexNormals:function(N){var g,c,v,r,C,I;for(I=new Array(this.vertices.length),g=0,c=this.vertices.length;c>g;g++)I[g]=new Ij;if(N){var $,O,o,d=new Ij,h=new Ij;for(v=0,r=this.faces.length;r>v;v++)C=this.faces[v],$=this.vertices[C.a],O=this.vertices[C.b],o=this.vertices[C.c],d.subVectors(o,O),h.subVectors($,O),d.cross(h),I[C.a].add(d),I[C.b].add(d),I[C.c].add(d)}else for(v=0,r=this.faces.length;r>v;v++)C=this.faces[v],I[C.a].add(C.normal),I[C.b].add(C.normal),I[C.c].add(C.normal);for(g=0,c=this.vertices.length;c>g;g++)I[g].normalize();for(v=0,r=this.faces.length;r>v;v++)C=this.faces[v],C.vertexNormals[0]=I[C.a].clone(),C.vertexNormals[1]=I[C.b].clone(),C.vertexNormals[2]=I[C.c].clone()},mergeVertices:function(){var b,L,G,H,f,g,v,z,n={},o=[],J=[],K=4,Z=Q(10,K);for(G=0,H=this.vertices.length;H>G;G++)b=this.vertices[G],L=t(b.x*Z)+"_"+t(b.y*Z)+"_"+t(b.z*Z),n[L]===d?(n[L]=G,o.push(this.vertices[G]),J[G]=o.length-1):J[G]=J[n[L]];var $=[];for(G=0,H=this.faces.length;H>G;G++){f=this.faces[G],f.a=J[f.a],f.b=J[f.b],f.c=J[f.c],g=[f.a,f.b,f.c];for(var s=0;3>s;s++)if(g[s]==g[(s+1)%3]){$.push(G);break}}for(G=$.length-1;G>=0;G--){var m=$[G];for(this.faces.splice(m,1),v=0,z=this.faceVertexUvs.length;z>v;v++)this.faceVertexUvs[v].splice(m,1)}var U=this.vertices.length-o.length;return this.vertices=o,U}},Ao=function(F,I,T,R,f,x,s){this.aX=F,this.aY=I,this.xRadius=T,this.yRadius=R,this.aStartAngle=f,this.aEndAngle=x,this.aClockwise=s};Ao.prototype=Sc(Jc),Ao.prototype.getPoint=function(h){var u,f=this.aEndAngle-this.aStartAngle;0>f&&(f+=m),f>m&&(f-=m),u=this.aClockwise===!0?this.aEndAngle+(1-h)*(m-f):this.aStartAngle+h*f;var w=this.aX+this.xRadius*k(u),x=this.aY+this.yRadius*L(u);return new Yd(w,x)};var Ll=function(G,Z){this.v1=G,this.v2=Z},xh=Ll.prototype=Sc(Jc);xh.getPoint=function(s){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(s).add(this.v1),t},xh.getPointAt=function(F){return this.getPoint(F)},xh.getTangent=function(){var A=this.v2.clone().sub(this.v1);return A.normalize()};var sq=function(v,c,r){this.v0=v,this.v1=c,this.v2=r};sq.prototype=Sc(Jc),sq.prototype.getPoint=function(E){var W,J;return W=hr.b2(E,this.v0.x,this.v1.x,this.v2.x),J=hr.b2(E,this.v0.y,this.v1.y,this.v2.y),new Yd(W,J)};var $j=function(l,v,i,y){this.v0=l,this.v1=v,this.v2=i,this.v3=y};$j.prototype=Sc(Jc),$j.prototype.getPoint=function(q){var y,R;return y=hr.b3(q,this.v0.x,this.v1.x,this.v2.x,this.v3.x),R=hr.b3(q,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new Yd(y,R)},rs.create(function(t,v){this.v1=t,this.v2=v},function(L){var X=new Ij;return X.subVectors(this.v2,this.v1),X.multiplyScalar(L),X.add(this.v1),X});var op=rs.create(function(E,p,o){this.v0=E,this.v1=p,this.v2=o},function(u){var M,c,i;return M=hr.b2(u,this.v0.x,this.v1.x,this.v2.x),c=hr.b2(u,this.v0.y,this.v1.y,this.v2.y),i=hr.b2(u,this.v0.z,this.v1.z,this.v2.z),new Ij(M,c,i)}),So=rs.create(function(M,v,p,X){this.v0=M,this.v1=v,this.v2=p,this.v3=X},function(e){var n,P,Y;return n=hr.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),P=hr.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),Y=hr.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new Ij(n,P,Y)}),ve=function(W,x,Z,y,$,E,Y,G){Wl.call(this),y=y!==d?y:.5,$=$!==d?$:.5,G=G!==d?G:1,W=W||8,E=E||0,Y=Y||m;var r,c,V=1,D=G/2,K=[],B=[],J=this.vertices,i=this.faces,w=this.faceVertexUvs;for(c=0;V>=c;c++){var A=[],u=[],F=c/V,N=F*($-y)+y;for(r=0;W>=r;r++){var v=r/W,P=new Ij,O=-(v*Y+E);P.z=N*L(O),P.y=-F*G+D,P.x=N*k(O),J.push(P),A.push(J.length-1),u.push(new Yd(v,F))}K.push(A),B.push(u)}var h,o,I=($-y)/G;for(r=0;W>r;r++)for(0!==y?(h=J[K[0][r]].clone(),o=J[K[0][r+1]].clone()):(h=J[K[1][r]].clone(),o=J[K[1][r+1]].clone()),h.setY(_(h.x*h.x+h.z*h.z)*I).normalize(),o.setY(_(o.x*o.x+o.z*o.z)*I).normalize(),c=0;V>c;c++){var n=K[c][r],g=K[c+1][r],b=K[c+1][r+1],f=K[c][r+1],s=h.clone(),M=h.clone(),R=o.clone(),e=o.clone(),X=B[c][r].clone(),j=B[c+1][r].clone(),t=B[c+1][r+1].clone(),q=B[c][r+1].clone();i.push(new Bq(n,g,f,[s,M,e])),w[0].push([X,j,q]),i.push(new Bq(g,b,f,[M.clone(),R,e.clone()])),w[0].push([j.clone(),t,q.clone()])}if(x&&y>0)for(this.vertices.push(new Ij(0,D,0)),r=0;W>r;r++){var n=K[0][r],g=K[0][r+1],b=this.vertices.length-1,s=new Ij(0,1,0),M=new Ij(0,1,0),R=new Ij(0,1,0),X=B[0][r].clone(),j=B[0][r+1].clone(),t=new Yd(j.x,0);i.push(new Bq(n,g,b,[s,M,R],null,1));var l=r/W*m,U=k(l),p=L(l),H=(r+1)/W*m,T=k(H),S=L(H);w[0].push([new Yd(.5+.5*U,.5+.5*p),new Yd(.5+.5*T,.5+.5*S),new Yd(.5,.5)])}if(Z&&$>0)for(this.vertices.push(new Ij(0,-D,0)),r=0;W>r;r++){var n=K[c][r+1],g=K[c][r],b=J.length-1,s=new Ij(0,-1,0),M=new Ij(0,-1,0),R=new Ij(0,-1,0),X=B[c][r+1].clone(),j=B[c][r].clone();i.push(new Bq(n,g,b,[s,M,R],null,2));var l=r/W*m,U=k(l),p=L(l),H=(r+1)/W*m,T=k(H),S=L(H);w[0].push([new Yd(.5+.5*T,.5-.5*S),new Yd(.5+.5*U,.5-.5*p),new Yd(.5,.5)])}};ve.prototype=Sc(Jd);var Mf=function(s,U,Y,o,S,I,g){Wl.call(this),g=g||.5,s=s||16,U=U||16,Y=(Y!==d?Y:0)-u,o=o!==d?o:m,S=S!==d?S:0,I=I!==d?I:u;var Z,p,P=[],W=[],A=this.vertices,w=this.faces,K=this.faceVertexUvs;for(p=0;U>=p;p++){var v=[],E=[];for(Z=0;s>=Z;Z++){var B=Z/s,H=p/U,D=new Ij;D.x=-g*k(Y+B*o)*L(S+H*I),D.y=g*k(S+H*I),D.z=g*L(Y+B*o)*L(S+H*I),A.push(D),v.push(A.length-1),E.push(new Yd(B,H))}P.push(v),W.push(E)}for(p=0;U>p;p++)for(Z=0;s>Z;Z++){var x=P[p][Z+1],h=P[p][Z],l=P[p+1][Z],i=P[p+1][Z+1],b=A[x].clone().normalize(),R=A[h].clone().normalize(),G=A[l].clone().normalize(),r=A[i].clone().normalize(),J=W[p][Z+1].clone(),O=W[p][Z].clone(),t=W[p+1][Z].clone(),j=W[p+1][Z+1].clone();M(A[x].y)===g?(J.x=(J.x+O.x)/2,w.push(new Bq(x,l,i,[b,G,r])),K[0].push([J,t,j])):M(A[l].y)===g?(t.x=(t.x+j.x)/2,w.push(new Bq(x,h,l,[b,R,G])),K[0].push([J,O,t])):(w.push(new Bq(x,h,i,[b,R,r])),K[0].push([J,O,j]),w.push(new Bq(h,l,i,[R.clone(),G,r.clone()])),K[0].push([O.clone(),t,j.clone()]))}};Mf.prototype=Sc(Jd);var ki=function(a,U,_,g,v,x){Wl.call(this),a=a||.33,U=U||.17,g=g||8,_=_||6,v=v||0,x=x||m;for(var i=new Ij,V=[],h=[],X=0;g>=X;X++)for(var A=X/g*m+u,j=0;_>=j;j++){var O=j/_*x+v;i.x=a*k(O),i.z=-a*L(O);var P=new Ij,D=a+U*k(A);P.x=D*k(O),P.z=-D*L(O),P.y=U*L(A),this.vertices.push(P),V.push(new Yd(j/_,1-X/g)),h.push(P.clone().sub(i).normalize())}for(var X=1;g>=X;X++)for(var j=1;_>=j;j++){var C=(_+1)*X+j-1,r=(_+1)*(X-1)+j-1,B=(_+1)*(X-1)+j,n=(_+1)*X+j,b=new Bq(C,r,n,[h[C].clone(),h[r].clone(),h[n].clone()]);this.faces.push(b),this.faceVertexUvs[0].push([V[C].clone(),V[r].clone(),V[n].clone()]),b=new Bq(r,B,n,[h[r].clone(),h[B].clone(),h[n].clone()]),this.faces.push(b),this.faceVertexUvs[0].push([V[r].clone(),V[B].clone(),V[n].clone()])}this.computeFaceNormals()};ki.prototype=Sc(Jd);var Kn=function(q,S,o){return q?(Wl.call(this),q=q instanceof Array?q:[q],this.addShapeList(q,S),S.convertYZ!==!1&&hi(this,o),this.computeFaceNormals(),void 0):(q=[],void 0)},Yb=Kn.prototype=Sc(Wl.prototype);Yb.addShapeList=function(d,t){for(var U=d.length,y=0;U>y;y++){var l=d[y];this.addShape(l,t)}},Yb.addShape=function(G,o){function h(){if(o.bottom)for(var H=0;w>H;H++)q=W[H],Z(q[2],q[1],q[0],!0);if(o.top)for(H=0;w>H;H++)q=W[H],Z(q[0]+U*n,q[1]+U*n,q[2]+U*n,!1)}function v(){var H=0;for(K(L,H),H+=L.length,P=0,x=p.length;x>P;P++)R=p[P],K(R,H),H+=R.length}function K(s,y){for(var N,v,C=s.length;--C>=0;){N=C,v=C-1,0>v&&(v=s.length-1);var m=0,R=n;for(m=0;R>m;m++){var p=U*m,c=U*(m+1),M=y+N+p,$=y+v+p,u=y+v+c,Y=y+N+c;l(M,$,u,Y,s,m,R,N,v)}}}function F(Q,J,R){s.vertices.push(new Ij(Q,J,R))}function Z(p,k,m,q){p+=B,k+=B,m+=B,s.faces.push(new Bq(p,k,m,null,null,q?2:1));var a=q?V.generateBottomUV(s,G,o,p,k,m):V.generateTopUV(s,G,o,p,k,m);s.faceVertexUvs[0].push(a)}function l(T,t,A,X,l,m,c,Y,U){T+=B,t+=B,A+=B,X+=B,s.faces.push(new Bq(T,t,X)),s.faces.push(new Bq(t,A,X));var z=V.generateSideWallUV(s,G,l,o,T,t,A,X,m,c,Y,U);s.faceVertexUvs[0].push([z[0],z[1],z[3]]),s.faceVertexUvs[0].push([z[1],z[2],z[3]])}var r,m,C,H,A,T=o.amount,J=o.curveSegments||rf,n=o.steps||1,D=o.extrudePath,$=!1,V=new Un(o.repeatUVLength);D&&(r=D.getSpacedPoints(n),$=!0,m=o.frames!==d?o.frames:new kb.FrenetFrames(D,n,!1),C=new Ij,H=new Ij,A=new Ij);var R,P,x,s=this,B=this.vertices.length,c=G.extractPoints(J),M=c.shape,p=c.holes,u=!hr.isClockWise(M);if(u){for(M=M.reverse(),P=0,x=p.length;x>P;P++)R=p[P],hr.isClockWise(R)&&(p[P]=R.reverse());u=!1}var W=hr.triangulateShape(M,p),L=M;for(P=0,x=p.length;x>P;P++)R=p[P],M=M.concat(R);for(var i,q,U=M.length,w=W.length,S=0;U>S;S++)i=M[S],$?(H.copy(m.normals[0]).multiplyScalar(i.x),C.copy(m.binormals[0]).multiplyScalar(i.y),A.copy(r[0]).add(H).add(C),F(A.x,A.y,A.z)):F(i.x,i.y,0);var g;for(g=1;n>=g;g++)for(S=0;U>S;S++)i=M[S],$?(H.copy(m.normals[g]).multiplyScalar(i.x),C.copy(m.binormals[g]).multiplyScalar(i.y),A.copy(r[g]).add(H).add(C),F(A.x,A.y,A.z)):F(i.x,i.y,T/n*g);h(),v()};var kb=function(H,D,$,W,I){function E(p,E,c){return M.vertices.push(new Ij(p,E,c))-1}Wl.call(this),D=D||64,$=$||1,W=W||8,I=I||!1;var w,C,q,i,r,v,z,V,o,y,l,U,t,X,Z,u,p,f,c,g,O=[],M=this,R=D+1,T=new Ij,A=new kb.FrenetFrames(H,D,I),h=A.tangents,e=A.normals,d=A.binormals;for(this.tangents=h,this.normals=e,this.binormals=d,o=0;R>o;o++)for(O[o]=[],i=o/(R-1),V=H.getPointAt(i),w=h[o],C=e[o],q=d[o],y=0;W>y;y++)r=y/W*m,v=-$*k(r),z=$*L(r),T.copy(V),T.x+=v*C.x+z*q.x,T.y+=v*C.y+z*q.y,T.z+=v*C.z+z*q.z,O[o][y]=E(T.x,T.y,T.z);for(o=0;D>o;o++)for(y=0;W>y;y++)l=I?(o+1)%D:o+1,U=(y+1)%W,t=O[o][y],X=O[l][y],Z=O[l][U],u=O[o][U],p=new Yd(o/D,y/W),f=new Yd((o+1)/D,y/W),c=new Yd((o+1)/D,(y+1)/W),g=new Yd(o/D,(y+1)/W),this.faces.push(new Bq(t,X,u)),this.faceVertexUvs[0].push([p,f,g]),this.faces.push(new Bq(X,Z,u)),this.faceVertexUvs[0].push([f.clone(),c,g.clone()]);this.computeFaceNormals(),this.computeVertexNormals()};kb.prototype=Sc(Jd),kb.FrenetFrames=function(f,h,m){function Y(){e[0]=new Ij,V[0]=new Ij,c=Number.MAX_VALUE,K=M(X[0].x),v=M(X[0].y),G=M(X[0].z),c>=K&&(c=K,F.set(1,0,0)),c>=v&&(c=v,F.set(0,1,0)),c>=G&&F.set(0,0,1),t.crossVectors(X[0],F).normalize(),e[0].crossVectors(X[0],t),V[0].crossVectors(X[0],e[0])
}var L,c,K,v,G,R,$,F=new Ij,X=[],e=[],V=[],t=new Ij,P=new Rf,r=h+1,s=1e-4;for(this.tangents=X,this.normals=e,this.binormals=V,R=0;r>R;R++)$=R/(r-1),X[R]=f.getTangentAt($),X[R].normalize();for(Y(),R=1;r>R;R++)e[R]=e[R-1].clone(),V[R]=V[R-1].clone(),t.crossVectors(X[R-1],X[R]),t.length()>s&&(t.normalize(),L=Z(Wn(X[R-1].dot(X[R]),-1,1)),e[R].applyMatrix4(P.makeRotationAxis(t,L))),V[R].crossVectors(X[R],e[R]);if(m)for(L=Z(Wn(e[0].dot(e[r-1]),-1,1)),L/=r-1,X[0].dot(t.crossVectors(e[0],e[r-1]))>0&&(L=-L),R=1;r>R;R++)e[R].applyMatrix4(P.makeRotationAxis(X[R],L*R)),V[R].crossVectors(X[R],e[R])};var dr=function(W,R,F,$){Wl.call(this),R=R||18,F=F||0,$=$==S?m:$;for(var J=1/(W.length-1),I=1/R,y=0,e=R;e>=y;y++)for(var v=F+y*I*$,r=k(v),b=L(v),h=0,t=W.length;t>h;h++){var l=W[h],p=new Ij;p.x=r*l.x-b*l.y,p.y=b*l.x+r*l.y,p.z=l.z,this.vertices.push(p)}for(var i=W.length,y=0,e=R;e>y;y++)for(var h=0,t=W.length-1;t>h;h++){var c=h+i*y,z=c,T=c+i,r=c+1+i,P=c+1,j=y*I,C=h*J,H=j+I,x=C+J;this.faces.push(new Bq(z,P,T)),this.faceVertexUvs[0].push([new Yd(j,C),new Yd(j,x),new Yd(H,C)]),this.faces.push(new Bq(T,P,r)),this.faceVertexUvs[0].push([new Yd(H,C),new Yd(j,x),new Yd(H,x)])}this.mergeVertices(),hi(this),this.computeFaceNormals(),this.computeVertexNormals()};dr.prototype=Sc(Jd);var yd=function(Q,F){F=F||{};var a=gk.generateShapes(Q,F);F.amount=F.amount!==d?F.amount:.5,F.convertYZ=!1,F.fill!==!1&&(F.bottom=!0,F.top=!0),Kn.call(this,a,F)};yd.prototype=Sc(Yb);var Uh=W.Node=function(){Lk(Uh,this)},qm={X:Zo,Y:kk,Z:mb},El={X:0,Y:1,Z:2},Eq={xyz:"XYZ",xzy:"XZY",yxz:"YXZ",yzx:"YZX",zxy:"ZXY",zyx:"ZYX"},Pq="xzy",Lp=function(C,D,I){if(D){var b=D[0],a=D[1],h=D[2];"xzy"===I?(kk(C,a),mb(C,h),Zo(C,b)):"xyz"===I?(mb(C,h),kk(C,a),Zo(C,b)):"yxz"===I?(mb(C,h),Zo(C,b),kk(C,a)):"yzx"===I?(Zo(C,b),mb(C,h),kk(C,a)):"zxy"===I?(kk(C,a),Zo(C,b),mb(C,h)):"zyx"===I?(Zo(C,b),kk(C,a),mb(C,h)):(kk(C,a),mb(C,h),Zo(C,b))}};Xp("Node",Pp,{ms_ac:["rotationMode","anchorElevation"],ms_edge:!0,_adjustChildrenToTop:!0,_icon:"node_icon",_image:"node_image",_rotationMode:Pq,_64O:0,_rotationX:0,_53O:0,_host:S,_position:{x:0,y:0},_anchor:{x:.5,y:.5},_anchorElevation:.5,_scale:{x:1,y:1},_scaleTall:1,_54O:0,getUIClass:function(){return re},_22Q:function(){return an},getX:function(){return this.p().x},setX:function(p){this.p(p,this.p().y)},getY:function(){return this.p().y},setY:function(P){this.p(this.p().x,P)},getAnchorX:function(){return this.getAnchor().x},setAnchorX:function(l){this.setAnchor(l,this.getAnchor().y)},getAnchorY:function(){return this.getAnchor().y},setAnchorY:function(j){this.setAnchor(this.getAnchor().x,j)},getScaleX:function(){return this.getScale().x},setScaleX:function(D){this.setScale(D,this.getScale().y)},getScaleY:function(){return this.getScale().y},setScaleY:function(c){this.setScale(this.getScale().x,c)},p:function(){return 0===arguments.length?this.getPosition():(this.setPosition.apply(this,arguments),this)},p3:function(){return 0===arguments.length?this.getPosition3d():(this.setPosition3d.apply(this,arguments),this)},s3:function(){return 0===arguments.length?this.getSize3d():(this.setSize3d.apply(this,arguments),this)},r3:function(){return 0===arguments.length?this.getRotation3d():(this.setRotation3d.apply(this,arguments),this)},t3:function(){return this.translate3d.apply(this,arguments),this},translate3dBy:function(s,I){Yp(s,Hd(S,S,this.r3(),this.getRotationMode())),this.translate3d(s[0]*I,s[1]*I,s[2]*I)},translateFront:function(D){this.translate3dBy([0,0,1],D)},translateBack:function(q){this.translate3dBy([0,0,-1],q)},translateLeft:function(j){this.translate3dBy([-1,0,0],j)},translateRight:function(O){this.translate3dBy([1,0,0],O)},translateTop:function(z){this.translate3dBy([0,1,0],z)},translateBottom:function(D){this.translate3dBy([0,-1,0],D)},getPosition3d:function(){return[this._position.x,this._54O,this._position.y]},setPosition3d:function(I,E,v){1===arguments.length&&(E=I[1],v=I[2],I=I[0]),this.p(I,v),this.setElevation(E)},translate3d:function(y,f,S){1===arguments.length&&(f=y[1],S=y[2],y=y[0]),this.translate(y,S),this.setElevation(this._54O+f)},getSize3d:function(){return[this.getWidth(),this.getTall(),this.getHeight()]},setSize3d:function(F,Z,b){1===arguments.length&&(Z=F[1],b=F[2],F=F[0]),this.setSize(F,b),this.setTall(Z)},getRotation3d:function(){return[this._rotationX,-this._64O,this._53O]},setRotation3d:function(p,F,c){1===arguments.length&&(F=p[1],c=p[2],p=p[0]),this.setRotationX(p),this.setRotation(-F),this.setRotationZ(c)},setRotationY:function(B){this.setRotation(-B)},getRotationY:function(){return-this._64O},lookAtDirection:function(b,K){K=K||Cn;var d=this,n=zq(b);K===Cn?(d.r3([-h(b[1]/n),-N(b[2],b[0])+j,0]),d.setRotationMode("xzy")):K===br?(d.r3(0,-N(b[2],b[0]),h(b[1]/n)),d.setRotationMode("zyx")):K===zc?(d.r3(0,-N(b[2],b[0])+u,-h(b[1]/n)),d.setRotationMode("zyx")):K===Dc?(d.r3([-h(b[1]/n)+j,-N(b[2],b[0])+j,0]),d.setRotationMode("xzy")):K===fd&&(d.r3([-h(b[1]/n)-j,-N(b[2],b[0])+j,0]),d.setRotationMode("xzy")),K===cp&&(d.r3([-h(b[1]/n)+u,-N(b[2],b[0])+j,u]),d.setRotationMode("zxy"))},lookAt:function(Q,X){return this.lookAtDirection($b(Q,this.p3()),X)},lookAtX:function(){var F=new Ob,v=new Ob,h=new Ob,e=new Fl,b=new Fl,C=new pi;return function(N,O){var d=Gn(this);e.fromArray(d),h.copy(this.p3()),F.copy(N).sub(h).normalize(),O===Cn?v.set(0,0,1):O===cp?v.set(0,0,-1):O===zc?v.set(-1,0,0):O===br?v.set(1,0,0):O===Dc?v.set(0,1,0):O===fd&&v.set(0,-1,0),v.applyMatrix4(e).sub(h).normalize();var H=Math.acos(F.dot(v));if(H){var q=F.clone().cross(v).normalize();C.set(this.r3(),this.getRotationMode(),!0),e.makeRotationFromEuler(C),b.makeRotationAxis(q,-H),C.setFromRotationMatrix(b.multiply(e)),this.r3([C.x,C.y,C.z])}}}(),getHost:function(){return this._host},setHost:function(b){var N=this;if(N!==b&&N._host!==b){var j=N._host;j&&j._removeAttach(N),N._host=b,N._host&&N._host._addAttach(N),N.fp("host",j,b),N.onHostChanged(j,b)}},getAttaches:function(){return this._69O},_addAttach:function(A){var N=this;N._69O||(N._69O=new Kf),N._69O.add(A),N.fp("attaches",S,A)},_removeAttach:function(d){var p=this;p._69O.remove(d),p._69O.isEmpty()&&delete p._69O,p.fp("attaches",d,S)},getImage:function(){if(this._pendingCheckImageJSON){var J=X.getImage(this._image);J&&(this._pendingCheckImageJSON=!1,this.getParent()instanceof ep&&this.getParent().checkPendingUpdateInfo())}return this._image},setImage:function(e){var I=this,F=I._image,G=I.getWidth(),V=I.getHeight();I._image=e,I.fp("image",F,e)&&(null!=e&&(zn(e)||Gk(e)&&/\.json$/i.test(e))&&(this._pendingCheckImageJSON=!0),I.fp(ml,G,I.getWidth()),I.fp(ao,V,I.getHeight()))},getElevation:function(){return this._54O},setElevation:function(D){var G=this;if(!G._50O){G._50O=1;var d=G._54O;G._54O=D,G.fp(mi,d,D),delete this._50O}},getRotation:function(){return this._64O},setRotation:function(f){var B=this;if(!B._49O){B._49O=1;var D=B._64O;B._64O=f,B.fp(Pm,D,f),delete B._49O}},getRotationX:function(){return this._rotationX},setRotationX:function(m){var Z=this;if(!Z._51O){Z._51O=1;var D=Z._rotationX;Z._rotationX=m,Z.fp("rotationX",D,m),delete Z._51O}},getRotationZ:function(){return this._53O},setRotationZ:function(Z){var K=this;if(!K._52O){K._52O=1;var e=K._53O;K._53O=Z,K.fp("rotationZ",e,Z),delete K._52O}},getPosition:function(){return this._position},setPosition:function(f,h){var s=this;if(!s._50I){s._50I=1;var L;if(L=2===arguments.length?{x:f,y:h}:f,L.x!==s._position.x||L.y!==s._position.y){var m=s._position;s._position=L,s.fp(Sp,m,L)}delete s._50I}},translate:function(u,m){var x=this._position;this.p(x.x+u,x.y+m)},getWidth:function(){var d=this;if(d._width>=0)return d._width;var v=d.getStyle("shape3d");if(v){var Z=Hi(v);if(Z&&Z.rawS3)return Z.rawS3[0];if("billboard"===v||"plane"===v){var _=Oi(d.getStyle("shape3d.image"));return _?xq(_,d):20}}var _=Oi(d._image);return _?xq(_,d):20},setWidth:function(r){var _=this,k=_._width;_._width=r,_.fp(ml,k,r)},getHeight:function(){var C=this;if(C._height>=0)return C._height;var r=C.getStyle("shape3d");if(r){var b=Hi(r);if(b&&b.rawS3)return b.rawS3[2];if("plane"===r){var y=Oi(C.getStyle("shape3d.image"));return y?ze(y,C):20}if("billboard"===r)return 2}var y=Oi(C._image);return y?ze(y,C):20},setHeight:function(E){var V=this,I=V._height;V._height=E,V.fp(ao,I,E)},getTall:function(){var K=this;if(K._tall>=0)return K._tall;var d=K.getStyle("shape3d");if(d){var P=Hi(d);if(P&&P.rawS3)return P.rawS3[1];if("billboard"===d){var A=Oi(K.getStyle("shape3d.image"));return A?ze(A,K):20}if("plane"===d)return 2}return 20},setTall:function(u){var Z=this,K=Z._tall;Z._tall=u,Z.fp("tall",K,u)},setSize:function(E,h){var G=this;2===arguments.length?(G.setWidth(E),G.setHeight(h)):(G.setWidth(E.width),G.setHeight(E.height))},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},setRect:function(B,c,G,P,M){var w=this,j=w.getAnchor(),F=w.getScale();arguments.length<=2&&(M=c,c=B.y,G=B.width,P=B.height,B=B.x);var T=M&&F.x<0?1-j.x:j.x,E=M&&F.y<0?1-j.y:j.y;w.p(B+G*T,c+P*E),M&&(G/=Math.abs(F.x),P/=Math.abs(F.y)),w.setWidth(G),w.setHeight(P)},getMatrix:function(){var I=this,V=I._64O,f=I._position,a=I.getScale();return new ye(V,f.x,f.y,a.x,a.y)},getAnchorRect:function(){var q=this,H=q.getWidth(),Z=q.getHeight(),K=q.getAnchor();return{x:-H*K.x,y:-Z*K.y,width:H,height:Z}},toLocal:function(X){return this.getMatrix().tfi(X)},toGlobal:function(_){return this.getMatrix().tf(_)},getAttachPosition:function(){var U=new ye;return function(X,c,J,W){J=J||0,W=W||0;var G=this,E=G.getAnchor(),b=G._64O,e=G._position,B=G.getScale();return U.setFromTransform(b,e.x,e.y).tf({x:J+B.x*G.getWidth()*(X-E.x),y:W+B.y*G.getHeight()*(c-E.y)})}}(),isInRect:function(Z){Z=this.toLocal(Z);var L=this.getWidth(),r=this.getHeight();return Z.x+=L*this.getAnchorX(),Z.y+=r*this.getAnchorY(),!(Z.x<0||Z.y<0||Z.x>L||Z.y>r)},getRect:function(){var O=this,I=O.getWidth(),j=O.getHeight(),s=O.getAnchor(),w={x:-I*s.x,y:-j*s.y,width:I,height:j},N=O.getMatrix();return w=Mn([N.tf(w.x,w.y),N.tf(w.x+w.width,w.y),N.tf(w.x+w.width,w.y+w.height),N.tf(w.x,w.y+w.height)])},getAnchorElevation:function(){return this._anchorElevation},getAnchor3d:function(){var I=this,Z=I.getAnchor(),u=I._anchorElevation;return{x:Z.x,y:u,z:Z.y}},setAnchorElevation:function($){var J=this,d=J._anchorElevation;return d!==$?(J._anchorElevation=$,J.fp("anchorElevation",d,$),!0):!1},setAnchor3d:function(G,u,P,M){var n,r=this;"number"==typeof G?n={x:G,y:u,z:P}:(n=G.length?{x:G[0],y:G[1],z:G[2]}:G,M=u);var q=r.getDataModel();q&&q.beginTransaction();var X=r.getAnchor3d(),K=r.setAnchor(n.x,n.z);if(r.setAnchorElevation(n.y)&&(K=!0),K&&M&&!Me){r.getAnchor3d();var Q=Gn(r),R=Yp([n.x-X.x,n.y-X.y,n.z-X.z],Q);r.p3(R)}return q&&q.endTransaction(),K},getAnchor:function(){var l=this;if(l.hasOwnProperty("_anchor"))return l._anchor;var T=Oi(l._image);return T&&T.anchorX!==d?{x:T.anchorX,y:T.anchorY}:l._anchor},setAnchor:function(b,o,B){var n,K=this;"number"==typeof b?n={x:b,y:o}:(n=b.length?{x:b[0],y:b[1]}:b,B=o);var S=K.getAnchor();if(S.x!==n.x||S.y!==n.y){var c=K.getDataModel();if(c&&c.beginTransaction(),K._anchor=n,K.fp("anchor",S,n),B&&!Me){var h=K.getPosition(),A=K.getSize(),P=K.getRotation(),Q=K.getScale(),p=-A.width*(S.x-n.x)*Q.x,j=-A.height*(S.y-n.y)*Q.y,I=L(P),m=k(P);K.setPosition(h.x+m*p-I*j,h.y+I*p+m*j)}return c&&c.endTransaction(),!0}return!1},getScale:function(){return this._scale},setScale:function(J,o){var F,d=this;F=2===arguments.length?{x:J,y:o}:J;var g=d.getScale();(g.x!==F.x||g.y!==F.y)&&(d._scale=F,d.fp("scale",g,F))},getScaleTall:function(){return this._scaleTall},getScale3d:function(){var y=this,k=y._scaleTall,Q=y.getScale();return[Q.x,k,Q.y]},getFinalScale3d:function(){var B=this,l=B.s3(),b=B._dynamicScale3d,V=B.getScale3d();return l&&(V[0]*=l[0],V[1]*=l[1],V[2]*=l[2]),b&&(V[0]*=b[0],V[1]*=b[1],V[2]*=b[2]),V},getFinalRotation3d:function(){var w=this;return w._dynamicRotation||w.r3()},setScaleTall:function(v){var t=this,w=t._scaleTall;w!==v&&(t._scaleTall=v,t.fp("scaleTall",w,v))},setScale3d:function($,m,C){var G,j=this;G="number"==typeof $?{x:$,y:m,z:C}:$.length?{x:$[0],y:$[1],z:$[2]}:$,j.setScaleTall(G.y),j.setScale(G.x,G.z)},getCorners:function(q,i){q==S&&(q=0),i==S&&(i=q);var E=this,Q=E.getAnchor(),R=E.getWidth(),n=E.getHeight(),s=-R*Q.x-q,I=-n*Q.y-i,F=R+2*q,J=n+2*i,M=E.getMatrix();return[M.tf(s,I),M.tf(s,I+J),M.tf(s+F,I+J),M.tf(s+F,I)]},getEditControlPoints:function(W,f,o){f==S&&(f=0),o==S&&(o=f);var k=this,T=k.getAnchor(),e=k.getWidth(),h=k.getHeight(),l=-e*T.x-f,N=-h*T.y-o,j=e+2*f,K=h+2*o;if(W)return[{x:l,y:N},{x:l,y:0},{x:l,y:N+K},{x:0,y:N+K},{x:l+j,y:N+K},{x:l+j,y:0},{x:l+j,y:N},{x:0,y:N}];var X=k.getMatrix();return[X.tf(l,N),X.tf(l,0),X.tf(l,N+K),X.tf(0,N+K),X.tf(l+j,N+K),X.tf(l+j,0),X.tf(l+j,N),X.tf(0,N)]},rotateAt:function(l,b,B){var f=this,H=f._position,d=f._64O,D=new ye(d,H.x,H.y).tf(l,b),$=_(l*l+b*b),i=N(H.y-D.y,H.x-D.x)+B;f.setRotation(d+B),f.p(D.x+$*k(i),D.y+$*L(i))},onParentChanged:function(){Uh.superClass.onParentChanged.apply(this,arguments),this._8I()},onPropertyChanged:function(){var D={};return"width|height|position|anchor|rotation|scale|s:layout.h|s:layout.v".split("|").forEach(function(U){D[U]=!0}),function(C){var E=this;Uh.superClass.onPropertyChanged.call(E,C),D[C.property]&&!E._layoutUpdating&&E.updateLayoutParameters(null,C.property),E._69O&&E._69O.each(function(X){X.handleHostPropertyChange(C)}),E._49I&&E._49I.each(function(x){x.fp("agentChange",!0,!1)})}}(),onHostChanged:function(){this.updateAttach(),this.updateLayoutParameters()},handleHostPropertyChange:function(y){this.updateAttach(y)},onStyleChanged:function(A){Uh.superClass.onStyleChanged.apply(this,arguments),eo[A]&&this.updateAttach()},updateAttach:function(b){var z=this;return Me?(z.updateLayoutParameters(),void 0):(z._51I||(z._51I=1,z._71O(b),delete z._51I),void 0)},_71O:function(n){var U,j,V,k,E,r,c=this,w=c._host,h=n?n.property:S,y=n?n.oldValue:S,l=n?n.newValue:S;if(w instanceof W.Grid){if(h===mi)c.setElevation(c._54O+l-y);else if(!n||xj[h]){if(U=c.s("attach.row.index"),j=c.s("attach.column.index"),V=w.getCellRect(U,j),!V)return;k=c.s("attach.row.span"),E=c.s("attach.column.span"),(1!==k||1!==E)&&(V=Vg(V,w.getCellRect(U+k-1,j+E-1))),pb(V,c,"attach.padding",1),c.setRect(V)}}else if(w instanceof Hj&&(r=c.s("attach.index"))>=0&&(!n||Wb[h])){var R=c.s("attach.thickness");R!=S&&c.setHeight(w.getThickness()*R);var s=c.s("attach.offset"),m=w.getPoints(),C=m.size();if(C>r){var b=m.get(r),H=C===r+1?m.get(0):m.get(r+1),D=[H.x-b.x,H.y-b.y],O=zq(D);if(O){c.s("attach.offset.relative")&&(s*=O),c.s("attach.offset.opposite")&&(s=O-s);var f={x:b.x+D[0]/O*s,y:b.y+D[1]/O*s},_=c.s("attach.gap");_&&(c.s("attach.gap.relative")&&(_*=w.getThickness()),f=no(S,f,H,_)),c.p(f),c.setRotation(N(D[1],D[0]))}}}else n&&(h===Sp?c.translate(l.x-y.x,l.y-y.y):h===mi?c.setElevation(c._54O+l-y):sb[h]?c._11Q(w,h,l-y):("anchor"===h||"width"===h||"height"===h||"scale"===h)&&c.layout(w))},_11Q:function(){var u=new W.Math.Euler,p=W.Math.Euler.ReverseOrder,V=new W.Math.Vector2,q=new W.Math.Vector2;return function(v,x,L){var Y=this,s=v.p3(),r=v.r3(),o=Y.p3(),d=Y.r3();if(x===Pm&&(x="rotationY",L=-L),(x===Pm||"rotationY"===x)&&0===d[0]&&0===d[2]&&0===r[0]&&0===r[2]&&0===o[1]&&0===s[1])return Y.setRotation(-d[1]-L),V.set(o[0],o[2]).rotateAround(q.set(s[0],s[2]),-L),Y.p(V.x,V.y),void 0;var W=Eq[v.getRotationMode()],H=W[0],K=W[1],M=W[2],k=qm[H],F=qm[K],t=qm[M],n=Xc();x===Pm+H?(t(n,r[El[M]]),F(n,r[El[K]]),k(n,L),F(n,-r[El[K]]),t(n,-r[El[M]])):x===Pm+K?(t(n,r[El[M]]),F(n,L),t(n,-r[El[M]])):x===Pm+M&&t(n,L);var e=$b(o,s);Yp(e,n),Y.p3(s[0]+e[0],s[1]+e[1],s[2]+e[2]);var i=Y.getRotationMode();Lp(n,Y.r3(),i),u.setFromRotationMatrix(n,p(i)),Y.r3([u.x,u.y,u.z])}}(),isHostOn:function(o){var w=this;if(w._host&&o&&o._69O)for(var Z={},a=w._host;a&&a!==w&&!Z[a._id];){if(a===o)return!0;Z[a._id]=a,a=a._host}return!1},isLoopedHostOn:function(x){return this.isHostOn(x)&&x.isHostOn(this)},getScaledSize:function(){var I=this.getSize(),N=this.getScale();return I.width*=Math.abs(N.x),I.height*=Math.abs(N.y),I},layout:function(z){if(z=z||this.getHost()){var y=this,Q=y.s("layout.h")||"center",n=y.s("layout.v")||"center";if("center"!==Q||"center"!==n){var E=new W.Math.Vector2,b=z.getPosition(),f=z.getAnchor(),G=z.getScaledSize();y.getPosition();var p,l,U,V,P,L=1,N=1;switch(y._layoutUpdating=!0,Q){case"left":E.setX(y._layoutHValue-f.x*G.width);break;case"right":E.setX((1-f.x)*G.width-y._layoutHValue);break;case"leftright":p=G.width-y._layoutHValue[2],U=y.getRotation()-z.getRotation(),V=Math.abs(Math.sin(U)),P=Math.abs(Math.cos(U)),L+=P*p/y._layoutHValue[3],N+=V*p/y._layoutHValue[4],E.setX(y._layoutHValue[1]+(y._layoutHValue[5]-f.x)*G.width);break;case"center":E.setX((.5-f.x)*G.width-y._layoutHValue);break;case"scale":U=y.getRotation()-z.getRotation(),V=Math.abs(Math.sin(U)),P=Math.abs(Math.cos(U)),E.setX((.5-f.x)*G.width-y._layoutHValue[1]*G.width/y._layoutHValue[0]),l=G.width/y._layoutHValue[2]-1,L+=P*l,N+=V*l}switch(n){case"top":E.setY(y._layoutVValue-f.y*G.height);break;case"bottom":E.setY((1-f.y)*G.height-y._layoutVValue);break;case"topbottom":U||(U=y.getRotation()-z.getRotation(),V=Math.abs(Math.sin(U)),P=Math.abs(Math.cos(U))),p=G.height-y._layoutVValue[2],L+=V*p/y._layoutVValue[3],N+=P*p/y._layoutVValue[4],E.setY(y._layoutVValue[1]+(y._layoutVValue[5]-f.y)*G.height);break;case"center":E.setY((.5-f.y)*G.height-y._layoutVValue);break;case"scale":U||(U=y.getRotation()-z.getRotation(),V=Math.abs(Math.sin(U)),P=Math.abs(Math.cos(U))),E.setY((.5-f.y)*G.height-y._layoutVValue[1]*G.height/y._layoutVValue[0]),l=G.height/y._layoutVValue[2]-1,L+=V*l,N+=P*l}if("leftright"===Q||"scale"===Q||"topbottom"===n||"scale"===n){var r=this.getScale(),$=Math.abs(r.x),u=Math.abs(r.y);"leftright"===Q||"scale"===Q?y.setSize(y._layoutHValue[3]*L/$,y._layoutHValue[4]*N/u):y.setSize(y._layoutVValue[3]*L/$,y._layoutVValue[4]*N/u)}E.rotateAround(null,z.getRotation()),this.setPosition(E.x+b.x,E.y+b.y),y._layoutUpdating=d}}},updateLayoutParameters:function(k,e){if(k=k||this.getHost()){var m=this,L=m.s("layout.h"),F=m.s("layout.v");if(L||F){var $,J,w,M,y,h,z=new W.Math.Vector2,K=k.getPosition(),G=k.getAnchor(),V=k.getScaledSize(),c=m.getPosition(),q=m.getScaledSize();switch(z.set(c.x-K.x,c.y-K.y),z.rotateAround(null,-k.getRotation()),L){case"left":m._layoutHValue=z.x+G.x*V.width;break;case"right":m._layoutHValue=-z.x+(1-G.x)*V.width;break;case"center":m._layoutHValue=-z.x+(.5-G.x)*V.width;break;case"leftright":case"scale":"scale"===L?$=-z.x+(.5-G.x)*V.width:(J=m.getAnchor(),w=m.getRotation()-k.getRotation(),M=Math.cos(w),y=Math.sin(w),h=-Math.min(-J.x*M+J.y*y,-J.x*M-(1-J.y)*y,(1-J.x)*M+J.y*y,(1-J.x)*M-(1-J.y)*y),$=z.x-(h-G.x)*V.width),"position"===e&&"object"==typeof m._layoutHValue?(m._layoutHValue[0]=V.width,m._layoutHValue[1]=$):m._layoutHValue=[V.width,$,V.width,q.width,q.height,h]}switch(F){case"top":m._layoutVValue=z.y+G.y*V.height;break;case"bottom":m._layoutVValue=-z.y+(1-G.y)*V.height;break;case"center":m._layoutVValue=-z.y+(.5-G.y)*V.height;break;case"topbottom":case"scale":"scale"===F?$=-z.y+(.5-G.y)*V.height:(w||(J=m.getAnchor(),w=m.getRotation()-k.getRotation(),M=Math.cos(w),y=Math.sin(w)),h=-Math.min(-J.x*y-J.y*M,-J.x*y+(1-J.y)*M,(1-J.x)*y-J.y*M,(1-J.x)*y+(1-J.y)*M),$=z.y-(h-G.y)*V.height),"position"===e&&"object"==typeof m._layoutVValue?(m._layoutVValue[0]=V.height,m._layoutVValue[1]=$):m._layoutVValue=[V.height,$,V.height,q.width,q.height,h]}}}},getSerializableProperties:function(){var O=Uh.superClass.getSerializableProperties.call(this);return uj(O,{image:1,host:1,rotation:1,rotationX:1,rotationZ:1,rotationMode:1,position:1,anchor:1,anchorElevation:1,scale:1,scaleTall:1,_width:1,_height:1,_tall:1,elevation:1}),O}});var Ah=W.Edge=function(k,d){var i=this;Lk(Ah,i),i.setSource(k),i.setTarget(d)};Xp("Edge",Pp,{ms_edge:!0,_icon:"edge_icon",getUIClass:function(){return um},_22Q:function(){return Si},getSource:function(){return this._source},getTarget:function(){return this._target},getSourceAgent:function(){return this._40I},getTargetAgent:function(){return this._41I},canSetSourceTarget:function($){if($===this)return!1;if(zm($))return!0;for(var X,P,h,J,v,V=[this],M=-1,Y=0;Y>M;)if(M++,X=V[M],P=X._44I)for(P=P.getArray(),J=0,v=P.length;v>J;J++)if(h=P[J],Pe(h)&&!(V.indexOf(h)>=0)){if(h===$)return!1;V.push(h),Y++}return!0},setSource:function(I){var d=this;if(d._source!==I&&d.canSetSourceTarget(I)){var s=d._source;d._source=I,s&&s._16I(d),I&&I._2I(d),d._7I(),d.fp("source",s,I)}},setTarget:function(N){var n=this;if(n._target!==N&&n.canSetSourceTarget(N)){var h=n._target;n._target=N,h&&h._18I(n),N&&N._4I(n),n._7I(),n.fp("target",h,N)}},isLooped:function(){var l=this;return l._source===l._target&&zm(l._source)&&zm(l._target)},onPropertyChanged:function(){var v=this;v._49I&&v._49I.each(function(E){E.fp("agentChange",!0,!1)})},_7I:function(){var O,t=this,X=Hk(t);t._40I!==X&&(O=this._40I,O&&O._15I(t),t._40I=X,X&&X._1I(t),t.fp("sourceAgent",O,X),Pj(O,t._41I),Pj(X,t._41I));var U=Kd(t);t._41I!==U&&(O=t._41I,O&&O._17I(t),t._41I=U,U&&U._3I(t),t.fp("targetAgent",O,U),Pj(O,t._40I),Pj(U,t._40I))},_22I:function(A){this._52I=A,this.fp("edgeGroup",!0,!1)},getEdgeGroup:function(){return this._52I},isEdgeGroupHidden:function(){var F=this;return F._52I&&F._52I.get(0)!==F&&!F.getStyle(Vn)},getEdgeGroupSize:function(){return this._52I?this._52I.size():1},getEdgeGroupIndex:function(){return this._52I?this._52I.indexOf(this):0},isEdgeGroupAgent:function(){var V=this,K=V._52I;return K&&!V.getStyle(Vn)&&K.size()>1&&V===K.get(0)},toggle:function(){var o=this._52I,s=!this.s(Vn);o&&o.size()>1&&(o.each(function(M){M.s(Vn,s)}),o.getSiblings().each(function(f){f!==o&&f.each(function(p){p.fp("edgeGroup",S,f)})}))},setStyle:function(y,B){(y===Ab||"edge.segments"===y)&&(B=jm(B)),Ah.superClass.setStyle.call(this,y,B)},onStyleChanged:function(A){Ah.superClass.onStyleChanged.apply(this,arguments),wb[A]&&Pj(this._41I,this._40I)},getSerializableProperties:function(){var i=Ah.superClass.getSerializableProperties.call(this);return uj(i,{source:1,target:1}),i}});var Bd=W.Group=function(){Lk(Bd,this)};Xp("Group",Uh,{_image:"group_image",_icon:"group_icon",_57O:!1,getUIClass:function(){return vs},onChildAdded:function(){Bd.superClass.onChildAdded.apply(this,arguments),this._81I()},onChildRemoved:function(){Bd.superClass.onChildRemoved.apply(this,arguments),this._81I()},_81I:function(){var _=this;if(!_._54I&&!Me){var W=_.getChildrenRect();W&&(_._53I=1,_.p(_l(_.s("group.position"),W,_.getSize())),delete _._53I)}},getChildrenRect:function(){var p,t=this;return t.eachChild(function(v){zm(v)&&(p=Vg(p,t.getChildRect(v)))}),p},getChildRect:function(v){var G;return zm(v)&&v.s(cg)&&(Ud(v)&&v.isExpanded()&&v.eachChild(function(Z){G=Vg(G,v.getChildRect(Z))}),!G&&v.getRect&&(G=v.getRect())),G},setPosition:function(C,X){var Y=this;if(!Y._54I){var L;L=2===arguments.length?{x:C,y:X}:C,Me||Y._53I||(Y._54I=1,Bc(Y._children,L.x-Y._position.x,L.y-Y._position.y),delete Y._54I),Bd.superClass.setPosition.call(this,L)}},toggle:function(){this.setExpanded(!this.isExpanded())},isExpanded:function(){return this._57O},setExpanded:function(M){var l=this;if(l._57O!==M){var Y=l._57O;l._57O=M,l.fp("expanded",Y,l._57O),l._fireInvalidateDeep(),l._8I()}},_fireInvalidateDeep:function(){this.eachChild(function(w){Ud(w)?w._fireInvalidateDeep():w.iv()})},_8I:function(){Bd.superClass._8I.call(this),this.eachChild(function(i){zm(i)&&i._8I()})},onStyleChanged:function(x){Bd.superClass.onStyleChanged.apply(this,arguments),"group.position"===x&&this._81I()},getSerializableProperties:function(){var r=Bd.superClass.getSerializableProperties.call(this);return r.expanded=1,r}});var Cc=W.Block=function(){Lk(Cc,this)};Xp("Block",Uh,{_icon:"block_icon",_clickThroughEnabled:!1,_syncSize:!0,ms_ac:["clickThroughEnabled","syncSize"],getUIClass:function(){return mc},onChildAdded:function(){Cc.superClass.onChildAdded.apply(this,arguments),this.updateFromChildren()},onChildRemoved:function(){Cc.superClass.onChildRemoved.apply(this,arguments),this.updateFromChildren()},updateFromChildren:function(){var f=this;if(!Me&&!f._updatingToChildren&&f._syncSize&&!f._freezeSyncFromChildren){var H,s,Z,m,y,i=[],z=f.getRotation();if(f.eachChild(function(T){zm(T)&&i.push.apply(i,T.getCorners())}),i.length){f._updatingFromChildren=1;var r=k(-z),U=L(-z),D=1/0,v=-1/0,K=1/0,B=-1/0;for(m=0,y=i.length;y>m;m++)Z=i[m],H=Z.x,s=Z.y,Z.x=r*H-U*s,Z.y=U*H+r*s,D=o(D,Z.x),v=V(v,Z.x),K=o(K,Z.y),B=V(B,Z.y);var F=f.getScale();f.setSize(M((v-D)/F.x),M((B-K)/F.y));var h;F.x<0&&(h=D,D=v,v=h),F.y<0&&(h=K,K=B,B=h),r=k(z),U=L(z);var w=f.getAnchor();H=D+(v-D)*w.x,s=K+(B-K)*w.y,f.setPosition(r*H-U*s,U*H+r*s),delete f._updatingFromChildren}}},setPosition:function(v,b){var m=this;if(!m._updatingToChildren){var C;C=2===arguments.length?{x:v,y:b}:v,Me||m._updatingFromChildren||(m._updatingToChildren=1,Bc(m._children,C.x-m._position.x,C.y-m._position.y),delete m._updatingToChildren),Cc.superClass.setPosition.call(this,C)}},setWidth:function(F){return this.setSize(F,this.getHeight())},setHeight:function(p){return this.setSize(this.getWidth(),p)},setSize:function(b,k){1>b&&(b=1),1>k&&(k=1);var U=this;if(!U._updatingToChildren){2!==arguments.length&&(k=b.height,b=b.width);var D=U.getWidth(),t=U.getHeight();if(b!==D&&Cc.superClass.setWidth.call(U,b),k!==t&&Cc.superClass.setHeight.call(U,k),!Me&&!U._updatingFromChildren){U._updatingToChildren=1;var O=b/D,L=k/t;U._adjustChildScaleOrSize(O,L,"size"),delete U._updatingToChildren,U.updateFromChildren()}}},_adjustChildScaleOrSize:function(U,s,M){var J=this;if(J._syncSize){var o=J.getPosition(),f=J.getRotation();J.getScale(),J.eachChild(function(C){if(zm(C)){var h=C.getPosition(),p=C.getRotation(),w=C.getWidth(),K=C.getHeight(),H=C.getScale(),u=H.x*w,O=H.y*K,B=new ye(p,h.x,h.y,u,O);B.translate(-o.x,-o.y),B.rotate(-f),p=N(B.b*Math.sign(u),B.a*Math.sign(u)),B.scale(U,s);var q,r,b,Q=k(p);if(Math.abs(Q)<.001?(q=L(p),r=B.b/q,b=-B.c/q):(r=B.a/Q,b=B.d/Q),"scale"===M)C.setScale(r/w,b/K);else if("size"===M){var T=r/H.x,y=b/H.y;C.setScale(pd(r)*Math.abs(H.x),pd(b)*Math.abs(H.y)),C instanceof W.Shape?(C.setWidthForce(Math.max(Math.abs(T),1e-5)),C.setHeightForce(Math.max(Math.abs(y),1e-5))):C.setSize(Math.max(.01,Math.abs(T)),Math.max(.01,Math.abs(y)))}B.rotate(f),B.translate(o.x,o.y),C.setPosition(B.tx,B.ty)}})}},_calcChangeFactor:function(S,n,T,g){var h,k,L,i;return h=M(S),k=M(T),L=h>k?h/k:k/h,h=M(n),k=M(g),i=h>k?h/k:k/h,V(L,i)},setAnchor:function(){var s=this;if(!s._updatingToChildren){var $=s.getAnchor();if(Cc.superClass.setAnchor.apply(s,arguments),!Me&&!s._updatingFromChildren&&s._syncSize){s._updatingToChildren=1;var R=s.getAnchor();s.getPosition();var E=s.getSize(),Y=s.getScale(),m=s.getRotation(),C=-E.width*Y.x*($.x-R.x),T=-E.height*Y.y*($.y-R.y),U=L(m),b=k(m),j=b*C-U*T,p=U*C+b*T;s.eachChild(function(f){if(zm(f)){var q=f.getPosition();f.setPosition(q.x-j,q.y-p)}}),delete s._updatingToChildren}}},setRotation:function(k){var B=this;if(!B._updatingToChildren){var s=B.getRotation();if(Cc.superClass.setRotation.apply(B,arguments),!Me&&!B._updatingFromChildren){B._updatingToChildren=1;var h=B.getPosition(),i=k-s;B.eachChild(function(X){if(zm(X)){var T=X.getMatrix();T.translate(-h.x,-h.y),T.rotate(i),T.translate(h.x,h.y);var z=Math.sign(X.getScale().x);X.setRotation(N(T.b*z,T.a*z)),X.setPosition(T.tx,T.ty)}}),delete B._updatingToChildren}}},setScale:function(A,l){var W=this;if(!W._updatingToChildren){null==l&&(l=A.y,A=A.x);var S=W.getScale();if(M(A)<.01&&(A=.01*(pd(A)||pd(S.x))),M(l)<.01&&(l=.01*(pd(l)||pd(S.y))),Cc.superClass.setScale.call(W,A,l),!Me&&!W._updatingFromChildren){W._updatingToChildren=1;var o=A/S.x,a=l/S.y;W._adjustChildScaleOrSize(o,a,"size"),delete W._updatingToChildren,W.updateFromChildren()}}},getSerializableProperties:function(){var R=Cc.superClass.getSerializableProperties.call(this);return R.clickThroughEnabled=1,R.syncSize=1,R}});var Xk=W.Grid=function(){Lk(W.Grid,this)};Xp("Grid",Uh,{IRotatable:!1,_icon:"grid_icon",_image:S,getUIClass:function(){return Uj},setRotation:function(){},getCellRect:function(N,R){var o=this,z=o.s("grid.row.count"),l=o.s("grid.column.count");if(0>=z||0>=l||0>N||N>=z||0>R||R>=l)return S;var u,p,s,U=o.getRect(),k=o.s("grid.row.percents"),a=o.s("grid.column.percents");if(pb(U,o,"grid.border",-1),k&&k._as&&(k=k._as),a&&a._as&&(a=a._as),k&&k.length===z){for(s=0,u=0;N>u;u++)s+=U.height*k[u];U.y+=s,U.height=U.height*k[N]}else U.height=U.height/z,U.y+=U.height*N;if(a&&a.length===l){for(p=0,u=0;R>u;u++)p+=U.width*a[u];U.x+=p,U.width=U.width*a[R]}else U.width=U.width/l,U.x+=U.width*R;return Vo(U,-o.s("grid.gap")),U}});var Yf=W.Text=function(){Lk(Yf,this),this.setSize(100,50),this.s("text","TEXT")};Xp("Text",Uh,{_icon:"text_icon",_image:"__text__",getUIClass:function(){return Uk},setWidth:function(h){h||(h=.001),Yf.superClass.setWidth.call(this,h)},setHeight:function(A){A||(A=.001),Yf.superClass.setHeight.call(this,A)},toLabel:function(){return this._displayName||this._name||this.s("text")}}),oc("__text__",{width:{value:100,isSafeFunc:!0,func:function(o){return o._width}},height:{value:50,isSafeFunc:!0,func:function(F){return F._height}},comps:[{type:"text",relative:!0,rect:[0,0,1,1],text:{func:"style@text"},align:{func:"style@text.align"},vAlign:{func:"style@text.vAlign"},color:{func:"style@text.color"},font:{func:"style@text.font"},shadow:{func:"style@text.shadow"},shadowColor:{func:"style@text.shadow.color"},shadowBlur:{func:"style@text.shadow.blur"},shadowOffsetX:{func:"style@text.shadow.offset.x"},shadowOffsetY:{func:"style@text.shadow.offset.y"},scaleX:{func:"style@text.scale.x"},scaleY:{func:"style@text.scale.y"}}]});var Hj=W.Shape=function(){Lk(Hj,this),this._59O=new Kf};Hj.__de__=jr,Xp("Shape",Uh,{ms_ac:["thickness","closePath"],_icon:"shape_icon",_thickness:10,_closePath:!1,getUIClass:function(){return Fd},_22Q:function(){return cn},getLength:function(R){return qs(ge(this._59O,this._58O,R,this._closePath))},getSegments:function(){return this._58O},toSegments:function(){var F=this._58O;return F?new Kf(F._as.slice(0)):F},setSegments:function(T){var V=this._58O;T=T?En(T)?new Kf(T.slice(0)):new Kf(T._as.slice(0)):null,(V&&T&&V._as.join(",")!==T._as.join(",")||V!==T)&&(this._58O=T,this.fp("segments",V,T))},getPoints:function(){return this._59O},toPoints:function(){var S=this._59O;return new Kf(S._as.slice(0))},setPoints:function(C,S){var R=this,v=R._59O;C=C?En(C)?new Kf(C.slice(0)):new Kf(C._as.slice(0)):new Kf;var d,n,L,Z,F,J;S&&(d=R.getPosition(),J=new ye(R.getRotation(),0,0,R.getScale().x,R.getScale().y)),(v&&C&&v._as.join(",")!==C._as.join(",")||v!==C)&&(R._59O=C,R.fs(),R.fp("points",v,C)),S&&(n=R.getPosition(),L=n.x-d.x,Z=n.y-d.y,F=J.tf(L,Z),R.setPosition(n.x-L+F.x,n.y-Z+F.y))},addPoint:function(r,K,u){var o=this.toPoints();o.add(r,K),this.setPoints(o,u)},setPoint:function(e,t,p){var Z=this.toPoints();Z.set(e,t),this.setPoints(Z,p)},removePointAt:function(r){var e=this.toPoints();e.removeAt(r),this.setPoints(e)},setWidthForce:function(e){var I=this;if(!I._55I&&!Me&&I.getWidth()){I._55I=1;var Z=I._position.x,R=e/I.getWidth(),m=I.toPoints(),Q=new Kf;m.each(function($){Q.add({x:($.x-Z)*R+Z,y:$.y,e:$.e})}),I.setPoints(Q),Tq(I,[R,0,0,1,Z*(1-R),0]),I.fs(),delete I._55I}Hj.superClass.setWidth.call(I,e)},setWidth:function(g){return this.setWidthForce(1>g?1:g)},setHeightForce:function(c){var L=this;if(!L._55I&&!Me&&L.getHeight()){L._55I=1;var h=L._position.y,O=c/L.getHeight(),Q=L.toPoints(),Z=new Kf;Q.each(function(D){Z.add({x:D.x,y:(D.y-h)*O+h,e:D.e})}),L.setPoints(Z),Tq(L,[1,0,0,O,0,h*(1-O)]),L.fs(),delete L._55I}Hj.superClass.setHeight.call(L,c)},setHeight:function(v){return this.setHeightForce(1>v?1:v)},setAnchorElevation:function(I){var D=this;D._55I=!0;var B=D._updatingAnchor3d,M=!Me&&!B;if(M){var L,j=I,z=D.getAnchorElevation(),C=D.getTall();L=C*(z-j),D.shiftPointsElevation(L)}var v=Hj.superClass.setAnchorElevation.apply(D,arguments);return B||delete D._55I,v},getShapeElevation:function(){var q=this,n=q._54O;return n-(q.getTall()||0)*(q._anchorElevation-.5)},setAnchor3d:function(s,w,O,d){var x,X=this;"number"==typeof s?x={x:s,y:w,z:O}:(x=s.length?{x:s[0],y:s[1],z:s[2]}:s,d=w),X._55I=!0,X._updatingAnchor3d=!0;
var L=X.getDataModel();if(L&&L.beginTransaction(),!Me){var q=X.getAnchor3d(),J=X.getSize(),g=X.getTall(),E=J.width*(q.x-x.x),j=J.height*(q.z-x.z),e=g*(q.y-x.y);d||X.shiftPoints(E,j,e);var N=X.p3()}var U=Hj.superClass.setAnchor3d.apply(X,arguments);if(!Me&&d){var B=X.p3();X.shiftPoints(B[0]-N[0]+E,B[2]-N[2]+j,B[1]-N[1]+e)}return L&&L.endTransaction(),delete X._updatingAnchor3d,delete X._55I,U},setAnchor:function(E,N,T){var x=this;x._55I=!0;var S=x._updatingAnchor3d,q=!Me&&!S;if(q){var D,r,U;"number"==typeof E?U={x:E,y:N}:(U=E.length?{x:E[0],y:E[1]}:E,T=N);var u=x.getAnchor(),L=x.getSize();D=L.width*(u.x-U.x),r=L.height*(u.y-U.y),T||x.shiftPoints(D,r);var c=x.getPosition()}var f=Hj.superClass.setAnchor.apply(x,arguments);if(q){var X=x.getPosition();T&&x.shiftPoints(X.x-c.x+D,X.y-c.y+r)}return S||delete x._55I,f},shiftPoints:function(V,w,H){var M=this,s=M.getElevation()||0,k=M.toPoints(),q=new Kf;k.each(function(W){var K=W.e;H&&(K=(K==S?s:K)+H),q.add({x:W.x+V,y:W.y+w,e:K})}),M.setPoints(q),M.fs()},shiftPointsElevation:function(y){return this.shiftPoints(0,0,y)},setPosition:function(U,C){var u,l=this;if(!l._28Q){if(l._28Q=1,!l._55I&&!Me){u=2===arguments.length?{x:U,y:C}:U;var P=u.x-l._position.x,H=u.y-l._position.y;if(0===P&&0===H)return delete l._28Q,void 0;l._55I=1,l.shiftPoints(P,H),Tq(l,[1,0,0,1,P,H]),delete l._55I}Hj.superClass.setPosition.apply(l,arguments),delete l._28Q}},fs:function(){this.fireShapeChange()},_70I:function(){var W=this;if(2!==W._59O.size())return!1;var H=W._58O;return H?2===H.size()&&1===H.get(0)&&2===H.get(1)?!0:!1:!0},fireShapeChange:function(){var p=this;if(!p._55I&&!Me){var T=Mn(p._59O);T&&(p._55I=1,p.setRect(T),delete p._55I)}p.fp(Jr,!1,!0)},getSerializableProperties:function(){var p=Hj.superClass.getSerializableProperties.call(this);return p.segments=1,p.points=1,p.thickness=1,p.closePath=1,p}});var lo=W.Polyline=function(){Lk(lo,this),this.s({"shape.background":null,"shape.border.width":2})};Xp("Polyline",Hj,{_icon:"polyline_icon",_22Q:function(){return Gr},getUIClass:function(){return Bn},setClosePath:function(){},setTall:function(x){var N=this;if(!N._55I&&!N._24Q&&!Me&&N.getTall()){N._24Q=1;var H=N._54O,a=x/N.getTall();N._59O.each(function(r){r.e=r.e==S?H:(r.e-H)*a+H}),N.fs(),delete N._24Q}lo.superClass.setTall.call(N,x)},setElevation:function(H){var z=this;if(!z._55I&&!z._24Q&&!Me){z._24Q=1;var P=H-z._54O;z._59O.each(function(u){u.e==S?u.e=H:u.e+=P}),z.fs(),delete z._24Q}lo.superClass.setElevation.apply(z,arguments)},fireShapeChange:function(){var Q=this,b=Q._59O;if(!Q._55I&&!Q._24Q&&!Me){var $=b.size();if($){var M=1,j=b.get(0),J=Q._54O;j.e==S&&(j.e=J);for(var u=j.e,a=0;$>M;M++){j=b.get(M),j.e==S&&(j.e=J);var l=o(u,j.e),g=V(u+a,j.e);u=l,a=g-l}Q._24Q=1,Q.setTall(a),Q.setElevation(u+a*Q._anchorElevation),delete Q._24Q}}lo.superClass.fireShapeChange.apply(Q,arguments)}});var nd=W.SubGraph=function(){Lk(nd,this)};Xp("SubGraph",Uh,{ISubGraph:1,_image:"subGraph_image",_icon:"subGraph_icon",_8I:function(){nd.superClass._8I.call(this),this.eachChild(function(C){zm(C)&&C._8I()})}}),X.loadingRefGraph=0;var ep=W.RefGraph=function(){Lk(ep,this)};Xp("RefGraph",Cc,{_icon:"refGraph_icon",getRef:function(){return this._ref},setRef:function(A){var O=this._ref;this._ref=A,this.fp("ref",O,A),this.updateRef()},_21I:function(){ep.superClass._21I.apply(this,arguments),this.updateRef()},updateRef:function(){var h=this;if(X.loadingRefGraph++,h.clearChildrenFromDataModel(),X.loadingRefGraph--,h._ref&&h._dataModel){h._xhrLoadHandler&&(h._xhrLoadHandler.cancel=!0);var G=Me,U=h._xhrLoadHandler=function(r){if(r&&h._dataModel){X.loadingRefGraph++;var e=h._pendingUpdateInfo={needToRestore:G};G&&(e.position=h.p(),e.width=h.getWidth(),e.height=h.getHeight(),e.rotation=h.getRotation(),e.anchor=h.getAnchor(),e.scale=h.getScale()),h.p(0,0),h.setAnchor(.5,.5),h.setRotation(0),h.setScale(1,1);var k=X.parse(r),A=h._dataModel.deserialize(k,h,{justDatas:!0});A.each(function(R){R._refGraph=h}),h.checkPendingUpdateInfo(),X.loadingRefGraph--,X.handleRefGraphLoaded(h,A,k)}};U.xhrLoadCalled=!1,X.load(h._ref,function(Y){U.cancel||(U.xhrLoadCalled?U(Y):dk(function(){U(Y)}))}),U.xhrLoadCalled=!0}},checkPendingUpdateInfo:function(){var D=this,$=D._pendingUpdateInfo;if(!$)return D.onPendingUpdated&&(X.loadingRefGraph++,D.onPendingUpdated(),X.loadingRefGraph--),void 0;var e=!0;this.eachChild(function(g){(g._pendingCheckImageJSON||g._pendingUpdateInfo)&&(e=!1)}),e&&(X.loadingRefGraph++,D._pendingUpdateInfo=null,D.updateFromChildren(),$.needToRestore&&(D.setSize($.width,$.height),D.setAnchor($.anchor),D.setRotation($.rotation),D.setScale($.scale),D.p($.position)),this.getParent()instanceof ep&&this.getParent().checkPendingUpdateInfo(),D.onPendingUpdated&&D.onPendingUpdated(),X.loadingRefGraph--)},getSerializableProperties:function(){var P=ep.superClass.getSerializableProperties.call(this);return P.ref=1,P}}),W.EdgeGroup=function(o,b){this._70O=o,this._siblings=b;for(var I,Q,T=0,r=o.size(),F=n[Vn];r>T;T++)if(I=o.get(T).getStyle(Vn,!1),I!=S){F=I;break}F==S&&(F=!0);var g=X.edgeGroupAgentFunc;for(g&&(Q=g(o),Q&&Q!==o.get(0)&&(o.remove(Q),o.add(Q,0))),T=0;r>T;T++)o.get(T).s(Vn,F)},Xp("EdgeGroup",G,{getEdges:function(){return this._70O},size:function(){return this._70O.size()},get:function(T){return this._70O.get(T)},indexOf:function(K){return this._70O.indexOf(K)},each:function(u,b){this._70O.each(u,b)},getSiblings:function(){return this._siblings},eachSiblingEdge:function(u,h){this._siblings.each(function(_){_._70O.each(u,h)})}});var ib=function(H,r,V){var i=dh[H]={type:H,action:r};if(V)for(var s in V)i[s]=V[s]};uj(X,{setConnectAction:ib,getConnectAction:function(k,v){if(!v){if(!k)return null;v=k.getCurrentConnectActionType()}return dh[v]},doConnectAction:function(J,$,O,g){g=g||J.getCurrentConnectActionType();var c=dh[g];if(!c)return!1;var u=c.action;return u?($ instanceof Sf.Group?J.sm().getSelection().each(function(b){u.call(null,J,b,O)}):u.call(null,J,$,O),!0):!1},doDeleteConnectionAction:function(u,Z,W){W=W||u.getCurrentConnectActionType();var V=dh[W];if(!V||!V.delete)return!1;var F=V.delete.action;return F?(Z instanceof Sf.Group?u.sm().getSelection().each(function(Q){F.call(null,u,Q)}):F.call(null,u,Z),!0):!1}});var xf=W.JSONSerializer=function(R,k){this.dm=this._dataModel=R,this._hierarchical=X.forceHierarchicalSerialization?!0:k==S?R.isHierarchicalRendering():k};Xp("JSONSerializer",G,{ms_ac:["hierarchical"],serialize:function(A){return X.stringify(this.toJSON(),A)},toJSON:function(){var i=this,p=i.dm,$=p.getRoots(),z=i.json={v:X.getVersion(),p:{},a:{},d:[]},l=p.getSerializableAttrs();p.getInit()&&(z.init=p.getInit()),p.getName()&&(z.p.name=p.getName()),p.getBackground()&&(z.p.background=p.getBackground()),p.getLayers()&&(z.p.layers=p.getLayers()),p.getEnvmap()&&(z.p.envmap=p.getEnvmap()),z.p.autoAdjustIndex=p.isAutoAdjustIndex(),z.p.hierarchicalRendering=p.isHierarchicalRendering();for(var W in l){var J=p.a(W);J!==d&&i[rm](W,J,z.a)}return bm(z.a)&&delete z.a,i._hierarchical?$.each(i.serializeData,this):p.each(function(p){i.serializeData(p)}),p.fireSerializeEvent({type:"serialize",json:z}),p.getPostProcessingData()&&(z.p.postProcessingData=p.getPostProcessingData()),z},isSerializable:function(){return!0},getProperties:function(I){return I.getSerializableProperties()},getStyles:function(m){return m.getSerializableStyles()},getAttrs:function(P){return P.getSerializableAttrs()},serializeData:function(X){var y=this;if(y.isSerializable(X)&&!X._refGraph){var V,z,k,D,G=Lh(X.getClassName())||X.getClass(),R=new G,i={c:X.getClassName(),i:X.getId(),p:{},s:{},a:{}};y.json.d.push(i),V=y.getProperties(X);for(z in V)if(/^_/.test(z)){if(k=X[z],("_width"===z||"_height"===z)&&k===d){var P;((X.s("layout.h")||X.s("layout.v"))&&X.getHost()||X instanceof W.Node&&(P=X.getParent())&&P instanceof W.Block||X.s("fullscreen"))&&(k=X[z]="_width"===z?X.getWidth():X.getHeight())}k!==R[z]&&y[rm](z.substr(1),k,i.p)}else D=lr(z),X[D]&&(k=X[D](),k!==R[D]()&&y[rm](z,k,i.p));V=y.getStyles(X);for(z in V)k=X.s(z),k!==R.s(z)&&y[rm](z,k,i.s);V=y.getAttrs(X);for(z in V)k=X.a(z),k!==R.a(z)&&y[rm](z,k,i.a);bm(i.p)&&delete i.p,bm(i.s)&&delete i.s,bm(i.a)&&delete i.a}y._hierarchical&&X.getChildren().each(y.serializeData,y)},serializeValue:function(h,F,R){dm(F)?F={__a:F._as}:F instanceof Pp&&(F={__i:F.getId()}),R[h]=F},deserialize:function(_,f,n){var G=this;return Gk(_)&&/.json$/.test(_)?(X.xhrLoad(_,function(b){G.deserializeImpl(b,f,n)}),void 0):G.deserializeImpl(_,f,n)},deserializeImpl:function(t,o,k){var d=this,Z=d.dm;k=Uf(k)?{setId:k}:dc(k)?{finishFunc:k}:k||{},t=d.json=Gk(t)?X.parse(t):t,t.a&&t.a.onPreDeserialize&&!k.disableOnPreDeserialize&&t.a.onPreDeserialize(t,Z,k.view),Z.beginTransaction(),Me++,d._82I={};var $=new Kf,V=new Kf,j=0,I=t.d.length;if(k.justDatas||(dc(t.init)&&t.init(Z),Z.setInit(t.init)),!k.justDatas){for(var x in t.a)Z.a(x,d[kc](t.a[x]));for(var E in t.p)Z[gb(E)](t.p[E])}for(;I>j;j++){var F=t.d[j],P=Lh(F.c),B=new P,_=F.i;k.setId&&_!=S&&(B._id=_),d._82I[_]=B,$.add(B),V.add(F)}for(j=0;I>j;j++)d.deserializeData($.get(j),V.get(j));return $.each(function(H){o&&!H.getParent()&&H.setParent(o),Z.add(H)}),Z.fireSerializeEvent({type:"deserialize",json:t}),Me--,Z.endTransaction(),t.a&&t.a.onPostDeserialize&&!k.disableOnPostDeserialize&&t.a.onPostDeserialize(t,Z,k.view,$),k.finishFunc&&k.finishFunc(t,Z,k.view,$),$},deserializeData:function(X,H){for(var D in H.p)X[gb(D)](this[kc](H.p[D]));for(D in H.s)X.s(D,this[kc](H.s[D]));for(D in H.a)X.a(D,this[kc](H.a[D]))},deserializeValue:function(u){if(zn(u)){var D=u.__i;if(D!=S)return this._82I[D];if(D=u.__a,En(D))return new Kf(D)}return u}}),uj(Ag,{serialize:function(B,u){return new xf(this,u).serialize(B)},toJSON:function(C){return new xf(this,C).toJSON()},deserialize:function(g,p,H){return new xf(this).deserialize(g,p,H)}});var eb=W.OverlappingBox=function(B){this.gv=B,this.boxes={}};Xp("OverlappingBox",G,{clear:function(){var V,e,o=this.boxes;for(V in o)e=o[V],e.length=0},isOverlapping:function(Z,C){var r,E,t=this,x=t.boxes,f=x[Z];f?(r=f.rects,E=f.length):f=x[Z]={rects:r=[],length:E=0};var y,B,C;for(y=0;E>y;y++)if(B=r[y],B.x<C.x+C.w&&B.x+B.w>C.x&&B.y<C.y+C.h&&B.h+B.y>C.y)return!0;return r.length<=E?(r.push(C),f.length++):r[f.length++]=C,!1}}),uj(X,{fetch:function(M,g){var L="GET",P=!1,h=null,V="";g&&(L=g.method||"GET",P=g.sync,V=g.url,h=g.data||null),M.open(L,V,!P),g.responseType?M.responseType=g.responseType:g.overrideMimeType&&M.overrideMimeType&&M.overrideMimeType(g.overrideMimeType),M.send(h)},convertImageSrc:function(K,Z){Z&&"function"==typeof Z||(Z=function(){}),Z(K)}});var Gh=W.Request=function(){this._xhr=new XMLHttpRequest,this._onloadFunc=function(){},this._errorFunc=function(){}};Xp("Request",G,{_responseType:null,_overrideMimeType:"text/plain",send:function(V){var Y=this._xhr,S=this.onload,F=this.onerror;this.getResponseType()?V.responseType=this.getResponseType():this.getOverrideMimeType()&&(V.overrideMimeType=this.getOverrideMimeType()),Y.onload=S,Y.onerror=F,X.fetch(Y,V)},onload:function(){},onerror:function(){},getResponseType:function(){return this._responseType},setResponseType:function(R){this._responseType=R},getOverrideMimeType:function(){return this._overrideMimeType},setOverrideMimeType:function(a){this._overrideMimeType=a},getResponseText:function(){var p=this._xhr;return p.response||p.responseText}}),Ee.GraphView=function(O){var w=this;w._24I={},w._34I=new Kf,w._25I={},w._56I={},w._view=Nm(1,w),w._canvas=kr(w._view),w.dm(O?O:new Ag),this._coreInteractor=new Vi(this),w.setEditable(!1),w.setScrollBarVisible(X.graphViewScrollBarVisible)},cs("GraphView",G,{ms_v:1,ms_gv:1,ms_bnb:1,ms_tip:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,_52o:1,_51o:1,ms_ac:[ts,Sn,yf,ke,"resettable","editInteractor",Dm,"zoomable","pannable","rectSelectable","autoScrollZone",jg,"movableFunc","editableFunc","pointEditableFunc","rectEditableFunc","rotationEditableFunc","anchorEditableFunc","rectSelectBackground","rectSelectBorderColor","editPointSize","editPointBorderColor","editPointBackground","hoverDelay"],_zoomable:X.graphViewZoomable,_resettable:X.graphViewResettable,_pannable:X.graphViewPannable,_rectSelectable:X.graphViewRectSelectable,_autoScrollZone:X.graphViewAutoScrollZone,_rectSelectBackground:X.graphViewRectSelectBackground,_rectSelectBorderColor:X.graphViewRectSelectBorderColor,_editPointSize:X.graphViewEditPointSize,_editPointBorderColor:X.graphViewEditPointBorderColor,_editPointBackground:X.graphViewEditPointBackground,_scrollBarColor:el,_scrollBarSize:Cg,_autoHideScrollBar:Cf,_autoMakeVisible:Km,_currentActionType:null,getCoreInteractor:function(){return this._coreInteractor},getLayers:function(){return this._dataModel.getLayers()},setLayers:function(w){this._dataModel.setLayers(w)},setEditable:function(B){var o=this,l=o.__interactorMap__;if(!l){var v=Ee.XEditInteractor;l=o.__interactorMap__={scrollBar:new od(o),select:new Mj(o),edit:v?new v(o):new ui(o),text:new Yg(o),move:new Tl(o),"default":new _k(o),touch:new Ck(o,{editable:!1})}}B?(o._uieditable=!0,o.setInteractors([l.scrollBar,l.select,l.edit,l.text,l.move,l.default,l.touch])):(o._uieditable=!1,o.setInteractors([l.scrollBar,l.select,l.move,l.default,l.touch]))},getCanvas:function(){return this._canvas},_33I:function(h){var P=h.getUIClass();return P?new P(this,h):S},getDataUI:function(r){var y=this,D=y._25I[r._id];return D===d&&(D=y._33I(r),y._25I[r._id]=D),D},getNodeRect:function(T){return X.getNodeRect(this,T)},getFullscreenDatas:function(){return this._dataModel.getFullscreenDatas()},getEdgeInfo:function(Z){var b=this.getDataUI(Z);return b?(b._79o(),b._78o):null},getEdgeSourcePosition:function(k){var n=this,a=n.getDataUI(k),d=a.s,I=a._data._40I;return Yc(n,I,d("edge.source.position"),d("edge.source.offset.x"),d("edge.source.offset.y"),d("edge.source.anchor.x"),d("edge.source.anchor.y"))},getEdgeTargetPosition:function(P){var u=this,K=u.getDataUI(P),d=K.s,J=K._data._41I;return Yc(u,J,d("edge.target.position"),d("edge.target.offset.x"),d("edge.target.offset.y"),d("edge.target.anchor.x"),d("edge.target.anchor.y"))},invalidateAll:function(Q){var A=this;if(Q){for(var F in A._25I){var t=A._25I[F];t&&t.dispose()}A._25I={},A._56I={},A._24I={},A._34I.clear(),A.redraw()}else A.dm().each(function(f){A.invalidateData(f)})},invalidateSelection:function(){var _=this;_.sm().each(function(f){_.invalidateData(f)})},invalidateData:function(n){var o=this;o._24I[n._id]=n,o._21Q(n),o.iv()},_21Q:function(Y){var d=this,m=d._24I;if(Pe(Y)&&Jp[Y.s(ug)]){var U=Y.getSourceAgent();U&&U.getAgentEdges().each(function(N){m[N._id]=N}),U=Y.getTargetAgent(),U&&U.getAgentEdges().each(function(I){m[I._id]=I}),d.iv()}},redraw:function(I){var E=this;E._32I||(I?E._34I.add(I):(E._32I=1,E._34I.clear()),E.iv())},each:function(R,Z){var X,c,m,s=0,z=this.getLayers(),r=this._dataModel,x=r._datas._as,y=x.length;if(z){for(var I=z.length;I>s;s++)if(m=z[s],zn(m)&&(m=m.name),r.isHierarchicalRendering()){var e=function(e){return e._layer===m?Z?R.call(Z,e):R(e):void 0};if(this._dataModel.eachByHierarchical(e)===!1)return}else for(var q=0;y>q;q++)if(X=x[q],X._layer===m&&(c=Z?R.call(Z,X):R(X),c===!1))return}else if(r.isHierarchicalRendering())this._dataModel.eachByHierarchical(R,null,Z);else for(;y>s;s++)if(X=x[s],c=Z?R.call(Z,X):R(X),c===!1)return},reverseEach:function(E,K){var A,O,f,j,L=this._dataModel,s=L._layers,x=L._datas._as,g=x.length;if(s){for(A=s.length-1;A>=0;A--)if(j=s[A],zn(j)&&(j=j.name),L.isHierarchicalRendering()){var R=function(m){return m._layer===j?K?E.call(K,m):E(m):void 0};if(L.reverseEachByHierarchical(R)===!1)return}else for(var k=g-1;k>=0;k--)if(O=x[k],O._layer===j&&(f=K?E.call(K,O):E(O),f===!1))return}else if(L.isHierarchicalRendering())L.reverseEachByHierarchical(E,null,K);else for(A=g-1;A>=0;A--)if(O=x[A],f=K?E.call(K,O):E(O),f===!1)return},getViewRect:function(){return this._29I},getContentRect:function(){var t=this,M=t._84I;if(!M){var a=this.dm().a("width"),Z=this.dm().a("height");a>0&&Z>0?t._84I={x:0,y:0,width:a,height:Z}:(t.each(function(b){t.isVisible(b)&&(M=Vg(M,t.getDataUIBounds(b)))}),t._84I=M?M:No)}return t._84I},getScrollRect:function(){return Vg(this.getContentRect(),this._29I)},makeCenter:function(H,A,W){var e=this;if(!e.getWidth()||!e.getHeight())return W||dk(e.makeCenter,e,[H,A,!0],500),void 0;e.makeVisible(H),e.validate();var h=e.getDataUIBounds(H);if(h){var t=e.getWidth(),P=e.getHeight(),V=h.x+h.width/2,I=h.y+h.height/2,T=-V*e._zoom+t/2,C=-I*e._zoom+P/2;e.setTranslate(T,C,A)}},fitData:function(_,L,C,U,c){var s=this;if(!s.getWidth()||!s.getHeight())return c||dk(s.fitData,s,[_,L,C,U,!0],500),void 0;var J=function(){s.makeVisible(_),s.validate();var Z=s.getDataUIBounds(_);Z&&(Z=or(Z),Vo(Z,C==S?20:C),s.fitRect(Z,L,U))};L?X.callWhenLoaded(J):J()},fitContent:function(r,c,k,m){var N=this;if(!N.getWidth()||!N.getHeight())return m||dk(N.fitContent,N,[r,c,k,!0],500),void 0;var s=function(){N.validate();var g=or(N.getContentRect());Vo(g,c==S?20:c),N.fitRect(g,r,k)};r?X.callWhenLoaded(s):s()},fitRect:function(w,V,S){var I=this,d=I.getWidth(),_=I.getHeight(),i=w.x+w.width/2,K=w.y+w.height/2,A=o(d/w.width,_/w.height),y=I._zoom,z=-i*y+d/2,X=-K*y+_/2;0===A||isNaN(A)||(S&&(A=o(1,A)),V?(I._65I&&(delete I._65I.finishFunc,I._65I.stop(!0)),I._14o&&I._14o.stop(!0),I.setTranslate(z,X,{finishFunc:function(){I.setZoom(A,V)}})):(I.setTranslate(z,X),I.setZoom(A)))},toCanvas:function(m,v){v=v||this._zoom,this.validateImpl();var B=this,S=B.getContentRect();S.width||(S.width=10),S.height||(S.height=10);var M=kr(),A=S.x*v,G=S.y*v,f=S.width*v,x=S.height*v;fp(M,f,x,1);var b=Md(M);return m=m||this._dataModel.getBackground(),m&&Eh(b,0,0,f,x,m),As(b,-A,-G),b.scale(v,v),B._42(b),b.restore(),M},toDataURL:function(Y,a,s){return this.toCanvas(Y,s).toDataURL(a||"image/png",1)},getClipBounds:function(){return this._74O},_42:function(e,i){var R=this,x=R.dm().getBackground();if(x){var d=R.dm().a("width"),P=R.dm().a("height");d>0&&P>0&&Eh(e,0,0,d,P,x)}var O=R.__htmlOrderList,X=[];if(R._93db(e,i),R.each(function(N){var C=R.getDataUI(N);if(C){var Z=R._56I[N._id],o=C._htmlView;if(Z){var m=C._79o();if(o=C._htmlView,W.HtmlNode&&N instanceof W.HtmlNode)C._42(e);else{var S=R.getViewRect(),b=o&&o.layoutHTML;!i||ee(i,m)?(b&&(o.layoutHTML(),C.__outerLayout&&delete C.__outerLayout),C._42(e)):ee(S,m)||!b||C.__outerLayout||(o.layoutHTML(),C.__outerLayout=!0)}}o&&(X.push(o),o.getView&&(o=o.getView()),o.style.display=Z?"block":jf)}}),O&&X.length>0){var L=!1;if(O.length!==X.length)L=!0;else for(var t=0;t<X.length;t++)if(X[t]!==O[t]){L=!0;break}L&&(X.forEach(function(I){I.autoAdjustIndex!==!1&&R.appendHTML(I,!0)}),this.__htmlOrderList=X)}else this.__htmlOrderList=X;R._92db(e,i)},validateImpl:function(){this.tryUpdateRootData();var O,m,x,d,p,N=this,h=N.tx(),b=N.ty(),g=N._zoom,f=N._canvas,G=this.getWidth(),c=this.getHeight(),e=N._29I,n={x:-h/g,y:-b/g,width:G/g,height:c/g},l={},Y=N._34I,z=N._24I,u=N._32I,y=N._23I;N._24I={},(G!==f.clientWidth||c!==f.clientHeight)&&(fp(f,G,c),u=1),u||is(n,e)||(u=1),N._29I=n,N.each(function(v){m=v._id;var E=l[m]=N.isVisible(v);E!==N._56I[m]&&(z[m]=v,x=N.getDataUI(z[m]),x&&x._84o(E),N._84o(v,E))},N);for(m in z)x=N.getDataUI(z[m]),x&&(!u&&N._56I[m]&&(p=x._79o(),p&&Y.add(p)),x.invalidate()),N._83I=1;if(N._56I=l,!u)for(m in z)l[m]&&(x=N.getDataUI(z[m]),x&&(p=x._79o(),p&&Y.add(p)));if(u?d=n:(Y.each(function(J){ee(n,J)&&(d=Vg(d,J))}),d&&(Vo(d,V(1,1/g)),d.x=R(d.x*g)/g,d.y=R(d.y*g)/g,d.width=w(d.width*g)/g,d.height=w(d.height*g)/g,d=dd(n,d))),N._74O=d,d){O=Md(f);var F=d.x,B=d.y,v=d.width,t=d.height;F=Math.floor((F*g+h)*pm),B=Math.floor((B*g+b)*pm),v=Math.ceil(v*g*pm)+1,t=Math.ceil(t*g*pm)+1,O.beginPath(),O.rect(F,B,v,t),O.clip(),O.clearRect(F,B,v,t),hq(O,h,b,g),N._42(O,d),O.restore(),delete N._74O}if(Y.clear(),delete N._32I,y&&G>0&&c>0){var x=N.getDataUI(y);if(x){var p=x._79o(),X=N._29I,A=X.x,H=X.y,J=X.width,j=X.height,g=N._zoom;p&&!ee(p,X)&&(p.x+p.width<A&&N.tx(-p.x*g),p.x>A+J&&N.tx(-(p.x+p.width-J)*g),p.y+p.height<H&&N.ty(-p.y*g),p.y>H+j&&N.ty(-(p.y+p.height-j)*g))}delete N._23I}N._83I&&(delete N._83I,delete N._84I),N._98O(),N.countFrame(),bm(N._24I)||dk(N.iv,N)},isValidGuideLineSource:function(){return!0},tryUpdateRootData:function(){if(!this._rootDataUpdating){this._rootDataUpdating=!0;var o,U=this.getFullscreenDatas();for(var n in U)o=U[n],this.scaleRootData(o);this._rootDataUpdating=!1}},scaleRootData:function(x){var k=x.s("fullscreen");if("uniform"===k||"fill"===k){x.getRotation()&&x.setRotation(0);var U=x.s("fullscreen.gap")||0,w=this.getWidth(),G=this.getHeight();if(w&&G){var $,A,r,L=w-2*U,S=G-2*U,l=x.getAnchor(),f=x.getScaledSize(),Q=f.width,t=f.height,T=x.s("fullscreen.lock");if(T)return"uniform"===k?L/S>Q/t?($=S/t,Q=t*L/S):($=L/Q,t=Q*S/L):"v"===T?($=S/t,Q=L/$,x.getWidth()!==Q&&x.setWidth(Q)):($=L/Q,t=S/$,x.getHeight()!==t&&x.setHeight(t)),this.setZoom($),A=U-(x.getX()-l.x*Q)*$,r=U-(x.getY()-l.y*t)*$,A!==this.tx()&&this.tx(A),r!==this.ty()&&this.ty(r),void 0;A=this.tx(),r=this.ty(),$=this._zoom;var B={x:(-A+U)/$,y:(-r+U)/$,width:L/$,height:S/$};if("uniform"===k){var i=Q/t,W=Math.min(B.width,B.height*i),g=W/i;B.x+=.5*(B.width-W),B.y+=.5*(B.height-g),B.width=W,B.height=g}L=B.width/x.getScaleX(),S=B.height/x.getScaleY(),(x.getWidth()!=L||x.getHeight()!==S)&&x.setSize(L,S);var e=B.x+l.x*B.width,R=B.y+l.y*B.height,d=x.getPosition();(e!==d.x||R!==d.y)&&x.setPosition(e,R)}}},isScrollBarVisible:function(){return!!this._79O},setScrollBarVisible:function(J){var U=this;J!==U.isScrollBarVisible()&&(J?(lc(U._view,U._79O=Zj()),lc(U._79O,U._27I=Zj()),lc(U._79O,U._28I=Zj())):(ws(U._79O),delete U._79O,delete U._27I,delete U._28I),U.fp("scrollBarVisible",!J,J))},getDebugTip:function(){return""},showScrollBar:function(){var G=this;G._79O&&(G._85I||(J(function(){G._86I()},fq),G.iv()),G._85I=new Date)},_86I:function(){var U=this;if(U._85I){var $=new Date,C=$.getTime();C-U._85I.getTime()>=fq?(delete U._85I,U.iv()):J(function(){U._86I()},fq)}},getVScrollBar:function(){return this._27I},getHScrollBar:function(){return this._28I},_98O:function(){var b=this,n=this._27I,l=this._28I;if(b._79O){if(b._autoHideScrollBar&&!b._85I)return n.style.visibility=Ne,l.style.visibility=Ne,void 0;var $=b.getScrollBarColor(),e=b._zoom,t=b.getScrollBarSize(),w=b.getViewRect(),Z=b.getScrollRect(),D=w.height*e,O=Z.height*e,a=w.width*e-t-2,x=D*((w.y-Z.y)*e/O),c=D*(D/O),z=n.style;O-.5>D?(Ed>c&&(x=x+c/2-Ed/2,0>x&&(x=0),x+Ed>D&&(x=D-Ed),c=Ed),Ap(n,a,x,t,c),z.visibility=Qn,z.background=$,z.borderRadius=t/2+wo):z.visibility=Ne;var i=w.width*e,E=Z.width*e,x=w.height*e-t-2,a=i*((w.x-Z.x)*e/E),m=i*(i/E),z=l.style;E-.5>i?(Ed>m&&(a=a+m/2-Ed/2,0>a&&(a=0),a+Ed>i&&(a=i-Ed),m=Ed),Ap(l,a,x,m,t),z.visibility=Qn,z.background=$,z.borderRadius=t/2+wo):z.visibility=Ne}},setDataModel:function(L){var V=this,w=V._dataModel,j=V._selectionModel;w!==L&&(w&&(w.ump(V.handleDataModelPropertyChange,V),w.umm(V.handleDataModelChange,V),w.umd(V.handleDataPropertyChange,V),w.removeIndexChangeListener(V._75O,V),w.removeHierarchyChangeListener(V.handleHierarchyChange,V),j||w.sm().ums(V.handleSelectionChange,V)),V._dataModel=L,L.mp(V.handleDataModelPropertyChange,V),L.mm(V.handleDataModelChange,V),L.md(V.handleDataPropertyChange,V),L.addIndexChangeListener(V._75O,V),L.addHierarchyChangeListener(V.handleHierarchyChange,V),j?j._21I(L):L.sm().ms(V.handleSelectionChange,V),V.invalidateAll(!0),V.fp(Ak,w,L),V.updateBackground())},getLayersInfo:function(){if(this._layersInfo===d){var k=this.getLayers();k?(this._layersInfo={},k.forEach(function(L){var x=zn(L)?L.name:L;this._layersInfo[x]=L},this)):this._layersInfo=null}return this._layersInfo},calculateEdgePosition:function(g,h,Z){var J,q,S=this,x=S.getDataUI(g),M=Hr(x),L=mk(h,function(Z){return Go(M,100*Z)},100,.001),s=Go(M,100*L);if(!Z){var W=Ej(x),j=new Lj(s.x,s.y),y=49/(S._zoom*S._zoom);for(J=0,q=W.length;q>J;J++)if(j.distanceToSquared(W[J])<y)return{index:J,point:W[J],distance:Math.sqrt((W[J].x-h.x)*(W[J].x-h.x)+(W[J].y-h.y)*(W[J].y-h.y))}}return{percent:L,point:s,distance:Math.sqrt((s.x-h.x)*(s.x-h.x)+(s.y-h.y)*(s.y-h.y))}},calculateAttachPoint:function(){var l=new Lj,$=new Lj,j=new Lj;return function(z,E){var Y=this.getAttachPoints(z);if(!Y||!Y.length)return null;j.set(E.x,E.y);for(var D,Q,I,P,A=1/0,o=0,n=Y.length;n>o;o++)I=Y[o],$.x=I.x,$.y=I.y,l.x=I.offsetX||0,l.y=I.offsetY||0,P=Yc(this,z,0,l.x,l.y,$.x,$.y),Q=j.distanceToSquared(P),A>Q&&(D=o,A=Q);A=Math.sqrt(A);var g=this.getAttachStyle(z);if("close"===g){var s=z.s("attach.close.threshold")/this._zoom;if(A>s)return null}return{index:D,distance:A,info:Y[D]}}}(),getAttachPoints:function(o){var s=o.s("attach.points");if(s)return s;var Z=Oi(o._image);return Z?lp(Z.attachPoints,o,this)||null:void 0},getAttachStyle:function(u){var i=u.s("attach.style");if(i)return i;var I=Oi(u._image);return I?lp(I.attachStyle,u,this)||"close":void 0},updateLayers:function(){this._layersInfo=d,this.invalidateSelection(),this.redraw()},updateBackground:function(){var u=this.dm().a("width"),W=this.dm().a("height");this._canvas.style.background=u>0&&W>0?"":this.dm().getBackground()||""},handleDataModelPropertyChange:function(A){if("background"===A.property){var M=this._canvas.style.background,m=A.newValue||"";this.updateBackground(),this.fp("canvasBackground",M,m),this.redraw()}else"a:width"===A.property||"a:height"===A.property?(this._83I=1,this.updateBackground(),this.redraw()):"layers"===A.property?this.updateLayers():"hierarchicalRendering"===A.property&&this.redraw()},handleDataPropertyChange:function(T){this.dm().isHierarchicalRendering()&&"parent"===T.property&&T.data.hasChildren()&&this.redraw(),this.invalidateData(T.data)},onPropertyChanged:function(h){var J=this,o=h.property;if(J.redraw(),"zoom"===o){var m=J.sm().getSelection();m.size()&&m.each(function(C){C.invalidate()})}else"dataModel"===o&&(J._83I=1);_p[o]?J.showScrollBar():o===Dm&&J.onCurrentSubGraphChanged(h)},onCurrentSubGraphChanged:function(){this.sm().cs(),this.reset()},handleDataModelChange:function(Q){var X=this,V=Q.kind,m=Q.data;if(X._83I=1,"add"===V)X.invalidateData(m),Pe(m)&&m.getEdgeGroup()&&m.getEdgeGroup().eachSiblingEdge(X.invalidateData,X);else if(V===li){X._21Q(m);var u=m._id,H=X._25I[u];if(H){if(X._56I[u]){var v=H._79o();v&&X.redraw(v)}H.dispose(),delete X._25I[u],delete X._24I[u],delete X._56I[u]}m===X._currentSubGraph&&X.setCurrentSubGraph(S)}else V===vh&&(X.invalidateAll(!0),X.setCurrentSubGraph(S))},_75O:function(K){this.invalidateData(K.data)},handleHierarchyChange:function(R){this.dm().isHierarchicalRendering()&&R.data.hasChildren()&&this.redraw(),this.invalidateData(R.data)},adjustIndex:function(k){var z=this;if(z.isVisible(k)){z.dm().beginTransaction();for(var n=k;n._parent&&z.isVisible(n._parent);)n=n._parent;n&&n!==k&&z._dataModel.adjustIndex(n),z._dataModel.adjustIndex(k),z.dm().endTransaction()}},getImage:function(l){return l.getImage?l.getImage():d},getSelectWidth:function(S){var o=Oi(this.getImage(S));return o&&lp(o.disableSelectedBorder,S,this)?0:S.s("select.width")},getSelectColor:function(z){return z.s("select.color")},isSelectable:function(w,I){if(this.isSelected(w))return!0;if(!I&&w.getParent()instanceof Cc&&this.isSelectable(w.getParent(),!0)&&w.getParent().isSyncSize())return!1;var U=this.getLayersInfo();if(U){var A=U[w._layer];if(A&&A.selectable===!1)return!1}return w.s("2d.selectable")&&this.sm().isSelectable(w)},isMovable:function(l){var y=this;if(Pe(l)&&l.getStyle(ug)!==xe)return!1;var R=this.getLayersInfo();if(R){var A=R[l._layer];if(A&&A.movable===!1)return!1}return l.s("2d.movable")?y._movableFunc?y._movableFunc(l):!0:!1},isEditable:function($){var m=this;if(W._uiSerializing)return m._uieditable;if(!m._editInteractor||!m.isSelected($))return!1;if(Ud($)){var H=m.getDataUI($);if(!H||H._88I)return!1}if(Pe($)&&$.getStyle(ug)!==xe)return!1;var G=this.getLayersInfo();if(G){var k=G[$._layer];if(k&&k.editable===!1)return!1}return $.s("2d.editable")?m._editableFunc?m._editableFunc($):!0:!1},handleDelete:function(){this._editInteractor&&(this._editInteractor.handleDelete?this._editInteractor.handleDelete():this.removeSelection())},isPointEditable:function(n){return zm(n)&&0!==n.getRotation()?!1:this._pointEditableFunc?this._pointEditableFunc(n):!0},isRectEditable:function(p){return this._rectEditableFunc?this._rectEditableFunc(p):!0},isAnchorEditable:function(V){return this._anchorEditableFunc?this._anchorEditableFunc(V):!0},isRotationEditable:function(o){return o.setRotation&&o.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(o):!0:!1},getRotationPoint:function(r){var N=r.getAnchor(),q=r.getScale(),Q=this._zoom,n=yl(r.getRotation(),0,-r.getHeight()*q.y*N.y-(q.y<0?-1:1)*(xl?32:16)/Q),Z=r.p();return n.x+=Z.x,n.y+=Z.y,n},getLogicalPoint:function(c){var H=this;return we(c,H._canvas,H.tx(),H.ty(),H._zoom,H._zoom)},getScreenPoint:function(m,z){var R,X=this;return"object"==typeof m?m.x!==d?(R=m.x,z=m.y):(R=m[0],z=m[1]):R=m,me(R,z,X._canvas,X.tx(),X.ty(),X._zoom,X._zoom)},getSelectedDataAt:function(e){var C=this;return this.getDataAt(e,function(O){return C.isSelected(O)})},getDataInfoAt:function(X,s,c){var I,p=this.lp(X),z=this.getDataAt(p,s,c);if(z){var w=this.getDataUI(z);I={data:z,ui:w,point:p};var W=w._38o;if(W){var i=W.icons;for(var L in i){var $=i[L],v=W.rects[L];if(v)for(var B=lp($.names,z,this),r=B?B.length:0,t=v.rotation,J=r-1;J>=0;J--){var o=B[J],F=v[J];if(th(F,p,t))return I.part="icons",I.name=L,I.icon=o,I.rect=F,I.index=J,I.rotation=t,I}}}if(this.isNoteVisible(z)){if(w.note2Info&&th(w.note2Info.clickRect,p,S,w.note2Info.scale))return I.part="note2",I;if(w.noteInfo&&th(w.noteInfo.clickRect,p,S,w.noteInfo.scale))return I.part="note",I}if(this.isLabelVisible(z)){if(w.label2Info&&th(w.label2Info.rect,p,w.label2Info.rotation,w.label2Info.scale))return I.part="label2",I;if(w.labelInfo&&th(w.labelInfo.rect,p,w.labelInfo.rotation,w.labelInfo.scale))return I.part="label",I}if(z.isInRect&&z.isInRect(p))return I.part="body",I}return I},getDataAt:function(E,z,U){E.target&&(E=this.lp(E));var d,c=this._zoom;return this.reverseEach(function(Z){return(z?z(Z):this.isSelectable(Z))&&this.rectIntersects(Z,Ql(E.x,E.y,U,c))?(d=Z,!1):void 0},this),d},getIconInfoAt:function(O,W){var Z=this;if(O.target&&(O=Z.lp(O)),W||(W=Z.getDataAt(O)),W){var n=Z.getDataUI(W);if(n&&n._38o){var I,F=n._38o,b=new Kf;for(I in F.icons)b.add(I);for(var c=b.size()-1;c>=0;c--){I=b.get(c);for(var z=F.rects[I],t=z.rotation,e=z.length-1;e>=0;e--){var K=z[e],g=K.width,C=K.height,f={x:O.x-K.x-g/2,y:O.y-K.y-C/2};t!=S&&(f=yl(-t,f.x,f.y));var K={x:-g/2,y:-C/2,width:g,height:C};if(th(K,f))return{key:I,index:e,name:F.icons[I].names[e],rect:z[e],point:O,rotation:t,relativeRect:K,relativePoint:f,data:W}}}}}return S},getDatasInRect:function(x,s,q){q===d&&(q=1);var X=this,e=new Kf;return X.reverseEach(function(K){q&&!X.isSelectable(K)||(s?X.rectIntersects(K,x):X.rectContains(K,x))&&e.add(K)}),e},moveSelection:function(W,o){var g=this;g.dm().beginTransaction(),Bc(g.sm().toSelection(g.isMovable,g),W,o),g.dm().endTransaction()},moveDatas:function(c,D,H){var I=this;I.dm().beginTransaction(),c instanceof Kf||(c=new Kf(c)),Bc(c,D,H),I.dm().endTransaction()},getDataUIBounds:function(Y){var P=this.getDataUI(Y);return P?P._79o():S},drawData:function(e,u,k){var B=this.getDataUI(u);if(B){var i=B._79o();(!k||ee(k,i))&&(B._42(e),u instanceof W.Block&&u.eachChild(function(m){this.drawData(e,m,k)},this))}},getBoundsForGroup:function(j){return j.s(cg)?this.getDataUIBounds(j):S},isPixelPerfect:function(U){return U.s("pixelPerfect")},rectIntersects:function(l,L){this.validate();var k=S;if(this._56I[l._id]){var i=this._25I[l._id];if(i){var o=i._79o();if(Te(L,o))k=!0;else if((L=dd(L,o))&&(i.rectIntersects&&(k=i.rectIntersects(L)),k==S)){if(!this.isPixelPerfect(l))return!0;var n=L.x,J=L.y,E=L.width,B=L.height,K=this._zoom,j=X.hitMaxArea,x=E*B*K*K;if(x>j){var s=Math.sqrt(j/x);K*=s}E*=K,B*=K,2>E&&(E=2),2>B&&(B=2),n*=K,J*=K;var N=eg(E,B);As(N,-n,-J),N.scale(K,K),this._drawForChecking=!0,this.drawData(N,l,L),this._drawForChecking=!1;try{for(var z=0,r=N.getImageData(0,0,E,B).data;z<r.length;z+=4)if(0!==r[z+3]){k=!0;break}N.restore()
}catch(t){wr=S,k=!1}}}}return k?!0:!1},rectContains:function(j,Y){if(this._56I[j._id]){var w=this._25I[j._id];if(w)return Te(Y,w._79o())}return!1},reset:function(){this.setZoom(1),this.setTranslate(0,0)},handleKeyDown:function(B){if(!X.isInput(B.target)){var k=this,b=k._focusData,W=b&&k._25I[b._id],P=0,C=k._dataModel._datas;if(!(b&&b._enabled&&b._editable&&W&&W.onKeyDown&&W.onKeyDown(B)===!0))if(9===B.keyCode&&(b&&(P=C.indexOf(b),Pn(B)?-1===--P&&(P=0):++P===C.size()&&(P=0)),k._focusData=b=C.get(P),k.sm().setSelection(b)),sr(B)?k.selectAll():Aq(B)&&k.isResettable()&&k.reset(),k.sm().isEmpty()){if(k._editing)return;var j=k.tx(),v=k.ty(),F=!1,Z=Pn()?100:10;ak(B)&&(j-=Z,F=!0),Zh(B)&&(v-=Z,F=!0),vj(B)&&(j+=Z,F=!0),ff(B)&&(v+=Z,F=!0),F&&k.setTranslate(j,v)}else{bg(B)&&k.handleDelete(B);var O=Pn()?10:1;ak(B)&&(k.moveSelection(-O,0),k.fi({kind:"moveLeft"})),Zh(B)&&(k.moveSelection(0,-O),k.fi({kind:"moveUp"})),vj(B)&&(k.moveSelection(O,0),k.fi({kind:"moveRight"})),ff(B)&&(k.moveSelection(0,O),k.fi({kind:"moveDown"}))}}},handleScroll:function($,N){if(Ub($),this.isZoomable()){if(!this.getEditInteractor()){var A=this.getDataAt($);if(A){var R=Oi(this.getImage(A));if(R&&lp(R.scrollable,A,this))return}}var s=this.lp($);N>0?this.scrollZoomIn(s):0>N&&this.scrollZoomOut(s)}},handlePinch:function(G,L,m){this.isZoomable()&&(L>m?this.pinchZoomIn(G):this.pinchZoomOut(G))},checkDoubleClickOnNote:function($,A){var B=this,W=B.lp($),c=B.getDataUI(A),H=c.note2Info;return H&&A.s("note2.toggleable")&&th(H.clickRect,W)?(A.s(gj,!A.s(gj)),B.fi({kind:"toggleNote2",event:$,data:A}),!0):(H=c.noteInfo,H&&A.s("note.toggleable")&&th(H.clickRect,W)?(A.s(_j,!A.s(_j)),B.fi({kind:"toggleNote",event:$,data:A}),!0):!1)},_84o:function(){},isNoteVisible:function(){return this._zoom>.15},isLabelVisible:function(){return this._zoom>.15},isEditVisible:function(){return this._zoom>.15},autoScroll:function(I,d){var x=this,A=x.getAutoScrollZone(),G=A/x.getZoom(),p=A/4,L=x._29I,X=x.lp(I),f={x:x.tx(),y:x.ty()};return X&&A>0&&L&&(X.x-L.x<G?x.translate(p,0):L.x+L.width-X.x<G&&x.translate(-p,0),X.y-L.y<G?x.translate(0,p):L.y+L.height-X.y<G&&x.translate(0,-p)),f.x=x.tx()-f.x,f.y=x.ty()-f.y,d&&(d.x+=f.x,d.y+=f.y),f},getMoveMode:function(X,F){var T=F.s("2d.move.mode");return T?T:hc["88"]?"x":hc["89"]?"y":"xy"},getSerializableProperties:function(){return{scrollBarColor:1,scrollBarSize:1,autoMakeVisible:1,autoHideScrollBar:1,editable:1,resettable:1,pannable:1,rectSelectable:1,autoScrollZone:1,visibleFunc:1,movableFunc:1,editableFunc:1,pointEditableFunc:1,rectEditableFunc:1,anchorEditableFunc:1,rotationEditableFunc:1,rectSelectBackground:1,rectSelectBorderColor:1,editPointSize:1,editPointBorderColor:1,editPointBackground:1,hoverDelay:1,dataModel:1,selectionModel:1,currentSubGraph:1,zoom:1,translateX:1,translateY:1}},serializeProperty:function(r,P,V){var E=this;return"currentSubGraph"===P?{__i:r.getId()}:V.serializeProperty(r,P,E)},deserializeProperty:function(Q,l,x){var H=this;if("currentSubGraph"===l){var k=H.dm(),I=k.__idMap;return I[Q.__i]}return x.deserializeProperty(Q,l,H)},setDefaultCursor:function(t,B){this._defaultCursor=t,B!==!1&&this.setCursor(t)},setCursor:function(G){"default"===G&&(G=this._defaultCursor||G);var l=this.getView().style;l.cursor=G,l.cursor="-webkit-"+G,l.cursor="-moz-"+G},getCurrentConnectActionType:function(){return this._currentActionType},setCurrentConnectActionType:function(p){return p===S||X.getConnectAction(null,p)?(this._currentActionType=p,this.redraw(),!0):!1},getEditStyle:function(k){var O=this.getEditInteractor();return O?O.getStyle(k):d},setEditStyle:function(O,E,t){var Y=this.getEditInteractor();return Y?(Y.setStyle(O,E,t),!0):!1},isConnectActionVisible:function(G){var e=X.getConnectAction(this);if(!e)return!1;var w=e.visible;return dc(w)&&(w=w(this,G)),w},isInteractive:function(L){var O=Oi(this.getImage(L));return O&&lp(O.interactive,L,this)?!0:L.s("interactive")},appendHTML:function(R,y){var x=this.getView();if(!(y||R&&R.parentNode!==x))return!1;var J=R.getView&&R.getView();if(!y&&J&&J.parentNode===x)return!1;(R.getView||R.isSelfViewEvent)&&(R=R.getView());var c=this.getEditInteractor();return c&&c._canvas?x.insertBefore(R,c._canvas):this.isScrollBarVisible()?x.insertBefore(R,this.getView().lastChild):lc(x,R),!0},_layoutHTMLImpl:function(I,V,M){if(arguments.length>1){var s,o=this,L=o._zoom;if(V.getView&&(s=V,V=V.getView()),V.style.position="absolute",M){var j=I.getRect();Ap(s||V,o.tx()+j.x*L,o.ty()+j.y*L,j.width*L,j.height*L)}else{var G=new We,j=I.getAnchorRect(),k=I.getPosition(),n=I.getScale(),J=V.style;Ap(s||V,j),G.appendTranslate(o.tx(),o.ty()),G.appendScale(L,L),G.append(new We(I.getRotation(),k.x,k.y,n.x,n.y)),ne(J,"transform","matrix("+G.a.toFixed(5)+", "+G.b.toFixed(5)+", "+G.c.toFixed(5)+",\n    "+G.d.toFixed(5)+", "+G.tx.toFixed(5)+", "+G.ty.toFixed(5)+")"),ne(J,"transformOrigin",(-j.x).toFixed(5)+"px "+(-j.y).toFixed(5)+"px"),V.updateAppendMatrix=!0}}else this._layoutHTML&&this._layoutHTML()},getTextEditInfo:function(f){return f instanceof Yf?{name:"text",accessType:"s",isMultiline:!1}:void 0},getState:function(z){var n="state",P=z.s(n);if(P)return P;var u=Oi(z._image);return u?lp(u[n],z,this)||null:void 0}}),G.defineProperties(Ee.GraphView.prototype,{layoutHTML:{get:function(){return this._layoutHTMLImplBind||(this._layoutHTMLImplBind=this._layoutHTMLImpl.bind(this)),this._layoutHTMLImplBind},set:function(W){this._layoutHTML=W}}});var xi=function(u,V){var x=this;x.gv=u,x.s=function(d){return V.getStyle(d)},x._data=V,x._87I=new Kf};jd(xi,G,{_6I:S,ms_icons:1,_84o:function(){},dispose:function(){},isShadowed:function(){return this.s("shadow")||this.gv.isSelected(this._data)&&"shadow"===this.s("select.type")},getSelectWidth:function(){var G=this,O=G.gv.isSelected(G._data);return!O||G.isShadowed()?0:G.gv.getSelectWidth(G._data)},getSelectColor:function(){return this.gv.getSelectColor(this._data)},getBodyColor:function(j){var Z=this._data,P=this.gv.getBodyColor(Z);return P?P:j?Z.getStyle(j):S},_2Q:function(e){return this.s(e)},_1Q:function(z,B,Y,i){var q=this.s,H=q("2d.gray"),A=q(B+".dash.color");if(H&&(A=X.toGrayColor(A)),z.strokeStyle=A,z.lineWidth=Y,z.stroke(),q(B+".dash.3d")){var b=q(B+".dash.3d.color");bf(z,A,H?X.toGrayColor(b):b,Y,this.gv._zoom,q(B+".dash.3d.accuracy"))}_h(z,i)},invalidate:function(){this._6I=S},_79o:function(){var Z=this;if(!Z._6I){var v=Z._data,N=Z.gv;Z.labelInfo=Z.label2Info=Z.noteInfo=Z.note2Info=Z._38o=S,Z._87I.clear(),Z.interactiveInfo=N.isInteractive(v)?{}:S,Z._3O(),Z._55O=N.isEditable(v)?{_42O:N.isRectEditable(v),_43O:N.isPointEditable(v),_56O:N.isRotationEditable(v)}:S,Z._6I=Z._81o()}return Z._6I},_3O:function(){},getPosition:function(){return No},_68o:function(a,b){a&&this._87I.add(Vh(a,b))},_81o:function(){var b=this,w=b.s;b._24O(Fn,"getLabel"),b._24O(gm,"getLabel2"),b._26O(he,"getNote"),b._26O(Vb,"getNote2"),b._15O(),b._55O&&b._48O();var S;if(b._87I.each(function(j){S=Vg(S,j)}),S&&b.isShadowed()){var H=or(S);H.x+=w("shadow.offset.x"),H.y+=w("shadow.offset.y"),Vo(H,w("shadow.blur")),S=Vg(S,H)}return b._87I.clear(),S},_42:function(d){var k=this,y=k._data,g=k.gv,n=k.s,P=n("opacity"),I=this.isShadowed();if(I){var N=d.shadowOffsetX,A=d.shadowOffsetY,O=d.shadowBlur,z=d.shadowColor,K=g.getZoom();d.shadowOffsetX=n("shadow.offset.x")*K,d.shadowOffsetY=n("shadow.offset.y")*K,d.shadowBlur=n("shadow.blur")*K,d.shadowColor=k.getSelectColor()}if(P!=S){var $=d.globalAlpha;d.globalAlpha=P}k._80o(d),g.isLabelVisible(y)&&((!g._drawForChecking||n("label.selectable"))&&oj(d,k.labelInfo),(!g._drawForChecking||n("label2.selectable"))&&oj(d,k.label2Info)),g.isNoteVisible(y)&&(Xn(d,k.noteInfo),Xn(d,k.note2Info)),k._99O(d),P!=S&&(d.globalAlpha=$),I&&(d.shadowOffsetX=N,d.shadowOffsetY=A,d.shadowBlur=O,d.shadowColor=z)},_80o:function(){},_47O:function(){},_24O:function(L,G){var o=this,p=o._data,a=o.gv,V=o.s,x=a[G](p);if(x!=S){var s=V(L+".scale"),X=V(L+".max"),F=V(L+".position"),H=o[L+"Info"]={label:x,scale:s,color:a[G+"Color"](p),font:V(L+".font"),opacity:V(L+".opacity"),align:V(L+".align"),rotation:o.getRotation(V(L+".rotation"),!1,F),background:a[G+"Background"](p)},y=fs(H,x);X>0&&X<y.width&&(H.labelWidth=y.width,y.width=X),1!==s&&(y.width*=s,y.height*=s);var M=o.getPosition(F,V(L+".offset.x"),V(L+".offset.y"),y,V(L+".position.fixed"));if(y.x=M.x-y.width/2,y.y=M.y-y.height/2,o._68o(H.rect=y,H.rotation),1!==s){var h=y.width/s,t=y.height/s;H.rect={x:M.x-h/2,y:M.y-t/2,width:h,height:t}}}},_26O:function(B,D){var L=this,N=L.gv,l=L._data,J=L.s,j=N[D](l);if(j!=S){var C,z,m=J(B+".scale"),Z=L[B+"Info"]={note:j,scale:m,data:l,view:N,expanded:J(B+".expanded"),font:J(B+".font"),color:J(B+".color"),opacity:J(B+".opacity"),align:J(B+".align"),icon:J(B+".icon"),backgroundImage:J(B+".backgroundImage"),borderWidth:J(B+".border.width"),borderColor:J(B+".border.color"),background:N[D+"Background"](l)},f=L.getPosition(J(B+".position"),J(B+".offset.x"),J(B+".offset.y")),H=f.x,Q=f.y;if(Z.expanded){var v,K=J(B+".max"),I=J(B+".backgroundImage");I?(I=Oi(I),v={width:xq(I,l),height:ze(I,l)}):v=fs(Z,j),v.width+=6,v.height+=2,K>0&&K<v.width&&(Z.labelWidth=v.width,v.width=K),C=v.width,z=v.height+8,Z.clickRect={x:H-C*m/2,y:Q-z*m,width:C*m,height:z*m*v.height/z}}else{var p=J(B+".icon");p?(p=Oi(p),C=xq(p,l),z=ze(p,l)):(C=12,z=18),Z.clickRect={x:H-C*m/2,y:Q-z*m,width:C*m,height:z*m}}Z.rect={x:H-C/2,y:Q-z*m/2-z/2,width:C,height:z};var q=w(Z.borderWidth/2)*m;L._68o({x:H-C*m/2-q,y:Q-z*m-q,width:C*m+2*q,height:z*m+2*q})}},_48O:function(){},_99O:function(h){var R=this,G=R._38o;if(G){var w=R.gv,Q=R._data,U=G.icons,v=R.interactiveInfo;v&&(v._38o={});for(var g in U){var n=U[g],o=G.rects[g];if(o){v&&(v._38o[g]=[]);var l=lp(n.opacity,Q,w),K=lp(n.names,Q,w),T=K?K.length:0,t=o.rotation;if(l!=S){var O=h.globalAlpha;h.globalAlpha*=l}for(var z=0;T>z;z++){var j=K[z],V=Oi(j),e=o[z];if(t){var W=e.x+e.width/2,Z=e.y+e.height/2;h.save(),As(h,W,Z),ap(h,t),As(h,-W,-Z)}v&&v._38o[g].push(h.interactiveInfo={compInfos:[],matrix:t?new We(t,W,Z).appendTranslate(-W,-Z):new We}),ng(h,V,lp(n.stretch,Q,w),e.x,e.y,e.width,e.height,R._data,R.gv),h.interactiveInfo=S,t&&h.restore()}l!=S&&(h.globalAlpha=O)}}}}});var re=function(U,N){Lk(re,this,[U,N])};jd(re,xi,{_checkEmptyRect:!0,_40O:function(K,v){var Q=this,P=Q.s,J=K.rect;(K.borderColor=Q.gv.getBorderColor(Q._data))&&(K.borderType=P("border.type"),K.borderWidth=P("border.width"),K.borderPadding=P("border.padding"),v=V(v,K.borderPadding+K.borderWidth/2));var X=Q._data.getScale(),f=V(1,V(M(X.x),M(X.y)));if(K.selectWidth=Q.getSelectWidth()){var d=Q.gv._zoom;K.selectType=P("select.type"),K._97o=Q.getSelectColor(),K.selectPadding=P("select.padding"),v=V(v,(K.selectPadding+K.selectWidth/2/d)/f)}v>0&&(v*=f,J=or(J),Vo(J,v)),Q._68o(J)},_39O:function(n,p){var P,q=this,s=p.rect;if(p.borderWidth>0&&(P=p.borderPadding,n.strokeStyle=p.borderColor,n.lineWidth=p.borderWidth,Lg(n,p.borderType,{x:s.x-P,y:s.y-P,width:s.width+2*P,height:s.height+2*P}),n.stroke()),p.selectWidth>0){var M=q.gv._zoom;if(P=p.selectPadding,n.strokeStyle=p._97o,n.lineWidth=p.selectWidth/M,p.rotation!=S){n.save(),n.translate(p.position.x,p.position.y),n.rotate(p.rotation);var _=q._data,N=_.getWidth(),f=_.getHeight(),U=p.scale,r=p.anchor;s={x:U.x*-N*r.x,y:U.y*-f*r.y,width:U.x*N,height:U.y*f}}Lg(n,p.selectType,{x:s.x-P,y:s.y-P,width:s.width+2*P,height:s.height+2*P}),p.rotation!=S&&n.restore(),n.stroke()}},dispose:function(){var s=this,a=s._htmlView;re.superClass._3O.call(s),a&&(a.onHTMLRemoved&&a.onHTMLRemoved(),ws(a))},_3O:function(){var r=this,L=r.s,W=r._data,e=r.gv,Q=W.getStyle(Jr),d=r.getBodyColor(),g=r._83o=Q?{shape:Q,_53o:r.getBodyColor("shape.background"),_27Q:Oi(L("shape.repeat.image"),d),shapeGradientPack:L("shape.gradient.pack"),_54o:L("shape.border.width"),_55o:L("shape.border.color"),_56o:L("shape.border.3d"),_57o:L("shape.border.3d.color"),_58o:L("shape.border.3d.accuracy"),shapeGradient:L("shape.gradient"),_59o:L("shape.gradient.color"),_60o:L("shape.border.pattern"),_61o:L("shape.border.cap"),_62o:L("shape.border.join"),shapeForeground:L("shape.foreground"),bodyColor:d,gray:L("2d.gray")}:{img:Oi(e.getImage(W),d),bodyColor:d,gray:L("2d.gray"),stretch:L("image.stretch")};if(b&&!a);else{var N,y=g.img;y&&y.renderHTML?(r._htmlInfo&&r._htmlInfo.img!==y&&(r._htmlInfo=S),r._htmlInfo||(r._htmlInfo={img:y,cache:{}}),N=y.renderHTML(W,e,r._htmlInfo.cache)):r._htmlInfo=S,r._htmlView&&r._htmlView!==N&&(r._htmlView.onHTMLRemoved&&r._htmlView.onHTMLRemoved(),ws(r._htmlView.getView?r._htmlView.getView():r._htmlView)),(r._htmlView=N)&&e.appendHTML(N)&&(N.onHTMLAddedSync&&N.onHTMLAddedSync(),N.onHTMLAdded&&dk(N.onHTMLAdded)),g.rect=W.getRect(),g.position=W.p(),g.scale=W.getScale(),g.anchor=W.getAnchor(),g.rotation=W.getRotation(),Q===Ni&&(g._63o=L("shape.depth"));var i=0;if(Q)i=db(S,g._54o/2,g._62o),r.s("shape.dash")&&(i=V(i,(r.s("shape.dash.width")||g._54o)/2));else if(y&&y.boundExtend)if(i=lp(y.boundExtend,W,e),y.boundExtendAbsolute){var o=W.getScale();i/=e._zoom*V(1,V(M(o.x),M(o.y)))}else if(!lp(y.fitSize,W,e)){var j=lp(y.width,W,e),P=lp(y.height,W,e);i*=V(W.getWidth()/j,W.getHeight()/P)}r._40O(g,i);var I=L("clip.percentage");if(1>I&&(0>I&&(I=0),g.clipRect=Jb(W.getAnchorRect(),L("clip.direction"),I)),Q){var B=L("shape.fill.clip.percentage");1>B&&(0>B&&(B=0),g.shapeClipRect=Jb(W.getAnchorRect(),L("shape.fill.clip.direction"),B));var v=L("shape.foreground.clip.percentage");1>v&&(0>v&&(v=0),g.shapeForegroundClipRect=Jb(W.getAnchorRect(),L("shape.foreground.clip.direction"),v))}}},getPosition:function(m,t,A,X){var I=_l(m,this._83o.rect,X);return I.x+=t,I.y+=A,I},_80o:function(a){var l=this,v=l.s,f=l.gv,u=l._data,T=l._83o,i=T.rect,g=T.position,r=T.rotation,n=T.anchor,c=T.scale,j=T.shape,p=T.clipRect;if(!l._checkEmptyRect||i.width>0&&i.height>0){var H=u.getSize();if(H.x=-H.width*n.x,H.y=-H.height*n.y,a.save(),As(a,g.x,g.y),ap(a,r),ce(a,c.x,c.y),p&&(a.beginPath(),a.rect(p.x,p.y,p.width,p.height),a.clip()),f._drawForChecking&&T.img&&lp(T.img.pixelPerfect,u,f)===!1)Eh(a,H.x,H.y,H.width,H.height,"#888888");else if(l.freeDraw)l.freeDraw(a,H,T);else if(j){var R,B,O,z,U=T._60o,I=xd(a,U),G=T._27Q,_=T._54o,F=T.shapeGradientPack,t=T.gray,Z=a.lineJoin,s=a.lineCap,L=function(N){return t?X.toGrayColor(N):N};"roundRect"===j?R=v("shape.corner.radius"):"polygon"===j?R=v("shape.polygon.side"):"arc"===j&&(R=v("shape.arc.from"),B=v("shape.arc.to"),O=v("shape.arc.close"),z=v("shape.arc.oval")),a.lineJoin=T._62o,a.lineCap=T._61o;var y=L(T._53o);if(y||G||F){var m=T.shapeClipRect;m&&(a.save(),a.beginPath(),a.rect(m.x,m.y,m.width,m.height),a.clip()),Lg(a,j,H,R,B,O,z),F?Tb(a,F):G?er(a,G,L(T.bodyColor),null,u,f):Rb(a,y,T.shapeGradient,L(T._59o),H),a.fill(),m&&a.restore(),F&&a.restore(),a!==I&&Lg(I,j,H,R,B,O,z)}else Lg(I,j,H,R,B,O,z);var N=T.shapeForeground;if(N){a.save();var Y=T.shapeForegroundClipRect;Y&&(a.beginPath(),a.rect(Y.x,Y.y,Y.width,Y.height),a.clip()),Lg(a,j,H,R,B,O,z),Rb(a,N,v("shape.foreground.gradient"),L(v("shape.foreground.gradient.color")),H),a.fill(),a.restore()}if(_>0){var Q=v("shape.border.width.absolute");Q&&(a.save(),a.setTransform(1,0,0,1,0,0)),a.lineWidth=_;var D=L(T._55o);a.strokeStyle=D,a.stroke(),Q&&a.restore(),T._56o&&bf(a,D,L(T._57o),_,f._zoom,T._58o)}if(_h(a,U),v("shape.dash")){var P=v("shape.dash.width")||_;if(P>0){U=v("shape.dash.pattern");var I=xd(a,U,l._2Q("shape.dash.offset"));I!==a&&Lg(I,j,H,R,B,O,z),l._1Q(a,"shape",P,U)}}Pd(a,y,T._63o,H),a.lineJoin=Z,a.lineCap=s}else{var V=l.interactiveInfo;V&&(a.interactiveInfo=V.bodyInfo={compInfos:[],matrix:new We(r,g.x,g.y,c.x,c.y)}),T.gray&&(a.compGray=!0);var E=T.img;E&&E.cacheRule!=S&&(E=Dh(a,E,T.stretch,H.width,H.height,u,f,T.bodyColor)),ng(a,E,T.stretch,H.x,H.y,H.width,H.height,u,f,T.bodyColor),a.compGray=!1,a.interactiveInfo=S}a.restore()}l._39O(a,T)},_48O:function(){},_47O:function(){}});var um=function(Z,Y){Lk(um,this,[Z,Y])},gi=function(P,j,n,a){var H=zq(P,j);return n=a?o(n,H):Ek(n,H),H?n/=H:n=0,{x:P.x+(j.x-P.x)*n,y:P.y+(j.y-P.y)*n}};jd(um,xi,{_3O:function(){var R,k=this,c=k._data,b=k.gv,H=k.s,A=H(ug),t=c.isLooped(),Z=H("edge.width"),o=H("edge.center"),I=H("edge.offset"),L=b.getBorderColor(c),q=L?H("border.width"):0,h=k.getSelectWidth(),F=c._40I,D=c._41I,l=k._78o=F&&D?{looped:t,type:A,width:Z,center:o,color:k.getBodyColor("edge.color"),borderColor:L,borderWidth:q,_97o:h?k.getSelectColor():S,selectWidth:h,pattern:H("edge.pattern"),cap:H("edge.cap"),join:H("edge.join"),is3d:H("edge.3d"),_67o:H("edge.3d.color"),_66o:H("edge.3d.accuracy"),gray:H("2d.gray")}:S;if(l){var y=X.getEdgeType(A);if(y){var M=y(c,oi(k,b,c,t,A),b,k._19Q);M.points&&M.points.size()>1?(l.edgeTypeInfo=M,R=Mn(l.edgeTypeInfo.points)):M[Am]&&M.rect&&(l.edgeTypeInfo=M,R=M.rect)}else{var j=H("edge.source.anchor.x"),J=H("edge.source.anchor.y"),Q=H("edge.target.anchor.x"),Y=H("edge.target.anchor.y"),z=ii(b,c,"source"),f=ii(b,c,"target");if(A===xe){var W=l.points=H(Ab)||le,P=W.size();l.segments=H("edge.segments");var i=j!==d||J!==d||Pe(F),C=Q!==d||Y!==d||Pe(D);if(!o)if(I)i||(z=gi(z,P?W.get(0):f,I,P)),C||(f=gi(f,P?W.get(P-1):z,I,P));else{var B;i||(B=tn(z,P?W.get(0):f,Pl(b,F)),B&&(z={x:B[0],y:B[1]})),C||(B=tn(P?W.get(P-1):z,f,Pl(b,D)),B&&(f={x:B[0],y:B[1]}))}R=Vg(Mn(l.points),Mn(z,f))}else{var r=oi(k,b,c,t,A);if(k._19Q||(r=-r),t)z=or(z),z.x=b.getNodeRect(F).x,l.radius=r,R={x:z.x-r,y:z.y-r,width:2*r,height:2*r};else{var G=zq(z,f),p=Ek(I,G),O={x:p,y:r},x={x:G-p,y:r},m=N(f.y-z.y,f.x-z.x),K=l.mat=new ye(m);if(l.orienAngle=m,l.angle=f.x<z.x?m+u:m,l.rect={x:O.x,y:O.y,width:x.x-O.x,height:0},l.origin=z,O=K.tf(O),O.x+=z.x,O.y+=z.y,x=K.tf(x),x.x+=z.x,x.y+=z.y,o){var U={x:G,y:0};U=K.tf(U),U.x+=z.x,U.y+=z.y,R=Mn([z,O,x,U]),l.c1=z,l.c2=U}else R=Mn(O,x);z=O,f=x}}l.sourcePoint=z,l.targetPoint=f,c._lastSourcePoint=z,c._lastTargetPoint=f}var T=0;H("edge.dash")&&(T=H("edge.dash.width")||Z);var g="square"===l.cap?.71:.5;db(R,V(T*g,Z*g+q+h),l.join),k._68o(R)}},getRotation:function(y,d,n){y=y||0;var _=this._78o;if(_){var M,G=_.angle,T=_.points,f=_.edgeTypeInfo;if(G!=S)return d?_.orienAngle+y:G+y;if(f&&f[Am])return f.getRotation?f.getRotation(this,y,d,n):0;if(f&&f.points){var E=f.points;return M=E.size(),Jg[n]?M&&0===M%2?ir(E.get(M/2-1),E.get(M/2),d,y):y:Tj[n]?ir(E.get(0),E.get(1),d,y):ir(E.get(M-2),E.get(M-1),d,y)}if(T)return M=T.size(),Jg[n]?M&&0===M%2?ir(T.get(M/2-1),T.get(M/2),d,y):y:Tj[n]?ir(_.sourcePoint,M?T.get(0):_.targetPoint,d,y):ir(M?T.get(M-1):_.sourcePoint,_.targetPoint,d,y)}return y},getPosition:function(e,J,R,W,A){var N=this._78o;if(N){var U,B=N.type,t=N.points,v=N.edgeTypeInfo,z=N.sourcePoint,j=N.targetPoint;if(!B)return N.looped?{x:z.x-N.radius+J,y:z.y+R}:(A&&z&&j&&(z.x>j.x||z.x===j.x&&z.y>j.y)&&(e=yj[e],R=-R),U=_l(e,N.rect,W),U.x+=J,U.y+=R,U=N.mat.tf(U),U.x+=N.origin.x,U.y+=N.origin.y,U);if(v&&v[Am])return v.getPosition?v.getPosition(this,e,J,R,W,A):{x:(z.x+j.x)/2,y:(z.y+j.y)/2};if(t){var U,r=t.size();if(Jg[e]){if(r){var b=r%2;if(0===b)return Eo(t.get(r/2-1),t.get(r/2),e,J,R,W,A);U=t.get((r-b)/2)}else U={x:(z.x+j.x)/2,y:(z.y+j.y)/2};return U=_l(e,{x:U.x,y:U.y,width:0,height:0},W),U.x+=J,U.y+=R,U}return Tj[e]?Eo(z,r?t.get(0):j,e,J,R,W,A):Eo(r?t.get(r-1):z,j,e,J,R,W,A)}if(v){var T=v.points,r=T.size();if(Jg[e]){var b=r%2;return 0===b?Eo(T.get(r/2-1),T.get(r/2),e,J,R,W,A):(U=T.get((r-b)/2),U=_l(e,{x:U.x,y:U.y,width:0,height:0},W),U.x+=J,U.y+=R,U)}return Tj[e]?Eo(T.get(0),T.get(1),e,J,R,W,A):Eo(T.get(r-2),T.get(r-1),e,J,R,W,A)}}return No},_42:function(u){this._78o&&um.superClass._42.call(this,u)},drawPath:function(p,r){p.beginPath();var L=r.type,b=r.points,n=r.segments,W=r.edgeTypeInfo;if(!L||b){var e=r.sourcePoint,u=e.x,N=e.y,S=r.targetPoint,E=S.x,g=S.y;if(L)if(n){var C=new Kf({x:u,y:N});C.addAll(b),C.add({x:E,y:g}),$f(p,C,n)}else p.moveTo(u,N),b.each(function(i){p.lineTo(i.x,i.y)}),p.lineTo(E,g);else r.looped?p.arc(u,N,r.radius,0,m,!0):r.center?(p.moveTo(r.c1.x,r.c1.y),p.lineTo(u,N),p.lineTo(E,g),p.lineTo(r.c2.x,r.c2.y)):(p.moveTo(u,N),p.lineTo(E,g))}else W&&(W.points?$f(p,W.points,W.segments):W[Am]&&W[Am](p,W))},_80o:function(c){var Y=this,o=Y.s,Q=Y._78o,i=Q.width,G=Q.selectWidth,q=Q.borderWidth,h=c.lineJoin,p=c.lineCap,B=Q.gray,Z=Q.pattern;c.lineJoin=Q.join,c.lineCap=Q.cap,Y.drawPath(xd(c,Z),Q);var x=o("edge.width.absolute");x&&(c.save(),c.setTransform(1,0,0,1,0,0)),G&&(c.strokeStyle=Q._97o,c.lineWidth=i+2*(q+G),c.stroke()),q&&(c.strokeStyle=B?X.toGrayColor(Q.borderColor):Q.borderColor,c.lineWidth=i+2*q,c.stroke());var k=B?X.toGrayColor(Q.color):Q.color,t=B?X.toGrayColor(Q._67o):Q._67o;if(c.strokeStyle=k,c.lineWidth=i,c.stroke(),Q.is3d&&bf(c,k,t,i,Y.gv._zoom,Q._66o),x&&c.restore(),_h(c,Z),o("edge.dash")){Z=o("edge.dash.pattern");var P=xd(c,Z,Y._2Q("edge.dash.offset"));P!==c&&Y.drawPath(P,Q),Y._1Q(c,"edge",o("edge.dash.width")||i,Z)}c.lineJoin=h,c.lineCap=p},_48O:function(){},_47O:function(){}});var vs=function(b,Z){Lk(vs,this,[b,Z])};jd(vs,re,{_3O:function(){var B,g,N=this,X=N.s,f=N._data,O=N.gv;if(N._88I=S,f.isExpanded()&&f.eachChild(function(w){if(zm(w)){var d=O.getBoundsForGroup(w);d&&(g||(g=[]),g.push(d),B=Vg(B,d))}}),B){var k=O.getLabel(f),D=X("group.type");B=Dd(D,g,B),pb(B,f,"group.padding",1);var W=N._88I={type:D,rect:B,_64o:B};if(!D&&k!=S){var P,$=N.labelInfo={label:k,color:X("group.title.color"),font:X("group.title.font"),align:X("group.title.align")},m=fs($,k),i=m.width,p=m.height,e=X("group.title.align"),L=X("group.title.orientation");if((L===Dc||L===fd)&&i>B.width?B.width=i:(L===zc||L===br)&&i>B.height&&(B.height=i),$.rect={y:B.y-p,width:m.width,height:p},P=e===zc?B.x:e===br?B.x+B.width-i:B.x+B.width/2-i/2,$.rect.x=P,L===fd)W.titleRect={x:B.x,y:B.y+B.height,width:B.width,height:p},W.rect={x:B.x,y:B.y,width:B.width,height:B.height+p},$.rect={x:P,y:B.y+B.height,width:i,height:p};else if(L===zc){var y=W.titleRect={x:B.x-p,y:B.y,width:p,height:B.height};W.rect={x:B.x-p,y:B.y,width:B.width+p,height:B.height},$.rect={x:y.x+p/2-B.height/2,y:y.y+B.height/2-p/2,width:B.height,height:p},$.rotation=-Math.PI/2}else if(L===br){var y=W.titleRect={x:B.x+B.width,y:B.y,width:p,height:B.height};W.rect={x:B.x,y:B.y,width:B.width+p,height:B.height},$.rect={x:y.x+p/2-B.height/2,y:y.y+B.height/2-p/2,width:B.height,height:p},$.rotation=Math.PI/2}else W.titleRect={x:B.x,y:B.y-p,width:B.width,height:p+1},W.rect={x:B.x,y:B.y-p,width:B.width,height:B.height+p}}N._40O(W,X("group.border.width")/2)}else vs.superClass._3O.call(N)},getPosition:function(W,J,A,g){var q=this._88I;if(q){var f=_l(W,q.rect,g);return f.x+=J,f.y+=A,f}return vs.superClass.getPosition.apply(this,arguments)},_24O:function(B,T){var y=this._88I;(!y||y.type||"label2"===B)&&vs.superClass._24O.call(this,B,T)},_80o:function(l){var x=this,f=x._88I;if(f){var n=x._data,V=x.s,z=x.gv,u=f.type,m=f.rect,r=f._64o,B=f.titleRect,E=x.getBodyColor(),k=Oi(V("group.image"),E),J=V("group.image.stretch"),j=x.getBodyColor("group.background"),w=Oi(V("group.repeat.image"),E),q=V("group.gradient.pack"),D=V("group.gradient"),s=V("group.gradient.color"),a=V("group.border.width"),U=V("group.border.color"),O=V("group.border.pattern"),$=V("group.title.orientation"),p=V("group.depth");if(u){var N=l.lineJoin,t=l.lineCap;if(l.lineJoin=V("group.border.join"),l.lineCap=V("group.border.cap"),k){if(l.save(),Lg(l,u,m),l.clip(),ng(l,k,J,m.x,m.y,m.width,m.height,n,z,E),l.restore(),a>0){var I=xd(l,O);Lg(I,u,m),l.lineWidth=a,l.strokeStyle=U,l.stroke(),_h(l,O)}}else{var I=xd(l,O);j||w||q?(Lg(l,u,m),q?Tb(l,q):w?er(l,w,E,null,n,z):Rb(l,j,D,s,m),l.fill(),q&&l.restore(),l!==I&&Lg(I,u,m)):Lg(I,u,m),a>0&&(l.lineWidth=a,l.strokeStyle=V("group.border.color"),l.stroke()),_h(l,O),u===Ni&&Pd(l,j,p,m)}l.lineJoin=N,l.lineCap=t}else{var S=V("group.title.background"),_=V("group.border.radius");if(k)ng(l,k,J,r.x,r.y,r.width,r.height,n,z,x.getBodyColor());else if(j||w)if(w?er(l,w,E,null,n,z):Rb(l,j,D,s,r),0===a)Lg(l,Ni,r),l.fill(),Pd(l,j,p,r);else{switch(l.beginPath(),$){case fd:Ik(l,r.x,r.y,r.width,r.height,_,_,0,0);break;case zc:Ik(l,r.x,r.y,r.width,r.height,0,_,0,_);break;case br:Ik(l,r.x,r.y,r.width,r.height,_,0,_,0);break;case Dc:Ik(l,r.x,r.y,r.width,r.height,0,0,_,_)}l.fill()}if(B&&S)if(0===a)Eh(l,B.x,B.y,B.width,B.height,S),Pd(l,S,p,B);else{switch(l.beginPath(),l.fillStyle=S,$){case fd:Ik(l,B.x,B.y,B.width,B.height,0,0,_,_);break;case zc:Ik(l,B.x,B.y,B.width,B.height,_,0,_,0);break;case br:Ik(l,B.x,B.y,B.width,B.height,0,_,0,_);break;case Dc:Ik(l,B.x,B.y,B.width,B.height,_,_,0,0)}l.fill()}if(a>0){var I=xd(l,O);if(Lg(I,"roundRect",m,_),l.lineWidth=a,l.strokeStyle=U,B&&V("group.splitLine")){var F=B.x,W=B.y,Y=B.width,e=B.height;$===fd?(l.moveTo(F,W),l.lineTo(F+Y,W)):$===zc?(l.moveTo(F+Y,W),l.lineTo(F+Y,W+e)):$===br?(l.moveTo(F,W),l.lineTo(F,W+e)):(l.moveTo(F,W+e),l.lineTo(F+Y,W+e))}l.stroke(),_h(l,O)}}x._39O(l,f)}else vs.superClass._80o.call(x,l)}});var mc=function(U,s){Lk(mc,this,[U,s])};jd(mc,re,{_80o:function(n){this._39O(n,this._83o)}});var Fd=function(k,O){Lk(Fd,this,[k,O])};jd(Fd,re,{_3O:function(){var R=this,m=R._data,x=R.s,k=R.gv,O=m.getPoints(),o=k.getBorderColor(m),J=o?x("border.width"):0,A=R.getSelectWidth(),C=x("shape.border.width"),E=m.getRect(),f=m.getAnchorRect(),p=k.getBodyColor(m),w=R._99o=O.isEmpty()?S:{rect:E,rotation:m.getRotation(),fillRule:x("shape.fill.rule"),scale:m.getScale(),position:m.p(),points:O,segments:m.getSegments(),bodyColor:p,borderColor:o,borderWidth:J,_94o:x("shape.border.3d"),_95o:x("shape.border.3d.color"),_96o:x("shape.border.3d.accuracy"),_97o:A?R.getSelectColor():S,selectWidth:A,_53o:x("shape.background"),_27Q:Oi(x("shape.repeat.image"),p),shapeGradientPack:x("shape.gradient.pack"),_54o:C,_55o:x("shape.border.color"),shapeGradient:x("shape.gradient"),_59o:x("shape.gradient.color"),_60o:x("shape.border.pattern"),_61o:x("shape.border.cap"),_62o:x("shape.border.join"),shapeForeground:x("shape.foreground"),gray:x("2d.gray")};if(w){f.x+=w.position.x,f.y+=w.position.y,w.gradientRect=f;var P=m.getScale(),v=V(1,V(M(P.x),M(P.y)));x("shape.dash")&&x("shape.dash.width")>C&&(C=x("shape.dash.width"));var Y=C*("square"===w._61o?.71:.5)+J+A/R.gv._zoom/v;Y&&(Y*=v,E=or(E),db(E,Y,w._62o)),R._68o(E);var h=x("clip.percentage");1>h&&(0>h&&(h=0),w.clipRect=Jb(m.getAnchorRect(),x("clip.direction"),h));var T=x("shape.fill.clip.percentage");1>T&&(0>T&&(T=0),w.shapeClipRect=Jb(m.getAnchorRect(),x("shape.fill.clip.direction"),T));var c=x("shape.foreground.clip.percentage");1>c&&(0>c&&(c=0),w.shapeForegroundClipRect=Jb(m.getAnchorRect(),x("shape.foreground.clip.direction"),c))}},getPosition:function(T,h,l,O){var L=this._99o;if(L){var E=_l(T,L.rect,O);return E.x+=h,E.y+=l,E}return No},_42:function(P){this._99o&&Fd.superClass._42.call(this,P)},_80o:function(K){var b,s=this,r=s.s,g=s._99o,d=g.position,n=g.scale,F=g.rotation,G=g.borderWidth,k=g.selectWidth/s.gv._zoom,M=g._27Q,x=g.shapeGradientPack,$=g._54o,y=g.clipRect,V=g.shapeClipRect,T=g.points,q=g.segments,N=s._data.isClosePath(),w=g.fillRule,A=g.gray,p=function(b){return A?X.toGrayColor(b):b},e=p(g._53o),R=e||M||x;K.save(),As(K,d.x,d.y),ap(K,F),ce(K,n.x,n.y),y&&(K.beginPath(),K.rect(y.x,y.y,y.width,y.height),K.clip()),R&&V&&(K.save(),K.beginPath(),K.rect(V.x,V.y,V.width,V.height),K.clip()),As(K,-d.x,-d.y);var i=g._60o,Q=xd(K,i),H=K.lineJoin,P=K.lineCap;K.lineJoin=g._62o,K.lineCap=g._61o;var u=p(g.bodyColor);R?($f(K,T,q,N),x?Tb(K,x):M?er(K,M,u,null,s._data,s.gv):(b=u?u:e,Rb(K,b,g.shapeGradient,p(g._59o),g.gradientRect)),K.fill(w),V&&(K.restore(),As(K,-d.x,-d.y)),x&&K.restore(),Q!==K&&$f(Q,T,q,N)):$f(Q,T,q,N);var _=g.shapeForeground;if(_){K.save();var D=g.shapeForegroundClipRect;D&&(As(K,d.x,d.y),K.beginPath(),K.rect(D.x,D.y,D.width,D.height),K.clip(),As(K,-d.x,-d.y)),$f(K,T,q,N),Rb(K,_,r("shape.foreground.gradient"),p(r("shape.foreground.gradient.color")),g.gradientRect),K.fill(w),K.restore()}var B=r("shape.border.width.absolute");if(B&&(K.save(),K.setTransform(1,0,0,1,0,0)),k&&(K.strokeStyle=g._97o,K.lineWidth=$+2*(G+k),K.stroke()),G&&(K.strokeStyle=p(g.borderColor),K.lineWidth=$+2*G,K.stroke()),$&&(b=p(g._55o),!e&&u&&(b=u),K.strokeStyle=b,K.lineWidth=$,K.stroke(),g._94o&&bf(K,b,p(g._95o),$,s.gv._zoom,g._96o)),B&&K.restore(),_h(K,i),r("shape.dash")){var J=r("shape.dash.width")||$;if(J>0){i=r("shape.dash.pattern");var Q=xd(K,i,s._2Q("shape.dash.offset"));Q!==K&&$f(Q,T,q,N),s._1Q(K,"shape",J,i)}}K.lineJoin=H,K.lineCap=P,K.restore()},_48O:function(){},_47O:function(){}});var Bn=function(R,z){Lk(Bn,this,[R,z])};jd(Bn,Fd,{getRotation:function(x,K,L){x=x||0;var h=this._data.getPoints(),D=h.size();return D>1?Jg[L]?D&&0===D%2?ir(h.get(D/2-1),h.get(D/2),K,x):x:Tj[L]?ir(h.get(0),h.get(1),K,x):ir(h.get(D-2),h.get(D-1),K,x):x},getPosition:function(o,U,L,z,W){var E=this._data.getPoints(),Y=E.size();if(Y>1){if(Jg[o]){var c=Y%2;if(0===c)return Eo(E.get(Y/2-1),E.get(Y/2),o,U,L,z,W);var B=E.get((Y-c)/2),y={x:B.x,y:B.y,width:0,height:0};return B=_l(o,y,z),B.x+=U,B.y+=L,B}return Tj[o]?Eo(E.get(0),E.get(1),o,U,L,z,W):Eo(E.get(Y-2),E.get(Y-1),o,U,L,z,W)}return No}});var Uj=function(p,Z){Lk(Uj,this,[p,Z])};jd(Uj,re,{_3O:function(){var H=this;Uj.superClass._3O.call(H);var y=H.s,X=H._83o;H._82o=X.img||X.shape?S:{background:H.getBodyColor("grid.background"),depth:y("grid.depth"),rect:X.rect,_88o:y("grid.cell.depth"),cellBorderColor:y("grid.cell.border.color"),_89o:y("grid.row.count"),_90o:y("grid.column.count"),block:y("grid.block"),_91o:y("grid.block.color"),_92o:y("grid.block.padding"),_93o:y("grid.block.width")}},_80o:function(k){var u=this,n=u._82o;if(!n)return Uj.superClass._80o.call(u,k),void 0;var i,E,P=u._data,G=n.background,H=n.rect,t=n.block,K=n._91o,z=n._92o,b=n._93o,U=n._88o,o=n.cellBorderColor,g=n._89o,_=n._90o;if(G)if(Eh(k,H.x,H.y,H.width,H.height,G),Pd(k,G,n.depth,H),U)for(i=0;g>i;i++)for(E=0;_>E;E++)H=P.getCellRect(i,E),H&&Pd(k,G,U,H);else if(o){for(k.beginPath(),i=0;g>i;i++)for(E=0;_>E;E++)H=P.getCellRect(i,E),H&&k.rect(H.x,H.y,H.width,H.height);k.strokeStyle=o,k.lineWidth=1,k.stroke()}if("h"===t)for(i=0;g>i;i++)H=Vg(P.getCellRect(i,0),P.getCellRect(i,_-1)),Vo(H,z),uc(k,K,H.x,H.y,H.width,H.height,b);else if("v"===t)for(E=0;_>E;E++)H=Vg(P.getCellRect(0,E),P.getCellRect(g-1,E)),Vo(H,z),uc(k,K,H.x,H.y,H.width,H.height,b);u._39O(k,u._83o)}});var Uk=function(p,U){Lk(Uk,this,[p,U])};jd(Uk,re,{_checkEmptyRect:!1,_81o:function(){var L=this._data,y=Uk.superClass._81o.call(this),e=L.s("text");if(e!=S){var b,E,X=L.s("text.font"),M=L.s("text.align"),u=L.s("text.vAlign"),s=rj(X,e),A=s.width,G=s.height,m=L.getAnchor(),f=L.getWidth(),q=L.getHeight();"left"===M?b=-f*m.x:"center"===M?b=-f*m.x+(f-A)/2:"right"===M&&(b=f*(1-m.x)-s.width),"top"===u?E=-q*m.y:"middle"===u?E=-q*m.y+(q-G)/2:"bottom"===u&&(E=q*(1-m.y)-s.height);var n,P=L.getMatrix();if(n=Mn([P.tf(b,E),P.tf(b+A,E),P.tf(b+A,E+G),P.tf(b,E+G)]),y=Vg(y,n),y&&L.s("text.shadow")){var x=or(y);x.x+=L.s("text.shadow.offset.x"),x.y+=L.s("text.shadow.offset.y"),Vo(x,L.s("text.shadow.blur")),y=Vg(y,x)}}return y}});var cf=Ee.Interactor=function(o){this.gv=this._graphView=o};cs("Interactor",G,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners(),this.clear()},clear:function(){},fi:function(I){this.gv.fi(I)},setCursor:function(Z){xl||this.gv.setCursor(Z)},startDragging:function(F){var w=this;w._lastClientPoint=Xd(F),w._lastLogicalPoint=w.gv.lp(F),sm(w,F)},clearDragging:function(){var J=this;J._lastClientPoint=J._lastLogicalPoint=J._logicalPoint=S},autoScroll:function(s){return this.gv.autoScroll(s,this._lastClientPoint)}});var kj=S,pp=function(e){kj.handleWindowTouchMove(e)},Yl=function(I){kj.handleWindowTouchEnd(I),F(E,pc,pp),F(E,ik,Yl),kj=S},pr=function(t){kj.handleWindowMouseMove(t)},pl=function(_){kj.handleWindowMouseUp(_),F(E,zk,pr),F(E,ag,pl),kj=S},wk=function(B,X){B!==kj&&(kj?xl?kj.handleWindowTouchEnd(X):kj.handleWindowMouseUp(X):xl?(s(E,pc,pp),s(E,ik,Yl)):(s(E,zk,pr),s(E,ag,pl)),kj=B)},Vi=function(o){var v=this;v.gv=o,v._is2d=o instanceof Ee.GraphView,v._eventListeners={},v._is2d&&(v.filter=function(u){return o.isSelectable(u)&&o.isInteractive(u)}),o.getView(),["mousedown","mousemove","mouseleave","touchstart","touchmove",Db].forEach(function(w){v.addListener(w)}),v.initImageResource()
};jd(Vi,cf,{enableVR:function(q){var g=this;if(!!g._vrEnable!==q)if(g._vrEnable=q,q)g.gv.vr.mp(g.onVRControllerChange,g);else if(g.gv.vr.ump(g.onVRControllerChange,g),g._vrRayPolyline){var W=g.gv.dm();W.remove(g._vrRayPolyline),W.remove(g._vrRayHitPoint),g._vrRayPolyline=d,g._vrRayHitPoint=d}},onVRControllerChange:function(m){var R=this,S=m.property,u=m.newValue,O=R.gv.vr.getController(u.id),r=O.getRay();r&&("gamepad.button.trigger"===S?"down"===u._62O?R.handle_mousedown(r):R.handleWindowMouseUp(r):"gamepad.pose"===S&&(R.handle_mousemove(r),R.handleWindowMouseMove(r)))},drawVRRay:function(X,w,z){var G,Y=this,N=Y.gv,h=Y._vrRayPolyline,o=!1;if(h)G=Y._vrRayHitPoint;else{var x=N.dm();Y._vrRayPolyline=h=new W.Polyline,Y._vrRayHitPoint=G=new W.Node,G.s({shape3d:"billboard","shape3d.transparent":!0,"shape3d.texture.scale":10,"shape3d.image":"coreInteractorRayHitImage"}),G.setAnchor3d(.5,.5,.499);var P=.2/N.vr.measureOflength;G.s3(P,P,P),h.s("intersect",!1),G.s("intersect",!1),x.add(h),x.add(G),o=!0}if(w){var u=z.world,b=z.worldNormal,c=u.x,i=u.y,H=u.z;h.s("shape.border.color","red"),h.setPoints([{x:X.origin.x,y:X.origin.z,e:X.origin.y},{x:c,y:H,e:i}]),G.s("3d.visible",!0),G.p3(c,i,H),G.lookAtDirection([b.x,b.y,b.z],"front")}else{h.s("shape.border.color","blue");var e=new W.Math.Vector3;e.copy(X.direction).setLength(1e3/Y.gv.vr.measureOflength).add(X.origin),h.setPoints([{x:X.origin.x,y:X.origin.z,e:X.origin.y},{x:e.x,y:e.z,e:e.y}]),G.s("3d.visible",!1)}N.fi({kind:"vrRayIntersect",ray:X,data:w,intersect:z,polyline:h,hitNode:G,begin:o})},setPreventEventDefault:function(D,C){var X=this,s=X._eventListeners[D];s?s._prevent=C:X._eventListeners[D]=s={_removal:d,_prevent:C}},removeListener:function(R){var X=this,j=X._eventListeners[R];j&&j._removal&&(j._removal(),j._removal=d)},addListener:function(R){var O=this,M=O._eventListeners[R];if(M||(O._eventListeners[R]=M={_removal:d,_prevent:!0}),!M||!M._removal){var D=function(m){M._prevent&&X.preventDefault(m),O.disabled||O["handle_"+R](m)};s(O.gv.getView(),R,D),M._removal=function(){F(O.gv.getView(),R,D)}}},handleWindowTouchMove:function(K){this.handleWindowMouseMove(K)},handleWindowMouseMove:function(k){this.downInfo&&(this.isDragging?this.handleDownInfo("onDrag",k):(this.handleDownInfo("onBeginDrag",k),this.isDragging=!0))},handleWindowTouchEnd:function(O){this.handleWindowMouseUp(O)},handleWindowMouseUp:function(n){if(this.isDragging&&(this.handleDownInfo("onEndDrag",n),this.isDragging=!1),this.downInfo){var y=this.handle("onUp",n);if(y&&y.data===this.downInfo.data){this.handleMissingUp(n);var P=this,K=2===n.button?"onContextMenu":"onClick";if(!P._dbclickTimer)return P._dbclickTimer=J(function(){delete P._dbclickTimer,P.handleClick(n,K,y),this.downInfo=S},X.clickDelay),void 0;B(P._dbclickTimer),delete P._dbclickTimer,K="onDoubleClick",P.handleClick(n,K,y)}else this.handleDownInfo("onUp",n);this.downInfo=S}},handle_mouseleave:function(J){var C=this,H=C.gv,k=C.currentInfo?C.currentInfo.data:S;if(k){k.s("onLeave")&&k.s("onLeave")(J,k,H),C.fire("data","onLeave",J,k);var s=C.currentInfo?C.currentInfo.hits:S;if(s)for(var M in s)C.handleLeave(J,M);C.currentInfo=S}},handle_mousewheel:function(H){H.scrollDelta=H.wheelDelta/40,this.handle("onScroll",H)},handle_DOMMouseScroll:function(r){r.scrollDelta=2===r.axis?-r.detail:0,this.handle("onScroll",r)},handle_touchstart:function(W){this.handle_mousedown(W)},handle_touchmove:function(o){this.handle("onMove",o)},handle_mousedown:function(V){this.isDragging&&(this.handleDownInfo("onEndDrag",V),this.isDragging=!1),this.downInfo=this.handle("onDown",V),this.downInfo&&wk(this,V)},handle_mousemove:function(I){var f=this,k=f.gv;f._hoverTimer&&(B(f._hoverTimer),delete f._hoverTimer);var m,h,N,z=f.handle("onMove",I),d=this.currentInfo?this.currentInfo.data:S,Q=this.currentInfo?this.currentInfo.hits:S;if(z&&(h=z.data,N=z.hits,f._hoverTimer=J(function(){B(f._hoverTimer),delete f._hoverTimer,f.handle("onHover",I,z)},k.getHoverDelay()||X.hoverDelay)),h!==d){if(d&&(d.s("onLeave")&&d.s("onLeave")(I,d,k),this.fire("data","onLeave",I,d)),h&&(h.s("onEnter")&&h.s("onEnter")(I,h,k),this.fire("data","onEnter",I,h)),Q)for(m in Q)this.handleLeave(I,m);if(N)for(m in N){var M=N[m];M.target.onEnter&&M.target.onEnter(I,h,k,M.point,M.width,M.height),this.fire(M.type,"onEnter",M.event,M.data,M.image,M.comp,M.point,M)}}else{if(Q)for(m in Q)N&&N[m]||this.handleLeave(I,m);if(N)for(m in N)if(!Q||!Q[m]){var M=N[m];M.target.onEnter&&M.target.onEnter(I,h,k,M.point,M.width,M.height),this.fire(M.type,"onEnter",M.event,M.data,M.image,M.comp,M.point,M)}}this.currentInfo=z},handle:function(Z,U,u){var i,m=this,J=m.gv;if(m._is2d){if(u=u||J.getDataInfoAt(U,this.filter),!u)return;if(i=u.ui.interactiveInfo){var Y,s=u.data;if(s.s(Z)&&s.s(Z)(U,s,J),this.fire("data",Z,U,s),"body"===u.part&&i.bodyInfo)Y="body",u.hits=this.handleImage(Y,J.getImage(s),Z,U,s,u.point,i.bodyInfo);else if("icons"===u.part&&i._38o){var N=i._38o[u.name];N&&N[u.index]&&(Y="icons|"+u.name+"|"+u.index,u.hits=this.handleImage(Y,u.icon,Z,U,s,u.point,N[u.index]))}}return u}var s,x;if(!u)if(U&&U instanceof W.Math.Ray){var l=J.vr.intersectWorld(U);if(s=l.data,x=l.intersect,m.drawVRRay(U,s,x),!s)return;var k=J.getData3dUI(s);if(i=k.interactiveInfo,!i)return;u={data:s,part:x.part,ui:k}}else{if(u=J.getDataInfoAt(U),!u)return;u&&(u={data:u.data,part:u.part})}if(J.isInteractive(u.data)){if(!x){s=u.data;var k=J.getData3dUI(s);if(u.ui=k,i=k.interactiveInfo,!i)return u;if(x=J.intersectObject(U,s),!x)return}s.s(Z)&&s.s(Z)(U,s,J),this.fire("data",Z,U,s);var T,H=x.part;return"body"!==H&&(T=s.s(H+".image")||s.s("shape3d."+H+".image")),T||(T=s.s("all.image")||s.s("shape3d.image")),i="object"==typeof T?i[T.uuid]:i[T],i&&i.bodyInfo?(u.part="body",u.interactiveInfo=i,u.point=x.uv.multiply({x:i.bodyInfo.rect.width,y:i.bodyInfo.rect.height}),u.image=T,u.hits=this.handleImage("body",T,Z,U,s,u.point,i.bodyInfo),u):u}},_handleLeaveOrMissing:function(e,d,x){var E="leave"===e?this.currentInfo:this.downInfo;if(E){var H=E.interactiveInfo||E.ui.interactiveInfo;if(H){var s,T,n=E.data;if(this._is2d){if(T=this.gv.lp(d),"body"===E.part&&H.bodyInfo)s="body","leave"===e?this.handleLeaveImage(x,s,this.gv.getImage(n),d,n,T,H.bodyInfo):this.handleMissingUpImage(s,this.gv.getImage(n),d,n,T,H.bodyInfo);else if("icons"===E.part&&H._38o){var O=H._38o[E.name];O&&O[E.index]&&(s="icons|"+E.name+"|"+E.index,"leave"===e?this.handleLeaveImage(x,s,E.icon,d,n,T,O[E.index]):this.handleMissingUpImage(s,E.icon,d,n,T,O[E.index]))}}else{if(!H.bodyInfo)return;var f=this.gv.intersectObject(d,n);T=f?f.uv.multiply({x:H.bodyInfo.rect.width,y:H.bodyInfo.rect.height}):{x:1/0,y:1/0},"leave"===e?this.handleLeaveImage(x,"body",E.image,d,n,T,H.bodyInfo):this.handleMissingUpImage("body",E.image,d,n,T,H.bodyInfo)}}}},handleClick:function(E,X,Y){var V=this,h=this.downInfo;if(h&&Y){var H,O=Y.interactiveInfo||Y.ui.interactiveInfo,o=Y.data,b=this.gv;if(o.s(X)&&o.s(X)(E,o,b),V.fire("data",X,E,o),O)if(this._is2d){if(h.part===Y.part){var n=b.lp(E);"body"===Y.part&&O.bodyInfo&&(H="body",this.handleClickImage(H,b.getImage(o),X,E,o,n,O.bodyInfo,Y))}}else{if(!O.bodyInfo)return;var L=b.intersectObject(E,o);if(!L)return;n=L.uv.multiply({x:O.bodyInfo.rect.width,y:O.bodyInfo.rect.height}),this.handleClickImage("body",h.image,X,E,o,n,O.bodyInfo,Y)}}},handleDownInfo:function(F,G){if(this.downInfo){var h=this.downInfo,p=this.gv,D=h.interactiveInfo||h.ui.interactiveInfo;if(D){var B,E=h.data;if(E.s(F)&&E.s(F)(G,E,p),this.fire("data",F,G,E),this._is2d){var I=p.lp(G);if("body"===h.part&&D.bodyInfo)B="body",this.handleDownInfoImage(B,p.getImage(E),F,G,E,I,D.bodyInfo);else if("icons"===h.part&&D._38o){var S=D._38o[h.name];S&&S[h.index]&&(B="icons|"+h.name+"|"+h.index,this.handleDownInfoImage(B,h.icon,F,G,E,I,S[h.index]))}}else{if(!D.bodyInfo)return;var x=p.intersectObject(G,E);if(!x)return;I=x.uv.multiply({x:D.bodyInfo.rect.width,y:D.bodyInfo.rect.height}),this.handleDownInfoImage("body",h.image,F,G,E,I,D.bodyInfo)}}}},fire:function(i,W,G,m,I,y,x,o){this.gv.fi({kind:W,type:i,event:G,data:m,image:I,comp:y,view:this.gv,point:x,width:o?o.width:d,height:o?o.height:d})},handleImage:function(n,k,C,w,W,U,g){var f={};if(k&&(k=Oi(k))){var z=this.gv,o=g.rect,v=this.convertPoint(U,g);v.inRect&&(k[C]&&k[C](w,W,z,v,o.width,o.height),this.fire("image",C,w,W,k,d,v,o),f[n+"|image"]={target:k,type:"image",image:k,data:W,event:w,point:v,width:o.width,height:o.height});for(var N=g.compInfos,x=k,S=N.length-1;S>=0;S--){var B=N[S],I=B.comp;v=this.convertPoint(U,B,x,I,z,W),v.inRect&&(o=B.rect,W._interactPrefix=B.prefix,I[C]&&I[C](w,W,z,v,o.width,o.height),this.fire("comp",C,w,W,k,I,v,o),(k=o.image)&&(k[C]&&k[C](w,W,z,v,o.width,o.height),this.fire("image",C,w,W,k,d,v,o)),W._interactPrefix=null,f[n+"|"+S]={target:I,type:"comp",comp:I,image:k,data:W,event:w,point:v,width:o.width,height:o.height},k&&(f[n+"|"+S+"|image"]={target:k,type:"image",image:k,data:W,event:w,point:v,width:o.width,height:o.height}))}}return f},handleLeave:function(Z,m){return this._handleLeaveOrMissing("leave",Z,m)},handleMissingUp:function(p){return this._handleLeaveOrMissing("missing",p)},handleLeaveImage:function(J,U,r,u,z,m,q){if(r&&(r=Oi(r))){var f=this.gv,Q=q.rect,C=this.convertPoint(m,q);J===U+"|image"&&(r.onLeave&&r.onLeave(u,z,f,C,Q.width,Q.height),this.fire("image","onLeave",u,z,r,d,C,Q));for(var T=q.compInfos,p=r,y=T.length-1;y>=0;y--){var b=T[y],V=b.comp;C=this.convertPoint(m,b,p,V,f,z),Q=b.rect,z._interactPrefix=b.prefix,J===U+"|"+y&&(V.onLeave&&V.onLeave(u,z,f,C,Q.width,Q.height),this.fire("comp","onLeave",u,z,r,V,C,Q)),(r=Q.image)&&J===U+"|"+y+"|image"&&(r.onLeave&&r.onLeave(u,z,f,C,Q.width,Q.height),this.fire("image","onLeave",u,z,r,d,C,Q)),z._interactPrefix=null}}},handleMissingUpImage:function(a,w,W,C,y,v){var c="onUp",z=this.downInfo.hits;if(z&&w&&(w=Oi(w))){var Z=this.gv,n=v.rect,e=this.convertPoint(y,v);!e.inRect&&z[a+"|image"]&&(w[c]&&w[c](W,C,Z,e,n.width,n.height),this.fire("image",c,W,C,w,d,e,n));for(var A=v.compInfos,m=w,o=A.length-1;o>=0;o--){var B=A[o],H=B.comp;e=this.convertPoint(y,B,m,H,Z,C),e.inRect||(n=B.rect,C._interactPrefix=B.prefix,z[a+"|"+o]&&(H[c]&&H[c](W,C,Z,e,n.width,n.height),this.fire("comp",c,W,C,w,H,e,n)),(w=n.image)&&z[a+"|"+o+"|image"]&&(w[c]&&w[c](W,C,Z,e,n.width,n.height),this.fire("image",c,W,C,w,d,e,n)),C._interactPrefix=null)}}},handleDownInfoImage:function(T,Y,Z,N,l,E,X){var J=this.downInfo.hits;if(J&&Y&&(Y=Oi(Y))){var h=this.gv,C=X.rect,$=this.convertPoint(E,X);J[T+"|image"]&&(Y[Z]&&Y[Z](N,l,h,$,C.width,C.height),this.fire("image",Z,N,l,Y,d,$,C));for(var W=X.compInfos,m=Y,a=W.length-1;a>=0;a--){var P=W[a],U=P.comp;$=this.convertPoint(E,P,m,U,h,l),C=P.rect,l._interactPrefix=P.prefix,J[T+"|"+a]&&(U[Z]&&U[Z](N,l,h,$,C.width,C.height),this.fire("comp",Z,N,l,Y,U,$,C)),(Y=C.image)&&J[T+"|"+a+"|image"]&&(Y[Z]&&Y[Z](N,l,h,$,C.width,C.height),this.fire("image",Z,N,l,Y,d,$,C)),l._interactPrefix=null}}},handleClickImage:function(q,K,e,C,U,s,h,x){var a=this.downInfo.hits,E=x.hits;if(a&&K&&(K=Oi(K))){var f=this.gv,G=h.rect,t=this.convertPoint(s,h);a[q+"|image"]&&(K[e]&&K[e](C,U,f,t,G.width,G.height),this.fire("image",e,C,U,K,d,t,G));for(var P=h.compInfos,o=K,y=P.length-1;y>=0;y--){var D=P[y],M=D.comp;t=this.convertPoint(s,D,o,M,f,U),G=D.rect,U._interactPrefix=D.prefix,a[q+"|"+y]&&E[q+"|"+y]&&(M[e]&&M[e](C,U,f,t,G.width,G.height),this.fire("comp",e,C,U,K,M,t,G)),(K=G.image)&&a[q+"|"+y+"|image"]&&(K[e]&&K[e](C,U,f,t,G.width,G.height),this.fire("image",e,C,U,K,d,t,G)),U._interactPrefix=null}}},initImageResource:function(){X.setImage("coreInteractorRayHitImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",opacity:.3,rotation:-1.593,rect:[.73315,.6933,14.5337,14.61341]},{type:"oval",background:"rgb(255,0,0)",borderWidth:1,borderColor:"rgb(250,120,120)",rotation:-1.593,rect:[3.56695,3.75073,8.8661,8.49856]}]})},convertPoint:function(r,I,s,z,n,k){var P=I.rect,F=I.matrix.applyInverse(r).sub(P),h=F.x>=0&&F.y>=0&&F.x<=P.width&&F.y<=P.height;if(!h)return F;if(z&&lp(z.pixelPerfect,k,n)){var P,p=1;this._is2d?(p=n.getZoom(),P=Ql(r.x,r.y,d,p)):P=Ql(r.x,r.y);var J=!1,V=P.x,g=P.y,G=P.width,O=P.height,Q=X.hitMaxArea,u=G*O*p*p;if(u>Q){var A=Math.sqrt(Q/u);p*=A}G*=p,O*=p,2>G&&(G=2),2>O&&(O=2),V*=p,g*=p;var U=eg(G,O),W=new We(0,-V,-g,p,p);W.append(I.matrix),n._drawForChecking=!0,z.transform=W;var N=s.comps;s.comps=[z],rl(U,s,0,0,G,O,k,self),s.comps=N,delete z.transform,n._drawForChecking=!1;try{for(var K=0,b=U.getImageData(0,0,G,O).data;K<b.length;K+=4)if(0!==b[K+3]){J=!0;break}U.restore()}catch(R){wr=S,J=!1}F.inRect=J}else F.inRect=!0;return F}});var _k=Ee.DefaultInteractor=function(m){Lk(_k,this,[m])};cs("DefaultInteractor",cf,{handle_mousedown:function(u){Ub(u);var o=this,K=o.gv,M=K.getDataAt(u);if(K.setFocus(u)&&!K._editing&&!K._scrolling){Qg(u)?K.handleDoubleClick(u,M):K.handleClick(u,M);var Q=Ih(u);!Aq()&&!Q&&M&&(K.isMovable(M)||K._39Q(M))||!K.isPannable()||!bh(u)&&!Q||nl(u)||(o._tx=K.tx(),o._ty=K.ty(),o.startDragging(u))}},handleWindowMouseUp:function(V){var q=this,y=q.gv;y._panning&&(delete y._panning,y.onPanEnded(),q.fi({kind:"endPan",event:V})),delete q._tx,delete q._ty,q.clearDragging()},handle_mousemove:function(L){var R=this,Q=R.gv;R._hoverTimer&&(B(R._hoverTimer),delete R._hoverTimer),R._hoverTimer=J(function(){R.fi({kind:"hover",event:L}),B(R._hoverTimer),delete R._hoverTimer},Q.getHoverDelay()||X.hoverDelay)},handle_touchmove:function(R){this.handle_mousemove(R)},handleWindowMouseMove:function(f){var U=this,r=U.gv;U.fi({kind:r._panning?"betweenPan":"beginPan",event:f}),r._panning=1;var F=Gi(r,f,U._lastClientPoint);r.setTranslate(U._tx+F.x,U._ty+F.y)},handle_mousewheel:function(o){this.gv.handleScroll(o,o.wheelDelta)},handle_DOMMouseScroll:function(w){2===w.axis&&this.gv.handleScroll(w,-w.detail)},handle_keydown:function(x){this.gv.handleKeyDown(x)}});var Mj=Ee.SelectInteractor=function(b){Lk(Mj,this,[b])};cs("SelectInteractor",cf,{_42:function(){var y=this,n=y.gv,P=n.getZoom(),u=y.mark,p=y.div;p||(p=y.div=Zj(),lc(y.getView(),p));var Y={};Y.x=u.x*P+n.tx(),Y.y=u.y*P+n.ty(),Y.width=u.width*P,Y.height=u.height*P,Ap(p,Y),this.intersects()?(p.style.border="",p.style.background=n.getRectSelectBackground()):(p.style.background="",p.style.border="1px solid "+n.getRectSelectBorderColor())},handle_mousedown:function(Z){var c=this,U=c.gv;if(c._57I=S,c.pendingClickThrough=S,!(U._editing||U._scrolling||Aq()||Ih(Z))){var s=U.getDataAt(Z),L=U.sm();s?nl(Z)?L.co(s)?L.rs(s):L.as(s):L.co(s)?s instanceof Cc&&s.isClickThroughEnabled()&&bh(Z)&&(c.pendingClickThrough=Xd(Z)):L.ss(s):nl(Z)||!U.isPannable()?bh(Z)&&(nl(Z)||L.cs(),U.isRectSelectable()&&(c.startDragging(Z),U._77O=1)):bh(Z)&&(c._57I=Xd(Z))}},handle_mouseup:function($){var b=this,M=b.gv,o=b._57I;if(o&&(zq(o,Xd($))<=1&&M.sm().cs(),b._57I=S),b.pendingClickThrough){if(zq(b.pendingClickThrough,Xd($))<=1){var U=M.getDataAt($);if(U instanceof Cc&&U.isClickThroughEnabled()){var Z=M.getDataAt($,function(Y){var c=Y.getParent()===U&&M.isSelectable(Y,!0);return c});Z&&($.clickThrough=!0,M.sm().ss(Z))}}b.pendingClickThrough=S}},handleWindowMouseUp:function(T){this.clear(T)},handleWindowMouseMove:function(h){var O=this,r=O.gv;O._logicalPoint=r.lp(h),O.mark?(O.fi({kind:"betweenRectSelect",event:h}),r.isPannable()&&O.autoScroll(h),O.redraw()):O.fi({kind:"beginRectSelect",event:h}),O.mark=Mn(O._lastLogicalPoint,O._logicalPoint),O.redraw()},intersects:function(){var O=this,J=O._lastLogicalPoint,d=O._logicalPoint;return J.x>d.x||J.y>d.y},clear:function(u){var f=this,R=f.gv,M=f.mark;if(f._57I=S,f.pendingClickThrough=S,f._lastLogicalPoint){if(M){if(0!==M.width&&0!==M.height){var h=R.getDatasInRect(M,f.intersects());if(!h.isEmpty()){var L=R.sm(),i=L.toSelection();h.each(function(S){L.co(S)?i.remove(S):i.add(S)}),L.ss(i)}}ws(f.div),delete f.div,delete f.mark,f.redraw(),f.fi({kind:"endRectSelect",event:u}),R.onRectSelectEnded()}f.clearDragging(),delete R._77O}},redraw:function(){var W=this;W._draw||(W._draw=1,J(function(){W.mark&&W._42(),delete W._draw},16))}});var Tl=Ee.MoveInteractor=function(X){Lk(Tl,this,[X])};cs("MoveInteractor",cf,{handle_mousedown:function(X){var V=this,N=V.gv;if(bh(X)&&!N._editing&&!N._scrolling&&!Aq()){var I=N.getSelectedDataAt(X);!I||N._39Q(I)&&!N.isMovable(I)?N._focusData=S:(V._data=I,N.handleMouseDown&&N.handleMouseDown(X,I),V.startDragging(X),N.isMovable(I)&&(N._moving=1))}},handleWindowMouseUp:function(W){var s=this,z=s.gv;z.handleMouseUp&&z.handleMouseUp(W,s._data),s.clear(W)},handleWindowMouseMove:function(U){var Z=this,N=Z._data,T=Z.gv;if((!T._93O||!T._93O(U,N))&&T._moving){Z._logicalPoint||Z.fi({kind:"prepareMove",event:U});var D=Z._logicalPoint?"betweenMove":"beginMove",W={kind:D,event:U},C=Z._logicalPoint=T.lp(U);"beginMove"!==D||Z._alreadyBeginTransaction||(Z._alreadyBeginTransaction=!0,T.getDataModel().beginTransaction());var z=Z._calcShift(D,U),_=z.x,j=z.y,t=Z.gv.getMoveMode(U,N);t&&("x"===t?j=0:"y"===t?_=0:"xy"!==t&&(_=j=0)),T.moveSelection(_,j),Z._lastLogicalPoint=C,Z.autoScroll(U),Z.fi(W)}},_calcShift:function(){var s=this,t=s._logicalPoint,R=s._lastLogicalPoint,D=t.x-R.x,Z=t.y-R.y;return{x:D,y:Z}},clear:function(M){var W=this,k=W.gv;W._lastLogicalPoint&&(W._lastLogicalPoint=W._data=k._moving=S,W._logicalPoint&&(W.fi({kind:"endMove",event:M}),k.onMoveEnded()),W.clearDragging()),W._alreadyBeginTransaction&&(W._alreadyBeginTransaction=!1,k.getDataModel().endTransaction())}});var Yg=Ee.TextEditInteractor=function(d){Lk(Yg,this,[d]),this.init()};cs("TextEditInteractor",cf,{init:function(){var r=this,n=this.input=l.createElement("input"),F=n.style;n.text="text",F.border="1px solid #d8d8d8",F.position="absolute",F.padding="2px 3px",F.outline="none",F.marginLeft="-90px",F.marginTop="-16px",F.backgroundColor="rgba(255,255,255, 0.9)",F.fontSize="14px",F.width="180px",F.height="32px",F.boxShadow="0 0 13px rgba(16,142,233, 0.5)",F.textAlign="center",F.boxSizing="border-box",s(n,"keyup",function(N){jo(N)&&r.endTextEdit()}),s(n,"focus",function(){n.select()});var m=this.textarea=l.createElement("textarea"),G=this.wrap=l.createElement("div");G.appendChild(m),F=m.style,F.margin=0,F.padding="4px",F.overflow="hidden",F.boxSizing="border-box",F.position="absolute",F.outline="none",F.backgroundColor="transparent",F.resize="none",F.textAlign="center",F.fontSize="14px",F.border="none",F.borderWidth=0,F.width="100%",F.top="50%",F=G.style,F.boxSizing="border-box",F.margin=0,F.padding=0,F.position="absolute",F.boxShadow="0 0 13px rgba(16,142,233, 0.5)",F.border="1px solid #d8d8d8",F.backgroundColor="rgba(255,255,255, 0.9)",F.width="180px",F.marginLeft="-90px",s(m,"keydown",function(B){return(Pn()||nl())&&jo(B)?(r.endTextEdit(),void 0):(r.calculateTextareaHeight(String.fromCharCode(B.keyCode)),void 0)}),s(m,"focus",function(){m.select()});var M=function(q){q.stopPropagation()};s(n,"mousedown",M),s(n,"touchstart",M),s(m,"mousedown",M),s(m,"touchstart",M),r.SIZING_STYLE=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],r.HIDDEN_TEXTAREA_STYLE="visibility:hidden; min-height:0 !important;max-height:none !important;height:0 !important;visibility:hidden !important;overflow:hidden !important;position:absolute !important;z-index:-1000 !important;top:0 !important;right:0 !important",r.handleWindowClick=function(x){var i=r._editingDOM,H=i.getBoundingClientRect(),e=Xd(x);th(H,e)||r.endTextEdit()}},handle_mousedown:function(p){var j=this,f=j.gv;if(Qg(p)&&!f._editing){var w=f.getDataAt(p);if(w){var B=f.getTextEditInfo(w);B&&(this._editInfo=B,this._editTarget=w,f._editing=!0,B.isMultiline?this.handleMultilineEdit():this.handleTextEdit())}}},handleMultilineEdit:function(){var a=this,f=a.gv,_=a._editTarget,n=a.getTargetValue(),o=a.textarea,Y=a.wrap;this.hiddenTextarea||this.createHiddenTextarea(),(null===n||n===d)&&(n=""),o.value=n,a._editingDOM=o,f.getView().appendChild(Y),this.layoutHTML(Y,_),this.calculateTextareaHeight(),J(function(){o.focus(),s(E,"mousedown",a.handleWindowClick),s(E,"touchstart",a.handleWindowClick)},10)},handleTextEdit:function(){var U=this,y=U.gv,l=U._editTarget,f=U.getTargetValue(),G=U.input;(null===f||f===d)&&(f=""),G.value=f,U._editingDOM=G,y.getView().appendChild(G),this.layoutHTML(G,l),J(function(){G.focus(),s(E,"mousedown",U.handleWindowClick),s(E,"touchstart",U.handleWindowClick)},10)},layoutHTML:function(V,T){var c=this.gv,G=c.getZoom();if(T instanceof W.Node){var b=T.getRect();V.style.left=(b.x+b.width/2)*G+c.tx()+"px",V.style.top=(b.y+b.height/2)*G+c.ty()+"px"}else if(T instanceof W.Edge){var f=c.getDataUI(T),b=f._6I;V.style.left=(b.x+b.width/2)*G+c.tx()+"px",V.style.top=(b.y+b.height/2)*G+c.ty()+"px"}},endTextEdit:function(){var k=this,v=k._editInfo.isMultiline?k.wrap:k.input,K=k._editInfo.isMultiline?k.textarea:k.input;k.setTargetValue(K.value),k.gv.getView().removeChild(v),k.gv._editing=!1,delete k._editingDOM,F(E,"mousedown",k.handlelick),F(E,"touchstart",k.handleWindowClick)},setTargetValue:function(A){var D=this,N=D._editTarget,i=D._editInfo,J=i.accessType,s=i.name;if(s&&J||(J="p",s="name"),"p"===J){var b=W.Default.setter(s);N[b](A)}else"a"===J?N.a(s,A):N.s(s,A)},getTargetValue:function(){var L=this,X=L._editTarget,H=L._editInfo,N=H.accessType,f=H.name;if(f&&N||(N="p",f="name"),"p"===N){var R=W.Default.getter(f);return X[R]()}return"a"===N?X.a(f):X.s(f)},createHiddenTextarea:function(){this.hiddenTextarea=l.createElement("textarea"),this.hiddenTextarea.setAttribute("style","margin:0; padding:0; position:absolute; overflowY:scroll; resize:none; box-sizing:border-box;"),this.hiddenTextarea.setAttribute("rows","1"),this.gv.getView().appendChild(this.hiddenTextarea)},calculateHTMLStyle:function($,G){if(G&&this.computedStyleCache)return this.computedStyleCache;var p=this,P=E.getComputedStyle($),I=P.getPropertyValue("box-sizing")||P.getPropertyValue("-moz-box-sizing")||P.getPropertyValue("-webkit-box-sizing"),_=parseFloat(P.getPropertyValue("padding-bottom"))+parseFloat(P.getPropertyValue("padding-top")),M=parseFloat(P.getPropertyValue("border-bottom-width"))+parseFloat(P.getPropertyValue("border-top-width")),u=p.SIZING_STYLE.map(function(H){return H+":"+P.getPropertyValue(H)}).join(";"),D={sizingStyle:u,paddingSize:_,borderSize:M,boxSizing:I};return G&&(this.computedStyleCache=D),D},calculateTextareaHeight:function(J){J=J||"";var Y=this,r=Y.textarea,O=Y.hiddenTextarea,g=Y.wrap,B=32,s=Y.calculateHTMLStyle(r,!1),I=s.paddingSize,a=s.borderSize,d=s.boxSizing,m=s.sizingStyle;O.setAttribute("style",m+";"+Y.HIDDEN_TEXTAREA_STYLE),O.value=r.value+J;var N=O.scrollHeight;"border-box"===d?N+=a:"content-box"===d&&(N-=I),r.style.height=N+"px",r.style.marginTop=0-.5*N+"px",g.style.height=Math.max(N,B)+"px",g.style.marginTop=N*-.5+"px"}});var od=Ee.ScrollBarInteractor=function(r){Lk(od,this,[r])};cs("ScrollBarInteractor",cf,{_41o:function(){return this.gv.getViewRect().height<this.gv.getScrollRect().height},_40o:function(){return this.gv.getViewRect().width<this.gv.getScrollRect().width},isV:function(e){var h=this.gv.getViewRect();return this._41o()&&(h.x+h.width-this.gv.lp(e).x)*this.gv.getZoom()<zr},isH:function(e){var D=this.gv.getViewRect();return this._40o()&&(D.y+D.height-this.gv.lp(e).y)*this.gv.getZoom()<zr},handle_mousemove:function(h){this.handle_touchmove(h)},handle_touchmove:function(C){if(!Zp&&bh(C)&&this.gv.isScrollBarVisible()){var n=this,h=n.isV(C),D=n.isH(C);(h||D)&&n.gv.showScrollBar(),n.gv._scrolling=h||D}},handleWindowMouseUp:function(s){this.handleWindowTouchEnd(s)},handleWindowTouchEnd:function(z){this._state=this._cp=this._tx=this._ty=this.gv._scrolling=S,this.fi({kind:"endScroll",event:z})},handle_mousedown:function(_){this.handle_touchstart(_)},handle_touchstart:function(G){var $=this;if($.gv.setFocus(G),Ub(G),$.handle_touchmove(G),!(Bk(G)>1)&&$.gv._scrolling&&$.gv.isScrollBarVisible()){$._cp=Xd(G),$._tx=$.gv.tx(),$._ty=$.gv.ty();var x=$.isV(G);$._state=x?"vScroll":"hScroll",sm($,G),$.fi({kind:"beginScroll",event:G})}},handleWindowMouseMove:function(c){this.handleWindowTouchMove(c)},handleWindowTouchMove:function(C){var i=Xd(C),u=this.gv.getViewRect(),e=this.gv.getScrollRect();"vScroll"===this._state?this.gv.ty(this._ty+(this._cp.y-i.y)*e.height/u.height):"hScroll"===this._state&&this.gv.tx(this._tx+(this._cp.x-i.x)*e.width/u.width),this.fi({kind:"betweenScroll",event:C})}});var Ck=Ee.TouchInteractor=function(L,f){f=f||{},f.selectable===d&&(f.selectable=!0),f.movable===d&&(f.movable=!0),f.pannable===d&&(f.pannable=!0),f.pinchable===d&&(f.pinchable=!0),f.editable===d&&(f.editable=!0),this.params=f,Lk(Ck,this,[L])};cs("TouchInteractor",cf,{ms_edit:1,setUp:function(){var B=this;Ck.superClass.setUp.call(B),xl&&B.params.editable&&B.gv.setEditInteractor(B)},tearDown:function(){var n=this;Ck.superClass.tearDown.call(n),xl&&n.params.editable&&n.gv.setEditInteractor(S)},clear:function(i){var x=this,f=x.gv;f._moving&&(x.fi({kind:"endMove",event:i}),delete f._moving,f.onMoveEnded(),f.dm().endTransaction()),f._panning&&(x.fi({kind:"endPan",event:i}),delete f._panning,f.onPanEnded()),f._pinching&&(x.fi({kind:"endPinch",event:i}),delete f._pinching,f.onPinchEnded()),f._editing&&(x._46O(i),x._77I=x._node=x._edge=x._shape=x._rect=x._89I=x._index=f._editing=S),x._moving=x._panning=x._pinching=x._editing=x._57I=x._data=x._beginHistory=S,x.clearDragging()},handle_touchstart:function(F){var v=this;if(!v.gv._editing){Ub(F),v._57I=S;var y=v.params,E=v.gv,C=E.sm(),f=E.getDataAt(F),p=Bk(F);if(1===p){if(Qg(F))return E.handleDoubleClick(F,f),void 0;E.handleClick(F,f),f&&(E.handleMouseDown&&E.handleMouseDown(F,f),v._data=f),y.selectable||(f=S),f&&(C.co(f)||C.ss(f),y.editable&&E.isEditable(f)&&v._79I(F,f,!0)?(v._editing=1,v.startDragging(F)):y.movable&&E.isMovable(f)&&(v._moving=1,v.startDragging(F))),f&&E.isMovable(f)||(v._57I=Xd(F),y.pannable&&E.isPannable()&&(v._panning=1,v.startDragging(F),v._translate={x:E.tx(),y:E.ty()}))}else if(y.pinchable&&2===p){if(f&&E._39Q(f))return;v._pinching=1,v.startDragging(F);var s=E.getView(),h=E.getZoom(),Z=s.getBoundingClientRect(),Q=F.touches[0],I=F.touches[1],D={x:(Q.clientX+I.clientX)/2-Z.left,y:(Q.clientY+I.clientY)/2-Z.top};D.x-=E.tx(),D.y-=E.ty(),D.x/=h,D.y/=h,v._p=D,v._d=co(F)}}},handle_touchend:function(g){var o=this,B=o.gv,Z=o._57I,R=o._data;Z&&(zq(Z,Xd(g))<=1&&!graphView.getDataAt(g)&&B.sm().cs(),o._57I=S),R&&B.handleMouseUp&&B.handleMouseUp(g,R)},handleWindowTouchEnd:function(L){this.clear(L)},handleWindowTouchMove:function(n){var r=this,v=r.gv,H=Bk(n);if(1===H){if(r._editing&&(r._beginHistory||(r._beginHistory=1,v.dm().beginTransaction()),v._editing=1,r._78I(n)),r._moving)r._beginHistory||(r._beginHistory=1,v.dm().beginTransaction()),r.handleMove(n);else if(r._panning){var P=Xd(n),C=Gi(v,P,r._lastClientPoint);v.setTranslate(r._translate.x+C.x,r._translate.y+C.y),r.fi({kind:v._panning?"betweenPan":"beginPan",event:n}),v._panning=1}}else if(2===H&&r._pinching){var d=co(n);v.handlePinch(r._p,d,r._d),r._d=d,r.fi({kind:v._pinching?"betweenPinch":"beginPinch",event:n}),v._pinching=1}},handleMove:function($){var n=this,O=n.gv,V=O.lp($);O._93O&&O._93O($,n._data)||(O.moveSelection(V.x-n._lastLogicalPoint.x,V.y-n._lastLogicalPoint.y),n._lastLogicalPoint=V,n.autoScroll($),n.fi({kind:O._moving?"betweenMove":"beginMove",event:$}),O._moving=1)}});var W=E.ht,Sf=W.graph._editor={Math:W.Math,Guide:{}};Sf.getStyle=function(F){var y,J=Sf.StyleMap;return J&&(y=J[F],y!==d)?y:Sf.DefaultStyleMap[F]},Sf.setStyle=function(v,E){var h=Sf.StyleMap;h||(h=Sf.StyleMap={}),h[v]=E},Sf.inEdit=function(S){return S._inXEdit===!0},Sf.startEdit=function(C){C._inXEdit=!0,Sf.Inject.doInject(C)},Sf._46O=function(G){G._inXEdit=!1,Sf.Inject.undoInject(G)},Sf.toScreenPosition=function(D,e){var y=D.tx(),Z=D.ty(),d=D._zoom;return new Sf.Math.Vector2(e.x*d+y,e.y*d+Z)},Sf.checkHit=function(b,V,K){return b.distanceTo(V)<K?!0:!1},Sf.toWorldPosition=function(z,U){var V=z.tx(),$=z.ty(),X=z._zoom;return{x:(U.x-V)/X,y:(U.y-$)/X}},Sf.setAntialias=function(q,U){for(var p,i=["imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","oImageSmoothingEnabled","msImageSmoothingEnabled"],B=0,P=i.length;P>B&&(p=i[B],!(p in q));B++);q[p],q[p]=U},Sf.getTargetCornersOnScreen=function(N,T){if(!T)return null;var H,w=[];if(gq(T,N)){var g=Pl(N,T);H=[{x:g.x,y:g.y},{x:g.x+g.width,y:g.y},{x:g.x+g.width,y:g.y+g.height},{x:g.x,y:g.y+g.height}]}else{if(!T.getCorners)return null;H=T.getCorners()}return H.forEach(function(x){var F=Sf.toScreenPosition(N,x);w.push(F.x,F.y)}),w},Sf.log=function(){};var _d=Sf.Inject={_modules:[]};_d.registAsModule=function(e,S){var v={},r={};for(var D in e){var W=S.prototype[D];v[D]=W}e.getBackup=function(h){return v[h]},e.getBackups=function(){return v},r.doInject=function(){for(var k in e)"getBackup"!==k&&(S.prototype[k]=e[k])},r.undoInject=function(){for(var f in e)"getBackup"!==f&&(S.prototype[f]=v[f])},_d._modules.push(r)},_d.doInject=function(v){for(var q,p=_d._modules,x=0,h=p.length;h>x;x++)q=p[x],q.doInject(v)},_d.undoInject=function($){for(var l,p=_d._modules,M=0,K=p.length;K>M;M++)l=p[M],l.undoInject($)};var cf=W.graph.EditInteractor=function(q){var T=this,d=l.createElement("canvas");d.className="editCanvas",d.style.position="absolute",T._styleMap={},T._canvas=d,T._context=d.getContext("2d"),cf.superClass.constructor.call(T,q),this._editDetail=!1,Sf.setAntialias(T._context,!1),T._subModules=[new Sf.Anchor(T),new Sf.RotateX(T),new Sf.MoveDummy(T),new Sf.Rect(T),new Sf.Curve(T),new Sf.MoveHelper(T)],T._gridGuide=new Sf.Guide.Grid(T),T._rectGuide=new Sf.Guide.Rect(T),T._hoverGuide=new Sf.Guide.Hover(T)},ui=cf;W.Default.def(cf,W.graph.Interactor,{ms_edit:1,ms_fire:1}),G.defineProperties(cf.prototype,{editDetail:{get:function(){var Y=!!this._editDetail;return Y},set:function(g){var B=this,k=B._editDetail;k!==g&&(B._editDetail=g,B.gv._editing=g,B.fp("editDetail",k,g),B.fp("pointsEditingMode",k,g),B.fi({kind:g?"beginEditPoints":"endEditPoints"}))}},gvEditing:{get:function(){return this.gv._editing},set:function(E){(!this._editDetail||E)&&(this.gv._editing=E,E||(this.editDetail=!1))}},editing:{get:function(){return this._editing},set:function(k){this._editing=k,this.gvEditing=k}},pointsEditingMode:{get:function(){return this.editDetail},set:function(V){var L=this;L.editDetail!==V&&(V?L._tryEnterEditDetailMode():L._tryQuitEditDetailMode())}},gridEnabled:{get:function(){var f=this._gridEnabled;if(!f)return!1;var j=this.gv;return j?!0:!0},set:function(M){M!==this._gridEnabled&&(this._gridEnabled=M,this._42())}},alignmentGuideEnabled:{get:function(){return this._agEnabled},set:function(h){h!==this._agEnabled&&(this._agEnabled=h,this._42())}},gridGuide:{get:function(){return this._gridGuide}},rectGuide:{get:function(){return this._rectGuide}},hoverGuide:{get:function(){return this._hoverGuide}}}),cf.prototype.getSubModule=function(z){var y,a,B,M=this._subModules;for(a=0,B=M.length;B>a;a++)if(y=M[a],y.catalog===z)return y},cf.prototype.invokeSubModule=function(W,v){var c=this,k=c._subModules;if(k)for(var P,f,U,o=Array.prototype.slice.call(arguments,2),I=0,m=k.length;m>I;I++)if(P=k[I],f=P[W],f&&(U=f.apply(P,o),U!=d&&v))return P},cf.prototype.invokeSubModuleInverse=function(v,X){var S=this,m=S._subModules;if(m)for(var n,q,T,U=Array.prototype.slice.call(arguments,2),x=m.length-1;x>=0;x--)if(n=m[x],q=n[v],q&&(T=q.apply(n,U),T!=d&&X))return n},cf.prototype.setUp=function(){Sf.log("setUp");var T=this,k=T.gv,Q=k.getView(),d=T._canvas;cf.superClass.setUp.call(T),k.setEditInteractor(T),k._79O?Q.insertBefore(d,k._79O):Q.appendChild(d),Sf.startEdit(k),T.invokeSubModule("setUp"),k.dm().mm(T._onDataModelChanged,T),k.dm().md(T._onDataPropertyChanged,T)},cf.prototype.tearDown=function(){Sf.log("tearDown");var P=this,l=P.gv,C=l.getView();P._resetCustomCursorStyle(),cf.superClass.tearDown.call(P),l.dm().umm(P._onDataModelChanged,P),l.dm().umd(P._onDataPropertyChanged,P),l.setEditInteractor(null),C.removeChild(P._canvas),P._drawTimer&&(B(P._drawTimer),P._drawTimer=null),Sf._46O(l),P.invokeSubModule("tearDown")
},cf.prototype._onDataModelChanged=function(f){var J=this;("clear"===f.kind||"remove"===f.kind&&J.editDetail&&f.data===J.getSubModule("Curve").target)&&(J.editDetail=!1,J._42())},cf.prototype._onDataPropertyChanged=function(G){var x=this;if(x.editDetail){var _=x.getSubModule("Curve"),p=G.data;p===_.target&&(p._writing||_._handleDataChanged(G))}},cf.prototype.clear=function(){Sf.log("clear")},cf.prototype.redraw=function(){this._42()},cf.prototype._42=function(){var U=this;U._drawTimer||(U._drawTimer=J(function(){U._drawTimer=null,U.drawImpl()},0))},cf.prototype.drawImpl=function(){var c;for(c in{_42:!0})break;return function(){var w=this,Z=w._canvas,k=w.gv,u=k.getWidth(),v=k.getHeight(),A=w._context,o=W.Default.getInternal(),g=E.devicePixelRatio;(Z.width!==u||Z.height!==v)&&o.setCanvas(Z,u,v,g),A.clearRect(0,0,Z.width,Z.height);var s=w._getValidSelection();A.save(),A.scale(g,g),w._gridGuide._42(),w.invokeSubModuleInverse(c,!1,A,k,s),w._rectGuide._42(),w._hoverGuide._42(),A.restore()}}(),cf.prototype._getValidSelection=function(){var u=this,P=u.gv,I=P.sm().getSelection(),M=[];return I.each(function(r){P.isVisible(r)&&P.isEditable(r)&&M.push(r)}),M},cf.prototype.handle_touchmove=function(i){return this.handle_mousemove(i)},cf.prototype.handle_mousemove=function(Y){if(!W.Default.isDragging()){var A=this;if(A.editDetail||!Aq()&&!Ih(Y))if(A.gvEditing=!1,A._checkEdit(Y))A.gvEditing=!0;else{if(!A.getStyle("hoverGuideVisible"))return;A.hoverData=A.gv.getDataAt(Y),A._42()}}},cf.prototype.handle_touchstart=function(b){return this.handle_mousedown(b)},cf.prototype.handle_mousedown=function(K){Ub(K);var W=this;if(W.editDetail||!Aq()&&!Ih(K)){if(Qg(K)&&!K.clickThrough){if(W.editDetail){if(W._tryQuitEditDetailMode(K))return}else if(W._tryEnterEditDetailMode())return;W.gv.dm().beginTransaction();var O=W.invokeSubModule("handleDoubleClick",!0,K);if(W.gv.dm().endTransaction(),O)return}var u=W._checkEdit(K);u&&(W._downPosition=W._getLogicalPoint(K),W.gv.dm().beginTransaction(),u.startEdit(W,K),W.editing=!0)}},cf.prototype._checkEdit=function(B){var W=this,m=W.gv,o=W._getLogicalPoint(B),V=W.invokeSubModule("check",!0,m,B,o)||null;return W._editMod=V,V},cf.prototype.handleWindowTouchMove=function(C){return this.handleWindowMouseMove(C)},cf.prototype.handleWindowMouseMove=function(c){var Q=this,A=Q._downPosition;if(A){var D=Q._getLogicalPoint(c);if(D.distanceTo(A)<Q.getStyle("moveSensitivity"))return;delete Q._downPosition}var z=Q._editMod;z&&z.handleEdit(Q.gv,c)},cf.prototype._getLogicalPoint=function(f){var F=this,t=W.Default.getLogicalPoint(f,F._canvas);return new Sf.Math.Vector2(t)},cf.prototype.handleWindowTouchEnd=function(K){return this.handleWindowMouseUp(K)},cf.prototype.handleWindowMouseUp=function(){var f;for(f in{_46O:!0})break;return function(H){var r=this;r.editing=!1,r.setCursor("default"),r.invokeSubModule(f,!1,H),r._42(),r.gv.dm().endTransaction()}}(),cf.prototype.handle_mousewheel=function(c){var w=this;Ub(c),w.invokeSubModule("preHandleScroll",!0)||w.gv.handleScroll(c,c.wheelDelta)},cf.prototype.handleDelete=function(){var N=this;if(!N.editDetail){N.gv.dm().beginTransaction();var Q=N.invokeSubModule("handleNormalStateDelete",!0);return N.gv.dm().endTransaction(),Q||N.gv.removeSelection(),void 0}N.gv.dm().beginTransaction(),N.invokeSubModule("handleDelete",!0),N.gv.dm().endTransaction(),N._42()},cf.prototype.handle_keydown=function(S){var N=this;if((S.metaKey||S.ctrlKey)&&N._42(),Aq(S)&&!N.editing)return N.gvEditing=!1,N.setCursor("default"),N._42(),void 0;var C=jo(S);return N.editDetail?((C||_f(S))&&(N.editDetail=!1,N._42()),N.gv.dm().beginTransaction(),N.invokeSubModule("handle_keydown",!0,S),N.gv.dm().endTransaction(),void 0):(N.gv.dm().beginTransaction(),N.invokeSubModule("handleNormalStateKeyDown",!0,S),N.gv.dm().endTransaction(),C&&N._tryEnterEditDetailMode(),void 0)},cf.prototype.handle_keyup=function(c){this.gv.dm().beginTransaction(),this.invokeSubModule("handle_keyup",!0,c),this.gv.dm().endTransaction()},cf.prototype._tryEnterEditDetailMode=function(){var L=this;return!L.editDetail&&L.invokeSubModule("canEnterEditDetailMode",!0)&&1===L._getValidSelection().length?(L.editDetail=!0,L._42(),!0):void 0},cf.prototype._tryQuitEditDetailMode=function(N){var d=this;return d.editDetail?!N||d.invokeSubModule("canQuitEditDetailMode",!0,N)?(d.editDetail=!1,d._42(),!0):!1:!1},cf.prototype.setStyle=function(G,S,U){var c=this;U?Sf.setStyle(G,S):c._styleMap[G]=S,"baseColor"===G&&(Kl=S),c.fp("styleChanged",null,{key:G,value:S,base:U}),c._42()},cf.prototype.getStyle=function(B){var J=this,C=J._styleMap[B];return C!==d?C:Sf.getStyle(B)},cf.prototype.setCursor=function(d){this._resetCustomCursorStyle(),W.graph.EditInteractor.superClass.setCursor.call(this,d)},cf.prototype._resetCustomCursorStyle=function(){var L=this;if(L._customStyle){var x=this.gv.getView();x.classList&&x.classList.remove&&x.classList.remove(L._customStyle),L._customStyle=null}},cf.prototype._setRotateCursor=function(T){var Q=this,K=Q._cursorFactory;K||(K=Q._cursorFactory=new Sf.CursorFactory(Q));var N=K.getRotateCursor(T),l=Q.gv.getView();Q._resetCustomCursorStyle(),Q._customStyle=N,l.classList&&l.classList.add&&l.classList.add(N)};var Up=Sf.Group=function(W){var m=this;m._entities=W,m._64O=0,m._position={x:0,y:0},m._scale={x:1,y:1},m._anchor={x:.5,y:.5},m._anchor2={x:.5,y:.5}};Up.prototype={},Up.prototype.constructor=Up;var hp=null;Up.findOrCreateGroup=function(g){if(hp&&hp.checkIsMe(g))return hp;var T=new Sf.Group(g);return T.getKeyOb()?(hp=T,T):void 0},Up.prototype.checkIsMe=function(R){var Q=this._entities;if(Q.length!==R.length)return!1;var q,V={},B=R.length;for(q=0;B>q;q++)V[R[q]._id]=!0;for(q=0;B>q;q++)if(!V[Q[q]._id])return!1;return!0},Up.prototype.getRotation=function(){return this._64O},Up.prototype.getPosition=function(){return this._position},Up.prototype.getAnchor=function(){return this._anchor},Up.prototype.getWidth=function(){return this._width},Up.prototype.getScale=function(){return this._scale},Up.prototype.getSize=function(){return{width:this._width,height:this._height}},Up.prototype.getHeight=function(){return this._height},Up.prototype.getKeyOb=function(){for(var Z=this._entities,Q=Z.length-1;Q>=0;Q--){var d=Z[Q];if(this.isNode(d))return d}},Up.prototype.getAnchor2=function(){var P=this,i=P.rotateCenter;if(i)return i;var o=P.getKeyOb();if(!o)return P._anchor;var A=P._anchor2,Q=o.getMatrix();return Q.tf({x:o.getWidth()*(A.x-o.getAnchor().x),y:o.getHeight()*(A.y-o.getAnchor().y)})},Up.prototype.setAnchor2=function(s,Y){var D=this,m=D.getKeyOb();if(m){var t,j=m.getMatrix();t="number"==typeof s?{x:s,y:Y}:s;var u=j.tfi(t);D._anchor2={x:m.getAnchor().x+u.x/m.getWidth(),y:m.getAnchor().y+u.y/m.getHeight()}}},Up.prototype.setRotation=function(){},Up.prototype.beginRotate=function(v){this.rotateCenter=v.pos,this.rotateMode=v.groupRotateMode},Up.prototype.endRotate=function(){delete this.rotateCenter,delete this.rotateMode},Up.prototype.addRotation=function(W,B){return"batch"===B?this._addRotationInBatchMode(W):"block"===B?this._addRotationInBlockMode(W):void 0},Up.prototype._addRotationInBlockMode=function(u){var h=this,t=h.rotateCenter||h.getPosition();h._entities.forEach(function(b){if(h.isNode(b)){var B=b.getMatrix();B.translate(-t.x,-t.y),B.rotate(u),B.translate(t.x,t.y);var G=Math.sign(b.getScale().x);b.setRotation(N(B.b*G,B.a*G)),b.setPosition(B.tx,B.ty)}})},Up.prototype._addRotationInBatchMode=function($){var p=this,a=p._anchor2;p._entities.forEach(function(u){if(p.isNode(u)){var w=u.getAnchor(),Q=u.getMatrix(),k=Q.tf({x:u.getWidth()*(a.x-w.x),y:u.getHeight()*(a.y-w.y)}),n=new Sf.Math.Matrix2d;n.set(Q.a,Q.b,Q.c,Q.d,Q.tx,Q.ty),n.translate(-k.x,-k.y),n.rotate($),n.translate(k.x,k.y);var J=Math.sign(u.getScale().x);u.setRotation(N(n.b*J,n.a*J)),u.setPosition(n.tx,n.ty)}})},Up.prototype.setPosition=function(e){var I,k,o,h,S=this,H=S._position,J=e.x-H.x,x=e.y-H.y,b=S._entities;for(k=0,o=b.length;o>k;k++)I=b[k],zm(I)&&(h=I.getPosition(),I.setPosition(h.x+J,h.y+x));S._position=e},Up.prototype.setScale=function(i,L){var E=this,R=i/E._scale.x,T=L/E._scale.y;E._adjustChildScaleOrSize(R,T,"size"),E._scale={x:i,y:L}},Up.prototype.getRect=function(){var I=this,H=I._position,g=I._width,a=I._height;return{x:H.x-g/2,y:H.y-a/2,width:g,height:a}},Up.prototype.setSize=function(D,$){var m=this,D=Math.max(1,D),$=Math.max(1,$),r=D/m._width,Z=$/m._height;m._adjustChildScaleOrSize(r,Z,"size"),m._width=D,m._height=$},Up.prototype._adjustChildScaleOrSize=function(Q,r,O){var W,c,R,K,U,n,C,V,p,B,m,$,L,s,F=this,g=F._position,Y=F._entities,J=new Sf.Math.Matrix2d;for(c=0,R=Y.length;R>c;c++)if(W=Y[c],F.isNode(W)){if(K=W.getPosition(),U=W.getRotation(),n=W.getWidth(),C=W.getHeight(),V=W.getScale(),m=V.x*n,$=V.y*C,J.identity().scale(m,$).rotate(U).translate(K.x,K.y).translate(-g.x,-g.y).rotate(-F._64O),U=N(J.b*Math.sign(m),J.a*Math.sign(m)),J.scale(Q,r),p=Math.cos(U),B=Math.sin(U),Math.abs(p)<.001?(L=J.b/B,s=-J.c/B):(L=J.a/p,s=J.d/p),"scale"===O)W.setScale(L/n,s/C);else if("size"===O){var i=L/V.x,H=s/V.y;W.setScale(pd(L)*Math.abs(V.x),pd(s)*Math.abs(V.y)),W.setSize(Math.max(.1,Math.abs(i)),Math.max(.1,Math.abs(H)))}J.rotate(F._64O).translate(g.x,g.y),W.setPosition(J.tx,J.ty)}},Up.prototype.getMatrix=function(){var y=this,X=y._position,B=W.Default.getInternal(),H=y._scale;return new B.Mat(y._64O,X.x,X.y,H.x,H.y)},Up.prototype.toGlobal=function(X){return this.getMatrix().tf(X)},Up.prototype.getCorners=function(){var j=this,D=j._width,V=j._height,P=j._anchor,p=-D*P.x,t=-V*P.y,r=j.getMatrix();return[r.tf(p,t),r.tf(p,t+V),r.tf(p+D,t+V),r.tf(p+D,t)]},Up.prototype.calcInfo=function(){var A,j,e,F,D,y,w=this,O=[],X=w._entities,u=w._64O;for(F=0,D=X.length;D>F;F++)y=X[F],w.isNode(y)&&y.getCorners&&O.push.apply(O,y.getCorners());if(O.length){var h=Math.cos(-u),o=Math.sin(-u),l=1/0,S=-1/0,s=1/0,n=-1/0;for(F=0,D=O.length;D>F;F++)e=O[F],A=e.x,j=e.y,e.x=h*A-o*j,e.y=o*A+h*j,l=Math.min(l,e.x),S=Math.max(S,e.x),s=Math.min(s,e.y),n=Math.max(n,e.y);w._width=(S-l)/w._scale.x,w._height=(n-s)/w._scale.y,h=Math.cos(u),o=Math.sin(u);var Q=w._anchor;A=l+(S-l)*Q.x,j=s+(n-s)*Q.y,w._position={x:h*A-o*j,y:o*A+h*j}}},Up.prototype.isNode=function(V){return zm(V)?gq(V)?!1:!0:!1},Up.prototype._42=function(C,J,I){var N,f,Y,m,l,V,h,j,A=this,u=A._entities,$=A.rotateMode;for("batch"===$&&(j=A.getKeyOb()),N=0,f=u.length;f>N;N++)Y=u[N],A.isNode(Y)&&(V=Y.getRect(),m=Sf.toScreenPosition(I,{x:V.x,y:V.y}),l=Sf.toScreenPosition(I,{x:V.x+V.width,y:V.y+V.height}),h={min:m,max:l},Y===j&&(h.isKeyOb=!0),Sf.Icons.DrawIcon(C,J,Sf.Icons.GroupSubEntityRect,h))};var Vk=Sf.CurveActiving=function(x,M){this._curve=x,this._interactor=x._interactor;for(var y in M)this[y]=M[y]};Vk.prototype={},Vk.prototype.constructor=Vk,G.defineProperties(Vk.prototype,{point:{get:function(){return this._point},set:function(N){var a=this;a._point=N,a.editingCtrl||a._firePointChange()}},pairs:{get:function(){return this._pairs},set:function(g){var y=this;y._pairs=g,y.editingCtrl&&y._firePointChange()}}}),Vk.prototype._firePointChange=function(){var j=this,F=j.getCurrentEditingPoint(),v=j._interactor;if(!F)return v.fi({kind:"selectPoint"}),void 0;var $=this._curve.target;if($){var l=Sf.getDataMatrix($).invert(),W=F.e;F=l.apply(Sf.toWorldPosition(v.gv,F)),F.e=W;var n=j._lastFirePoint;n&&Math.abs(F.x-n.x)<1e-5&&Math.abs(F.y-n.y)<1e-5&&(F.e==d&&n.e==d||Math.abs(F.e-n.e)<1e-5)||(j._lastFirePoint=F,v.fi({kind:"selectPoint",x:F.x,y:F.y,e:F.e}))}},Vk.prototype.dispose=function(){this._interactor.fi({kind:"selectPoint"})},Vk.prototype.getCurrentEditingPoint=function(){var P=this,p=P.editingCtrl;if(p){var y=P.pairs;if(y){var J=y[p.pairId],i=J[p.type];if(i)return i}}return P._point};var ho=Sf.CursorFactory=function(_){var U=this;U._interactor=_,U._rotateCursorStyles={}};ho.prototype={},ho.prototype.constructor=ho,ho.prototype.getRotateCursor=function(e){var i=this;0>e&&(e+=2*Math.PI);var v=i._interactor,w=v.getStyle("rotateCursorSize"),z=v.getStyle("rotateCursorRound"),x=Math.round(180*(e/Math.PI)/z);x*z>=360&&(x=0);var b=i._rotateCursorStyles,T="htCustomRotateStyle_"+w+"_"+z+"_"+x;return b[T]||(i._produceRotateCursor(T,w,z,x),b[T]=!0),T},ho.prototype._produceRotateCursor=function(p,E,C,P){var d=this;d._interactor;var Q=d._canvas;Q||(Q=d._canvas=l.createElement("canvas")),Q.width=Q.height=E*devicePixelRatio,Q.style.width=Q.style.height=E+" px";var R=Q.getContext("2d");Sf.setAntialias(R,!1),R.scale(devicePixelRatio,devicePixelRatio);var u,b,V,k,D,J=Math.round(E/2),M=""+J+" "+J+",auto !important;";u=Math.PI/180*P*C,R.clearRect(0,0,E,E),R.save(),R.scale(E/32,E/32),R.translate(16,16),R.rotate(u+Math.PI/2),R.beginPath(),R.moveTo(-8,0),R.lineTo(-8,3),R.lineTo(-5,3),R.moveTo(8,0),R.lineTo(8,3),R.lineTo(5,3),R.moveTo(-8,3),R.quadraticCurveTo(0,-6,8,3),R.restore(),R.strokeStyle="white",R.lineWidth=4,R.stroke(),R.strokeStyle="black",R.lineWidth=2,R.stroke(),b=JSON.stringify(Q.toDataURL()),k="cursor:url("+b+")"+M,1!==devicePixelRatio&&(V='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+E+'px" height="'+E+'px"><image xlink:href='+b+' width="'+E+'" height="'+E+'"/></svg>',k+="cursor:url(data:image/svg+xml;base64,"+btoa(V)+")"+M,k+="cursor:-webkit-image-set(url("+b+")"+devicePixelRatio+"x,url("+b+")1x)"+M),D=l.createElement("style"),D.textContent="body."+p+" *, ."+p+"{"+k+"}",l.head.appendChild(D)};var Xk=Sf.Guide.Grid=function(S){var N=this;N._interactor=S,N._alignmentGuideId=0,N._xAlignmentGuide=[],N._yAlignmentGuide=[]};Xk.prototype={},Xk.prototype.constructor=Xk,G.defineProperties(Xk.prototype,{gridBlockSize:{get:function(){var Q=this;return Q._gridBlockSize||Q._interactor.getStyle("gridBlockSize")},set:function(z){this._gridBlockSize=z,this._interactor._42()}},gridThickLinesEvery:{get:function(){var w=this;return w._gridThickLinesEvery||w._interactor.getStyle("gridThickLinesEvery")},set:function(A){this._gridThickLinesEvery=A,this._interactor._42()}},gridEnabled:{get:function(){var I=this,x=I._interactor;return x.gridEnabled&&I.isValidGrid()}}}),Xk.prototype._42=function(){var h=this,X=h._interactor;h.gridEnabled&&h.drawGrid(),X.alignmentGuideEnabled&&h.drawAlignmentGuide()},Xk.prototype.makeMatrix=function(){var J=this,I=J._interactor.getStyle("gridAngle"),o=J._interactor.getStyle("gridRotation"),K=new Sf.Math.Matrix2d,r=Math.sin(I),k=Math.cos(I);return K.set(1,0,k,r,0,0),K.rotate(o),K},Xk.prototype.isValidGrid=function(){var m=this,C=Math.PI,d=m._interactor,i=d.gv;if(i._zoom<d.getStyle("gridZoomThreshold"))return!1;var J=d.getStyle("gridAngle"),D=Math.abs(180*(J%C/C)),M=1-1e-8;return M>D||D>180-M?!1:!0},Xk.prototype.drawAlignmentGuide=function(){var f=this,L=f._interactor,F=L.gv,e=L._canvas,W=L._context,$=e.width,i=e.height,y=F.tx(),b=F.ty(),r=F._zoom;W.beginPath(),W.strokeStyle=L.getStyle("gridAlignmentGuideColor"),W.lineWidth=1,f._xAlignmentGuide.forEach(function(q){var A=q.p*r+y;W.moveTo(A,0),W.lineTo(A,i)}),f._yAlignmentGuide.forEach(function(D){var e=D.p*r+b;W.moveTo(0,e),W.lineTo($,e)}),W.stroke()},Xk.prototype.drawGrid=function(){function P(z,k,q,Z){var w=Sf.toScreenPosition(O,R.apply({x:z,y:k})),M=Sf.toScreenPosition(O,R.apply({x:q,y:Z}));m.moveTo(w.x,w.y),m.lineTo(M.x,M.y)}var F=this,w=F._interactor,x=F.gridBlockSize,N=F.gridThickLinesEvery,y=w.getStyle("gridThickColor"),S=w.getStyle("gridLightColor"),O=w.gv,l=w._canvas,m=w._context,$=l.width,b=l.height,R=F.makeMatrix(),B=R.applyInverse(Sf.toWorldPosition(O,{x:0,y:0})),i=R.applyInverse(Sf.toWorldPosition(O,{x:$,y:0})),g=R.applyInverse(Sf.toWorldPosition(O,{x:0,y:b})),Q=R.applyInverse(Sf.toWorldPosition(O,{x:$,y:b})),T=Math.min(B.x,i.x,g.x,Q.x),V=Math.max(B.x,i.x,g.x,Q.x),_=Math.min(B.y,i.y,g.y,Q.y),G=Math.max(B.y,i.y,g.y,Q.y);$=V-T,b=G-_;var D=Math.ceil(T/x),J=Math.floor(V/x),z=Math.ceil(_/x),W=Math.floor(G/x);O.tx(),O.ty(),O._zoom;var c,r,d;for(m.save(),m.lineWidth=1,m.beginPath(),m.strokeStyle=y,d=Math.ceil(D/N)*N;J>=d;d+=N)c=d*x,P(c,_,c,G);for(d=Math.ceil(z/N)*N;W>=d;d+=N)r=d*x,P(T,r,V,r);for(m.stroke(),m.beginPath(),m.strokeStyle=S,d=D;J>=d;d++)0!==d%N&&(c=d*x,P(c,_,c,G));for(d=z;W>=d;d++)0!==d%N&&(r=d*x,P(T,r,V,r));m.stroke(),m.restore()},Xk.prototype.getAlignmentGuides=function(){var z=this;return{x:z._xAlignmentGuide,y:z._yAlignmentGuide}},Xk.prototype.addAlignmentGuide=function(K,l,t){var f=this,w="x"===K?f._xAlignmentGuide:f._yAlignmentGuide,t=t?t:++f._alignmentGuideId,z={p:l,id:t};if(w.length){var J=f._findClosestAlignmentGuide(z.p,w);J.dis<0?w.splice(J.index+1,0,z):w.splice(J.index,0,z)}else w.push(z);return f._interactor._42(),t},Xk.prototype.findClosest=function(w,p,Z){var b=this,Y=b._interactor,z=Y.gv;Z&&(w=Sf.toWorldPosition(z,w));var C,c,h,r=1/0,R=1/0,k=w.x,B=w.y;if(b.gridEnabled){var m=b.gridBlockSize,j=b.makeMatrix(),n=j.applyInverse(w);n=j.apply({x:Math.round(n.x/m)*m,y:Math.round(n.y/m)*m}),r=n.x-k,R=n.y-B,h=!0}if(Y.alignmentGuideEnabled&&(C=b._findClosestAlignmentGuide(k,b._xAlignmentGuide).dis,c=b._findClosestAlignmentGuide(B,b._yAlignmentGuide).dis,Math.abs(C)<Math.abs(r)&&(r=C,h=!0),Math.abs(c)<Math.abs(R)&&(R=c,h=!0)),h){h=!1;var N=z._zoom,d=Y.getStyle("smartGuideThreshold")/N,G={};if(Math.abs(r)<d&&"y"!==p&&(G.x=Z?r*N:r,h=!0),Math.abs(R)<d&&"x"!==p&&(G.y=Z?R*N:R,h=!0),h)return G}},Xk.prototype._findClosestAlignmentGuide=function(B,K){if(!K.length)return{dis:1/0};for(var X,h=0,Y=K.length-1;Y-h>1;)X=Math.floor((h+Y)/2),K[X].p<B?h=X:Y=X;var k=K[h].p-B,H=K[Y].p-B;return Math.abs(k)<=Math.abs(H)?{line:K[h],dis:k,index:h}:{line:K[Y],dis:H,index:Y}},Xk.prototype.removeAllAlignmentGuide=function(N){var b=this;"y"!==N&&(b._xAlignmentGuide=[]),"x"!==N&&(b._yAlignmentGuide=[]),b._interactor._42()},Xk.prototype.removeAlignmentGuide=function(M){for(var t,_,h,Z=this,x=Z._xAlignmentGuide,o=0;2>o;o++)for(x=0===o?Z._xAlignmentGuide:Z._yAlignmentGuide,t=0,_=x.length;_>t;t++)if(h=x[t],h.id===M)return x.splice(t,1),Z._interactor._42(),{axis:0===o?"x":"y",position:h.p};return!1},Xk.prototype.adjustAlignmentGuide=function(Z,d){var C=this,s=C.removeAlignmentGuide(Z);return s?(C.addAlignmentGuide(s.axis,d,Z),!0):!1};var zd=Sf.Guide.Rect=function(W){var D=this;D._interactor=W};zd.prototype={},zd.prototype.constructor=zd,zd.prototype.gatherRects=function(){var Z,P,L,w,K=this,N=K._interactor.gv,M=[],V=[],A={x:M,y:V},G={},k=N.getDataModel(),J=k.a("width"),e=k.a("height");J&&e&&(Z=0,P=0,L=J,w=e,M.push({node:k,type:0,p:Z},{node:k,type:1,p:Z+L/2},{node:k,type:2,p:Z+L}),V.push({node:k,type:0,p:P},{node:k,type:1,p:P+w/2},{node:k,type:2,p:P+w}),G[k._id||0]={x:Z,y:P,width:L,height:w}),k.each(function(e){if(zm(e)&&!N.isSelected(e)&&N.isVisible(e)&&N.isValidGuideLineSource(e)){var B=!1;if(N.sm().getSelection().each(function(j){B||(e.isHostOn(j)?B=!0:e.isDescendantOf(j)&&(B=!0))}),!B){var W=e.getRect();Z=W.x,P=W.y,L=W.width,w=W.height,M.push({node:e,type:0,p:Z},{node:e,type:1,p:Z+L/2},{node:e,type:2,p:Z+L}),V.push({node:e,type:0,p:P},{node:e,type:1,p:P+w/2},{node:e,type:2,p:P+w}),G[e._id]=W}}}),M.sort(function(I,W){return I.p-W.p}),V.sort(function(U,F){return U.p-F.p}),K._grid=A,K._87I=G},zd.prototype.gatherLines=function(o,O,C){var G,c,n,w,Q,s,m,g,U,i,K,y,h=this,f=[h.findClosest({x:o.x,y:o.y},O),h.findClosest({x:o.x+o.w/2,y:o.y+o.h/2},O),h.findClosest({x:o.x+o.w,y:o.y+o.h},O)],z={},B=h._87I;C=C||255;var E,$;for(h._guideLine=[],G=0;2>G;G++)for(z={},0===G?(w="y",g=o.x,U=g+o.w):(w="x",g=o.y,U=g+o.h),c=0;3>c;c++)Q=f[c],Q&&isFinite(Q[w])&&(E=1<<3*G+c,C&E&&(s=Q[w+"Line"],m=s.node,$=m._id||0,z[$]||(z[$]=!0,y=B[$],"y"===w?(i=y.x,K=y.x+y.width):(i=y.y,K=y.y+y.height),n=s.p,h._guideLine.push({type:w,a:g,b:U,c:i,d:K,p:n,center:1===s.type}))))},zd.prototype._binarySearchClosest=function(d,R){if(!R.length)return{dis:1/0};for(var E,Y=0,k=R.length-1;k-Y>1;)E=Math.floor((Y+k)/2),R[E].p<d?Y=E:k=E;var D=R[Y].p-d,a=R[k].p-d;return Math.abs(D)<=Math.abs(a)?{line:R[Y],dis:D}:{line:R[k],dis:a}},zd.prototype.findClosest=function(G,f,$){var S=this,F=S._interactor,N=F.gv,k=S._grid;$&&(G=Sf.toWorldPosition(N,G));var E,U=S._binarySearchClosest(G.x,k.x),n=S._binarySearchClosest(G.y,k.y),C=U.dis,M=n.dis,P=N._zoom,w=F.getStyle("smartGuideThreshold")/P,q={};return Math.abs(C)<w&&"y"!==f&&(q.x=$?C*P:C,q.xLine=U.line,E=!0),Math.abs(M)<w&&"x"!==f&&(q.y=$?M*P:M,q.yLine=n.line,E=!0),E?q:void 0},zd.prototype._42=function(){var l=this,e=l._guideLine;if(e&&!W.Default.isCtrlDown()){var q=l._interactor;if(q.getStyle("guideLineVisible")){var Z,j,v,P,x,K,J,s,i,M,$,o,R,h,B,U,y,m=q.gv,H=q._context,f=m.tx(),p=m.ty(),t=m._zoom,k=q.getStyle("guideLineTextSpacing");for(Z=0,j=e.length;j>Z;Z++)v=e[Z],s=v.type,i=v.p,M=v.a,$=v.b,o=v.c,R=v.d,h=Math.min(M,o),B=Math.max($,R),"x"===s?(P=i*t+f,x=h*t+p,K=P,J=B*t+p):(P=h*t+f,x=i*t+p,K=B*t+f,J=x),Sf.Icons.DrawIcon(q,H,Sf.Icons.MoveLineGuide,{rect:[P,x,K,J],center:v.center}),R>=M&&$>=o||(h=M>R?R:$,B=M>R?M:o,y=B-h,"x"===s?(v.center2center||(P-=k,K=P),x=h*t+p,J=B*t+p,U=Sf.Icons.MoveLineGuideDistanceV):"y"===s&&(v.center2center||(x-=k,J=x),P=h*t+f,K=B*t+f,U=Sf.Icons.MoveLineGuideDistanceH),Sf.Icons.DrawIcon(q,H,U,{x0:P,y0:x,x1:K,y1:J,dis:y}))}}},zd.prototype.clear=function(){this._guideLine=null};var ae=Sf.Guide.Hover=function(W){var K=this;K._interactor=W};ae.prototype={},ae.prototype.constructor=ae,G.defineProperties(ae.prototype,{}),ae.prototype._42=function(){var P=this._interactor;if(P.getStyle("hoverGuideVisible")&&!P.gvEditing){var X=P.hoverData,r=P.gv;if(!zm(X)||r.isSelected(X))return P.hoverData=null,void 0;var U=Pl(r,X),C=Sf.toScreenPosition(r,{x:U.x,y:U.y}),M=Sf.toScreenPosition(r,{x:U.x+U.width,y:U.y+U.height});Sf.Icons.DrawIcon(P,P._context,Sf.Icons.HoverDataRect,{min:C,max:M,color:P.getStyle("hoverGuideColor")||P.getStyle("baseColor")})}},Sf.DefaultStyleMap={baseColor:"rgb(51,153,255)",pointSize:[24,9],checkSize:7,rotateCheckSize:10,moveSensitivity:10,moveDummyThreshold:32,moveDummyPosition:[0,0,-16,-16],moveDummyLineExtraShift:[-32,0],moveDummySensitivity:16,keepAspectRatio:!1,rotateRound:Math.PI/2,shiftRotateRound:Math.PI/12,rotateSensitivity:Math.PI/60,rotateAsClock:!1,shiftLineRotateRound:Math.PI/4,anchorMovable:!0,anchorVisible:!0,anchorHideThreshold:25,anchorOutsideVisibleThreshold:.25,anchorRound:.25,anchorSensitivity:.02,smartGuideThreshold:8,curveIntersectSize:5,curvePointIntersectSize:8,edgeHostDetectPerFrame:!0,edgeHostEdgeMaxDistance:12,edgeHostEdgeHighlighColor:"#5d5d5d",edgeHostPointHighlighColor:"red",edgeHostHighlighPeriod:1500,guideLineVisible:!0,guideLineTextSpacing:0,hoverGuideVisible:!1,hoverGuideColor:null,gridBlockSize:40,gridThickLinesEvery:10,gridThickColor:"#5d5d5d",gridLightColor:"#d0d0d0",gridZoomThreshold:.25,gridAlignmentGuideColor:"#ff0000",gridAngle:Math.PI/2,gridRotation:0,groupRotateModeDefault:"block",groupRotateModeKey:["ctrlKey","metaKey"],rotateCursorSize:32,rotateCursorRound:45,tipTextColor:"#ffffff",tipBackground:"#333333",curveHighlightColor:"#30599e",rectPointBackground:"white",rectPointBorderColor:"#666666",rectPointShadowColor:"rgba(0,0,0,0.35)",shapeCtrlPointBackground:"white",shapeCtrlPointBorderColor:null,shapeCtrlPointHighlightBorder:null,shapeHighlighPointBackground:"#30599e",curveElevationVisible:!0,curveElevationIntersectSize:8,curveElevationGuideShift:[20,0],connectGuideVisible:!0,connectGuideShift:[1,.25,8,0],connectGuideIntersectSize:8,connectGuideGarbageIntersectsize:25,connectGuideGarbageShift:[1,1,-48,-48]};var Hg=Sf.Icons={},Cj=1e4,uq=null,Kl=Sf.DefaultStyleMap.baseColor,jq="rgb(183,232,135)",dn="rgb(255,204,153)",Zm=6;W.Default.setImage("Icons.RectPoint",{width:Zm,height:Zm,comps:[{type:"rect",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Kl}},rect:[0,0,Zm,Zm]}]}),Hg.GroupSubEntityRect={comps:[{type:"shape",points:{func:function(){var T=Hg.GroupSubEntityRect.data;if(!T)return[];var l=T.min,M=T.max;return[l.x,l.y,l.x,M.y,M.x,M.y,M.x,l.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Hg.GroupSubEntityRect.data.isKeyOb?Kl:Kl}}}]};var $m=4;Hg.HoverDataRect={comps:[{type:"shape",points:{func:function(){var r=Hg.HoverDataRect.data;if(!r)return[];var D=r.min,R=r.max,c=$m;return D.x-=c,D.y-=c,R.x+=c,R.y+=c,[D.x,D.y,D.x,R.y,R.x,R.y,R.x,D.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Hg.HoverDataRect.data.color}},borderCap:"round",borderPattern:[1,4]}]},Hg.Line={comps:[{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Hg.Line.data.P1.x,Hg.Line.data.P1.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rect:{func:function(){return[[Hg.Line.data.P2.x,Hg.Line.data.P2.y],Zm,Zm]}}}]},Hg.NodeHoverGuide={comps:[{type:"shape",points:{func:function(){return Hg.NodeHoverGuide.data}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:"#3399FF"}]},Hg.Rect={comps:[{type:"shape",points:{func:function(){var b=Hg.Rect.data;if(!b)return[];var I=b.LT,f=b.LB,Y=b.RB,H=b.RT;return[I.x,I.y,f.x,f.y,Y.x,Y.y,H.x,H.y]}},segments:[1,2,2,2,5],background:null,borderWidth:1,borderColor:{func:function(){return Kl}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},rect:{func:function(){return[[Hg.Rect.data.LT.x,Hg.Rect.data.LT.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},rect:{func:function(){return[[Hg.Rect.data.LB.x,Hg.Rect.data.LB.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},rect:{func:function(){return[[Hg.Rect.data.RB.x,Hg.Rect.data.RB.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},rect:{func:function(){return[[Hg.Rect.data.RT.x,Hg.Rect.data.RT.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},visible:{func:function(){return Hg.Rect.data.L?!0:!1}},rect:{func:function(){return[[Hg.Rect.data.L.x,Hg.Rect.data.L.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},visible:{func:function(){return Hg.Rect.data.R?!0:!1}},rect:{func:function(){return[[Hg.Rect.data.R.x,Hg.Rect.data.R.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},visible:{func:function(){return Hg.Rect.data.T?!0:!1}},rect:{func:function(){return[[Hg.Rect.data.T.x,Hg.Rect.data.T.y],Zm,Zm]}}},{type:"image",name:"Icons.RectPoint",rotation:{func:function(){return Hg.Rect.data.rotation}},visible:{func:function(){return Hg.Rect.data.B?!0:!1}},rect:{func:function(){return[[Hg.Rect.data.B.x,Hg.Rect.data.B.y],Zm,Zm]}}}]};var Wm=16;W.Default.setImage("Icons.Anchor",{width:12,height:12,comps:[{type:"shape",borderWidth:1,borderColor:{func:function(){return Kl}},borderCap:"round",shadowColor:"#1ABC9C",points:[.50928,6,11.49072,6,6,6,6,.50928,6,11.49072]},{type:"circle",borderWidth:1,borderColor:{func:function(){return Kl}},shadowColor:"#1ABC9C",rect:[2.84391,2.84391,6.53697,6.53697]}]}),Hg.Anchor={comps:[{type:"image",name:"Icons.Anchor",rect:{func:function(){return[[Hg.Anchor.data.POS.x,Hg.Anchor.data.POS.y],Wm,Wm]}}}]},Hg.TipShiftX=12,Hg.TipShiftY=12;var mq=[8,28];Hg.TipHelper={comps:[{type:"roundRect",rect:{func:function(){return[Hg.TipHelper.data.helperPos.x,Hg.TipHelper.data.helperPos.y,mq[0]*Hg.TipHelper.data.size,mq[1]]}},background:{func:function(){return uq.getStyle("tipBackground")}},opacity:.6},{type:"text",text:{func:function(){return Hg.TipHelper.data.text}},rect:{func:function(){return[Hg.TipHelper.data.helperPos.x,Hg.TipHelper.data.helperPos.y,mq[0]*Hg.TipHelper.data.size,mq[1]]}},color:{func:function(){return uq.getStyle("tipTextColor")}},font:"bold 12px Arial",align:"center"}]};var Se=7;Hg.ShapePoint={comps:[{type:"circle",visible:{func:function(){return!!Hg.ShapePoint.data.dynamicVisible}},rect:{func:function(){var H=Hg.ShapePoint.data.point,u=Hg.ShapePoint.data.size||Se;return[H,u+10,u+10]}},background:{func:function(){var U=Date.now(),S=Hg.ShapePoint.data.dynamicPeriod||1500,m=Math.sin(U%S/S*Math.PI);return"rgba(27,124,22,"+.5*m+")"}},borderWidth:0},{type:"circle",rect:{func:function(){var E=Hg.ShapePoint.data.point,T=Hg.ShapePoint.data.size||Se;return[E,T,T]}},background:{func:function(){var k=Hg.ShapePoint.data.isEnd;return k?"rgba(27,124,222,0.7)":"#ffffff"}},borderWidth:1,borderColor:{func:function(){return Hg.ShapePoint.data.color||Kl}}},{type:"rect",visible:{func:function(){return!!Hg.ShapePoint.data.dynamicVisible}},background:"red",borderWidth:0,rotation:Math.PI/4,borderColor:{func:function(){return Kl}},rect:{func:function(){var Q=5;return[Hg.ShapePoint.data.point,Q,Q]}}}]},Hg.ShapeBgCurve={comps:[{type:"shape",visible:{func:function(){return!!Hg.ShapeBgCurve.data.dynamicVisible}},points:{func:function(){return Hg.ShapeBgCurve.data.P}},segments:{func:function(){return Hg.ShapeBgCurve.data.S}},background:null,borderWidth:6,borderColor:{func:function(){var $=Date.now(),O=Hg.ShapeBgCurve.data.dynamicPeriod||1500,i=Math.sin($%O/O*Math.PI);return"rgba(27,124,22,"+.3*i+")"}}},{type:"shape",points:{func:function(){return Hg.ShapeBgCurve.data.P}},segments:{func:function(){return Hg.ShapeBgCurve.data.S}},background:null,borderWidth:1,borderColor:{func:function(){return Hg.ShapeBgCurve.data.color||Kl}}}]};var Ip=8;Hg.ShapeHighlighPoint={comps:[{type:"circle",rect:{func:function(){var L=Hg.ShapeHighlighPoint.data;return[[L.x,L.y],Ip,Ip]}},background:{func:function(){return uq.getStyle("shapeHighlighPointBackground")}},borderWidth:0}]};var Fh=10;Hg.ShapeHighlighRealPoint={comps:[{type:"circle",rect:{func:function(){var Q=Hg.ShapeHighlighRealPoint.data;return[[Q.x,Q.y],Fh,Fh]}},background:"#ffffff",borderWidth:2,borderColor:{func:function(){return Kl}}}]};var Cd=8;Hg.ShapeHighlighCtrlPoint={comps:[{type:"shape",points:{func:function(){var s=Hg.ShapeHighlighCtrlPoint.data,A=s.x,R=s.y,H=Cd/2;return[A-H,R-H,A-H,R+H,A+H,R+H,A+H,R-H]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return uq.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return uq.getStyle("shapeCtrlPointBorderColor")||Kl}}}]};var Je=3;Hg.ShapeHighlightCurve={comps:[{type:"shape",points:{func:function(){return Hg.ShapeHighlightCurve.data}},segments:[1,4],background:null,borderWidth:Je,borderColor:{func:function(){return uq.getStyle("curveHighlightColor")}}}]},Hg.ShapeGuideLine={comps:[{type:"shape",points:{func:function(){return Hg.ShapeGuideLine.data}},background:null,borderWidth:1,borderColor:"rgb(255,204,153)"}]},Hg.MoveLineGuide={comps:[{type:"shape",points:{func:function(){return Hg.MoveLineGuide.data.rect}},background:null,borderWidth:1,borderColor:{func:function(){return Hg.MoveLineGuide.data.center?jq:dn}}}]};var Oo=5;Hg.MoveLineGuideDistanceH={comps:[{type:"shape",points:{func:function(){var j=Hg.MoveLineGuideDistanceH.data,L=j.x0,X=j.y0;return[L,X-Oo,L,X+Oo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dn},{type:"shape",points:{func:function(){var D=Hg.MoveLineGuideDistanceH.data,L=D.x1,X=D.y1;return[L,X-Oo,L,X+Oo]}},rotation:-Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dn},{type:"text",text:{func:function(){return Math.round(Hg.MoveLineGuideDistanceH.data.dis)}},rect:{func:function(){var K=Hg.MoveLineGuideDistanceH.data;return[[(K.x0+K.x1)/2,K.y0-10],20,20]}},color:dn,font:"12px Arial",align:"center"}]},Hg.MoveLineGuideDistanceV={comps:[{type:"shape",points:{func:function(){var x=Hg.MoveLineGuideDistanceV.data,f=x.x0,V=x.y0;return[f-Oo,V,f+Oo,V]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dn},{type:"shape",points:{func:function(){var H=Hg.MoveLineGuideDistanceV.data,E=H.x1,m=H.y1;return[E-Oo,m,E+Oo,m]}},rotation:Math.PI/4,segments:[1,2],background:null,borderWidth:1,borderColor:dn},{type:"text",text:{func:function(){return Math.round(Hg.MoveLineGuideDistanceV.data.dis)}},rect:{func:function(){var $=Hg.MoveLineGuideDistanceV.data;return[[$.x0-10,($.y0+$.y1)/2],20,20]}},color:dn,font:"12px Arial",align:"center"}]},W.Default.setImage("Icons.EdgeElevationGuideImage",{width:16,height:16,comps:[{type:"oval",background:"rgb(255,255,255)",borderWidth:1,borderColor:"rgb(138,138,138)",rect:[.5,.5,15,15]},{type:"shape",borderWidth:2,borderColor:"rgb(44,44,44)",borderCap:"round",points:[4,8,8,4,12,8,8,4,8,13],segments:[1,2,2,1,2]}]}),Hg.EdgeElevationGuide={comps:[{type:"image",name:"Icons.EdgeElevationGuideImage",rect:{func:function(){var w=Hg.EdgeElevationGuide.data,x=w.x,f=w.y,v=uq.getStyle("curveElevationIntersectSize"),A=uq.getStyle("curveElevationGuideShift");
return x+=A[0],f+=A[1],[x-v,f-v,2*v,2*v]}}}]},W.Default.setImage("Icons.ConnectGuideBgImage",{width:12,height:12,comps:[{type:"shape",background:"#3399ff",fillRule:"evenodd",shadowColor:"#1ABC9C",rotation:3.14159,points:[6.00001,11.99999,6.00001,11.99999,2.6863,11.99999,1e-5,9.30695,1e-5,5.99999,1e-5,5.99999,1e-5,2.68628,2.69305,-1e-5,6.00001,-1e-5,12.00001,-1e-5,11.99998,12.00001,6.00001,11.99999],segments:[1,2,4,2,4,2,2,2]}]}),W.Default.setImage("Icons.ConnectGuideHeaderImage",{width:12,height:12,comps:[{type:"oval",background:"#3399FF",borderColor:"#3399FF",shadowColor:"#1ABC9C",rect:[0,0,12,12]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[4.76,2.56,8.2,5.98,4.76,9.44]}]}),Hg.ConnectGuide={comps:[{type:"image",name:"Icons.ConnectGuideBgImage",rotation:{func:function(){return Hg.ConnectGuide.data.rotation}},rect:{func:function(){var e=Hg.ConnectGuide.data.connect;e.x,e.y;var p=uq.getStyle("connectGuideIntersectSize");return[[e.x,e.y],2*p,2*p]}}},{type:"image",name:"Icons.ConnectGuideHeaderImage",rect:{func:function(){var T=Hg.ConnectGuide.data.cursorPos||Hg.ConnectGuide.data.connect,G=uq.getStyle("connectGuideIntersectSize");return[[T.x,T.y],2*G-2,2*G-2]}}},{type:"shape",background:null,borderColor:"#3399ff",borderWidth:2,segments:[1,4],points:{func:function(){var A=Hg.ConnectGuide.data.connect,l=Hg.ConnectGuide.data.cursorPos||A;return[A.x,A.y,A.x+.5*(l.x-A.x),A.y,l.x+.5*(A.x-l.x),l.y,l.x,l.y]}}}]},W.Default.setImage("Icons.ConnectGuideGarbageImage",{width:48,height:48,comps:[{type:"oval",background:"rgba(0,0,0,0.1)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,48,48]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[19.84721,19.69091,19.84721,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[24.10371,19.69091,24.10371,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[28.15279,19.69091,28.15279,32.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[11.23055,15.22377,36.76945,15.189,19.12302,15.17121,20.94722,11.5228,26.41985,11.5228,28.24406,15.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[15.48702,15.22377,17.02595,21.25344]}]}),W.Default.setImage("Icons.ConnectGuideDeletingImage",{width:56,height:56,comps:[{type:"oval",background:"rgba(232,0,0,0.75)",borderColor:"#979797",shadowColor:"#1ABC9C",rect:[0,0,56,56]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[22.67939,27.69091,22.67939,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[26.93588,27.69091,26.93588,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",points:[30.98497,27.69091,30.98497,40.25123]},{type:"shape",borderWidth:2,borderColor:"rgb(255,255,255)",borderCap:"round",shadowColor:"#1ABC9C",anchorX:0,anchorY:1,rotation:5.65062,points:[14.06272,23.22377,39.60163,23.189,21.9552,23.17121,23.7794,19.5228,29.25203,19.5228,31.07623,23.17121]},{type:"rect",borderWidth:2,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[18.3192,23.22377,17.02595,21.25344]}]}),Hg.ConnectGuideGarbage={comps:[{type:"image",name:{func:function(){var Q=Hg.ConnectGuideGarbage.data.hover;return Q?"Icons.ConnectGuideDeletingImage":"Icons.ConnectGuideGarbageImage"}},rect:{func:function(){var t=Hg.ConnectGuideGarbage.data,d=uq.getStyle("connectGuideGarbageIntersectsize");return t.hover&&(d+=5),[[t.x,t.y],2*d,2*d]}}}]};var ie=6;Hg.ShapeActivingCtrl={comps:[{type:"shape",visible:{func:function(){return Hg.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var T=Hg.ShapeActivingCtrl.data;return[T.point.x,T.point.y,T.c1.x,T.c1.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Kl}}},{type:"shape",visible:{func:function(){return Hg.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var p=Hg.ShapeActivingCtrl.data;return[p.point.x,p.point.y,p.c2.x,p.c2.y]}},segments:[1,2],background:null,borderWidth:1,borderColor:{func:function(){return Kl}}},{type:"shape",visible:{func:function(){return Hg.ShapeActivingCtrl.data.c1?!0:!1}},points:{func:function(){var T=Hg.ShapeActivingCtrl.data.c1,J=T.x,c=T.y,p=ie/2;return"c1"===Hg.ShapeActivingCtrl.data.hl&&(p+=.5),[J-p,c-p,J-p,c+p,J+p,c+p,J+p,c-p]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return uq.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c1"===Hg.ShapeActivingCtrl.data.hl?uq.getStyle("shapeCtrlPointHighlightBorder")||Kl:uq.getStyle("shapeCtrlPointBorderColor")||Kl}}},{type:"shape",visible:{func:function(){return Hg.ShapeActivingCtrl.data.c2?!0:!1}},points:{func:function(){var U=Hg.ShapeActivingCtrl.data.c2,w=U.x,v=U.y,m=ie/2;return"c2"===Hg.ShapeActivingCtrl.data.hl&&(m+=.5),[w-m,v-m,w-m,v+m,w+m,v+m,w+m,v-m]}},segments:[1,2,2,2,5],borderWidth:2,background:{func:function(){return uq.getStyle("shapeCtrlPointBackground")}},borderColor:{func:function(){return"c2"===Hg.ShapeActivingCtrl.data.hl?uq.getStyle("shapeCtrlPointHighlightBorder")||Kl:uq.getStyle("shapeCtrlPointBorderColor")||Kl}}}]},Hg.RoundPoint={comps:[{type:"circle",background:"rgb(247,247,247)",borderWidth:1,borderColor:{func:function(){return Kl}},rect:{func:function(){return[[Hg.RoundPoint.data.x,Hg.RoundPoint.data.y],Zm,Zm]}}}]},Hg.AttachPoint={comps:[{type:"rect",background:{func:function(){return Hg.AttachPoint.data.isAttach?"rgb(51,153,255)":"rgb(247,247,247)"}},borderWidth:1,rotation:Math.PI/4,borderColor:{func:function(){return Kl}},rect:{func:function(){var v=Hg.AttachPoint.data.isAttach?Zm+4:Zm;return[[Hg.AttachPoint.data.x,Hg.AttachPoint.data.y],v,v]}}}]},Hg.SimpleRect={comps:[{type:"rect",background:null,borderWidth:{func:function(){return Hg.SimpleRect.data.borderWidth||1}},borderColor:{func:function(){return Hg.SimpleRect.data.color||Kl}},rect:{func:function(){var Y=Hg.SimpleRect.data;return[Y.x,Y.y,Y.width,Y.height]}}}]},W.Default.setImage("Icons.MoveDummyImage",{width:32,height:32,boundExtend:12,attachStyle:"close",comps:[{type:"oval",background:"rgb(255,255,255)",borderColor:"#979797",shadow:!0,shadowColor:"rgba(0,0,0,0.25)",shadowOffsetX:0,rect:[0,0,32,32]},{type:"shape",background:"rgb(51,153,255)",pixelPerfect:!0,points:[8.65079,11.90713,9.05502,11.46921,9.70629,11.46921,10.11052,11.90713,10.51476,12.28891,10.51476,12.92895,10.11052,13.34441,8.49359,14.97258,12.2889,14.97258,12.85034,14.97258,13.29949,15.42172,13.29949,15.99439,13.29949,16.57828,12.85034,17.0162,12.2889,17.0162,8.49359,17.0162,10.11052,18.6556,10.51476,19.0486,10.51476,19.7111,10.11052,20.09288,9.70629,20.50834,9.05502,20.50834,8.65079,20.09288,5.32709,16.76917,5.28217,16.71303,4.87794,16.32002,4.87794,15.67998,5.28217,15.26452,8.65079,11.90713,8.65079,11.90713,8.65079,11.90713,13.3444,10.09931,13.3444,10.09931,12.94017,10.50354,12.2889,10.50354,11.88467,10.09931,11.48043,9.69507,11.48043,9.0438,11.88467,8.63957,15.27574,5.25973,15.66874,4.86672,16.32001,4.86672,16.73547,5.25973,16.76917,5.31586,20.10409,8.63957,20.50832,9.0438,20.50832,9.68385,20.10409,10.09931,19.69986,10.49231,19.07105,10.50354,18.64436,10.09931,17.02742,8.45991,17.02742,12.26646,17.02742,12.83912,16.55581,13.31072,15.99438,13.31072,15.43295,13.31072,14.98379,12.83912,14.98379,12.26646,14.96134,8.45991,13.3444,10.09931,13.3444,10.09931,13.3444,10.09931,21.90069,13.33318,21.90069,13.33318,21.49646,12.91771,21.49646,12.27768,21.90069,11.89591,22.31615,11.45798,22.94497,11.45798,23.36043,11.89591,26.72904,15.2533,27.12205,15.66876,27.12205,16.3088,26.72904,16.7018,26.6729,16.75794,23.36043,20.08165,22.94497,20.49711,22.31615,20.49711,21.90069,20.08165,21.49646,19.69987,21.49646,19.03737,21.90069,18.64437,23.51763,17.00498,19.72231,17.00498,19.14965,17.00498,18.71173,16.56705,18.71173,15.98316,18.71173,15.41049,19.14965,14.96135,19.72231,14.96135,23.51763,14.96135,21.90069,13.33318,21.90069,13.33318,21.90069,13.33318,11.88467,23.32675,11.88467,23.32675,11.48043,22.94498,11.48043,22.27125,11.88467,21.88948,12.2889,21.48523,12.94017,21.48523,13.3444,21.88948,14.96134,23.52887,14.98379,19.7111,14.98379,19.14966,15.43295,18.67805,15.99438,18.67805,16.55581,18.67805,17.02742,19.14966,17.02742,19.7111,17.02742,23.52887,18.64436,21.88948,19.07105,21.48523,19.69986,21.48523,20.10409,21.88948,20.50832,22.27125,20.50832,22.94498,20.10409,23.32675,16.76917,26.65045,16.73547,26.72905,16.32001,27.13329,15.66874,27.13329,15.27574,26.72905,11.88467,23.32675,11.88467,23.32675,11.88467,23.32675],segments:[1,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,4,2,2,4,4,2,2,4,4,2,2,2,2,1,2,4,4,2,2,4,4,2,2,4,4,2,2,4,2,2,2]}]}),Hg.MoveDummy={comps:[{type:"image",name:"Icons.MoveDummyImage",rect:{func:function(){var i=Hg.MoveDummy.data;return[[i.pos.x,i.pos.y],2*i.size,2*i.size]}}}]},Sf.Icons.DrawIcon=function(y,z,O,L){O.width=O.height=Cj,O.data=L,uq=y,W.Default.drawImage(z,O,0,0,Cj,Cj)},Sf.Icons.MapPoints=function(t,i){for(var u=0,v=t.length;v>u;u++)t[u]/=i},Sf.roundTo=function(c,H,t){var E=Math.abs(c%H);return t>E||t>H-E?H*Math.round(c/H):c},Sf.toFixed=function(I){return Math.round(100*I)/100},Sf.getDataMatrix=function(K){if(K instanceof W.Shape){var J=new W.Math.Matrix2d,F=K.getPosition();return J.translate(-F.x,-F.y).scale(K.getScale().x,K.getScale().y).rotate(K.getRotation()).translate(F.x,F.y),J}return K.getMatrix?K.getMatrix():new W.Math.Matrix2d};var Br=Sf.Math.Curve=function(){this._curves=[]};Br.prototype={},Br.prototype.constructor=Br,Br.prototype.createFromHtShape=function(_,o,k){o instanceof W.List&&(o=o.toArray());var f,K,B,O,w,P,T,g=this,l=null,R=null,U=0,Z=Sf.Math.Vector2,F=Sf.Math.CubicBezier,j=function(v){return new Z(_[v],_[v+1],k?k[v/2]:d)};for(K=0,B=o.length;B>K;K++){switch(O=o[K],w=null,O){case 1:R=j(U),l=R,U+=2;break;case 2:f=j(U),U+=2,w=new F(R,R.clone(),f.clone(),f),R=f;break;case 3:P=j(U),f=j(U+2),U+=4,w=new F(R,P.clone().sub(R).multiplyScalar(2/3).add(R),P.clone().sub(f).multiplyScalar(2/3).add(f),f),R=f;break;case 4:P=j(U),T=j(U+2),f=j(U+4),U+=6,w=new F(R,P,T,f),R=f;break;case 5:if(!l)break;w=new F(R,R.clone(),l.clone(),l),R=null,l=null}w&&(w._index=g._curves.length,g._curves.push(w))}},Br.prototype.checkPoint=function(U,f){var s,F,R,d,i,m=this,u=m._curves;for(s=0,F=u.length;F>s;s++)if(d=u[s],i=d.intersectRect(U,f,f),i.length)return R=0,i.forEach(function(h){R+=h.t}),R/=i.length,U=d.getPointAt(R),U.t=R,{bezier:d,intersection:U}},Br.prototype.insertKnot=function(I,Y){var u=I.insertKnot(Y),b=this,Z=b._curves;Z.splice(I._index,1,u[0],u[1])},Br.prototype._isCloseEnough=function(p,n){return Math.abs(p.x-n.x)<1e-6&&Math.abs(p.y-n.y)<1e-6},Br.prototype._isSamePoint=function(D,O){return D===O},Br.prototype.moveRealPoint=function(L,J){var w=this,o=w._curves,E=J.clone().sub(L);o.forEach(function(e){var t=e._p1;e._p2,e._p3;var R=e._p4;w._isSamePoint(t,L)&&(e._p2.add(E),e._p1=J),w._isSamePoint(R,L)&&(e._p3.add(E),e._p4=J)})},Br.prototype.moveCtrlDueToRealPointMovement=function(u,R){var B=this,T=B._curves,v=function(w){w.add(R),w.e&&R.e&&(w.e+=R.e)};T.forEach(function(g){var a=g._p1;g._p2,g._p3;var d=g._p4;B._isSamePoint(a,u)&&v(g._p2),B._isSamePoint(d,u)&&v(g._p3)})},Br.prototype.moveCtrlPoint=function(N,i,l){var $=N[l];if($){$.e!==d&&(i.e=$.e);var p=this,X=p._curves;i.clone().sub($),X.forEach(function(H){var e;"c2"===l?e="_p2":"c1"===l&&(e="_p3"),p._isSamePoint(H[e],$)&&(H[e]=i)}),N[l]=i}},Br.prototype.deleteRealPoint=function(D,N){var q,R,t,P,Z,j,X,V=this,o=V._curves,f={},I=[],H=Sf.Math.CubicBezier;for(R=0,t=o.length;t>R;R++)q=o[R],P=q._p1,Z=q._p2,j=q._p3,X=q._p4,(f[R]||!V._isSamePoint(P,D))&&(V._isSamePoint(X,D)?t>R+1&&V._isSamePoint(o[R+1]._p1,D)&&(N||I.push(new H(P,Z,o[R+1]._p3,o[R+1]._p4))):I.push(q));V._curves=I},Br.prototype.findPairs=function(l,S){var r,y,L,Y,_,C,R,H,E=this,j=E._curves,t={},P=[];for(y=0,L=j.length;L>y;y++)r=j[y],Y=r._p1,_=r._p2,C=r._p3,R=r._p4,!t[y]&&E._isSamePoint(Y,l)&&(S?P.push({point:Y,r2:R}):P.push({point:Y,c2:_})),E._isSamePoint(R,l)&&(H=S?{point:R,r1:Y}:{point:R,c1:C},L>y+1&&E._isSamePoint(j[y+1]._p1,l)&&(S?H.r2=j[y+1]._p4:H.c2=j[y+1]._p2,t[y+1]=!0),P.push(H));return P},Br.prototype.toHtShape=function(){var w=this,t=w._curves,Q=[],D=[],P={x:1/0,y:1/0};return t.forEach(function(K){var T=K._p1,M=K._p2,V=K._p3,r=K._p4;return w._isCloseEnough(T,P)||(Q.push(1),D.push(T.clone())),P=r,w._isCloseEnough(T,M)&&w._isCloseEnough(V,r)?(Q.push(2),D.push(r.clone()),void 0):(Q.push(4),D.push(M.clone(),V.clone(),r.clone()),void 0)}),{segments:Q,points:D}};var vo=Sf.Math.CubicBezier=function(M,I,i,j){var w=this;w._id=Sf.Math.CubicBezier._globalId++,w._p1=M,w._p2=I,w._p3=i,w._p4=j};vo._globalId=1,vo.prototype={},vo.prototype.constructor=vo,vo.prototype.toString=function(){return this._id},vo.prototype.intersectRect=function(I,m,O){var T=m/2,l=O/2,z=I.x,f=I.y,x=Sf.Math.Vector2,b=new x(-T+z,-l+f),F=new x(T+z,l+f),Y=new x(F.x,b.y),q=new x(b.x,F.y),D=this,w=D.intersectLine(b,Y),W=D.intersectLine(Y,F),c=D.intersectLine(F,q),k=D.intersectLine(q,b),B=w.concat(W).concat(c).concat(k);return B},vo.prototype.intersectLine=function(k,u){var w,B,j,A,t,v,U,C,h,y,T,i,E,N=this,P=k.clone().min(u),z=k.clone().max(u);A=N._p1,t=N._p2,v=N._p3,U=N._p4,w=A.clone().multiplyScalar(-1),B=t.clone().multiplyScalar(3),j=v.clone().multiplyScalar(-3),T=w.add(B).add(j).add(U),w=A.clone().multiplyScalar(3),B=t.clone().multiplyScalar(-6),j=v.clone().multiplyScalar(3),y=w.add(B).add(j),w=A.clone().multiplyScalar(-3),B=t.clone().multiplyScalar(3),h=w.add(B),C=A.clone(),E=new Sf.Math.Vector2(k.y-u.y,u.x-k.x),i=k.x*u.y-u.x*k.y;for(var Z=N.getRoots(E.dot(T),E.dot(y),E.dot(h),E.dot(C)+i),p=new Array,r=0,d=Z.length;d>r;r++){var e=Z[r];if(!(0>e||e>1)){var n=A.clone().lerp(t,e),S=t.clone().lerp(v,e),H=v.clone().lerp(U,e),g=n.lerp(S,e),D=S.lerp(H,e),W=g.lerp(D,e);W.t=e,k.x==u.x?P.y<=W.y&&W.y<=z.y&&p.push(W):k.y==u.y?P.x<=W.x&&W.x<=z.x&&p.push(W):W.x>=P.x&&W.y>=P.y&&W.x<=z.x&&W.y<=z.y&&p.push(W)}}return p},vo.prototype.solveTForPoint=function(H){var A,o,X,r,g=this;A=g._p1.x-H.x,o=g._p2.x-H.x,X=g._p3.x-H.x,r=g._p4.x-H.x;for(var U=g.getRoots(r-3*X+3*o-A,3*X-6*o+3*A,3*o-3*A,A),c=d,v=1/0,e=0,h=U.length;h>e;e++){var j=U[e];if(!(0>j||j>1)){var $=g._p1.clone().lerp(g._p2,j),s=g._p2.clone().lerp(g._p3,j),K=g._p3.clone().lerp(g._p4,j),I=$.lerp(s,j),D=s.lerp(K,j),t=I.lerp(D,j);t.t=j;var b=Math.abs(t.y-H.y);v>b&&(v=b,c=t)}}return c},vo.prototype.getPointAt=function(k){var x=this,z=x._p1,$=x._p2,f=x._p3,Y=x._p4,W=z.clone().lerp($,k),_=$.clone().lerp(f,k),s=f.clone().lerp(Y,k),q=W.lerp(_,k),o=_.lerp(s,k);return q.lerp(o,k)},vo.prototype.getRoots=function(E,j,o,x){var G,U,v,Z,t,e=new Array;if(Math.abs(E)<1e-6){var G=j,U=o/G,v=x/G,Z=U*U-4*v;if(Z>0){var t=Math.sqrt(Z);e.push(.5*(-U+t)),e.push(.5*(-U-t))}else 0==Z&&e.push(.5*-U)}j/=E,o/=E,x/=E,G=(3*o-j*j)/3,U=(2*j*j*j-9*o*j+27*x)/27;var B=j/3,W=U*U/4+G*G*G/27,d=U/2;if(Math.abs(W)<=1e-6&&(W=0),W>0){var k,Q,t=Math.sqrt(W);k=-d+t,Q=k>=0?Math.pow(k,1/3):-Math.pow(-k,1/3),k=-d-t,k>=0?Q+=Math.pow(k,1/3):Q-=Math.pow(-k,1/3),e.push(Q-B)}else if(0>W){var Y=Math.sqrt(-G/3),C=Math.atan2(Math.sqrt(-W),-d)/3,X=Math.cos(C),N=Math.sin(C),l=Math.sqrt(3);e.push(2*Y*X-B),e.push(-Y*(X+l*N)-B),e.push(-Y*(X-l*N)-B)}else{var k;k=d>=0?-Math.pow(d,1/3):Math.pow(-d,1/3),e.push(2*k-B),e.push(-k-B)}return e},vo.prototype._70I=function(){var D=this;return D._p1.distanceToSquared(D._p2)<1e-10&&D._p3.distanceToSquared(D._p4)<1e-10},vo.prototype.insertKnot=function(H){var b=this,M=b._p1,x=b._p2,k=b._p3,z=b._p4,F=M.clone().lerp(x,H),A=x.clone().lerp(k,H),d=k.clone().lerp(z,H),O=F.clone().lerp(A,H),E=A.clone().lerp(d,H),I=O.clone().lerp(E,H);return b._70I()?(M.clone().lerp(z,H),[new Sf.Math.CubicBezier(M,M.clone(),I.clone(),I),new Sf.Math.CubicBezier(I,I.clone(),z.clone(),z)]):[new Sf.Math.CubicBezier(M,F,O,I),new Sf.Math.CubicBezier(I,E,d,z)]};var um=W.Default.getInternal().ui().EdgeUI,jk={_47O:function(E){var b=this,n=jk.getBackups()._47O;Sf.inEdit(b.gv)||n.call(b,E)}};Sf.Inject.registAsModule(jk,um);var re=W.Default.getInternal().ui().NodeUI,ue={_47O:function(p){var h=this,W=ue.getBackups()._47O;Sf.inEdit(h.gv)||W.call(h,p)},getSelectWidth:function(){var F=this,j=F.gv,V=F._data;if(j.isEditable(V)&&Sf.inEdit(j))return 0;var t=ue.getBackup("getSelectWidth");return t.call(F)}};Sf.Inject.registAsModule(ue,re);var Cm=W.graph.GraphView,sg={_editPointSize:function(){var s=W.Default.isTouchable,X=Sf.getStyle("pointSize");return X[s?0:1]}(),isPointEditable:function(x){var Y=this;if(Sf.inEdit(Y))return Y._pointEditableFunc?Y._pointEditableFunc(x):!0;var o=sg.getBackup("isPointEditable");o.call(Y,x)},isEditable:function(n){var A,y=this,z=sg.getBackup("isEditable");if(A=n instanceof Sf.Group?!0:z.call(y,n),!Sf.inEdit(y))return A;if(!(n instanceof W.Edge))return A;if(!n.s("2d.editable"))return!1;var s=y.getEditableFunc();return s?s(n):!0},_42:function(S,n){var C=this,Y=sg.getBackups()._42;if(Y.call(C,S,n),Sf.inEdit(C)){var D=C.getEditInteractor();D.drawImpl()}}};Sf.Inject.registAsModule(sg,Cm);var Fd=W.Default.getInternal().ui().ShapeUI,Nb={_47O:function(g){var X=this,Y=Nb.getBackups()._47O;Sf.inEdit(X.gv)||Y.call(X,g)}};Sf.Inject.registAsModule(Nb,Fd);var _k=W.graph.DefaultInteractor,Ym={handle_mousewheel:function(k){var C=this,T=Ym.getBackup("handle_mousewheel");Sf.inEdit(C.gv)||T.call(C,k)}};Sf.Inject.registAsModule(Ym,_k);var Tl=W.graph.MoveInteractor,Ib={_calcShift:function(c,v){var C=this,z=Ib.getBackup("_calcShift"),f=C.gv;if(!Sf.inEdit(f))return z.call(C,c,v);var i=f.getEditInteractor(),X=i.getSubModule("Move").calcShift(c,v,C);return X||z.call(C,c,v)},clear:function(o){var m=this,d=Ib.getBackup("clear");d.call(m,o);var r=m.gv;if(Sf.inEdit(r)){var Z=r.getEditInteractor();Z.getSubModule("Move").clear(o)}}};Sf.Inject.registAsModule(Ib,Tl);var zd=Sf.Rect=function(v){this.catalog="Rect",this._interactor=v};zd.prototype={},zd.prototype.constructor=zd,zd.prototype.gatherInfo=function(O,i){var p=this;if(1===i.length){var j=i[0];return j instanceof W.Shape&&j._70I()?p.gatherLine(O,j):gq(j,O)?!1:p.gatherSingleTarget(O,j)}return i.length>1?p.gatherMultiTargets(O,i):!1},zd.prototype.gatherSingleTarget=function(T,H){if(H.getCorners){var W,J=this,X=J.info;J.target=H,W=J.screenInfo={};var N=H.getCorners();X.LT=new Sf.Math.Vector2(N[0]),X.LB=new Sf.Math.Vector2(N[1]),X.RB=new Sf.Math.Vector2(N[2]),X.RT=new Sf.Math.Vector2(N[3]),X.T=X.LT.clone().add(X.RT).divideScalar(2),X.B=X.LB.clone().add(X.RB).divideScalar(2),X.L=X.LT.clone().add(X.LB).divideScalar(2),X.R=X.RT.clone().add(X.RB).divideScalar(2);for(var q in X)W[q]=Sf.toScreenPosition(T,X[q]);var z=J._interactor,U=z.getStyle("checkSize"),O=function(z,t,d){var P=t.clone().sub(z).setLength(-U),u=d.clone().sub(z).setLength(-U),v=P.add(u).add(z);return v};return W.rotLT=O(W.LT,W.RT,W.LB),W.rotLB=O(W.LB,W.LT,W.RB),W.rotRB=O(W.RB,W.LB,W.RT),W.rotRT=O(W.RT,W.LT,W.RB),W.rotT=W.rotLT.clone().add(W.rotRT).divideScalar(2),W.rotB=W.rotLB.clone().add(W.rotRB).divideScalar(2),W.rotL=W.rotLT.clone().add(W.rotLB).divideScalar(2),W.rotR=W.rotRT.clone().add(W.rotRB).divideScalar(2),W.rotation=H.getRotation(),J.gatherConnectInfo(),!0}},zd.prototype.gatherConnectInfo=function(){var L=this,F=L.target,G=L._interactor,Y=L.screenInfo,m=G.gv;if(m.isConnectActionVisible(F)&&G.getStyle("connectGuideVisible")){var $;F.s&&($=F.s("connectGuideShift")),$||($=G.getStyle("connectGuideShift"));var D=F.getAnchor(),V=F.getSize(),i=F.toGlobal({x:V.width*($[0]-D.x),y:V.height*($[1]-D.y)});i=Sf.toScreenPosition(m,i),Y.P1?i.add(Y.P2.clone().sub(Y.P1).setLength($[2])):(i.add(Y.RT.clone().sub(Y.LT).setLength($[2])),i.add(Y.LB.clone().sub(Y.LT).setLength($[3]))),Y.connect=i}},zd.prototype.gatherMultiTargets=function(U,f){var Z=Sf.Group.findOrCreateGroup(f);if(!Z)return!1;var C=this;return C.editing&&"rotate"!==C.editing.mode||Z.calcInfo(),C.gatherSingleTarget(U,Z)},zd.prototype.gatherLine=function(N,k){this.target=k;var g=this.screenInfo={},S=k.getPoints(),U=Sf.getDataMatrix(k);return g.P1=Sf.toScreenPosition(N,U.apply(S.get(0))),g.P2=Sf.toScreenPosition(N,U.apply(S.get(1))),this.gatherConnectInfo(),!0},zd.ResizeKeys=["LT","RB","LB","RT","L","R","B","T"],zd.ResizeDirection=[{x:-1,y:-1},{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}],zd.RotateKeys=["rotLT","rotRB","rotLB","rotRT","rotL","rotR","rotB","rotT"],zd.prototype.check=function(w,C,E){if(W.Default.isLeftButton(C)){var _=this;if(_.editing=null,_.tipInfo=null,_.screenInfo){var T=_.target,Y=w.isEditable(T),k=_.screenInfo;if(Y&&k.connect){var K=_._checkConnect(E);if(K)return K}if(k.P1)return _._checkLine(E);var n,v,t,r=null,Q=_._interactor,R=Q.getStyle("checkSize");if(Y&&w.isRectEditable(T))for(v=0;v<Sf.Rect.ResizeKeys.length;v++)if(t=Sf.Rect.ResizeKeys[v],Sf.checkHit(E,k[t],R)){r=t,n="resize";break}if(!r&&Y&&w.isRotationEditable(T)&&!Q.getStyle("rotateAsClock")){var G=Q.getStyle("rotateCheckSize");for(v=0;v<Sf.Rect.RotateKeys.length;v++)if(t=Sf.Rect.RotateKeys[v],Sf.checkHit(E,k[t],G)){r=t,n="rotate";break}}if(!r)return Q.setCursor("default"),void 0;if("rotate"===n){var O,g=w.lp(C);if(T instanceof Sf.Group){var B=Q.getStyle("groupRotateModeKey");"string"==typeof B&&(B=[B]);for(var U=!1,f=0,J=B.length;J>f;f++)if(C[B[f]]){U=!0;break}var M=Q.getStyle("groupRotateModeDefault");O=U?"batch"===M?"block":"batch":M}var A="batch"===O?T.getAnchor2():T.getPosition(),s=Math.atan2(g.y-A.y,g.x-A.x);Q._setRotateCursor(s),_.editing={mode:n,key:r,pos:A,flipY:T.getScale().y<0,rotation:T.getRotation(),hitRot:s},O&&(_.editing.groupRotateMode=O)}else{var y=Sf.Rect.ResizeKeys.indexOf(r),i=Sf.Rect.ResizeDirection[y],p=Math.cos(T.getRotation()),d=Math.sin(T.getRotation()),L=i.x*Math.sign(T.getScale().x),D=i.y*Math.sign(T.getScale().y),j=Math.atan2(-d*L-p*D,p*L-d*D),u=(Math.round(j/(Math.PI/4))+8)%8,o=["ew-resize","nesw-resize","ns-resize","nwse-resize","ew-resize","nesw-resize","ns-resize","nwse-resize"][u];this._interactor.setCursor(o);var q=T.getWidth(),I=T.getHeight(),F=T.getAnchor();_.editing={mode:n,key:r,rect:{x:-q*F.x,y:-I*F.y,width:q,height:I},anchor:F,matrix:T.getMatrix()}}return r}}},zd.prototype._checkLine=function(b){var O=this;O.screenInfo;var X,M=O._interactor.getStyle("checkSize");if(Sf.checkHit(b,O.screenInfo.P1,M))X="P1";else{if(!Sf.checkHit(b,O.screenInfo.P2,M))return this._interactor.setCursor("default"),void 0;X="P2"}return O.editing={mode:"line",key:X},X},zd.prototype._checkConnect=function(e){var Z=this,M=Z.screenInfo,E=Z._interactor,G=E.getStyle("connectGuideIntersectSize"),F=M.connect,U=e.x,K=F.x;if(K>U&&G>K-U&&Math.abs(F.y-e.y)<G||U>=K&&Sf.checkHit(e,F,G)){var o="connect",l=X.getConnectAction(E.gv);if(Z.editing={mode:o},l&&l.delete)if(Z.target instanceof Sf.Group){var s=!0;E.gv.sm().getSelection().each(function(q){l.delete.visible.call(null,E.gv,q)||(s=!1)}),Z.editing.hasDeleteAction=s}else l.delete.visible.call(null,E.gv,Z.target)&&(Z.editing.hasDeleteAction=!0);return E.setCursor("default"),o}},zd.prototype._fireEditEvent=function(u,B){var c=this._interactor,h=this.editing;if(h){var K=h.mode;K="rotate"===K?"Rotation":"connect"===K?"Connection":K[0].toUpperCase()+K.slice(1),c.fi({kind:u+"Edit"+K,event:B})}},zd.prototype.startEdit=function(_,o){_.startDragging(o);var p=this;p._interactor.fi({kind:"prepareEdit",event:o});var b=p.editing,O=p.target;if(b){if(p._fireEditEvent("begin",o),"rotate"===b.mode)return b.groupRotateMode&&O.beginRotate(b),void 0;if("connect"!==b.mode)("line"===b.mode||O&&0===O.getRotation())&&(p._inSmartGuide=!0,p._interactor.rectGuide.gatherRects());else if(b.hasDeleteAction){var V=_.gv,m=p._interactor.getStyle("connectGuideGarbageShift");b.garbageInfo={x:V.getWidth()*m[0]+m[2],y:V.getHeight()*m[1]+m[3],size:p._interactor.getStyle("connectGuideGarbageIntersectsize")},_._42()}}},zd.prototype._46O=function(K){var l,I,y=this,Q=y.editing,U=y.target;if(Q){if("connect"===Q.mode&&!Q.canceled&&!Q.deleted)try{Q.garbageInfo&&Q.garbageInfo.hover?X.doDeleteConnectionAction(y._interactor.gv,U):X.doConnectAction(y._interactor.gv,U,Q.target)}catch(t){console.error(t)}I=Q.freezeFlag,l=y.editing.groupRotateMode,y._fireEditEvent("end",K),y.editing=null}y.tipInfo=null,y._inSmartGuide&&(y._interactor.rectGuide.clear(),y._inSmartGuide=!1),l&&U&&U.endRotate(),U instanceof W.Block&&(I===d?delete U._freezeSyncFromChildren:U._freezeSyncFromChildren=I,U.updateFromChildren())},zd.prototype.handleNormalStateDelete=function(){var m=this,w=m.editing;if(w&&"connect"===w.mode&&!w.canceled&&!w.deleted){if(w.garbageInfo){try{X.doDeleteConnectionAction(m._interactor.gv,m.target)}catch(N){console.error(N)}w.garbageInfo=null}return w.cursorPos=null,w.targetCorners=null,w.deleted=!0,m._interactor._42(),!0}},zd.prototype.handleNormalStateKeyDown=function(S){var m=this,Z=m.editing;return!Z||"connect"!==Z.mode||Z.canceled||Z.deleted?void 0:W.Default.isEsc(S)?(Z.cursorPos=null,Z.targetCorners=null,Z.canceled=!0,m._interactor._42(),!0):void 0},zd.prototype.handleEdit=function(s,F){var S=this,m=S.editing;if(m){var U,_,j,K,T,R=S.target,l=m.key,p=m.mode,n=s.lp(F),P=S._interactor;if("connect"===p){if(m.canceled)return;if(m.deleted)return;m.cursorPos=P._getLogicalPoint(F);var f=m.garbageInfo;return f&&Sf.checkHit(m.cursorPos,f,f.size)?(f.hover=!0,m.target=null,m.targetCorners=null):(f&&(f.hover=!1),m.target=s.getDataAt(n,function(i){return s.isSelectable(i)?zm(i)?!0:!1:!1})||null,m.targetCorners=Sf.getTargetCornersOnScreen(s,m.target)),P._42(),void 0}if("rotate"===p){var x,M,t=m.pos,V=Math.atan2(n.y-t.y,n.x-t.x);if(m.groupRotateMode?M=V-m.hitRot:(x=V-m.hitRot,M=m.rotation+x),M%=2*Math.PI,0>M&&(M+=2*Math.PI),!W.Default.isCtrlDown(F)){var u,Z;Pn(F)?(u=P.getStyle("shiftRotateRound"),Z=u/2):(u=P.getStyle("rotateRound"),Z=P.getStyle("rotateSensitivity")),M=Sf.roundTo(M,u,Z)}m.groupRotateMode?(x=M-(m.lastRotation||0),0!==x&&(R.addRotation(x,m.groupRotateMode),m.lastRotation=M)):R.setRotation(M),P._setRotateCursor(V),M>Math.PI&&(M-=2*Math.PI);var G=180*(M/Math.PI);G=G.toFixed(2),U=""+G+"°"}else if("resize"===p){var h=m.rect;j=h.x,K=h.y;var v,J=h.width,c=h.height,q=m.anchor,$=m.matrix,r=R.s&&R.s("keepAspectRatio")||P.getStyle("keepAspectRatio");Pn(F)&&(r=!r);var O=S._unionPointMode1,C=S._unionPointMode2;if(S._inSmartGuide&&!W.Default.isCtrlDown(F)&&!r){var E;"L"===l||"R"===l?E="x":("T"===l||"B"===l)&&(E="y"),S._adsorbedToClosest(n,E),T=!0}v=$.tfi(n);var Y;"LT"===l?(h=O(v,{x:j+J,y:K+c},J,c,r),Y=9):"T"===l?(h=C({x:j,y:v.y},{x:j+J,y:K+c},J,c,r,"v"),Y=1):"RT"===l?(h=O(v,{x:j,y:K+c},J,c,r),Y=33):"L"===l?(h=C({x:v.x,y:K},{x:j+J,y:K+c},J,c,r,"h"),Y=8):"R"===l?(h=C({x:j,y:K},{x:v.x,y:K+c},J,c,r,"h"),Y=32):"LB"===l?(h=O(v,{x:j+J,y:K},J,c,r),Y=12):"B"===l?(h=C({x:j,y:K},{x:j+J,y:v.y},J,c,r,"v"),Y=4):"RB"===l&&(h=O(v,{x:j,y:K},J,c,r),Y=36);var B=$.tf(h.x+h.width*q.x,h.y+h.height*q.y);R instanceof W.Block&&(m.hasOwnProperty("freezeFlag")||(m.freezeFlag=R._freezeSyncFromChildren,R._freezeSyncFromChildren=!0)),R.setPosition(B),R.setSize(h.width,h.height),T&&(_=R.getRect(),P.rectGuide.gatherLines({node:R,x:_.x,y:_.y,w:_.width,h:_.height},E,Y)),U=""+Math.round(h.width)+" * "+Math.round(h.height)}else if("line"===p){if(Pn(F)){var D=R.getPoints(),I="P1"===l?D.get(1):D.get(0),X={x:n.x-I.x,y:n.y-I.y},b=P.getStyle("shiftLineRotateRound"),N=S._shiftDirList;if(!N||S._shiftRotateRound!==b){S._shiftRotateRound=b,S._shiftDirList=N=[];for(var g=0;g<Math.PI;g+=b)N.push({x:L(g),y:k(g)})}for(var d,z=0,Q=0,A=N.length;A>Q;Q++){var e=N[Q],a=e.x*X.x+e.y*X.y;Math.abs(a)>Math.abs(z)&&(z=a,d=e)}n={x:I.x+d.x*z,y:I.y+d.y*z},P.rectGuide.clear()}else S._inSmartGuide&&!W.Default.isCtrlDown(F)&&(S._adsorbedToClosest(n),T=!0);var o=Sf.getDataMatrix(R).applyInverse(n);R.setPoint("P1"===l?0:1,o,!0);var w=R.getPoints(),i=w.get(0),H=w.get(1);j=i.x-H.x,K=i.y-H.y,U=" "+Math.round(Math.sqrt(j*j+K*K))+" ",T&&(_=R.getRect(),P.rectGuide.gatherLines({node:R,x:_.x,y:_.y,w:_.width,h:_.height}))}if(U){var y=W.Default.getLogicalPoint(F,P._canvas);y.x+=Sf.Icons.TipShiftX,y.y+=Sf.Icons.TipShiftY,S.tipInfo={helperPos:y,text:U,size:U.length}}S._fireEditEvent("between",F)}},zd.prototype._unionPointMode1=function(b,U,I,V,N){if(N&&I&&V){var F=b.x-U.x,Q=b.y-U.y;Math.abs(F*V)<Math.abs(Q*I)?(Q=Math.sign(Q)*Math.abs(F*V/I),b.y=U.y+Q):(F=Math.sign(F)*Math.abs(Q*I/V),b.x=U.x+F)}return W.Default.unionPoint(b,U)},zd.prototype._unionPointMode2=function(c,z,h,S,R,F){var i=W.Default.unionPoint(c,z);if(R&&h&&S){var s;"v"===F?(s=i.x+i.width/2,i.width=h*i.height/S,i.x=s-i.width/2):(s=i.y+i.height/2,i.height=S*i.width/h,i.y=s-i.height/2)}return i},zd.prototype._adsorbedToClosest=function(A,w){var c=this,y=c._interactor,M=y.rectGuide.findClosest(A,w),E=y.gridGuide.findClosest(A,w),G=1/0,n=1/0;M&&(isFinite(M.x)&&(G=M.x),isFinite(M.y)&&(n=M.y)),E&&(isFinite(E.x)&&Math.abs(E.x)<Math.abs(G)&&(G=E.x),isFinite(E.y)&&Math.abs(E.y)<Math.abs(n)&&(n=E.y)),isFinite(G)&&(A.x+=G),isFinite(n)&&(A.y+=n)},zd.prototype._42=function(w,U,e){var Y=this;Y.info={},Y.screenInfo=null;var D=Y._interactor;if(!D.editDetail&&Y.gatherInfo(U,e)){var x=Y.editing,Z=x?x.groupRotateMode:null,F=Y.screenInfo;if("block"!==Z){if(F.P1?Sf.Icons.DrawIcon(D,w,Sf.Icons.Line,F):Sf.Icons.DrawIcon(D,w,Sf.Icons.Rect,F),F.connect&&(Sf.Icons.DrawIcon(D,w,Sf.Icons.ConnectGuide,{rotation:F.rotation,connect:F.connect,cursorPos:x?x.cursorPos:null}),x)){if(x.targetCorners){for(var I={x:1/0,y:1/0},z={x:-1/0,y:-1/0},$=0,d=x.targetCorners.length;d>$;$+=2)I.x=Math.min(I.x,x.targetCorners[$]),z.x=Math.max(z.x,x.targetCorners[$]),I.y=Math.min(I.y,x.targetCorners[$+1]),z.y=Math.max(z.y,x.targetCorners[$+1]);Sf.Icons.DrawIcon(D,w,Sf.Icons.HoverDataRect,{min:I,max:z,color:D.getStyle("hoverGuideColor")||D.getStyle("baseColor")})}x.garbageInfo&&Sf.Icons.DrawIcon(D,w,Sf.Icons.ConnectGuideGarbage,x.garbageInfo)}Y.tipInfo&&Sf.Icons.DrawIcon(D,w,Sf.Icons.TipHelper,Y.tipInfo)}Y.target instanceof Sf.Group&&Y.target._42(D,w,U)}};var nf=Sf.Anchor=function(s){this.catalog="Anchor",this._interactor=s};nf.prototype={},nf.prototype.constructor=nf,nf.prototype.gatherInfo=function(D,R){var o=this;if(1===R.length){var M=R[0];if(!M.getAnchor)return;if(M instanceof W.Shape&&M._70I())return;if(gq(M,D))return;return o.gatherSingleTarget(D,R[0])}return R.length>1?o.gatherMultiTargets(D,R):!1},nf.prototype.gatherSingleTarget=function(j,k){var d=this;return d.info.POS=k.getPosition(),d.screenInfo.POS=Sf.toScreenPosition(j,d.info.POS),d.target=k,!0},nf.prototype.gatherMultiTargets=function(d,q){var i=this,F=Sf.Group.findOrCreateGroup(q);return F?(i.screenInfo.POS=Sf.toScreenPosition(d,F.getAnchor2()),i.target=F,!0):!1},nf.prototype.isVisible=function(){var R=this,Z=R._interactor;if(Z.getStyle("anchorVisible")===!1)return!1;var o=R.target;if(o){if(this.editing)return!0;var F=o.getAnchor(),N=Z.getStyle("anchorOutsideVisibleThreshold");if(F.x<-N||F.x>1+N||F.y<-N||F.y>1+N)return!0;var T=o.getSize(),C=o.getScale(),W=Math.min(Math.abs(T.width*C.x),Math.abs(T.height*C.y));if(W*Z.gv._zoom<Z.getStyle("anchorHideThreshold"))return!1}return!0},nf.prototype.check=function(F,Z,O){if(W.Default.isLeftButton(Z)){var q=this,y=q._interactor;if(q.isVisible()&&y.getStyle("anchorMovable")!==!1){q.editing=null,q.tipInfo=null;var k=q.target;if(k&&F.isAnchorEditable(k)&&F.isEditable(k)){var l;if(q.screenInfo&&(l=q.screenInfo.POS)&&Sf.checkHit(O,new Sf.Math.Vector2(l),y.getStyle("checkSize"))){if(k instanceof Sf.Group)return q.editing={},!0;var G=k.getWidth(),S=k.getHeight(),d=k.getAnchor();return q.editing={rect:{x:-G*d.x,y:-S*d.y,width:G,height:S},anchor:d,matrix:k.getMatrix()},!0}}}}},nf.prototype.startEdit=function(Y,d){Y.startDragging(d),Y.fi({kind:"beginEditAnchor",event:d})},nf.prototype._46O=function(P){var N=this;N.editing&&(N.editing=null,N._interactor.fi({kind:"endEditAnchor",event:P})),N.tipInfo=null},nf.prototype.handleEdit=function(X,g){var c=this,m=c.target;if(m){var Z=c.editing;if(Z){var S=X.lp(g),k=c._interactor;
if(m instanceof Sf.Group)return m.setAnchor2(S),k._42(),void 0;var _=Z.matrix,V=_.tfi(S),A=Z.rect,b=(V.x-A.x)/A.width,U=(V.y-A.y)/A.height;if(!W.Default.isCtrlDown(g)){var Q=k.getStyle("anchorRound"),O=k.getStyle("anchorSensitivity");b=Sf.roundTo(b,Q,O),U=Sf.roundTo(U,Q,O)}m.setAnchor(b,U,!0);var B=W.Default.getLogicalPoint(g,k._canvas);B.x+=Sf.Icons.TipShiftX,B.y+=Sf.Icons.TipShiftY;var r=""+b.toFixed(2)+", "+U.toFixed(2);c.tipInfo={helperPos:B,text:r,size:r.length},k.fi({kind:"betweenEditAnchor",event:g})}}},nf.prototype._42=function(V,q,G){var f=this;f.info={},f.screenInfo={};var d=f._interactor;d.editDetail||f.gatherInfo(q,G)&&f.isVisible()&&(Sf.Icons.DrawIcon(d,V,Sf.Icons.Anchor,f.screenInfo),f.tipInfo&&Sf.Icons.DrawIcon(d,V,Sf.Icons.TipHelper,f.tipInfo))};var Ro=Sf.MoveDummy=function(l){this.catalog="MoveDummy",this._interactor=l};Ro.prototype={},Ro.prototype.constructor=Ro,Ro.prototype.gatherInfo=function(){var N=this,w=this._interactor.getSubModule("Rect");if(w){var T=w.screenInfo;if(T){var S=N._interactor,q=N.getMovableTarget(w.target);if(q){var g=S.getStyle("moveDummyThreshold");if(g!==!1){var v=T.LT||T.P1,f=T.RT||T.P2,J=T.LB||v;if(v){var O=T.P1,h=Math.min(v.distanceTo(J),v.distanceTo(f));if(!(g!==!0&&h>g)){var R=S.getStyle("moveDummyPosition"),K=f.clone().sub(v),u=J.clone().sub(v),d=R[2],E=R[3];if(O){var L=S.getStyle("moveDummyLineExtraShift");L&&(d+=L[0],E+=L[1])}var Z=v.clone().add(K.clone().multiplyScalar(R[0])).add(K.setLength(d)).add(u.clone().multiplyScalar(R[1])).add(u.setLength(E));return N.screenInfo.pos=Z,N.screenInfo.size=S.getStyle("moveDummySensitivity"),!0}}}}}}},Ro.prototype.getMovableTarget=function(f){var G=this._interactor.gv;if(zm(f)){if(G.isMovable(f))return f}else if(f instanceof Sf.Group)for(var y=f._entities,u=y.length-1;u>=0;u--){var q=y[u];if(zm(q)&&G.isMovable(q))return q}return null},Ro.prototype.getMoveInteractor=function(){for(var p,q,v,t=this._interactor.gv,y=t.getInteractors(),p=0,q=y.length;q>p;p++)if(v=y.get(p),v instanceof Tl)return v},Ro.prototype.startEdit=function(F,T){F.startDragging(T);var q=this.getMoveInteractor();if(q){var l=this.selectedTarget,Y=F.gv;Y._moving=1,q._data=l,Y.handleMouseDown&&Y.handleMouseDown(T,l)}},Ro.prototype._46O=function(N){var n=this,c=n.getMoveInteractor();c&&(c.handleWindowMouseUp(N),n.selectedTarget=null)},Ro.prototype.handleEdit=function(c,C){var y=this.getMoveInteractor();y&&y.handleWindowMouseMove(C)},Ro.prototype.check=function(R,p,D){if(this.selectedTarget=null,W.Default.isLeftButton(p)&&!R._scrolling&&!Aq()){var g=this;if(g.screenInfo){var $=g.screenInfo.pos;if($&&!(D.distanceTo($)>g.screenInfo.size)){var M=g._interactor;return g.selectedTarget=g.getMovableTarget(M.getSubModule("Rect").target),M.setCursor("default"),!0}}}},Ro.prototype._42=function(v,U,f){var w=this;w.screenInfo={};var h=w._interactor;h.editDetail||w.gatherInfo(U,f)&&(!h.editing||w.selectedTarget)&&Sf.Icons.DrawIcon(h,v,Sf.Icons.MoveDummy,w.screenInfo)};var Kc=Sf.RotateX=function(X){this.catalog="RotateX",this._interactor=X};Kc.prototype={},Kc.prototype.constructor=Kc,Kc.prototype.gatherInfo=function(N,P){var T=this;if(1===P.length){var J=P[0];return J instanceof W.Shape&&J._70I()||gq(J,N)?!1:T.gatherSingleTarget(N,J)}return P.length>1?T.gatherMultiTargets(N,P):!1},Kc.prototype.gatherSingleTarget=function(){var x=new W.Math.Vector2,H=new W.Math.Vector2,f=new W.Math.Vector2,d=new W.Math.Vector2,E=function(s,F){var b=s.x-F.x,w=s.y-F.y;return b*b+w*w};return function(Q,W){if(W.getCorners){var X=this,N=W.getCorners(),y=15,w=W.getPosition();x.copy(N[0]),f.copy(N[1]),d.copy(N[3]),H.copy(x).add(d).divideScalar(2).add(x.sub(f).setLength(y/Q.getZoom()));var Z=Math.max(E(w,N[0]),E(w,N[1]),E(w,N[2]),E(w,N[3]));return X.info.POS=H.clone(),X.screenInfo.POS=Sf.toScreenPosition(Q,X.info.POS),X.screenInfo.LEN=Math.sqrt(Z)*Q.getZoom()+y,X.screenInfo.CENTER=Sf.toScreenPosition(Q,w),X.target=W,!0}}}(),Kc.prototype.gatherMultiTargets=function(r,t){var C=this,V=Sf.Group.findOrCreateGroup(t);if(!V)return!1;var C=this;return C.gatherSingleTarget(r,V)},Kc.prototype.isVisible=function(){var l=this._interactor;if(!l.getStyle("rotateAsClock"))return!1;var g=this.target;if(!g)return!0;var f=l.gv;return f.isEditable(g)&&f.isRotationEditable(g)?!0:!1},Kc.prototype.check=function(e,n,$){var g=this,c=g._checkImpl(e,n,$);return(c||g._clockPainted)&&g._interactor._42(),c},Kc.prototype._checkImpl=function(Z,r,N){if(W.Default.isLeftButton(r)){var e=this;e.editing=null,e.tipInfo=null;var J;if(e.screenInfo&&(J=e.screenInfo.POS)&&e.isVisible()){var j=e._interactor;if(Sf.checkHit(N,J,j.getStyle("checkSize"))){var h=e.target,P=Z.lp(r),R=h.getPosition(),n=Math.atan2(P.y-R.y,P.x-R.x);return j._setRotateCursor(n),e.editing={pos:R,rotation:h.getRotation(),hitRot:n,groupRotateMode:"block",screenInfo:{CENTER:e.screenInfo.CENTER,LEN:e.screenInfo.LEN}},!0}}}},Kc.prototype.startEdit=function(G,J){G.startDragging(J),G.fi({kind:"beginEditRotation",event:J}),this.target instanceof Sf.Group&&this.target.beginRotate(this.editing)},Kc.prototype._46O=function(p){var J=this;J.editing&&(J.editing=null,J._interactor.fi({kind:"endEditRotation",event:p})),J.target instanceof Sf.Group&&J.target.endRotate(),J.tipInfo=null},Kc.prototype.handleEdit=function(Y,E){var u=this,b=u.editing;if(b){var X,K,Q=u.target,I=Y.lp(E),z=u._interactor,J=b.pos,p=Math.atan2(I.y-J.y,I.x-J.x),j=Q instanceof Sf.Group;if(j?K=p-b.hitRot:(X=p-b.hitRot,K=b.rotation+X),K%=2*Math.PI,0>K&&(K+=2*Math.PI),!W.Default.isCtrlDown(E)){var Z,s;Pn(E)?(Z=z.getStyle("shiftRotateRound"),s=Z/2):(Z=z.getStyle("rotateRound"),s=z.getStyle("rotateSensitivity")),K=Sf.roundTo(K,Z,s)}j?(X=K-(b.lastRotation||0),0!==X&&(Q.addRotation(X,b.groupRotateMode),b.lastRotation=K)):Q.setRotation(K),z._setRotateCursor(p),K>Math.PI&&(K-=2*Math.PI);var g=180*(K/Math.PI),r=""+g.toFixed(2)+"°",y=W.Default.getLogicalPoint(E,z._canvas);y.x+=Sf.Icons.TipShiftX,y.y+=Sf.Icons.TipShiftY,u.tipInfo={helperPos:y,text:r,size:r.length},z.fi({kind:"betweenEditRotation",event:E})}},Kc.prototype._42=function(b,c,Q){var K=this;K._clockPainted=!1,K.info={},K.screenInfo={};var A=K._interactor;A.editDetail||K.gatherInfo(c,Q)&&K.isVisible()&&(Sf.Icons.DrawIcon(A,b,Sf.Icons.RoundPoint,K.screenInfo.POS),K.tipInfo&&Sf.Icons.DrawIcon(A,b,Sf.Icons.TipHelper,K.tipInfo),K.editing&&K.drawClock(b))},Kc.prototype.drawClock=function(q){q.save();var N=this;N._clockPainted=!0;var l=N.editing||{},O=l.screenInfo||N.screenInfo,U=O.LEN,o=U+8,_=U+18;q.save(),q.translate(O.CENTER.x,O.CENTER.y),q.beginPath(),q.strokeStyle="rgb(150, 150, 150)";for(var I,R,a,p,s,z=0;360>z;z++)I=z*Math.PI/180,0===z%5&&(R=k(I)*U,a=L(I)*U,p=k(I)*o,s=L(I)*o,q.moveTo(R,a),q.lineTo(p,s)),0===z%45&&(R=k(I)*U,a=L(I)*U,p=k(I)*_,s=L(I)*_,q.moveTo(R,a),q.lineTo(p,s));q.stroke(),q.rotate(-j);var i=l.lastRotation||N.target.getRotation();q.beginPath(),q.fillStyle="rgba(255, 0, 0, 0.1)",q.strokeStyle="rgb(157, 157, 157)",q.moveTo(0,0),q.arc(0,0,_,0,i,!1),q.fill(),q.beginPath(),q.moveTo(0+_,0),q.arc(0,0,_,0,i,!1),q.stroke(),q.restore()};var Br=Sf.Curve=function(j){this.catalog="Curve",this._interactor=j};Br.prototype={},Br.prototype.constructor=Br,G.defineProperties(Br.prototype,{activing:{get:function(){return this._activing},set:function(I){var k=this;if(I)k._activing=new Sf.CurveActiving(this,I);else{var D=k._activing;D&&D.dispose(),k._activing=null}}}}),Br.PointType={Mirrored:0,Straight:1,Disconnected:2,Asymmetric:3},Br.prototype.setUp=function(){var V=this,s=V._interactor;s&&s.gv.mp(V._onGraphviewPropertyChanged,V)},Br.prototype._onGraphviewPropertyChanged=function(G){("zoom"===G.property||"translateX"===G.property||"translateY"===G.property)&&this._handleDataChanged()},Br.prototype.tearDown=function(){var z=this,L=z._interactor;L&&L.gv.ump(z._onGraphviewPropertyChanged,z)},Br.prototype.canEnterEditDetailMode=function(){var F=this,n=F._interactor,J=n._getValidSelection();if(1===J.length){var Z=J[0],b=Z instanceof W.Edge;if(Z instanceof W.Shape||b){if(b){var $=Z.s("edge.type");if($&&"points"!==$)return}var u=n.gv;if(u.isPointEditable(Z)&&u.isEditable(Z))return F.target=Z,!0}}},Br.prototype.canQuitEditDetailMode=function(t){var r=this,p=r._interactor._getLogicalPoint(t);return r._checkEditRealPoint(p)?void 0:r._interactor.gv.getDataAt(t)!==r.target?!0:void 0},Br.prototype.preHandleScroll=function(){var A=this.editing;return A&&A.inEdit?!0:void 0},Br.prototype.getCurrentSelectintStatus=function(){var n=this;if(n.activing&&!n.activing.selections){if(n.activing.status!=d)return n.activing.status;var T=function(H){var O=n.activing.status;n.activing.status=H,n._interactor.fp("shapePointStatus",O,H)},f=Sf.Curve.PointType,o=n.activing.point,N=n.activing.pairs;if(!N||1!==N.length)return T(f.Mirrored);var t=N[0],j=t.c1&&t.c1.isNearEnough(o),B=t.c2&&t.c2.isNearEnough(o);if(!t.c1||!t.c2)return j||B?T(f.Straight):T(f.Disconnected);if(j&&B)return T(f.Straight);if(j||B)return T(f.Asymmetric);var H=t.c1.clone().sub(o),L=t.c2.clone().sub(o);return Math.abs(H.x*L.y-H.y*L.x)>1e-5||H.x*L.x>0?T(f.Disconnected):Math.abs(H.length()-L.length())>1e-5?T(f.Asymmetric):T(f.Mirrored)}},Br.prototype.handle_keydown=function(J){var L=this;if(L._interactor.editDetail){var i=Sf.Curve.PointType;"1"===J.key?L._setCurrentSelectionStatus(i.Straight):"2"===J.key?L._setCurrentSelectionStatus(i.Mirrored):"3"===J.key?L._setCurrentSelectionStatus(i.Disconnected):"4"===J.key&&L._setCurrentSelectionStatus(i.Asymmetric)}},Br.prototype.setCurrentSelectionStatus=function(Z){var R=this,q=R._interactor;if(q){var j=q.gv;j.dm().beginTransaction(),this._setCurrentSelectionStatus(Z),j.dm().endTransaction()}},Br.prototype._setCurrentSelectionStatus=function(F){var $=this,P=$.activing;if(P){var s=$.getCurrentSelectintStatus();if(null!==s&&s!==F){P.status=F;var t=$.activing.point,v=$.activing.pairs;if(v&&1===v.length){var f=v[0],Y=$.screenInfo.curve,V=Sf.Curve.PointType,W=function(){$._writeToHt(),$._interactor.fp("shapePointStatus",s,F)};if(F===V.Straight)return Y.moveCtrlPoint(f,t,"c1"),Y.moveCtrlPoint(f,t,"c2"),W(),void 0;if(s===V.Straight){var g=Y.findPairs(t,!0),J=g[0],I=J.r1||t,A=J.r2||t,u=A.clone().sub(I).multiplyScalar(.25);return Y.moveCtrlPoint(f,t.clone().sub(u),"c1"),Y.moveCtrlPoint(f,t.clone().add(u),"c2"),W(),void 0}var o=f.c1,M=f.c2;if(o&&M){if(F===V.Mirrored)return Y.moveCtrlPoint(f,t.clone().multiplyScalar(2).sub(M),"c1"),W(),void 0;if(F===V.Asymmetric&&s===V.Disconnected){var n=o.clone().sub(t).length(),u=t.clone().sub(M).setLength(n).add(t);return Y.moveCtrlPoint(f,u,"c1"),W(),void 0}}P._firePointChange(),$._interactor.fp("shapePointStatus",s,F)}}}},Br.prototype._handleDataChanged=function(){var N="points,segments,shape,position,rotation,scale".split(",");return function(v){var b=this;if(b.screenInfo&&b.target){if(v&&N.indexOf(v.property)<0)return;var d=b._interactor;b.gatherSingleTarget(d.gv,b.target,!0),b.check(d.gv,null,new Sf.Math.Vector2(d._lastClientPoint)),d._42()}}}(),Br.prototype.gatherSingleTarget=function(f,Y,e){var S,T,Q=this;Q.screenInfo&&Q.screenInfo.curve&&(T=Q.screenInfo.curve._curves);var w=Q.editing;S=w?Q.screenInfo:Q.screenInfo={};var b,F,o=Y instanceof W.Edge;o?(b=Y.s("edge.segments"),F=Y.s("edge.points")||new W.List):(b=Y._58O,F=Y._59O),S.S=b;var I,B=S.P=[],d=Sf.getDataMatrix(Y);if(Y instanceof W.Polyline&&(I=Y.getElevation()||0,S.E=[]),F.each(function(w){S.E&&S.E.push(w.e||I),w=d.apply(w);var A=Sf.toScreenPosition(f,w);B.push(A.x,A.y)}),o){var j=B.length,_=Sf.toScreenPosition(f,Y._lastSourcePoint||(j?{x:B[0],y:B[1]}:{x:0,y:0})),h=Sf.toScreenPosition(f,Y._lastTargetPoint||(j?{x:B[j-2],y:B[j-1]}:{x:0,y:0}));B.splice(0,0,_.x,_.y),B.push(h.x,h.y)}if(!S.S||!S.S.size()){S.S=new W.List,S.S.add(1);for(var g=0;g<B.length/2-1;g++)S.S.add(2)}if((!w||e)&&Q.convertToCubicBezier(T),Q.activing&&(e||!Q.editing||"realPoint"===Q.editing.type)){var C=S.curve.findPairs(Q.activing.point);Q.activing.pairs=C}o&&"points"!==Y.s("edge.type")&&Q._writeToHt()},Br.prototype._convertToNewPoint=function(k,D,A,I){var w,L,t;for(w=0,L=D.length;L>w;w++){if(t=D[w],t._p1.isNearEnough(k)&&(!I||I.indexOf(t._p1)<0))return t._p1;if(t._p4.isNearEnough(k)&&(!I||I.indexOf(t._p4)<0))return t._p4}if(A)for(w=0,L=Math.min(A.length,L);L>w;w++){if(t=A[w],t._p1===k&&(!I||I.indexOf(D[w]._p1)<0))return D[w]._p1;if(t._p4===k&&(!I||I.indexOf(D[w]._p4)<0))return D[w]._p4}},Br.prototype.convertToCubicBezier=function(K){var y,H,Q=this,B=new Sf.Math.Curve,b=Q.screenInfo;if(B.createFromHtShape(b.P,b.S,b.E),b.curve=B,Q.activing){var g=B._curves;y=Q.activing.point,H=Q._convertToNewPoint(y,g,K);var P=[];if(H&&(Q.activing.point=H,P.push(H)),Q.activing.selections){var p=-1,R=Q.activing.selections;R.forEach(function($){p++,H=Q._convertToNewPoint($,g,K,P),H&&(R[p]=H,P.push(H))})}}},Br.prototype.check=function(T,U,A){if(!U||bh(U)||Ih(U)){var k=this;if(k._interactor.setCursor("default"),k.editing=null,k.highlight=null,k.tipInfo=null,k.edgeEditResult=null,k.screenInfo){if(Aq()||Ih(U))return k._interactor._42(),!0;if(k._checkEditCtrlPoint(A))return k._interactor._42(),!0;if(k._checkEditRealPoint(A))return k._interactor._42(),!0;if(k._checkEditElevation(A))return k._interactor._42(),!0;var J=k.screenInfo.curve,p=J.checkPoint(A,k._interactor.getStyle("curveIntersectSize"));if(p){var F=k.highlight={};F.type="insertKnot",F.bezier=p.bezier,F.point=p.intersection}return k._interactor._42(),!0}}},Br.prototype._checkEditRealPoint=function(c){var H,y,q,V,o,Q,I=this,b=I.screenInfo.curve._curves,j=I._interactor.getStyle("curvePointIntersectSize"),J=1/0;for(j*=j,q=0,V=b.length;V>q;q++)H=b[q],o=H._p1,Q=c.distanceToSquared(o),J>Q&&(J=Q,y=o),o=H._p4,Q=c.distanceToSquared(o),J>Q&&(J=Q,y=o);if(J>j)return!1;var x=I.highlight={};return x.type="changeRealPoint",x.point=y,I.editing={type:"realPoint",point:y,shiftGuide:{point:y.clone(),dir:"x",limit:0}},I._interactor.setCursor("crosshair"),!0},Br.prototype._checkEditElevation=function(h){var D=this;if(!D._interactor.getStyle("curveElevationVisible"))return!1;var t=D.activing;if(!t)return!1;var z=t.getCurrentEditingPoint();if(!z)return!1;var R=D._interactor,$=R.getStyle("curveElevationGuideShift"),M=R.getStyle("curveElevationIntersectSize"),i=h.distanceToSquared({x:z.x+$[0],y:z.y+$[1]});if(!(i>M*M)){var u=D.highlight={};u.type="elevation";var P=new Sf.Math.Vector2(h.x,h.y,z.e);return D.editing={type:"elevation",startPoint:P},D._interactor.setCursor("crosshair"),!0}},Br.prototype._checkEditCtrlPoint=function(v){var R=this;if(R.activing&&!R.activing.selections){var M=R.getCurrentSelectintStatus();if(M!==Sf.Curve.PointType.Straight){var o=R.activing.pairs;if(o){var V=R._interactor.getStyle("curvePointIntersectSize");V*=V;var g,t,z,Y,h,P,e,A,f,k=1/0;for(e=0,f=o.length;f>e;e++)for(Y=o[e],A=0;2>A;A++)h=0===A?"c1":"c2",Y[h]&&(P=v.distanceToSquared(Y[h]),k>P&&(k=P,g=Y,t=e,z=h));if(k>V)return!1;R.activing.hlpair=g,R.activing.hltype=z;var p=R.highlight={};return p.type="changeCtrlPoint",p.point=g[z],R.editing={type:"ctrlPoint",pair:g,pairId:t,ctrlType:z,direction:g[z].clone().sub(R.activing.point).normalize()},R._interactor.setCursor("crosshair"),!0}}}},Br.prototype.startEdit=function(P,c){P.startDragging(c);var i=this;i.highlight&&"insertKnot"===i.highlight.type&&(i.insertKnot(),i.gatherSingleTarget(i._interactor.gv,i.target),i.activing=null,i._checkEditRealPoint(i._interactor._getLogicalPoint(c)));var b=i._activing;if(b){var v=i.editing?i.editing.type:null;"ctrlPoint"===v?b.editingCtrl={pairId:i.editing.pairId,type:b.hltype}:"realPoint"===v&&(b.editingCtrl=!1)}var U=i.highlight,Z=W.Default.isCtrlDown(c);if(!U||Aq()||Ih(c)){var y=i._interactor.gv;if(!y.setFocus(c)||y._scrolling)return;return Z?i._multiSelect={startPoint:y.lp(c)}:y.isPannable()&&(bh(c)||Ih(c))&&(i._pan={tx:y.tx(),ty:y.ty()},P.fi({kind:"beginPan",event:c})),void 0}if("changeRealPoint"===U.type){var j,S=i.activing?i.activing.point:null,V=i.activing?i.activing.selections:null;if(Z&&i.activing)S===U.point?(V?(i.activing={point:V[0]},V.length>1&&(V.splice(0,1),i.activing.selections=V)):i.activing=null,i.editing=null):V&&(j=V.indexOf(U.point))>=0?(V.length>1?V.splice(j,1):delete i.activing.selections,i.editing=null):V?(V.push(S),i.activing={point:U.point,selections:V}):i.activing={point:U.point,selections:[S]};else if(V)S===U.point||((j=V.indexOf(U.point))>=0?(V.splice(j,1,S),i.activing={point:U.point,selections:V}):i.activing={point:U.point});else{var k;S===U.point&&(k=i.activing.status),i.activing={point:U.point},k&&(i.activing.status=k)}P.fi({kind:"beginEditPoint",event:c})}},Br.prototype.insertKnot=function(){var j=this,V=j.highlight,L=j.screenInfo.curve;L.insertKnot(V.bezier,V.point.t),j._writeToHt()},Br.prototype._writeToHt=function(){var A,q,v,I,f=this,z=f.screenInfo.curve,t=z.toHtShape(),O=t.points,e=[],y=t.segments,m=f._interactor.gv,L=f.target,V=L instanceof W.Edge,j=Sf.getDataMatrix(L).invert();I=L instanceof W.Polyline,I&&(v=L.getElevation());for(var $=0,C=O.length;C>$;$++)A=O[$],q=Sf.toWorldPosition(m,A),q=j.apply(q),A.e!=d&&A.e!==v&&(q.e=A.e),e.push(q);if(L._writing=!0,V){L.s("edge.type","points"),L.setStyle("edge.segments",y),L.setStyle("edge.points",e.slice(1,e.length-1)),L.setStyle("edge.source.offset.x",0),L.setStyle("edge.source.offset.y",0),L.setStyle("edge.target.offset.x",0),L.setStyle("edge.target.offset.y",0);var c=f._nextChangeEdgeHost;delete f._nextChangeEdgeHost,c&&("source"===c.type?L.setSource(c.host):L.setTarget(c.host)),f._writeEdgeHostAnchor("source",e[0]),f._writeEdgeHostAnchor("target",e[e.length-1])}else e.length?(L.setSegments(y),L.setPoints(e,!0)):L.removeFromDataModel();delete L._writing},Br.prototype._writeEdgeHostAnchor=function(r,k){var h=this,P=h.target,Z=h._calcHostAnchor(P,r,k);Z.index!==d?(P.setStyle("edge."+r+".index",Z.index),P.setStyle("edge."+r+".percent",d),P.setStyle("edge."+r+".anchor.x",d),P.setStyle("edge."+r+".anchor.y",d)):Z.percent!==d?(P.setStyle("edge."+r+".percent",Z.percent),P.setStyle("edge."+r+".index",d),P.setStyle("edge."+r+".anchor.x",d),P.setStyle("edge."+r+".anchor.y",d)):(P.s("edge."+r+".anchor.x",Z.x),P.s("edge."+r+".anchor.y",Z.y),Z.offsetX||Z.offsetY?(P.s("edge."+r+".offset.x",Z.offsetX),P.s("edge."+r+".offset.y",Z.offsetY)):(P.s("edge."+r+".offset.x",0),P.s("edge."+r+".offset.y",0)))},Br.prototype._calcHostAnchor=function(m,x,C,q){q||(q="source"===x?m.getSource():m.getTarget());var M=this._interactor.gv,h=M.calculateAttachPoint(q,C);if(h)return h.info;if(Pe(q)){var V=M.calculateEdgePosition(q,C);return V}var p=q.getRotation(),u=q.getAnchor();gq(q,M)&&(p=0);var A=q.getScale();if(p||A.x<0||A.y<0){var R=q.getMatrix(),g=R.tfi(C),t=q.getSize();return{x:g.x/t.width+u.x,y:g.y/t.height+u.y}}var c=Pl(M,q),L={x:(C.x-c.x)/c.width,y:(C.y-c.y)/c.height};return L},Br.prototype._handlePanning=function(V){var H=this,c=H._pan;if(c){c.started=!0;var p=H._interactor,T=p.gv,e=p._lastClientPoint,M=Xd(V),A=Gi(T,M,e);T.setTranslate(c.tx+A.x,c.ty+A.y),H.gatherSingleTarget(p.gv,H.target),p._42(),p.fi({kind:"betweenPan",event:V})}},Br.prototype.handleEdit=function(I,D){var u=this,V=u.editing;if(u._pan)return u._handlePanning(D),void 0;if(u._multiSelect)return u._multiSelect.endPoint=I.lp(D),u._interactor.redraw(),void 0;if(V){V.inEdit=!0;var v,P,J,t=u._interactor._getLogicalPoint(D),$=W.Default.isCtrlDown(D),B=W.Default.isShiftDown(D),F=V.type,L=u.activing;if(u._guideInfo=null,"ctrlPoint"===F&&B){var M=u.editing.direction.clone();v=L.point;var X=M.dot(t.clone().sub(v));t=M.setLength(X).add(v)}else if("ctrlPoint"===F||"realPoint"===F){var M;if("realPoint"===F&&B){var n=u.editing.shiftGuide;P=n.point;var w=Math.abs(t.x-P.x),f=Math.abs(t.y-P.y);w>f&&w>n.limit&&"y"===n.dir&&(n.dir="x"),f>w&&f>n.limit&&"x"===n.dir&&(n.dir="y"),M=n.dir,"x"===M?(t.y=P.y,n.limit=Math.max(n.limit,w)):"y"===M&&(t.x=P.x,n.limit=Math.max(n.limit,f))}var Y=u._isEditEdgeSourceTarget();if(Y){var K=u._editEdgeSourceTarget(Y,t,$);K&&(u.edgeEditResult=K,J=K.tipText)}else if(!$){var O=u._guidingToEdit(t,M),l="realPoint"===F?u._interactor.gridGuide.findClosest(t,M,!0):null,Z=1/0,N=1/0;l&&(l.x&&(Z=l.x),l.y&&(N=l.y));var H=!1;O&&(O.xList&&(Math.abs(O.x)<=Math.abs(Z)?(H=!0,Z=O.x):delete O.xList),O.yList&&(Math.abs(O.y)<=Math.abs(N)?(H=!0,N=O.y):delete O.yList),H&&(u._guideInfo=O)),isFinite(Z)&&(t.x+=Z),isFinite(N)&&(t.y+=N),H&&(O.v=t)}}var A=u.screenInfo.curve;if("realPoint"===V.type){v=V.point,v.e!==d&&(t.e=v.e),A.moveRealPoint(v,t),V.point=t,u.highlight.point=t;var C=L.status,h=L.selections;if(u.activing={point:t,status:C},h){var E=t.clone().sub(v),S=0;h.forEach(function(Q){var N=Q.clone().add(E);A.moveRealPoint(Q,N),h[S++]=N}),u.activing.selections=h}}else if("ctrlPoint"===V.type){var g=L.pairs,m=g[V.pairId];A.moveCtrlPoint(m,t,V.ctrlType);var c=L.status,T=Sf.Curve.PointType;if((c===T.Mirrored||c===T.Asymmetric)&&m.c1&&m.c2){var v=new Sf.Math.Vector2(L.point),U="c1"===V.ctrlType?"c2":"c1";if(c===Sf.Curve.PointType.Mirrored)A.moveCtrlPoint(m,v.clone().multiplyScalar(2).sub(t),U);else if(c===T.Asymmetric){var X=m[U].clone().sub(v).length(),p=v.clone().sub(m[V.ctrlType]).setLength(X).add(v);isNaN(p.x)||A.moveCtrlPoint(m,p,U)}}L._firePointChange()}else if("elevation"===V.type){P=V.startPoint;var e=P.e+(P.y-t.y)/I._zoom;u._setCurrentPointImpl("e",e),L._firePointChange(),J="E: "+Sf.toFixed(e)}var i=W.Default.getLogicalPoint(D,u._interactor._canvas);if(i.x+=Sf.Icons.TipShiftX,i.y+=Sf.Icons.TipShiftY,!J){var o=Sf.toWorldPosition(I,t);J=""+Sf.toFixed(o.x)+", "+Sf.toFixed(o.y)}u.tipInfo={helperPos:i,text:J,size:J.length},u._writeToHt(),u._interactor.fi({kind:"betweenEditPoint",event:D})}},Br.prototype._setCurrentPointImpl=function(l,A){var e=this,k=e._activing;if(!k)return!1;var f=e.target;if(!f)return!1;var m=k.getCurrentEditingPoint();if(!m)return!1;var g=k.editingCtrl;if(!g)var B=m.clone();if("e"===l)m.e=A;else{var F;if("x"===l||"y"===l){var w=k._lastFirePoint;F="x"===l?{x:A,y:w?w.y:0}:{x:w?w.x:0,y:A}}else"object"==typeof l?(F=l,l.e!==d&&(m.e=l.e)):(F={x:arguments[0],y:arguments[1]},arguments[2]!==d&&(m.e=arguments[2]));var y=Sf.getDataMatrix(f);F=Sf.toScreenPosition(e._interactor.gv,y.apply(F)),m.x=F.x,m.y=F.y}if(!g){var r=B.multiplyScalar(-1).add(m);m.e&&B.e&&(r.e=m.e-B.e),e.screenInfo.curve.moveCtrlDueToRealPointMovement(m,r)}return!0},Br.prototype.setCurrentPoint=function(u,e){return this._setCurrentPointImpl(u,e)?(this._writeToHt(),!0):!1},Br.prototype._isEditEdgeSourceTarget=function(){var f=this,E=f.target;if(!(E instanceof W.Edge))return!1;var b=f.editing.point,z=f.screenInfo.curve._curves;return b===z[0]._p1?"source":b===z[z.length-1]._p4?"target":!1},Br.prototype._editEdgeSourceTarget=function(V,_,A){var H,l=this,n=l.target;if(H="source"===V?n.getSource():n.getTarget()){var N,w=l._interactor.gv,F=Sf.toWorldPosition(w,_),G=l._calcHostAnchor(n,V,F,H);if(N=G.index!==d||G.percent!==d?G.distance*w.getZoom()>l._interactor.getStyle("edgeHostEdgeMaxDistance"):l._interactor.getStyle("edgeHostDetectPerFrame")?!0:G.x<0||G.x>1||G.y<0||G.y>1?!0:!1){var U=w.getDataAt(F,function(j){return w.isSelectable(j)?j===H?!1:n.canSetSourceTarget(j,V)?!0:!1:!1});if(U){var Z=l._calcHostAnchor(n,V,F,U);H=U,l._nextChangeEdgeHost={type:V,host:U},G=Z}}var b,Y,e;if(A||G.x===d)(G.percent!==d||G.index!==d)&&(Y=G.point);else{var q=l._interactor.getStyle("anchorRound"),x=l._interactor.getStyle("anchorSensitivity");b=w.calculateAttachPoint(H,F),b?G=b.info:(G.x=Sf.roundTo(G.x,q,x),G.y=Sf.roundTo(G.y,q,x)),Y=H.getAttachPosition(G.x,G.y,G.offsetX,G.offsetY)}Y&&(e=Sf.toScreenPosition(w,Y),_.x=e.x,_.y=e.y),l._edgeHostGuideInfo={corners:Sf.getTargetCornersOnScreen(w,H),attach:b?b.index:-1,host:H};var i;return G.percent!==d?i="percent: "+G.percent.toFixed(2):G.index!==d?i="index: "+G.index:(i=""+G.x.toFixed(2)+", "+G.y.toFixed(2),(G.offsetX||G.offsetY)&&(i+=" offset: "+G.offsetX.toFixed(2)+", "+G.offsetY.toFixed(2))),{host:H,anchor:G,tipText:i}}},Br.prototype._guidingToEdit=function($,g){var Y,n,s=this;if(Y=s.screenInfo.curve){n=Y._curves;var P,M,d,r,S,j,i,L,E=1/0,V=1/0,J=[];for(s.editing&&"realPoint"===s.editing.type&&(L=s.editing.point),S=0,j=2*n.length;j>S;S++)i=n[Math.floor(S/2)][S%2?"_p4":"_p1"],J.indexOf(i)>=0||(J.push(i),L&&L===i||(d=i.x-$.x,r=i.y-$.y,Math.abs(d)<Math.abs(E)?(E=d,P=[i]):d===E&&P.push(i),Math.abs(r)<Math.abs(V)?(V=r,M=[i]):r===V&&M.push(i)));var k=s._interactor.getStyle("smartGuideThreshold");if((Math.abs(E)>k||"y"===g)&&(P=null),(Math.abs(V)>k||"x"===g)&&(M=null),P||M){var b=!1,B={};if(P&&(b=!0,B.xList=P,B.x=E),M&&(b=!0,B.yList=M,B.y=V),b)return B}}},Br.prototype._46O=function(I){var y=this;y.editing&&(y.editing=null,y._interactor.fi({kind:"endEditPoint",event:I})),y._guideInfo=null,y._edgeHostGuideInfo=null,y._pan&&(y._pan=null,y._interactor.fi({kind:"endPan",event:I})),y._multiSelect&&(y._handleMultiSelect(y._multiSelect),y._multiSelect=null),y.tipInfo=null,y.edgeEditResult=null},Br.prototype._handleMultiSelect=function(B){if(B.startPoint&&B.endPoint){var H,s,A,c,V,m=this,j=m._interactor,r=j.gv,N=Sf.toScreenPosition(r,B.startPoint),n=Sf.toScreenPosition(r,B.endPoint),z=W.Default.unionPoint(N,n),L=m.screenInfo.curve._curves,X=[],b=function(P){P.x>=z.x&&P.y>=z.y&&P.x<=z.x+z.width&&P.y<=z.y+z.height&&X.indexOf(P)<0&&X.push(P)};for(H=0,s=L.length;s>H;H++)V=L[H],b(V._p1),b(V._p4);if(X.length){var Y=m.activing||{},S=Y.selections||[];for(Y.point&&S.push(Y.point),H=0,s=S.length;s>H;H++)A=S[H],c=X.indexOf(A),c>=0?X[c]=d:X.push(A);var M=X;for(X=[],H=0,s=M.length;s>H;H++)M[H]&&X.push(M[H]);s=X.length,0===s?m.activing=null:1===s?m.activing={point:X[0]}:(A=X[s-1],m.activing={point:A,selections:X.splice(0,s-1)}),j.redraw()}}},Br.prototype._canDeletePoint=function(Z,M){var o=this.target;if(!(o instanceof W.Edge))return!0;var K=Z._curves[0],U=Z._curves[Z._curves.length-1];return K._p1===M||U._p4===M?!1:!0},Br.prototype.handleDelete=function(){var z=this;if(z.activing&&z.screenInfo){var D=W.Default.isShiftDown(),v=z.screenInfo.curve;z._canDeletePoint(v,z.activing.point)&&v.deleteRealPoint(z.activing.point,D),z.activing.selections&&z.activing.selections.forEach(function(X){z._canDeletePoint(v,X)&&v.deleteRealPoint(X,D)}),z.activing=null,delete z.editing,delete z.tipInfo,delete z.edgeEditResult,delete z._pan,delete z._multiSelect,z._writeToHt(),z._interactor.fp("deleteShapePoint",!1,!0)}},Br.prototype.handleDoubleClick=function(U){var M=this,B=M._interactor._getLogicalPoint(U);if(M.screenInfo&&M._checkEditRealPoint(B)){var i=M.getCurrentSelectintStatus(),v=Sf.Curve.PointType;return i=i===v.Mirrored?v.Straight:v.Mirrored,M._setCurrentSelectionStatus(i),M._interactor._42(),!0}},Br.prototype._drawHighlight=function(c){var h=this,v=h.highlight;if(v){var t=v.bezier,S=h._interactor;t&&Sf.Icons.DrawIcon(S,c,Sf.Icons.ShapeHighlightCurve,[t._p1.x,t._p1.y,t._p2.x,t._p2.y,t._p3.x,t._p3.y,t._p4.x,t._p4.y]);var z=v.point;z&&"insertKnot"===v.type&&Sf.Icons.DrawIcon(S,c,Sf.Icons.ShapeHighlighPoint,z)}},Br.prototype._drawGuide=function(q){var J=this,o=J._guideInfo;if(o){var C,w,s,p,u=o.v;for(C=0;2>C;C++)if(p=0===C?o.xList:o.yList)for(w=0,s=p.length;s>w;w++)Sf.Icons.DrawIcon(J._interactor,q,Sf.Icons.ShapeGuideLine,[u.x,u.y,p[w].x,p[w].y])}},Br.prototype._drawCurrentPoint=function(H){var f=this;if(f.activing){var r=f.activing,G=f.getCurrentSelectintStatus(),c=f._interactor;if(G!==Sf.Curve.PointType.Straight){var A=r.pairs;r.hlpair,r.hltype;var i=r.selections,h=r.editingCtrl;if(A&&!i){var o,g,l;for(g=0,l=A.length;l>g;g++)o=A[g],h&&g===h.pairId&&o[h.type]?Sf.Icons.DrawIcon(c,H,Sf.Icons.ShapeActivingCtrl,{point:o.point,c1:o.c1,c2:o.c2,hl:h.type}):Sf.Icons.DrawIcon(c,H,Sf.Icons.ShapeActivingCtrl,o)}}Sf.Icons.DrawIcon(c,H,Sf.Icons.ShapeHighlighRealPoint,f.activing.point),i&&i.forEach(function(f){Sf.Icons.DrawIcon(c,H,Sf.Icons.ShapeHighlighRealPoint,f)})}},Br.prototype.clear=function(){var x=this;x.editing=null,x._guideInfo=null,x.activing=null,x.highlight=null},Br.prototype._42=function(t){var n=this;n.info={},n.editing||(n.screenInfo=null);var Z=n._interactor;if(!Z.editDetail)return n.clear(),void 0;var T=Z.gv;if(!n.target||!T.isSelected(n.target)||!T.isVisible(n.target))return Z.editDetail=!1,n.clear(),void 0;if(n.gatherSingleTarget(T,n.target),Sf.Icons.DrawIcon(Z,t,Sf.Icons.ShapeBgCurve,n.screenInfo),n._drawHighlight(t),n._drawCurrentPoint(t),n._getRealPoint().forEach(function(I){Sf.Icons.DrawIcon(Z,t,Sf.Icons.ShapePoint,I)}),n._drawGuide(t),n.tipInfo&&Sf.Icons.DrawIcon(Z,t,Sf.Icons.TipHelper,n.tipInfo),n._edgeHostGuideInfo){Sf.Icons.DrawIcon(Z,t,Sf.Icons.NodeHoverGuide,n._edgeHostGuideInfo.corners);var h=n._edgeHostGuideInfo.host;if(h){var $=T.getAttachPoints(h);if($&&$.length)for(var m=0,F=$.length;F>m;m++){var M=$[m],j=h.getAttachPosition(M.x,M.y,M.offsetX,M.offsetY);j=Sf.toScreenPosition(T,j),j.isAttach=n._edgeHostGuideInfo.attach===m,Sf.Icons.DrawIcon(Z,t,Sf.Icons.AttachPoint,j)}}}if(n._interactor.getStyle("curveElevationVisible")&&n.target instanceof W.Polyline&&n.activing){var J=n.activing.getCurrentEditingPoint();J&&Sf.Icons.DrawIcon(Z,t,Sf.Icons.EdgeElevationGuide,J)}if(n.edgeEditResult&&n._drawEdgeHostHighlight(t,n.edgeEditResult.host,n.edgeEditResult.anchor),n._multiSelect&&n._multiSelect.endPoint){var Y=W.Default.unionPoint(Sf.toScreenPosition(T,n._multiSelect.startPoint),Sf.toScreenPosition(T,n._multiSelect.endPoint));Y.color=T.getRectSelectBorderColor(),t.save(),t.setTransform(1,0,0,1,0,0);var K=E.devicePixelRatio,X=Y.borderWidth=Math.round(K);X/=2,Y.x=Math.round(Y.x*K)+X,Y.y=Math.round(Y.y*K)+X,Y.width=Math.round(Y.width*K),Y.height=Math.round(Y.height*K),Sf.Icons.DrawIcon(Z,t,Sf.Icons.SimpleRect,Y),t.restore()}},Br.prototype._drawEdgeHostHighlight=function(a,f,y){this.drawEdgeHostHighlight(a,f,y),this._interactor.redraw()},Br.prototype.drawEdgeHostHighlight=function(t,p,W){if(Pe(p)){var S,$,R,H,x=this,F=x._interactor,z=F.gv,v=z.getDataUI(p),V=Hn(v),u=[];for(R=0,H=V.points.length;H>R;R++)$=Sf.toScreenPosition(z,V.points.get(R)),u.push($.x,$.y);V.segments&&(S=V.segments.toArray());var K=F.getStyle("edgeHostHighlighPeriod"),h=F.getStyle("edgeHostEdgeHighlighColor");Sf.Icons.DrawIcon(F,t,Sf.Icons.ShapeBgCurve,{P:u,S:S,color:h,dynamicVisible:W.index===d,dynamicPeriod:K}),h=F.getStyle("edgeHostPointHighlighColor");var y=Ej(v);for(R=0,H=y.length;H>R;R++){var L=y[R],c=Sf.toScreenPosition(z,L);Sf.Icons.DrawIcon(F,t,Sf.Icons.ShapePoint,{point:{x:c.x,y:c.y},color:h,size:12,dynamicVisible:R===W.index,dynamicPeriod:K})}}},Br.prototype._getRealPoint=function(){var S,l=this.screenInfo,G=l.P,U=l.S,Q=-1,d=[],N=-1,u=U.length;return U.each(function(M){N++;var g=1;if(3===M)g=2;else if(4===M)g=3;else if(5===M)return;Q+=g,S=N+1>=u?!0:1===U.get(N+1)?!0:!1,d.push({point:{x:G[2*Q],y:G[2*Q+1]},segmentIndex:N,pointIndex:Q,isEnd:S})}),d},Br.prototype.getEditingPointsInfo=function(d){var Z=this,i=Z.activing;if(!i)return!1;var f=i.point;if(!f)return!1;var Y=this._getRealPoint(),F=[{screen:f}];i.selections&&i.selections.forEach(function(E){F.push({screen:E})});var D,w,p=Y.length;return F.forEach(function(k){for(D=0;p>D;D++)if(w=Y[D],k.screen.isNearEnough(w.point)){k.segmentIndex=w.segmentIndex,k.pointIndex=w.pointIndex,k.point=Z.target.getPoints().get(w.pointIndex);break}}),d&&F.sort(function(G,X){return G.segmentIndex-X.segmentIndex}),F};var Ho=Sf.MoveHelper=function(H){var I=this;I.catalog="Move",I._interactor=H};Ho.prototype={},Ho.prototype.constructor=Ho,Ho.prototype.calcShift=function(P,z,M){var O,e,c=this,I=c._interactor.gv,v=I.lp(z);if("beginMove"===P&&c._gatherGridInfo(M._lastLogicalPoint||v),O=c._target){var j=O.downPosition;if(j){var $=c._interactor.getStyle("moveSensitivity")/I._zoom;if(j.distanceTo(v)<$)return{x:0,y:0};delete O.downPosition}var l;e=W.Default.isShiftDown(z),e&&(v=c._dealShiftDown(v),l=O.shiftGuide.dir);var A,J=O.rawPos={x:O.pos.x+v.x-O.lp.x,y:O.pos.y+v.y-O.lp.y};if(W.Default.isCtrlDown(z)){if(A=c._calcShiftByAddon(),c._target.node instanceof Sf.Group){var d=c._target.node;d._position.x+=A.x,d._position.y+=A.y}return A}for(var g,C=O.x+J.x,q=O.y+J.y,V={x:C,y:q},U={x:C+O.w/2,y:q+O.h/2},b={x:C+O.w,y:q+O.h},x=c._interactor.rectGuide,R=c._interactor.gridGuide,k=[x.findClosest(V,l),x.findClosest(U,l),x.findClosest(b,l),R.findClosest(V,l),R.findClosest(U,l),R.findClosest(b,l)],X=1/0,S=1/0,w=0,_=k.length;_>w;w++)g=k[w],g&&(C=g.x,q=g.y,isFinite(C)&&Math.abs(C)<Math.abs(X)&&(X=C),isFinite(q)&&Math.abs(q)<Math.abs(S)&&(S=q));
if(isFinite(X)||(X=0),isFinite(S)||(S=0),A=c._calcShiftByAddon(X,S),c._target.node instanceof Sf.Group){var d=c._target.node;d._position.x+=A.x,d._position.y+=A.y}var a=O.node;if(!gq(a,I)){var B=J.x+X,m=J.y+S;c._interactor.rectGuide.gatherLines({node:a,x:O.x+B,y:O.y+m,w:O.w,h:O.h},l)}return A}},Ho.prototype._calcShiftByAddon=function(m,g){var M=this._target,Y=M.rawPos,s=M.node.getPosition();return m=m||0,g=g||0,{x:Y.x-s.x+m,y:Y.y-s.y+g}},Ho.prototype._dealShiftDown=function(Y){var $=this,a=$._target.shiftGuide,W=$._target.lp,R=Math.abs(Y.x-W.x),v=Math.abs(Y.y-W.y);R>v&&R>a.limit&&"y"===a.dir&&(a.dir="x"),v>R&&v>a.limit&&"x"===a.dir&&(a.dir="y");var o=a.dir;return"x"===o?(Y.y=W.y,a.limit=Math.max(a.limit,R)):"y"===o&&(Y.x=W.x,a.limit=Math.max(a.limit,v)),Y},Ho.prototype._gatherGridInfo=function(_){var j,L=this,E=L._interactor,U=E._getValidSelection();if(U.length){if(1===U.length){if(j=U[0],!j.getRect)return L._target=null,void 0}else if(j=Sf.Group.findOrCreateGroup(U),!j)return L._target=null,void 0}else{var U=E.gv.sm().getSelection();if(U.length&&(j=U.get(0),!j.getRect))return L._target=null,void 0}var n=j.getPosition(),B=j.getRect();L._target={node:j,x:B.x-n.x,y:B.y-n.y,w:B.width,h:B.height,lp:{x:_.x,y:_.y},pos:{x:n.x,y:n.y},shiftGuide:{dir:"x",limit:0},downPosition:new Sf.Math.Vector2(_)},E.rectGuide.gatherRects()},Ho.prototype.clear=function(){var y=this;y._interactor.rectGuide.clear(),y._interactor._42()};var df="directional",kn="point",zl="spot",bo="light.color",fl={},wc=function(h,n){Gk(n)&&wh.test(n)?yi(h,n):zn(n)&&n.modelType?Tk(h,n):xk[h]=n},Hi=function(Z){if(zn(Z))return Z.modelType?Z.uuid?xk[Z.uuid]:(Z.uuid=W.Math.generateUUID(),Tk(Z.uuid,Z),d):Z;var K=xk[Z];return Z&&K===d&&wh.test(Z)&&(qc&&qc[Z]||yi(Z,Z)),K},Jk=function(D,y){D.frameStack?D.frameStack.push(y):D.frameStack=[y],D.bindFramebuffer(D.FRAMEBUFFER,y)},Nk=function(J){var u=J.frameStack;if(u){if(u.pop(),u.length)return J.bindFramebuffer(J.FRAMEBUFFER,u[u.length-1]),void 0;J.frameStack=null}J.bindFramebuffer(J.FRAMEBUFFER,null)};uj(X,{graph3dViewAttributes:S,graph3dViewFirstPersonMode:!1,graph3dViewMouseRoamable:!0,graph3dViewMoveStep:15,graph3dViewRotateStep:u/60,graph3dViewEditHelperDisabled:!1,graph3dViewPannable:!0,graph3dViewRotatable:!0,graph3dViewWalkable:!0,graph3dViewResettable:!0,graph3dViewZoomable:!0,graph3dViewRectSelectable:!0,graph3dViewRectSelectBackground:ef,graph3dViewGridVisible:!1,graph3dViewGridSize:50,graph3dViewGridGap:50,graph3dViewGridColor:[.4,.75,.85,1],graph3dViewOriginAxisVisible:!1,graph3dViewCenterAxisVisible:!1,graph3dViewAxisXColor:[1,0,0,1],graph3dViewAxisYColor:[0,1,0,1],graph3dViewAxisZColor:[0,0,1,1],graph3dViewEditSizeColor:[1,1,0,1],graph3dViewOrtho:!1,graph3dViewOrthoWidth:2e3,graph3dViewFovy:u/4,graph3dViewNear:10,graph3dViewFar:1e4,graph3dViewEye:[0,300,1e3],graph3dViewCenter:[0,0,0],graph3dViewUp:[0,1,-1e-7],graph3dViewHeadlightRange:0,graph3dViewHeadlightColor:[1,1,1,1],graph3dViewHeadlightIntensity:1,graph3dViewHeadlightDisabled:!1,graph3dViewFogDisabled:!0,graph3dViewFogColor:"white",graph3dViewFogNear:1,graph3dViewFogFar:2e3,graph3dViewDashDisabled:!0,graph3dViewBatchBlendDisabled:!0,graph3dViewBatchBrightnessDisabled:!0,graph3dViewBatchColorDisabled:!1,graph3dMaxVectorCacheTime:50,setShape3dModel:wc,getShape3dModel:Hi,createMatrix:function($,N){En($)||($=[$]);for(var H=$.length-1;H>=0;H--){var r=$[H];N=Hd(r.mat,r.s3,r.r3,r.rotationMode,r.t3,N)}return N},transformVec:function(w,z){return Yp(w,z)},glBindFrame:Jk,glUnbindFrame:Nk,createBoxModel:function(){return{vs:us,ns:wq,uv:Jl,is:Ii}},createRoundRectModel:function(E,e){return Dr.roundRect(E,e)},createStarModel:function(h,K){return Dr.star(h,K)},createRectModel:function(u,w){return Dr.rect(u,w)},createTriangleModel:function(K,W){return Dr.triangle(K,W)},createRightTriangleModel:function(n,O){return Dr.rightTriangle(n,O)},createParallelogramModel:function(q,w){return Dr.parallelogram(q,w)},createTrapezoidModel:function(C,G){return Dr.trapezoid(C,G)},createSmoothSphereModel:function(B,p,c,N,L,M,I){return Bm(new Mf(B,p,c,N,L,M,I))},createSphereModel:function(O,i,P,x,g,z){return O?Tc(O,i,P,x,g,z):X.createSmoothSphereModel()},createSmoothConeModel:function(N,M,l,K,U){return Hb(N,M,l,K,U)},createConeModel:function(N,L,y,O,s,r){return N?mj(N,L,y,O,s,r):Hb(r)},createSmoothCylinderModel:function(n,v,o,H,q,t,J,N){return Bm(new ve(n,v,o,H,q,t,J,N))},createCylinderModel:function(n,c,m,L,b,j,I){return n?cj(n,c,m,L,b,j,I):ej(j,I)},createSmoothTorusModel:function(j,y,E,T,R,r){return Bm(new ki(j,y,E,T,R,r))},createTorusModel:function(w,H,R,g,S,J,O){return w?Aj(w,H,R,g,S,J,O):Of(J,O)},createExtrusionModel:function(m,g,C,G,q,X,W,p){return ti(m,g,C,G,q,X,W,p)},createSmoothRingModel:function(p,U,x,G,T,I){for(var K=[],O=0;O<p.length-1;O+=2)K.push({x:p[O],y:p[O+1]});for(p=ge(K,U,x)[0],K=[],O=0;O<p.length;O++){var H=p[O];K.push(new Ij(H.x,0,H.y))}return Bm(new dr(K,I,G,T))},createTextGeometry:function(Q,S){return Bm(new yd(Q,S))},loadFontFace:function(G,K){X.xhrLoad(G,function(E){if(!E)return K();var U;try{U=JSON.parse(E)}catch(B){U=JSON.parse(E.substring(65,E.length-2))}gk.loadFace(U),K&&K(U.familyName.toLowerCase())},K?null:{sync:!0})},createRingModel:function(v,c,E,V,l,q,B,o,t,O){for(var z=[],b=0;b<v.length-1;b+=2)z.push({x:v[b],y:v[b+1]});q=q||X.shapeSide,B=B||0,o=o||q;var w,N,y,J,I,M,i,G,u,p,b,e,x,F,Q,R,s,g,Y=[],Z=[],$=t?[]:S,P=t?[]:S,A=O?[]:S,f=O?[]:S,W=V?[]:S,d=V?[]:S,h=l?[]:S,H=l?[]:S,v=ge(z,c,E),K=qs(v),D=0,j=2*Math.PI/q;return v.forEach(function(T){if(y=T.length,y>1){if(J=T[0],V)for(M=J.x,G=J.y,b=B;o>b;b++)e=b+1,x=b*j,F=e*j,Q=k(x),R=L(x),s=k(F),g=L(F),W.push(Q*M,G,-R*M,s*M,G,-g*M,0,G,0),d.push(.5-.5*Q,.5-.5*R,.5-.5*s,.5-.5*g,.5,.5);for(p=0;y>p;p++){for(I=T[p],M=J.x,i=I.x,G=J.y,u=I.y,w=D/K,D+=zq(J,I),N=D/K,b=B;o>b;b++)e=b+1,x=b*j,F=e*j,Q=k(x),R=L(x),s=k(F),g=L(F),Y.push(Q*i,u,-R*i,s*i,u,-g*i,Q*M,G,-R*M,s*i,u,-g*i,s*M,G,-g*M,Q*M,G,-R*M),Z.push(b/q,N,e/q,N,b/q,w,e/q,N,e/q,w,b/q,w),t&&b===B&&($.push(0,G,0,0,u,0,Q*i,u,-R*i,Q*i,u,-R*i,Q*M,G,-R*M,0,G,0),P.push(0,.5-G,0,.5-u,2*i,.5-u,2*i,.5-u,2*M,.5-G,0,.5-G)),O&&e===o&&(A.push(0,G,0,s*i,u,-g*i,0,u,0,s*i,u,-g*i,0,G,0,s*M,G,-g*M),f.push(1,.5-G,1-2*i,.5-u,1,.5-u,1-2*i,.5-u,1,.5-G,1-2*M,.5-G));J=I}if(l)for(M=J.x,G=J.y,b=B;o>b;b++)e=b+1,x=b*j,F=e*j,Q=k(x),R=L(x),s=k(F),g=L(F),h.push(s*M,G,-g*M,Q*M,G,-R*M,0,G,0),H.push(.5-.5*s,.5+.5*g,.5-.5*Q,.5+.5*R,.5,.5)}}),{vs:Y,uv:Z,bottom_vs:h,bottom_uv:H,top_vs:W,top_uv:d,from_vs:$,from_uv:P,to_vs:A,to_uv:f}}},!0),uj(n,{"3d.move.mode":d,"3d.selectable":!0,"3d.visible":!0,"3d.movable":!0,"3d.editable":!0,"shape.border.gradient.color":d,"edge.gradient.color":d,"edge.source.t3":d,"edge.target.t3":d,"light.type":kn,"light.center":[0,0,0],"light.color":[1,1,1,1],"light.disabled":!1,"light.angle":u/4,"light.range":0,"light.exponent":1,"light.intensity":1,"wf.visible":!1,"wf.width":1,"wf.color":Ul,"wf.short":!1,"wf.mat":d,"wf.geometry":!1,"wf.loadQuadWireframe":!1,"wf.combineTriangle":!0,batch:d,"transparent.mask":!1,brightness:d,"select.brightness":.7,"repeat.uv.length":d,alphaTest:.4,renderTextureSamples:4,"highlight.visible":!0,"highlight.width":.8,"highlight.color":"rgba(190, 210, 250, 1)","color.empty":[0,0,0,0],"shape3d.vector.dynamic.maxsize":2048,"label.face":Cn,"label.t3":d,"label.r3":d,"label.texture.scale":2,"label.rotationMode":Pq,"label.light":!1,"label.blend":d,"label.reverse.flip":!1,"label.reverse.color":hb,"label.reverse.cull":!1,"label.transparent":!1,"label.autorotate":!1,"label2.face":Cn,"label2.t3":d,"label2.r3":d,"label2.texture.scale":2,"label2.rotationMode":Pq,"label2.light":!1,"label2.blend":d,"label2.reverse.flip":!1,"label2.reverse.color":hb,"label2.reverse.cull":!1,"label2.transparent":!1,"label2.autorotate":!1,"note.face":Cn,"note.t3":d,"note.r3":d,"note.texture.scale":2,"note.rotationMode":Pq,"note.light":!1,"note.blend":d,"note.reverse.flip":!1,"note.reverse.color":hb,"note.reverse.cull":!1,"note.transparent":!1,"note.autorotate":!1,"note2.face":Cn,"note2.t3":d,"note2.r3":d,"note2.texture.scale":2,"note2.rotationMode":Pq,"note2.light":!1,"note2.blend":d,"note2.reverse.flip":!1,"note2.reverse.color":hb,"note2.reverse.cull":!1,"note2.transparent":!1,"note2.autorotate":!1,shape3d:d,"shape3d.color":Ch,"shape3d.top.color":d,"shape3d.bottom.color":d,"shape3d.from.color":d,"shape3d.to.color":d,"shape3d.image":d,"shape3d.top.image":d,"shape3d.bottom.image":d,"shape3d.from.image":d,"shape3d.to.image":d,"shape3d.light":!0,"shape3d.side":0,"shape3d.side.from":d,"shape3d.side.to":d,"shape3d.visible":!0,"shape3d.from.visible":!0,"shape3d.to.visible":!0,"shape3d.top.visible":!0,"shape3d.bottom.visible":!0,"shape3d.torus.radius":.17,"shape3d.resolution":0,"shape3d.blend":d,"shape3d.opacity":d,"shape3d.reverse.flip":!1,"shape3d.reverse.color":hb,"shape3d.reverse.cull":!1,"shape3d.transparent":!1,"shape3d.uv.offset":d,"shape3d.uv.scale":d,"shape3d.top.uv.offset":d,"shape3d.top.uv.scale":d,"shape3d.bottom.uv.offset":d,"shape3d.bottom.uv.scale":d,"shape3d.from.uv.offset":d,"shape3d.from.uv.scale":d,"shape3d.to.uv.offset":d,"shape3d.to.uv.scale":d,"shape3d.top.cap":d,"shape3d.bottom.cap":d,"shape3d.start.angle":0,"shape3d.sweep.angle":m,"shape3d.point.epsilon":1e-6,"shape3d.discard.selectable":!0,"shape3d.top.discard.selectable":!0,"shape3d.bottom.discard.selectable":!0,"shape3d.from.discard.selectable":!0,"shape3d.to.discard.selectable":!0,"shape3d.scaleable":!0,"shape3d.autorotate":!1,"shape3d.fixSizeOnScreen":d,"shape3d.image.cache":!1,"shape3d.alwaysOnTop":!1,"all.light":!0,"all.visible":!0,"all.color":Ch,"all.image":d,"all.blend":d,"all.opacity":d,"all.reverse.flip":!1,"all.reverse.color":hb,"all.reverse.cull":!1,"all.transparent":!1,"all.uv":d,"all.uv.offset":d,"all.uv.scale":d,"all.discard.selectable":!0,mat:d,"left.mat":d,"right.mat":d,"top.mat":d,"bottom.mat":d,"front.mat":d,"back.mat":d},!0);var io,_q=!1,cr=[0,0,0,0],gh={left:[1/255,0,0,1],right:[2/255,0,0,1],top:[3/255,0,0,1],bottom:[4/255,0,0,1],front:[5/255,0,0,1],back:[6/255,0,0,1],m:{1:zc,2:br,3:Dc,4:fd,5:Cn,6:cp}},Ji=function(I,e,D,O){if(e.getFaceVisible(I,D)){Vl(e,Gn(I,e.getFaceMat(I,D)||e.getMat(I)));var A=e._26I;e.getFaceReverseCull(I,D)?A.enable(A.CULL_FACE):A.disable(A.CULL_FACE),Wj(A,e._prg.uFixPickReverseColor,gh[D]),qo(A),Mo(A,O,6),ul(A),vc(e)}},Hf=function(e){return e instanceof fc},wj=function(t){return[t.x,t.e||0,t.y]},Qe=function(_,W,H){for(var W=jb(W),F=W[0],b=W[1],B=W[2];H--;)_.push(F,b,B)},Yn=function(Q,Y,l){for(var Y=jb(Y),u=Y[0],E=Y[1],w=Y[2],X=Y[3];l--;)Q.push(u,E,w,X)},oh=function(R,A,H){if(A)for(var p,z,e,f=A[0],U=A[1],d=A[2],_=A[4],l=A[5],m=A[6],L=A[8],X=A[9],V=A[10],h=A[12],S=A[13],N=A[14],g=H.length,s=0,s=0;g>s;s+=3)p=H[s],z=H[s+1],e=H[s+2],R.push(f*p+_*z+L*e+h,U*p+l*z+X*e+S,d*p+m*z+V*e+N);else qh(R,H)},Xh=function(D,z){var m=z.s("light.intensity"),s=jb(z.s(bo)),t=s[0],f=s[1],l=s[2];1!==m&&(t*=m,f*=m,l*=m),D.push(t,f,l,z.s("light.disabled")?1:0)},_b=function(K,f,i){Wj(f,i.uHeadlightRange,K._headlightRange);var O=K._headlightIntensity,Y=jb(K._headlightColor);1!==O&&(Y=[Y[0]*O,Y[1]*O,Y[2]*O]),Wj(f,i.uHeadlightColor,[Y[0],Y[1],Y[2],K._headlightDisabled?1:0]);var v=K._59O,Z=K._spots,m=K._dirs;if(v.length){var t=[],q=[],F=[];v.forEach(function(k){Xh(t,k),qh(q,K._transformPointToViewSpace(k.p3())),F.push(k.s("light.range"))}),f.uniform4fv(i.uPointColor,t),f.uniform1fv(i.uPointRange,F),f.uniform3fv(i.uPointPosition,q)}if(Z.length){var l=[],e=[],M=[],b=[],A=[],s=[];Z.forEach(function(T){Xh(l,T),qh(e,K._transformPointToViewSpace(T.p3())),qh(A,K._transformDirectionToViewSpace(T.p3(),T.s("light.center"))),M.push(T.s("light.range")),b.push(k(T.s("light.angle")/2)),s.push(T.s("light.exponent"))}),f.uniform4fv(i.uSpotColor,l),f.uniform1fv(i.uSpotRange,M),f.uniform1fv(i.uSpotAngle,b),f.uniform1fv(i.uSpotExponent,s),f.uniform3fv(i.uSpotPosition,e),f.uniform3fv(i.uSpotDirection,A)}if(m.length){var E=[],G=[];m.forEach(function(j){Xh(E,j),qh(G,K._transformDirectionToViewSpace(j.p3()))}),f.uniform4fv(i.uDirColor,E),f.uniform3fv(i.uDirDirection,G)}},Lm=function(X){return X>0&&0===(X-1&X)},Wd=function(H){return H=V(0,o(u,H)),H=V(Do,o(u-Do,H))},tb=function(){return.05+A()/2},zs=function(t,i,Y,P){var y,V=t.getEye();return t.isOrtho()?(y=$b(t.getCenter(),V),y[0]+=P[0],y[1]+=P[1],y[2]+=P[2]):y=V,Pk(i,Y,P,y)},Pk=function(x,D,J,m){var d=Od(x,D),f=$b(m,J,!0),O=Od(f,D);if(M(O)<Do)return S;var c=(d-Od(J,D))/O;return[J[0]+f[0]*c,J[1]+f[1]*c,J[2]+f[2]*c]},Xe=function(b,q){return{x:2*b.x-q.x,y:2*b.y-q.y}},no=function(b,$,E,Q){var l,g;if(!b)return l=N($.y-E.y,E.x-$.x),{x:$.x+Q*L(l),y:$.y+Q*k(l)};if(!E)return l=N(b.y-$.y,$.x-b.x),{x:$.x+Q*L(l),y:$.y+Q*k(l)};var n=$b([b.x,b.y,0],[$.x,$.y,0],!0),a=$b([E.x,E.y,0],[$.x,$.y,0],!0),C=-(n[0]+a[0])/2,J=-(n[1]+a[1])/2,j=_(C*C+J*J);if(Do>j)return l=N(b.y-$.y,$.x-b.x),{x:$.x+Q*L(l),y:$.y+Q*k(l)};var h=b.x-$.x,G=b.y-$.y,u=E.x-$.x,I=E.y-$.y,y=_(h*h+G*G),e=_(u*u+I*I);l=Z(Od(n,a))/2,g=n[1]*a[0]-n[0]*a[1]>0?-1:1,C/=j,J/=j;var S=Q/L(l),z=V(y,e)/k(l);j=Math.min(S,z);var D={x:$.x+g*j*C,y:$.y+g*j*J};return E.b&&S>e/k(l)&&(D.adjust=!0),D},Zn=function(m){var h=m[1],q=m[2],H=m[3],A=m[6],s=m[7],b=m[11];m[1]=m[4],m[2]=m[8],m[3]=m[12],m[4]=h,m[6]=m[9],m[7]=m[13],m[8]=q,m[9]=A,m[11]=m[14],m[12]=H,m[13]=s,m[14]=b},Rg=function(W){var J=W[0],C=W[1],A=W[2],B=W[3],G=W[4],r=W[5],n=W[6],l=W[7],t=W[8],L=W[9],d=W[10],b=W[11],v=W[12],D=W[13],c=W[14],j=W[15],m=J*r-C*G,K=J*n-A*G,T=J*l-B*G,U=C*n-A*r,s=C*l-B*r,u=A*l-B*n,p=t*D-L*v,y=t*c-d*v,$=t*j-b*v,M=L*c-d*D,q=L*j-b*D,N=d*j-b*c,P=m*N-K*q+T*M+U*$-s*y+u*p;return P?(P=1/P,W[0]=(r*N-n*q+l*M)*P,W[1]=(A*q-C*N-B*M)*P,W[2]=(D*u-c*s+j*U)*P,W[3]=(d*s-L*u-b*U)*P,W[4]=(n*$-G*N-l*y)*P,W[5]=(J*N-A*$+B*y)*P,W[6]=(c*T-v*u-j*K)*P,W[7]=(t*u-d*T+b*K)*P,W[8]=(G*q-r*$+l*p)*P,W[9]=(C*$-J*q-B*p)*P,W[10]=(v*s-D*T+j*m)*P,W[11]=(L*T-t*s-b*m)*P,W[12]=(r*y-G*M-n*p)*P,W[13]=(J*M-C*y+A*p)*P,W[14]=(D*K-v*U-c*m)*P,W[15]=(t*U-L*K+d*m)*P,void 0):S},qj=function(y,D){if(D){var E=D[0],Q=D[1],e=D[2];y[12]=y[0]*E+y[4]*Q+y[8]*e+y[12],y[13]=y[1]*E+y[5]*Q+y[9]*e+y[13],y[14]=y[2]*E+y[6]*Q+y[10]*e+y[14],y[15]=y[3]*E+y[7]*Q+y[11]*e+y[15]}},Bi=function(d,B){if(B){var P=B[0],Q=B[1],I=B[2];d[0]=d[0]*P,d[1]=d[1]*P,d[2]=d[2]*P,d[3]=d[3]*P,d[4]=d[4]*Q,d[5]=d[5]*Q,d[6]=d[6]*Q,d[7]=d[7]*Q,d[8]=d[8]*I,d[9]=d[9]*I,d[10]=d[10]*I,d[11]=d[11]*I}},Ke=function(N,y,m){var o=y[0],H=y[1],k=y[2],q=y[3],w=y[4],K=y[5],Y=y[6],f=y[7],O=y[8],j=y[9],S=y[10],M=y[11],G=y[12],C=y[13],z=y[14],Q=y[15],t=m[0],U=m[1],v=m[2],B=m[3];return N[0]=t*o+U*w+v*O+B*G,N[1]=t*H+U*K+v*j+B*C,N[2]=t*k+U*Y+v*S+B*z,N[3]=t*q+U*f+v*M+B*Q,t=m[4],U=m[5],v=m[6],B=m[7],N[4]=t*o+U*w+v*O+B*G,N[5]=t*H+U*K+v*j+B*C,N[6]=t*k+U*Y+v*S+B*z,N[7]=t*q+U*f+v*M+B*Q,t=m[8],U=m[9],v=m[10],B=m[11],N[8]=t*o+U*w+v*O+B*G,N[9]=t*H+U*K+v*j+B*C,N[10]=t*k+U*Y+v*S+B*z,N[11]=t*q+U*f+v*M+B*Q,t=m[12],U=m[13],v=m[14],B=m[15],N[12]=t*o+U*w+v*O+B*G,N[13]=t*H+U*K+v*j+B*C,N[14]=t*k+U*Y+v*S+B*z,N[15]=t*q+U*f+v*M+B*Q,N},_n=function(R,d,q,Q){var l,p,n,Y,z,b,U,e,c,x,N=d[0],j=d[1],O=d[2],L=Q[0],I=Q[1],t=Q[2],w=q[0],W=q[1],F=q[2];return M(N-w)<Do&&M(j-W)<Do&&M(O-F)<Do?om(R):(U=N-w,e=j-W,c=O-F,x=1/_(U*U+e*e+c*c),U*=x,e*=x,c*=x,l=I*c-t*e,p=t*U-L*c,n=L*e-I*U,x=_(l*l+p*p+n*n),x?(x=1/x,l*=x,p*=x,n*=x):(l=0,p=0,n=0),Y=e*n-c*p,z=c*l-U*n,b=U*p-e*l,x=_(Y*Y+z*z+b*b),x?(x=1/x,Y*=x,z*=x,b*=x):(Y=0,z=0,b=0),R[0]=l,R[1]=Y,R[2]=U,R[3]=0,R[4]=p,R[5]=z,R[6]=e,R[7]=0,R[8]=n,R[9]=b,R[10]=c,R[11]=0,R[12]=-(l*N+p*j+n*O),R[13]=-(Y*N+z*j+b*O),R[14]=-(U*N+e*j+c*O),R[15]=1,R)},al=function(Z,N,a,g,x){var p=1/O(N/2),G=1/(g-x);return Z[0]=p/a,Z[1]=0,Z[2]=0,Z[3]=0,Z[4]=0,Z[5]=p,Z[6]=0,Z[7]=0,Z[8]=0,Z[9]=0,Z[10]=(x+g)*G,Z[11]=-1,Z[12]=0,Z[13]=0,Z[14]=2*x*g*G,Z[15]=0,Z},bi=function(t,g,A,B,v,Q,T){var d=1/(g-A),D=1/(B-v),z=1/(Q-T);return t[0]=-2*d,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(g+A)*d,t[13]=(v+B)*D,t[14]=(T+Q)*z,t[15]=1,t},Vr=function(u,z){var S=z[0],U=z[1],b=z[2],L=z[3],i=S*S+U*U+b*b+L*L,D=i?1/i:0;return u[0]=-S*D,u[1]=-U*D,u[2]=-b*D,u[3]=L*D,u},_c=function(L,N){var T=N[0]+N[5]+N[10],Y=0;return T>0?(Y=2*Math.sqrt(T+1),L[3]=.25*Y,L[0]=(N[6]-N[9])/Y,L[1]=(N[8]-N[2])/Y,L[2]=(N[1]-N[4])/Y):N[0]>N[5]&N[0]>N[10]?(Y=2*Math.sqrt(1+N[0]-N[5]-N[10]),L[3]=(N[6]-N[9])/Y,L[0]=.25*Y,L[1]=(N[1]+N[4])/Y,L[2]=(N[8]+N[2])/Y):N[5]>N[10]?(Y=2*Math.sqrt(1+N[5]-N[0]-N[10]),L[3]=(N[8]-N[2])/Y,L[0]=(N[1]+N[4])/Y,L[1]=.25*Y,L[2]=(N[6]+N[9])/Y):(Y=2*Math.sqrt(1+N[10]-N[0]-N[5]),L[3]=(N[1]-N[4])/Y,L[0]=(N[8]+N[2])/Y,L[1]=(N[6]+N[9])/Y,L[2]=.25*Y),L},fj=function(c,Z,D){var g=Z[0],n=Z[1],j=Z[2],W=Z[3],s=g+g,A=n+n,H=j+j,u=g*s,X=g*A,z=g*H,G=n*A,Q=n*H,N=j*H,V=W*s,m=W*A,I=W*H;return c[0]=1-(G+N),c[1]=X+I,c[2]=z-m,c[3]=0,c[4]=X-I,c[5]=1-(u+N),c[6]=Q+V,c[7]=0,c[8]=z+m,c[9]=Q-V,c[10]=1-(u+G),c[11]=0,c[12]=D[0],c[13]=D[1],c[14]=D[2],c[15]=1,c},Id=function(n,G){if(n.vr.enable){var R=n.vr.getViewMatrix(G);if(R)return R}return _n(G?G:Xc(),n._eye,n._center,n._up)},Yq=function(l,J){if(l.vr.enable){var g=l.vr.getProjectMatrix();if(g)return g}if(!J&&l._computedProjectMatrix)return Dj(l._computedProjectMatrix);var W=l.getAspect(),m=l._near,G=l._far,C=Xc();if(l._ortho){var o=l._orthoWidth/2,U=o/W;bi(C,-o,o,-U,U,m,G)}else al(C,l._fovy,W,m,G);return C},nn=function(T,Q){if(!T)return S;var K=0,s=1,U=2,Y=[],r=0,b=T.length,d=b/3;if(Q){for(;b>r;r++)Y[r]=0;for(r=0;r<Q.length;r+=3){var x=[],M=[],L=[];x[K]=T[3*Q[r+1]+K]-T[3*Q[r]+K],x[s]=T[3*Q[r+1]+s]-T[3*Q[r]+s],x[U]=T[3*Q[r+1]+U]-T[3*Q[r]+U],M[K]=T[3*Q[r+2]+K]-T[3*Q[r+1]+K],M[s]=T[3*Q[r+2]+s]-T[3*Q[r+1]+s],M[U]=T[3*Q[r+2]+U]-T[3*Q[r+1]+U],L[K]=x[s]*M[U]-x[U]*M[s],L[s]=x[U]*M[K]-x[K]*M[U],L[U]=x[K]*M[s]-x[s]*M[K];for(var I=0;3>I;I++)Y[3*Q[r+I]+K]+=L[K],Y[3*Q[r+I]+s]+=L[s],Y[3*Q[r+I]+U]+=L[U]}}else for(r=0;d>r;r+=3){var x=[],M=[],L=[];x[K]=T[3*(r+1)+K]-T[3*r+K],x[s]=T[3*(r+1)+s]-T[3*r+s],x[U]=T[3*(r+1)+U]-T[3*r+U],M[K]=T[3*(r+2)+K]-T[3*(r+1)+K],M[s]=T[3*(r+2)+s]-T[3*(r+1)+s],M[U]=T[3*(r+2)+U]-T[3*(r+1)+U],L[K]=x[s]*M[U]-x[U]*M[s],L[s]=x[U]*M[K]-x[K]*M[U],L[U]=x[K]*M[s]-x[s]*M[K];for(var I=0;3>I;I++)Y[3*(r+I)+K]=L[K],Y[3*(r+I)+s]=L[s],Y[3*(r+I)+U]=L[U]}for(r=0;b>r;r+=3){var p=[];p[K]=Y[r+K],p[s]=Y[r+s],p[U]=Y[r+U];var H=_(p[K]*p[K]+p[s]*p[s]+p[U]*p[U]);0===H&&(H=Do),p[K]=p[K]/H,p[s]=p[s]/H,p[U]=p[U]/H,Y[r+K]=p[K],Y[r+s]=p[s],Y[r+U]=p[U]}return new am(Y)},xb=function(N,b,T,q){if(T||(T=N.createTexture()),b){var i=N.TEXTURE_2D,m=N.REPEAT,H=N.CLAMP_TO_EDGE,R=N.TEXTURE_MIN_FILTER;q!==N.NEAREST&&(q=N.LINEAR),ms(N,T),N.texImage2D(i,0,N.RGBA,N.RGBA,N.UNSIGNED_BYTE,b),id(N,N.TEXTURE_MAG_FILTER,q);var r=b.naturalWidth||b.width,j=b.naturalHeight||b.height;Lm(r)&&Lm(j)&&!b.clampToEdge?(id(N,N.TEXTURE_WRAP_S,m),id(N,N.TEXTURE_WRAP_T,m),id(N,R,N.LINEAR_MIPMAP_LINEAR),N.generateMipmap(i)):(id(N,N.TEXTURE_WRAP_S,H),id(N,N.TEXTURE_WRAP_T,H),id(N,R,q)),ms(N,S)}return T},Tm=function(k,o){var g=new Uint8Array(4);return o=o||k.createTexture(),ms(k,o),id(k,k.TEXTURE_MIN_FILTER,k.LINEAR),k.texImage2D(k.TEXTURE_2D,0,k.RGBA,1,1,0,k.RGBA,k.UNSIGNED_BYTE,g),o},te=function(K){K._26I&&K._prg&&(K._26I.deleteProgram(K._prg),K._prg=S)},wi=function(X,v,g,b){var C=X.createShader(g);return X.shaderSource(C,b),X.compileShader(C),X.attachShader(v,C),C},ed=function(l){return l.createBuffer()},ms=function(J,x){J.bindTexture(J.TEXTURE_2D,x)},id=function(l,n,t){l.texParameteri(l.TEXTURE_2D,n,t)},xo=function(v,$){v.enable(v.POLYGON_OFFSET_FILL),v.polygonOffset($[0],$[1])},ro=function(_){_.disable(_.POLYGON_OFFSET_FILL)},Sl=function(P,r){if(r){var r=jb(r);P.clearColor(r[0],r[1],r[2],r[3])}},Ei=function(S,s){Wj(S,s.uFix,!0),Kp(S,s.aNormal)},Gb=function(E,z){Wj(E,z.uFix,!1),so(E,z.aNormal)},Yi=function(I,C,b,D,E,Q,t,c){I._picking||(b?(Wj(I,C.uBlend,!0),Wj(I,C.uBlendColor,b)):Wj(I,C.uBlend,!1),Wj(I,C.uLight,D==S?!0:D),Vc(E)&&1!==E&&Wj(I,C.uPartOpacity,E),Wj(I,C.uReverseFlip,Q==S?!1:Q),Wj(I,C.uFixPickReverseColor,t||hb)),c?I.enable(I.CULL_FACE):I.disable(I.CULL_FACE)},uf=function(z,s){z._picking||Wj(z,s.uPartOpacity,1)},qo=function(){var W=[0,0,1,1];return function(j,g,x,u,y,v,K,Q,l){return x?(Wj(j,g.uTexture,!0),Wj(j,g.uDiscardSelectable,Uf(u)?u:!0),so(j,g.aUv),Rl(j,y,v,g.aUv,2),l?(Wj(j,g.uBlendTexture,!0),j.activeTexture(j.TEXTURE1),ms(j,l),j.uniform1i(g.uBlendSampler,1)):(Wj(j,g.uBlendTexture,!1),j.activeTexture(j.TEXTURE1),ms(j,j._emptyBlendTexture)),j.activeTexture(j.TEXTURE0),ms(j,x),j.uniform1i(g.uSampler,0),K?(W[0]=K[0],W[1]=K[1]):(W[0]=0,W[1]=0),Q?(W[2]=Q[0],W[3]=Q[1]):(W[2]=1,W[3]=1),Wj(j,g.uOffsetScale,W),void 0):(j.activeTexture(j.TEXTURE0),ms(j,j._emptyTexture),j.activeTexture(j.TEXTURE1),ms(j,j._emptyBlendTexture),void 0)}}(),ul=function(O,B,C){O.activeTexture(O.TEXTURE0),ms(O,S),O.activeTexture(O.TEXTURE1),ms(O,S),C&&(Kp(O,B.aUv),Wj(O,B.uTexture,!1),Wj(O,B.uBlendTexture,!1))},yc=function(s,g,P,i,O,q){!P||bl||lh||s.lineWidth(P),i&&!s._picking&&Wj(s,g.uFixPickReverseColor,i),O&&Rl(s,O,q,g.aPosition)},nk=function(I,p,E,q){io&&(q=I[io]),I.drawArrays(q==S?I.TRIANGLES:q,p,E);var L=I._renderInfo;L&&(L.calls++,L.vertices+=E,(q==S||q===I.TRIANGLES)&&(L.faces+=E/3),q===I.LINES&&(L.lines+=E/2))},Mo=function(A,w,m,T){io&&(T=A[io]),A.drawElements(T==S?A.TRIANGLES:T,m,A.UNSIGNED_SHORT,w==S?0:2*w);var e=A._renderInfo;e&&(e.calls++,e.vertices+=m,(T==S||T===A.TRIANGLES)&&(e.faces+=m/3),T===A.LINES&&(e.lines+=m/2))},Gd=function(T,y,u,L,P){var Q=T.ARRAY_BUFFER;T.bindBuffer(Q,y),u&&T.bufferData(Q,u,T.STATIC_DRAW),L!=S&&T.vertexAttribPointer(L,P?P:3,T.FLOAT,!1,0,0)},Rl=function(a,q,R,w,Z){return R?(Om(a,a.ARRAY_BUFFER,q,R),w!=S&&a.vertexAttribPointer(w,Z?Z:3,a.FLOAT,!1,0,0),void 0):Gd(a,q,R,w,Z)},Uo=function(e,$,C){var Y=e.ELEMENT_ARRAY_BUFFER;e.bindBuffer(Y,$),C&&e.bufferData(Y,C,e.STATIC_DRAW)},Hm=function(l,J,U){Om(l,l.ELEMENT_ARRAY_BUFFER,J,U)},Om=function(d,e,i,j){var U=j._bufId;U||(U=j._bufId=W.Math.generateIncreasingID());var i,V=d._bufPool;(i=V[U])&&i._buf?d.bindBuffer(e,i._buf):(i=V[U]={_buf:ed(d)},d.bindBuffer(e,i._buf),d.bufferData(e,j,d.STATIC_DRAW)),i._fid=d._renderInfo.frame},Wj=function(V,w,t){if(t!=S&&w!=S){t=jb(t);var N=t.length;3===N?V.uniform3fv(w,t):4===N?V.uniform4fv(w,t):16===N?V.uniformMatrix4fv(w,!1,t):Uf(t)?V.uniform1i(w,t?1:0):2===N?V.uniform2fv(w,t):V.uniform1f(w,t)}},so=function(J,W){W!=S&&W>=0&&J.enableVertexAttribArray(W)},Kp=function(P,H){H!=S&&H>=0&&P.disableVertexAttribArray(H)},vc=function(Z,S){var u=Z.getGL(),c=Z._prg;Z._7O=Z._8O.pop(),S&&(Wj(u,c.uMVMatrix,Z._7O),Z._6O=S,Wj(u,c.uNMatrix,S))},ci=function(N,e){return e||(e=Xc()),ks(e,N),Rg(e),Zn(e),e},Vl=function(e,d){var u=e.getGL(),q=e._prg,z=e._7O;d&&(e._8O.push(Dj(z)),Wj(u,q.uMMatrix,d),Ke(z,z,d),e._7O=z),Wj(u,q.uMVMatrix,z),Wj(u,q.uNMatrix,ci(z,e._6O))},Bs=function(r,x,m,q,Y,D){if(m){if(q){var R=m.value++,s=2147483648|R,G=[(255&s>>16)/255,(255&s>>8)/255,(255&s)/255,(255&s>>24)/255];m[R]={data:Y,part:D}}else G=cr;return Wj(r,x.uFixPickReverseColor,G),G}},Qq=function(){var C={center:function($,K,n,s,V){var k=-K[1]/2,c={x:-K[0]/2,y:k,width:K[0],height:K[1]},L=_l($,c,n);return[L.x+s,-L.y-V,tb()]},front:function(Y,R,s,H,l){var z=-R[1]/2,F={x:-R[0]/2,y:z,width:R[0],height:R[1]},e=_l(Y,F,s);return[e.x+H,-e.y-l,R[2]/2+tb()]},back:function(v,w,c,e,W){var z=-w[0]/2,$=-w[1]/2,p={x:z,y:$,width:w[0],height:w[1]},K=_l(v,p,c);return[-K.x-e,-K.y-W,-w[2]/2-tb()]},left:function(a,i,j,v,T){var e=-i[1]/2,X={x:-i[2]/2,y:e,width:i[2],height:i[1]},g=_l(a,X,j);return[-i[0]/2-tb(),-g.y-T,g.x+v]},right:function(Q,r,T,D,m){var E=-r[2]/2,t=-r[1]/2,x={x:E,y:t,width:r[2],height:r[1]},F=_l(Q,x,T);return[r[0]/2+tb(),-F.y-m,-F.x-D]},top:function(m,B,F,h,j){var T={x:-B[0]/2,y:-B[2]/2,width:B[0],height:B[2]},$=_l(m,T,F);return[$.x+h,B[1]/2+tb(),$.y+j]},bottom:function(x,Z,H,n,K){var A=-Z[2]/2,t={x:-Z[0]/2,y:A,width:Z[0],height:Z[2]},M=_l(x,t,H);return[M.x+n,-Z[1]/2-tb(),-M.y-K]}};return function(l,T,m,S,s,z){return C[S](l,T,m,s||0,z||0)}}(),Em=function(e,O,w,q,C,g,K,W,L,k){if(C&&(O[0]+=C[0],O[1]+=C[1],O[2]+=C[2]),qj(e,w),W){var f=Xc();if(Lp(f,L,k),Yp(O,f),qj(e,O),e.auto=W,e.pos=Yp([0,0,0],e),g){var t=e.mat2=Xc();Lp(t,g,K)}}else Lp(e,L,k),qj(e,O),q===zc?kk(e,-j):q===br?kk(e,j):q===Dc?Zo(e,-j):q===fd?Zo(e,j):q===cp&&kk(e,u),Lp(e,g,K);return e},Tr=function(E,B){var F=B.auto,p=B.mat2,N=E.gv;if(F){var o,i=Xc(),J=[0,0,0,0];o="string"==typeof F?[F.indexOf("x")<0?N._eye[0]:N._center[0],F.indexOf("y")<0?N._eye[1]:N._center[1],F.indexOf("z")<0?N._eye[2]:N._center[2]]:N._eye,_c(J,_n(Xc(),o,N._center,N._up)),fj(i,Vr(J,J),B.pos),p&&Ke(i,i,p),Vl(N,i)}else Vl(N,B)},ai=function(H,a,M,A,V){var G=H.s,X=H.gv,O=X.getGL(),h=X._prg,l=X._buffer,u=X._1O;xb(O,wr,u),Tr(H,M),Yi(O,h,G(a+".blend"),G(a+".light"),G(a+".opacity"),G(a+".reverse.flip"),G(a+".reverse.color"),G(a+".reverse.cull")),qo(O,h,u,V,l.uv,xr),Rl(O,l.vs,A,h.aPosition),Rl(O,l.ns,fg,h.aNormal),Hm(O,l.is,Xj),Mo(O,0,Xj.length),ul(O,h,u),uf(O,h),vc(X)},ps=function(x,J,F){var T=x.gv,D=x.data,G=x[J]={blend:T.getBodyColor(D)||T.getFaceBlend(D,J),light:T.getFaceLight(D,J),color:T.getFaceColor(D,J),opacity:T.getFaceOpacity(D,J),transparent:T.getFaceTransparent(D,J),reverseFlip:T.getFaceReverseFlip(D,J),reverseColor:T.getFaceReverseColor(D,J),reverseCull:T.getFaceReverseCull(D,J),texture:T.getFaceImage(D,J),blendTexture:T.getFaceBlendImage(D,J),discardSelectable:T.getFaceDiscardSelectable(D,J)};if("csg"!==J){G.uv=T.getFaceUv(D,J)||F&&F[J+"Uv"],G.uvScale=T.getFaceUvScale(D,J)||F&&F[J+"UvScale"],G.uvOffset=T.getFaceUvOffset(D,J)||F&&F[J+"UvOffset"];var N=T.getFaceMat(D,J);N&&(G.mat=Gn(D,N))}return G},mn=function(L,Q,V,q,k){if(q){if(!k(q.transparent))return;var S=L.data,D=L.gv,r=D._buffer,Y=D.getTexture(q.texture,S),v=D.getTexture(q.blendTexture,S);qo(Q,V,Y,q.discardSelectable,r.uv,q.tuv,q.uvOffset,q.uvScale,v),Yi(Q,V,q.blend,q.light,q.opacity,q.reverseFlip,q.reverseColor,q.reverseCull),Wj(Q,V.uDiffuse,q.color||n["color.empty"]),Rl(Q,r.vs,q.vs,V.aPosition),Rl(Q,r.ns,q.ns,V.aNormal),nk(Q,0,q.vs.length/3),uf(Q,V),ul(Q,V,Y)}},Lo=function(G,r,J,O,F,g){var C,Z,N,A,W,S,m,x,u,I,X,n=[O-r,F-J],y=G?G.length:0;for(N=0;y>N;N++){for(A=2,C=G[N],W=C[0],S=C[1];A+1<C.length;){if(m=C[A],x=C[A+1],Z=Rq(r,J,O,F,W,S,m,x,!0)){u=[m-W,x-S],I=zq(u),u[0]/=I,u[1]/=I,I=Od(n,u),I=I>0?g:-g,X=[u[0]*I,u[1]*I];break}W=m,S=x,A+=2}if(X)break}if(X)for(O=r+X[0],F=J+X[1],N=0;y>N;N++)for(A=2,C=G[N],W=C[0],S=C[1];A+1<C.length;){if(m=C[A],x=C[A+1],Z=Rq(r,J,O,F,W,S,m,x,!0))return[0,0];W=m,S=x,A+=2}return X?X:[O-r,F-J]},Er=W.graph3d={},rk=function(M,G,d){jd(g+".graph3d."+M,G,d)},xg="~<yfusfw!+!yjsubNQv!>!opjujtpQ`mh!gjeof$!~<fdobutjEfojMb!>!fdobutjEfojMw|*itbEv)gj!ITBE!gfegj$!!gjeof$!~<ttfouihjsCidubCb!>!ttfouihjsCidubCw|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!~<eofmCidubCb!>!eofmCidubCw|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!!gjeof$!~<spmpDidubCb!>!spmpDidubCw|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!~<wVb!>!wVs|*fsvuyfUeofmCv)gj~<x{/fmbdTuftggPv!+!wVb!,!zy/fmbdTuftggPv!>!wVw|*fsvuyfUv)gj~<**1/2!-opjujtpQb)5dfw!+!yjsubNNv)4dfw!>!emspXw<*yfusfw)4dfw!>!yfusfWw<**1/2!-mbnspOb)5dfw!+!yjsubNOv)4dfw!>!mbnspOw|*ldjQva!%%!yjGva)gj<*1/2!-opjujtpQb)5dfw!+!yjsubNWNv!>!yfusfw!5dfw|!*ejpw)ojbn!ejpw!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEfojMb!ubpmg!fuvcjsuub<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCb!4dfw!fuvcjsuub<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCb!ubpmg!fuvcjsuub<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCb!5dfw!fuvcjsuub<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<emspXw!4dfw!hojzsbw<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<yjGv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjsubNxfjWv!5ubn!nspgjov<yjsubNOv!5ubn!nspgjov<yjsubNQv!5ubn!nspgjov<yjsubNNv!5ubn!nspgjov<yjsubNWNv!5ubn!nspgjov<opjujtpQb!4dfw!fuvcjsuub<mbnspOb!4dfw!fuvcjsuub<wVs!3dfw!hojzsbw<wVw!3dfw!hojzsbw<wVb!3dfw!fuvcjsuub<fmbdTuftggPv!5dfw!nspgjov<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov!YJGFSQ^#CBRBEJxTT87hJFI,,bX1XrIwcn3UM{ZeZ,M6HEN6nLxe2Z72s2:3johr6foKrpqwxNKYkdbJ2CN[mBbf[wXU,T0oGuSEd190ohLZkEn8IuCe[OHoWeKz:Sf,VS7xdSLw23W1YJLU:jdv2{hiDbhDzNNEh9tp3xsuEp94Sl4c3wRzqwShMDRhCLRjCDEBOH5BBVRBCFRE4cJTHrTDH1BNgHJN",Cb="~~<eJ!>!spmpDhbsG`mh~<spmpDsfmqnbTwv!>+!eJ<*wVs!-sfmqnbTeofmCv)E3fsvuyfu!>!spmpDsfmqnbTwv!5dfw|!*fsvuyfUeofmCv)!gj!!gjeof$!~<ttfouihjsCidubCw!>+!chs/eJ!!!|*ttfouihjsCidubCv)gj!TTFOUIHJSCIDUBC!gfegj$!~<ttfouihjsCv!>+!chs/eJ!!!|*1/2!>a!ttfouihjsCv)gj~~<zujdbqPusbQv!>+!b/eJ!!!|*1/2!>a!zujdbqPusbQv)gj~!gjeof$!~<zujwjudfmgfSv!+!{zy/spmpDwof!>,!chs/eJ<*!spmpDwof!)sbfojMpUmfyfUqbNwof!>!spmpDwof<*!*!{z/dfWudfmgfs!-y/dfWudfmgfs)4dfw!-qbNwoFv!)fcvDfsvuyfu!>!spmpDwof!5dfw<*!mbnspOemspx!-yfusfWpUbsfnbd!)udfmgfs!>!dfWudfmgfs!4dfw<*!yjsubNxfjWv!-O!)opjudfsjEnspgtobsUftsfwoj!>!mbnspOemspx!4dfw<*!opjujtpQbsfnbDv!.!emspXw!)f{jmbnspo!>!yfusfWpUbsfnbd!4dfw|*qbNwoFftVv)!gj!QBNWOF`FTV!gfegj$!!gjeof$!<*spudbGhpg!-*x/eJ!-chs/spmpDhpGv)5dfw!-eJ)yjn!>!eJ<*iuqfe!-sbGhpGv!-sbfOhpGv)qfutiuppnt!>!spudbGhpg!ubpmg<x/esppDhbsG`mh0{/esppDhbsG`mh!>!iuqfe!ubpmg!HPG!gfegj$!!gjeof$!~~~~<chs/^j]spmpDupqTv!+!udfggFupqt!+!fhobSm!+!*1/1!-*mbnspOm.!-O)upe)ybn!>,!chs/eJ<*1/1!-*^j]uofopqyFupqTv!-udfggFupqt)xpq)ybn!>!udfggFupqt|*^j]fmhoBupqTv!?!udfggFupqt)gj<*mbnspOm!-^j]opjudfsjEupqTv)upe!>!udfggFupqt!ubpmg<*spudfWm)f{jmbnspo!>!mbnspOm!4dfw|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSupqTv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSupqTv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQupqTv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDupqTv)gj|!*,,j!<UPQT`YBN!=!j!<1>j!uoj)spg!1!?!UPQT`YBN!gj$!!gjeof$!~~~<chs/^j]spmpDuojpQv!+!fhobSm!+!*1/1!-**spudfWm)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!?!fhobSm)!gj~<*1/2!-*^j]fhobSuojpQv!0!*spudfWm)iuhofm))ojn!.!1/2!>!fhobSm|*1/1!?!^j]fhobSuojpQv)!gj<1/2!>!fhobSm!ubpmg<^j]opjujtpQuojpQv!.!yfusfWw!>!spudfWm!4dfw|*1/1!>>!x/^j]spmpDuojpQv)gj|!*,,j!<UOJPQ`YBN!=!j!<1>j!uoj)spg!1!?!UOJPQ`YBN!gj$!!gjeof$!~~<chs/^j]spmpDsjEv!+!*1/1!-**^j]opjudfsjEsjEv)f{jmbnspo.!-O)upe)ybn!>,!chs/eJ|*1/1!>>!x/^j]spmpDsjEv)gj|!*,,j!<SJE`YBN!=!j!<1>j!uoj)spg!1!?!SJE`YBN!gj$!~<chs/spmpDuihjmebfIv!+!nsfUusfcnbm!>+!chs/eJ~<*1/2!-fhobSuihjmebfIv0*yfusfWw)iuhofm)ojn!.!1/2!!>+!nsfUusfcnbm|*1/1!?!fhobSuihjmebfIv)gj<*1/1!-6/1!,!6/1!+!*M.!-O)upe)ybn!>!nsfUusfcnbm!ubpmg|*1/1!>>!x/spmpDuihjmebfIv)gj|*uihjMv)gj~!gjeof$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf$!~<spmpDeofmCv!>+!eJ|*eofmCv)gj!ftmf~<eofmCidubCw!>+!chs/eJ|*eofmCidubCv)gj!EOFMCIDUBC!gfegj$!~~<esbdtje|*1/1!>>!x/eJ)gj!gjeof$!<ftvggjEv!>!eJ!ftmf$!~<ftvggjEv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|ftmf~<spmpDwv!>!eJ|*fsvuyfUv)gj|!ftmf~<spmpDftsfwfSldjQyjGv!>!eJ|*qjmGftsfwfSva!%%!ldbCtj)gj~<fvsu!>!ldbCtj<O.!>!O|*1/1!=!*O!-F)upe)gj<ftmbg!>!ldbCtj!mppc<F.!>!M!4dfw!gjeof$!<*yfusfWw.)f{jmbnspo!>!F!4dfw!ftmf$!<*2!-1!-1)4dfw!>!F!4dfw!DJIQBSHPIUSP!gfegj$!<*mbnspOw)f{jmbnspo!>!O!4dfw|!ftmf~!gjeof$!~~<ftvggjEv!>!eJ|ftmf~<esbdtje|*1/1!>>!x/ftvggjEv)gj|!*!fdobutjEitbEv!?!*!fdobutjEqbHitbEv!-fdobutjEfojMw!)epn!%%!itbEv)!gj!ITBE!gfegj$!!gjeof$!<spmpDftsfwfSldjQyjGv!>!eJ!ftmf$!~<spmpDftsfwfSldjQyjGv!>!eJ|ftmf~<spmpDidubCw!>!eJ|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*yjGv)gj<eJ!5dfw|ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDhbsG`mh)!gj!gjeof$!<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh!ftmf$!~<spmpDftsfwfSldjQyjGv!>!spmpDhbsG`mh|ftmf~<spmpDidubCw!>!spmpDhbsG`mh|*spmpDidubCv)gj!SPMPDIDUBC!gfegj$!|*ldjQv)gj~~~!<esbdtje!|!*utfUbiqmBv!>=!b/spmpDwv)!gj!!!!|!ftmf~~!<esbdtje!|!*1/1!>>!b/spmpDwv)!gj!!!!|!*uofsbqtobsUv)!gj<*wVw!-sfmqnbTv)E3fsvuyfu!>!spmpDwv|**fmcbudfmfTesbdtjEv!%%!ldjQv)a!%%!fsvuyfUv)gj<spmpDwv!5dfw|!*ejpw)ojbn!ejpw~<*!{zy/*!yjsubn!+!*!1/1!-sje!)5dfw!)!)f{jmbnspo!osvufs|!*!yjsubn!5ubn!oj!-sje!4dfw!oj!)opjudfsjEnspgtobsUftsfwoj!4dfw~!<*!*!SPUDBG`BNNBH!)ubpmg!-fvmbw!)sbfojMpUbnnbH!osvufs!|!*!fvmbw!5dfw!)sbfojMpUmfyfUqbNwof!5dfw~<*!x/fvmbw!-*!*!spudbGbnnbh!)4dfw!-{zy/fvmbw!)xpq!)5dfw!osvufs|!*!spudbGbnnbh!ubpmg!oj!-fvmbw!5dfw!oj!)sbfojMpUbnnbH!5dfw<1/3!>!SPUDBG`BNNBH!ubpmg!utopd!gjeof$!<fdobutjEfojMw!ubpmg!hojzsbw<fdobutjEqbHitbEv!ubpmg!nspgjov<fdobutjEitbEv!ubpmg!nspgjov<itbEv!mppc!nspgjov!ITBE!gfegj$!!gjeof$!<sbGhpGv!ubpmg!nspgjov<sbfOhpGv!ubpmg!nspgjov<spmpDhpGv!5dfw!nspgjov!HPG!gfegj$!!gjeof$!<^UPQT`YBN]opjudfsjEupqTv!4dfw!nspgjov<^UPQT`YBN]opjujtpQupqTv!4dfw!nspgjov<^UPQT`YBN]fhobSupqTv!ubpmg!nspgjov<^UPQT`YBN]fmhoBupqTv!ubpmg!nspgjov<^UPQT`YBN]uofopqyFupqTv!ubpmg!nspgjov<^UPQT`YBN]spmpDupqTv!5dfw!nspgjov!1!?!UPQT`YBN!gj$!!gjeof$!<^UOJPQ`YBN]opjujtpQuojpQv!4dfw!nspgjov<^UOJPQ`YBN]fhobSuojpQv!ubpmg!nspgjov<^UOJPQ`YBN]spmpDuojpQv!5dfw!nspgjov!1!?!UOJPQ`YBN!gj$!!gjeof$!<^SJE`YBN]opjudfsjEsjEv!4dfw!nspgjov<^SJE`YBN]spmpDsjEv!5dfw!nspgjov!1!?!SJE`YBN!gj$!!gjeof$!<eofmCidubCw!4dfw!hojzsbw<eofmCidubCv!mppc!nspgjov!EOFMCIDUBC!gfegj$!!gjeof$!<ttfouihjsCidubCw!ubpmg!hojzsbw<ttfouihjsCidubCv!mppc!nspgjov!TTFOUIHJSCIDUBC!gfegj$!!gjeof$!<spmpDidubCw!5dfw!hojzsbw<spmpDidubCv!mppc!nspgjov!SPMPDIDUBC!gfegj$!<spmpDuihjmebfIv!5dfw!nspgjov<fhobSuihjmebfIv!ubpmg!nspgjov<emspXw!4dfw!hojzsbw<opjujtpQbsfnbDv!4dfw!nspgjov<yjsubNxfjWv!5ubn!nspgjov!gjeof$!<zujwjudfmgfSv!ubpmg!nspgjov<qbNwoFv!fcvDsfmqnbt!nspgjov<qbNwoFftVv!mppc!nspgjov!QBNWOF`FTV!gfegj$!<yfusfWw!4dfw!hojzsbw<mbnspOw!4dfw!hojzsbw<ftvggjEv!5dfw!nspgjov<zujdbqPusbQv!ubpmg!nspgjov<ttfouihjsCv!ubpmg!nspgjov<uihjMv!mppc!nspgjov<spmpDeofmCv!5dfw!nspgjov<eofmCv!mppc!nspgjov<wVs!3dfw!hojzsbw<sfmqnbTeofmCv!E3sfmqnbt!nspgjov<sfmqnbTv!E3sfmqnbt!nspgjov<wVw!3dfw!hojzsbw<fsvuyfUeofmCv!mppc!nspgjov<fsvuyfUv!mppc!nspgjov<uofsbqtobsUv!mppc!nspgjov<utfUbiqmBv!ubpmg!nspgjov<spmpDftsfwfSldjQyjGv!5dfw!nspgjov<qjmGftsfwfSv!mppc!nspgjov<ldjQv!mppc!nspgjov<yjGv!mppc!nspgjov<fmcbudfmfTesbdtjEv!mppc!nspgjov!YJGFSQ!gjeof$!!gjeof$!!<ubpmg!qnvjefn!opjtjdfsq!!ftmf$!!<ubpmg!qihji!opjtjdfsq!!IHJI`OPJTJDFSQ`UOFNHBSG`MH!gfegj$!!TF`MH!gfegj$!";
uj(X,{setBatchInfo:function(J,p){Di[J]=p},getBatchInfo:function(d){return Di[d]}},!0);var kl=[1,1,1],Ci=[1,0,0,0,0,1,0,1,1,1,1,0],Kj=[-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5],Zi=[.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5],jh=[.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5],gc=[.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5],Li=[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5],In=[-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5],qn=function(g,h){Lf(g,h,"_batchModelMap","_batchIndexMap"),pj(g,h,"_wireframeModelMap","_wireframeIndexMap"),pj(g,h,"_polylineModelMap","_polylineIndexMap"),pj(g,h,"_wireframeModelMapSwap","_wireframeIndexMapSwap"),pj(g,h,"_polylineModelMapSwap","_polylineIndexMapSwap")},Lf=function(g,i,M,T){if(!i)return g[M]={},g[T]={},void 0;var y=i._id,A=g[T],C=A[y];if(C){var l=g[M],W=C.batch,$=l[W],j=$.ds,P=C.index;if($.invalidate=!0,delete A[y],j.splice(P,1),ud(j))return delete l[W],void 0;for(var v=C.begin,c=C.size,L=3*v,x=3*c,f=4*v,w=4*c,F=$.vs,_=$.ps,d=$.uv,G=$.cs,Y=$.bs,N=$.rs,I=$.ns,h=$.ls;P<j.length;P++)C=A[j[P]._id],C.index--,C.begin-=c;F.splice(L,x),_.splice(f,w),d&&d.splice(2*v,2*c),G&&G.splice(f,w),Y&&Y.splice(L,x),N&&N.splice(v,c),I&&I.splice(L,x),h&&h.splice(v,c)}},pj=Lf,ur=function(X,Z,i,u){if(!u)return S;var o=Z[u];if(!o){var P=Di[u]||ni,T=P.image?[]:S;o=Z[u]={vs:[],ns:[],uv:T,cs:T?S:P.color?S:[],bs:P.blend?[]:S,ps:[],rs:P.brightness?[]:S,ds:[]}}return o.invalidate=!0,X[i._id]={index:o.ds.length,begin:o.vs.length/3,batch:u},o.ds.push(i),o},Wh=function(P,e){return e!=S&&1!==e?[P[0]*e,P[1]*e,P[2]*e,P[3]]:P},em=function(){var c;return function(y,Q,I){var S=y.getData3dUI(Q),O=S.shapeModel;O||(O=di(S));var U,M=Q.s("wf.combineTriangle");if(I.geometry){if(!O&&(Q instanceof W.Node&&!(Q instanceof W.Shape)?(c||(c={vs:us,is:Ii,uv:Jl}),O=c):O=[S.left,S.front,S.right,S.back,S.top,S.bottom],!O))return d;if(M?(M=0|Math.min(3,Math.max(1,isNaN(M)?1:M)),U=Xg[M-1](O)):U=Nh(O),!U||0===U.length)return}else U=I.short?Qr:Dg;var N=y.getBrightness(Q),v=jb(I.color||"white"),D=v[3]<1,$=Math.ceil(I.width)||1,t=(D?"T":"O")+$,w=y._wireframeIndexMap,G=y._wireframeModelMap,b=G[t];b||(b=G[t]={vs:[],cs:[],ps:[],ds:[],T:D,W:$}),b.invalidate=!0;var K=b.vs,T=b.cs,k=b.ds,l=w[Q._id]={index:k.length,begin:K.length/3,batch:t};k.push(Q);var C=S.mat;if(!C){C=Gn(Q,I.mat);var q=S._calcAnchorMat(Q);q&&Ke(C,C,q)}oh(K,C,U);var L=l.size=K.length/3-l.begin;Yn(T,Wh(v,N),L)}}(),im=function(X,U,t,A,G,R,b,c,P){var y=X.getBrightness(U);y==S&&(y=1);var F=Wh(jb(A),y),Y=F[3]<1;R=Math.ceil(R)||1;var Z=(Y?"T":"O")+R;if(b){var n=b[0],W=(b[1]||n)+n;Z+="-"+n+"-"+W,P&&(Z+="-"+_m(P)+"-"+y,P=Wh(jb(P),y))}var J=X._polylineIndexMap,g=X._polylineModelMap,L=g[Z];L||(L=g[Z]={vs:[],cs:[],ps:[],ds:[],ls:b?[]:S,T:Y,W:R},b&&(L.D=n,L.G=W,L.A=P)),L.invalidate=!0;var j,u=L.vs,l=L.cs,d=L.ds,o=L.ls,E=J[U._id]={index:d.length,begin:u.length/3,batch:Z};d.push(U),qh(u,t);var D,r=E.size=u.length/3-E.begin,s=t.length,x=0,H=[];if(b||G)for(j=0;s>j;j+=6)D=zq([t[j],t[j+1],t[j+2]],[t[j+3],t[j+4],t[j+5]]),H.push(D),x+=D;if(x&&G){var T,_=Wh(jb(G),y),f=[_[0]-F[0],_[1]-F[1],_[2]-F[2],_[3]-F[3]],V=0;for(j=0;s>j;j+=6)T=V/x,Yn(l,[F[0]+f[0]*T,F[1]+f[1]*T,F[2]+f[2]*T,F[3]+f[3]*T],1),V+=H[j/6],T=V/x,Yn(l,[F[0]+f[0]*T,F[1]+f[1]*T,F[2]+f[2]*T,F[3]+f[3]*T],1)}else Yn(l,F,r);if(b)for(V=c||0,j=0;s>j;j+=6)o.push(V),V+=H[j/6],o.push(V)},kq=function(E,O,$){if(O)for(var k=4*O.begin,F=$[O.batch].ps,Z=0;Z<O.size;Z++)F[k++]=E[0],F[k++]=E[1],F[k++]=E[2],F[k++]=E[3]},Pi=function(B,O){var Q=O+["32"],t=B[O],j=B[Q];t?j&&j.length===t.length?(j.set(t),j._bufId=null):B[Q]=new am(t):delete B[Q]},on=function(u,l,w,I,i,c,s,r,f){if(En(w))w.forEach(function(M){on(u,l,M,I,i,c,s,r,f)});else if(Gk(w))on(u,l,di(I,w),I,i,c,s,r,f);else if(zn(w)){var j,R=lp(w.mat,l,u),q=lp(w.s3,l,u),o=lp(w.t3,l,u),b=lp(w.r3,l,u);if((q||b||o||R)&&(j=Hd(R,q,b,lp(w.rotationMode,l,u),o),c.push(j)),w.shape3d)on(u,l,w.shape3d,I,i,c,s,r,w);else{var d=I.s;f=f||ni;var t=c[0],m=c.length,H=d("shape3d.color",w.color,f.color);if(i||(i=d("shape3d.blend",w.blend,f.blend)),m>1){t=Dj(t);for(var N=1;m>N;N++)Ke(t,t,c[N])}w.vs&&d(eh,w.visible,f.visible)&&ac(t,s,r,w.vs,w.uv,w.is,i,H),w.top_vs&&d(Ol,w.topVisible,f.topVisible)&&ac(t,s,r,w.top_vs,w.top_uv,w.top_is,i,d("shape3d.top.color",w.topColor,f.topColor)||H),w.bottom_vs&&d(bk,w.bottomVisible,f.bottomVisible)&&ac(t,s,r,w.bottom_vs,w.bottom_uv,w.bottom_is,i,d("shape3d.bottom.color",w.bottomColor,f.bottomColor)||H),w.from_vs&&d(vr,w.fromVisible,f.fromVisible)&&ac(t,s,r,w.from_vs,w.from_uv,w.from_is,i,d("shape3d.from.color",w.fromColor,f.fromColor)||H),w.to_vs&&d(Zr,w.toVisible,f.toVisible)&&ac(t,s,r,w.to_vs,w.to_uv,w.to_is,i,d("shape3d.to.color",w.toColor,f.toColor)||H)}j&&c.pop()}},ac=function(g,C,K,S,D,H,c,e){var V,s=C.cs,i=C.uv,B=C.bs;if(H){V=H.length;for(var x=0;V>x;x++){var Z=H[x];oh(K,g,[S[3*Z],S[3*Z+1],S[3*Z+2]]),i&&qh(i,[D[2*Z],D[2*Z+1]])}}else V=S.length/3,oh(K,g,S),i&&qh(i,D);s&&Yn(s,e,V),B&&(c?Qe(B,c,V):qh(B,kl,V))},ob=function(u,$,O,l){var y=[];l?on(u.gv,u.data,l,u,u.getBodyColor(),[$],O,y):(Mq(u,zc,$,O,y),Mq(u,br,$,O,y),Mq(u,Cn,$,O,y),Mq(u,cp,$,O,y),Mq(u,Dc,$,O,y),Mq(u,fd,$,O,y),Mq(u,"csg",$,O,y)),y.length&&(qh(O.vs,y),qh(O.ns,nn(y)))},Mq=function(y,e,f,$,q){var x=y[e];if(x){var t=x.tuv;if(t){var k,Z,K,u,I=x.uvScale,W=x.uvOffset;if(I)for(k=t.length,Z=I[0],K=I[1],u=0;k>u;u+=2)t[u]*=Z,t[u+1]*=K;if(W)for(k=t.length,Z=W[0],K=W[1],u=0;k>u;u+=2)t[u]+=Z,t[u+1]+=K}ac(f,$,q,x.vs,t,S,x.blend,x.color)}},cd=function(m,P,S,t,p,j,x,w){var W,$=S.cs,I=S.uv,k=S.bs;if(m.getFaceVisible(P,j)){var l=m.getFaceMat(P,j);if(l&&(p=Gn(P,l)),oh(x,p,w),$&&Yn($,m.getFaceColor(P,j),6),I){var Y=m.getFaceUv(P,j)||t[j+"Uv"],s=m.getFaceUvScale(P,j)||t[j+"UvScale"],C=m.getFaceUvOffset(P,j)||t[j+"UvOffset"];Y=Y?[Y[6],Y[7],Y[0],Y[1],Y[2],Y[3],Y[2],Y[3],Y[4],Y[5],Y[6],Y[7]]:Ci;var A=Y[0],U=Y[1],D=Y[2],y=Y[3],e=Y[4],R=Y[5],B=Y[6],N=Y[7],i=Y[8],X=Y[9],c=Y[10],H=Y[11];if(s){var Q=s[0],q=s[1];A*=Q,U*=q,D*=Q,y*=q,e*=Q,R*=q,B*=Q,N*=q,i*=Q,X*=q,c*=Q,H*=q}if(C){var n=C[0],V=C[1];A+=n,U+=V,D+=n,y+=V,e+=n,R+=V,B+=n,N+=V,i+=n,X+=V,c+=n,H+=V}I.push(A,U,D,y,e,R,B,N,i,X,c,H)}k&&(W=m.getBodyColor(P)||m.getFaceBlend(P,j),W?Qe(k,W,6):qh(k,kl,6))}},Wf=function(U,G,i,F){var W=U.getGL(),A=U._prg,N=U._buffer;if(!U.drawFilter&&!bm(G)){Vl(U),Ei(W,A);for(var w in G){var p=G[w];if(!(F&&!p.T||!F&&p.T)){p.invalidate?(p.invalidate=!1,Pi(p,"vs"),Pi(p,"cs"),Pi(p,"ls"),Pi(p,"ps")):i&&Pi(p,"ps");var d=p.vs32,r=i?p.ps32:p.cs32;yc(W,A,p.W,S,N.vs,d);var H=p.D,C=!U._dashDisabled&&H;Wj(W,A.uAlphaTest,n.alphaTest),C&&(Wj(W,A.uDash,!0),Wj(W,A.uDashDistance,H),Wj(W,A.uDashGapDistance,p.G),so(W,A.aLineDistance),Rl(W,N.lineDistance,p.ls32,A.aLineDistance,1),Wj(W,A.uDiffuse,p.A||n["color.empty"]));var R=!U._batchColorDisabled;R&&(Wj(W,A.uBatchColor,!0),so(W,A.aBatchColor),Rl(W,N.batchColor,r,A.aBatchColor,4)),qo(W),nk(W,0,d.length/3,W.LINES),ul(W),R&&(Wj(W,A.uBatchColor,!1),Kp(W,A.aBatchColor)),C&&(Wj(W,A.uDash,!1),Kp(W,A.aLineDistance))}}Gb(W,A)}},Wp=function(Z,z,q){var G,y,w,K,m,r,p,I,j,J,F,O=Z.getGL(),u=Z._prg,D=Z._buffer,B=Z._batchModelMap;if(!bm(B)){Vl(Z);for(G in B)if(y=Di[G]||ni,!(q&&!y.transparent||!q&&y.transparent)&&(w=B[G],z||!y.transparentMask)){var $=q&&y.autoSort!==!1&&(Z._33Q||w.invalidate);if(w.invalidate?(w.invalidate=!1,Pi(w,"vs"),Pi(w,"ns"),Pi(w,"cs"),Pi(w,"rs"),Pi(w,"ps"),Pi(w,"bs"),Pi(w,"uv")):z&&Pi(w,"ps"),m=w.vs32,r=z?w.ps32:w.cs32,j=w.uv32,p=w.bs32,I=w.rs32,F=m.length/3,$&&(w.is=Eb(m,Z.getEye())),F){K=y.light,J=Z.getTexture(y.image),Yi(O,u,S,y.light,y.opacity,y.reverseFlip,y.reverseColor,y.reverseCull),r?Z._batchColorDisabled||(Wj(O,u.uBatchColor,!0),so(O,u.aBatchColor),Rl(O,D.batchColor,r,u.aBatchColor,4)):Wj(O,u.uDiffuse,y.color||n["color.empty"]);var W=y.alphaTest;Wj(O,u.uAlphaTest,W===d?n.alphaTest:W),y.envmap!==d?(Wj(O,u.uUseEnvMap,!0),Wj(O,u.uReflectivity,y.envmap)):(Wj(O,u.uUseEnvMap,!1),Wj(O,u.uReflectivity,0));var t=p&&!Z._batchBlendDisabled;t&&(Wj(O,u.uBatchBlend,!0),so(O,u.aBatchBlend),Rl(O,D.batchBlend,p,u.aBatchBlend));var C=I&&!Z._batchBrightnessDisabled;C&&(Wj(O,u.uBatchBrightness,!0),so(O,u.aBatchBrightness),Rl(O,D.batchBrightness,I,u.aBatchBrightness,1)),j?qo(O,u,J,y.discardSelectable,D.uv,j,y.uvOffset,y.uvScale):qo(O),Rl(O,D.vs,m,u.aPosition),Rl(O,D.ns,w.ns32,u.aNormal),w.is?(Uo(O,D.is,w.is),Mo(O,0,F)):nk(O,0,F),j?ul(O,u,J):ul(O),r&&!Z._batchColorDisabled&&(Wj(O,u.uBatchColor,!1),Kp(O,u.aBatchColor)),t&&(Wj(O,u.uBatchBlend,!1),Kp(O,u.aBatchBlend)),C&&(Wj(O,u.uBatchBrightness,!1),Kp(O,u.aBatchBrightness)),uf(O,u)}}}},Eb=function(H,j){for(var z=H.length/3,u=new Array(z),y=z/3,M=new Array(y),T=0;y>T;T++)M[T]=T;M.sort(function(y,L){var J=9*y,n=[(H[J]+H[J+3]+2*H[J+6])/4,(H[J+1]+H[J+4]+2*H[J+7])/4,(H[J+2]+H[J+5]+2*H[J+8])/4];J=9*L;var h=[(H[J]+H[J+3]+2*H[J+6])/4,(H[J+1]+H[J+4]+2*H[J+7])/4,(H[J+2]+H[J+5]+2*H[J+8])/4],M=zq(j,n)-zq(j,h);return M>0?-1:0>M?1:0});for(var T=0;y>T;T++){var J=3*T,l=3*M[T];u[J]=l,u[J+1]=l+1,u[J+2]=l+2}return new Ae(u)},Ac={obj:function(b,i){var r={mat:b.mat,s3:b.s3,r3:b.r3,rotationMode:b.rotationMode,t3:b.t3,cube:b.cube==S?!0:b.cube,center:b.center==S?!0:b.center,ignoreMtls:b.ignoreMtls,ignoreTransparent:b.ignoreTransparent,ignoreColor:b.ignoreColor,ignoreImage:b.ignoreImage,ignoreNormal:b.ignoreNormal,prefix:b.prefix,flipY:b.flipY,flipFace:b.flipFace,reverseFlipMtls:b.reverseFlipMtls,finishFunc:function(L,f){if(L){var f=[];for(var y in L){var m=L[y];f.rawS3=m.rawS3,f.push(m),b.eachModel&&b.eachModel(y,m)}f.json=b,i(f)}else i()}};X.loadObj(b.obj,b.mtl,r)}};X.getModelTypeHandlers=function(){return Ac},X.setModelTypeHandler=function(N,Q){Ac[N]=Q},X.getModelTypeHandler=function(X){return Ac[X]},X.handleModelLoaded=function(){},X.handleUnfoundModel=function(){};var qc=S,nj=S,Xf=function(L){qc&&!L._loadingModelView_&&(nj||(nj={}),nj[L._loadingModelView_=mf()]=L)},yi=function(r,l){qc||(qc={});var W=qc[r];if(W){if(W.url===l)return;W.request.onload=ic,W.request.onerror=ic}var F=new Gh;if(qc[r]={request:F,url:l},l=X.beforeLoadURL(l),l.data){var x=X.parse(l.data);Tk(r,x,l)}else{F.onload=function(){if(200===this.status||0===this.status){delete qc[r];var Y=X.parse(F.getResponseText());Tk(r,Y,l)}else ld(r,X.handleUnfoundModel(r,l)||S)},F.onerror=function(){ld(r,X.handleUnfoundModel(r,l)||S)};var k={};k.url=encodeURI(l),k.sync=!1,F.send(k)}},Tk=function(D,F,e){var d=F.modelType;if(!d)return ld(D,F),X.handleModelLoaded(D,F),void 0;var l=X.getModelTypeHandler(d);if(l){if(qc||(qc={}),qc[D])return;qc[D]=!0;var x=function(c){c?(ld(D,c),X.handleModelLoaded(D,c)):ld(D,X.handleUnfoundModel(D,e)||S)};l(F,x)}else ld(D,X.handleUnfoundModel(D,e)||S)},ld=function(u,y){if(xk[u]=y,delete qc[u],bm(qc)&&(qc=S,nj)){for(var J in nj){var X=nj[J];X.invalidateAll&&X.invalidateAll(d,"modelLoaded",u),X.redraw&&X.redraw(),X.iv(),delete X._loadingModelView_}nj=S}if(y&&nj)for(var J in nj){var X=nj[J];X.invalidateAll&&X.invalidateAll(d,"modelLoading",u),X.redraw&&X.redraw(),X.iv()}},xr=new am([0,0,0,1,1,1,1,0]),fg=new am([0,0,1,0,0,1,0,0,1,0,0,1]),Xj=new Ae([0,1,2,2,3,0]),us=new am([-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),Ii=new Ae([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Jl=new am([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]),wq=nn(us,Ii),Vq=(new am([-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5]),new Ae([0,1,2,3,0,7,5,4,6,7,5,3,2,4,6,1]),[zc,Cn,br,cp,Dc,fd]),Dg=[-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5],Qr=[-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,.5,.5,.5,.5,.5,.5,.4,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,.5,.5,-.5,.5,.5,-.5,.4,-.5,.5,-.5,-.4,.5,-.5,-.5,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,.5,.5,-.5,.4,.5,-.5,.5,.5,-.5,.5,.4,-.5,.5,.5,-.5,.5,.5,-.4,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,-.5,-.5,-.5,-.5,-.5,-.5,-.4,.5,-.5,-.5,.4,-.5,-.5,.5,-.5,-.5,.5,-.4,-.5,.5,-.5,-.5,.5,-.5,-.4],Tc=function(y,I,B,z,c,Y){Y=Y||16,y=y||16,I=I||0,B=B||y;var a,f,K,o,r,F,U,N,d=.5,H=[],l=[],g=m/y,p=u/Y;for(a=0;Y>a;a++)for(r=a+1,o=a*p,N=r*p,f=I;B>f;f++)F=f+1,K=f*g,U=F*g,H.push(d*L(o)*k(K),d*k(o),-d*L(o)*L(K),d*L(N)*k(U),d*k(N),-d*L(N)*L(U),d*L(o)*k(U),d*k(o),-d*L(o)*L(U),d*L(o)*k(K),d*k(o),-d*L(o)*L(K),d*L(N)*k(K),d*k(N),-d*L(N)*L(K),d*L(N)*k(U),d*k(N),-d*L(N)*L(U)),l.push(f/y,a/Y,F/y,r/Y,F/y,a/Y,f/y,a/Y,f/y,r/Y,F/y,r/Y);if(z){var s=[],J=[];for(K=I*g,a=0;Y>a;a++)r=a+1,o=a*p,N=r*p,s.push(0,0,0,d*L(N)*k(K),d*k(N),-d*L(N)*L(K),d*L(o)*k(K),d*k(o),-d*L(o)*L(K)),J.push(0,.5,I/y,r/Y,I/y,a/Y)}if(c){var $=[],t=[];for(K=B*g,a=0;Y>a;a++)r=a+1,o=a*p,N=r*p,$.push(0,0,0,d*L(o)*k(K),d*k(o),-d*L(o)*L(K),d*L(N)*k(K),d*k(N),-d*L(N)*L(K)),t.push(1,.5,B/y,a/Y,B/y,r/Y)}return{vs:H,uv:l,from_vs:s,from_uv:J,to_vs:$,to_uv:t}},Of=function(w,J,i){w=w||.17,J=J||12,i=i||18,0>w?w=0:w>.25&&(w=.25);var d,N,K,V,G,D,T,U=.5,Q=[],y=[],j=[],Z=m/i,_=m/J,s=U-w;for(N=0;J>=N;N++)for(V=-u+N*_,D=k(V),G=L(V),d=0;i>=d;d++)K=d*Z,T=s+w*D,Q.push(k(K)*T,G*w,-L(K)*T),y.push(d/i,1-N/J);for(N=0;J>N;N++){var $=N*(i+1),O=(N+1)*(i+1);for(d=0;i>d;d++)j.push($+d,O+d+1,O+d,$+d,$+d+1,O+d+1)}return{vs:Q,uv:y,is:j}},Aj=function(t,h,K,l,C,w,D){D=D||12,t=t||18,h=h||0,K=K||t,w=w||.17,0>w?w=0:w>.25&&(w=.25);var R,j,q,M,J,X,b,d,g,U,v=.5,F=[],f=[],H=m/t,W=m/D,E=v-w;for(q=0;D>q;q++)for(M=q+1,b=-u+q*W,d=-u+M*W,R=h;K>R;R++)j=R+1,J=R*H,X=j*H,g=E+w*k(b),U=E+w*k(d),F.push(k(J)*g,L(b)*w,-L(J)*g,k(X)*g,L(b)*w,-L(X)*g,k(X)*U,L(d)*w,-L(X)*U,k(J)*g,L(b)*w,-L(J)*g,k(X)*U,L(d)*w,-L(X)*U,k(J)*U,L(d)*w,-L(J)*U),f.push(R/t,1-q/D,j/t,1-q/D,j/t,1-M/D,R/t,1-q/D,j/t,1-M/D,R/t,1-M/D);if(l){var a=[],r=[];for(q=0;D>q;q++)M=q+1,b=-u+q*W,d=-u+M*W,J=h*H,g=E+w*k(b),U=E+w*k(d),a.push(k(J)*g,L(b)*w,-L(J)*g,k(J)*U,L(d)*w,-L(J)*U,k(J)*E,0,-L(J)*E),r.push(.5+.5*k(b),.5-.5*L(b),.5+.5*k(d),.5-.5*L(d),.5,.5)}if(C){var T=[],e=[];for(q=0;D>q;q++)M=q+1,b=-u+q*W,d=-u+M*W,J=K*H,g=E+w*k(b),U=E+w*k(d),T.push(k(J)*g,L(b)*w,-L(J)*g,k(J)*E,0,-L(J)*E,k(J)*U,L(d)*w,-L(J)*U),e.push(.5-.5*k(b),.5-.5*L(b),.5,.5,.5-.5*k(d),.5-.5*L(d))}return{vs:F,uv:f,from_vs:a,from_uv:r,to_vs:T,to_uv:e}},ej=function(B,S){for(var d,C,G,Y=.5,R=16,z=[],Q=[],N=[],A=m/R,x=0;R>=x;x++)d=x*A,C=k(d)*Y,G=L(d)*Y,z.push(C,-Y,G,C,Y,G),Q.push(1-x/R,1,1-x/R,0);for(x=0;R>x;x++)N.push(2*x,2*x+1,2*x+3,2*x,2*x+3,2*x+2);if(S){var E=[],i=[],q=[];for(E.push(0,-Y,0),i.push(.5,.5),x=0;R>=x;x++)d=x*A,C=k(d),G=L(d),E.push(C*Y,-Y,-G*Y),i.push(.5+.5*C,.5+.5*G);for(x=0;R>x;x++)q.push(0,x+2,x+1)}if(B){var a=[],Z=[],y=[];for(a.push(0,Y,0),Z.push(.5,.5),x=0;R>=x;x++)d=x*A,C=k(d),G=L(d),a.push(C*Y,Y,-G*Y),Z.push(.5+.5*C,.5-.5*G);for(x=0;R>x;x++)y.push(0,x+1,x+2)}return{vs:z,uv:Q,is:N,bottom_vs:E,bottom_uv:i,bottom_is:q,top_vs:a,top_uv:Z,top_is:y}},cj=function(J,Q,C,V,b,W,_){J=J||12,Q=Q||0,C=C||J;for(var y,x,S,u,I,N,E,p,n=.5,z=[],G=[],s=m/J,l=Q;C>l;l++)y=l+1,x=l*s,S=y*s,u=k(x)*n,I=L(x)*n,N=k(S)*n,E=L(S)*n,z.push(u,-n,-I,N,-n,-E,u,n,-I,N,-n,-E,N,n,-E,u,n,-I),G.push(l/J,1,y/J,1,l/J,0,y/J,1,y/J,0,l/J,0);if(_){var q=[],X=[];for(l=Q;C>l;l++)x=s*l,S=s*(l+1),u=k(x),I=L(x),N=k(S),E=L(S),q.push(u*n,-n,-I*n,0,-n,0,N*n,-n,-E*n),X.push(.5+.5*u,.5+.5*I,.5,.5,.5+.5*N,.5+.5*E)}if(W){var g=[],B=[];for(l=Q;C>l;l++)x=s*l,S=s*(l+1),u=k(x),I=L(x),N=k(S),E=L(S),g.push(u*n,n,-I*n,N*n,n,-E*n,0,n,0),B.push(.5+.5*u,.5-.5*I,.5+.5*N,.5-.5*E,.5,.5)}if(V){var Y=[],P=[];x=s*Q,u=k(x)*n,I=L(x)*n,p=Q/J,Y.push(0,n,0,0,-n,0,u,-n,-I,u,-n,-I,u,n,-I,0,n,0),P.push(0,0,0,1,p,1,p,1,p,0,0,0)}if(b){var K=[],A=[];x=s*C,u=k(x)*n,I=L(x)*n,p=C/J,K.push(0,-n,0,0,n,0,u,n,-I,u,n,-I,u,-n,-I,0,-n,0),A.push(1,1,1,0,p,0,p,0,p,1,1,1)}return{vs:z,uv:G,bottom_vs:q,bottom_uv:X,top_vs:g,top_uv:B,from_vs:Y,from_uv:P,to_vs:K,to_uv:A}},Hb=function(u,E,b,f,y){E=E||18,b=b||0,f=f==S?m:f,y=y==S?.5:y;for(var c,l,e,g,T,C,J=[0,.5,.75,.875,.9375],d=[],v=[],H=[],s=f/E,Q=0;Q<J.length;Q++){var R=0===Q%2?0:.5;for(c=0;E>=c;c++)l=(c+R)*s+b,e=1-J[Q],d.push(k(l)*y*e,-y+2*J[Q]*y,-L(l)*y*e),v.push((c+R)/E,e)}for(Q=0;Q<J.length-1;Q++){var B=Q*(E+1),P=(Q+1)*(E+1);for(c=0;E>c;c++)H.push(B+c,P+c+1,P+c,B+c,B+c+1,P+c+1)}for(C=d.length/3-(E+1),c=0;E>c;c++)d.push(0,y,0),v.push((c+.5)/E,0);for(c=0;E>c;c++)H.push(C+c,C+c+1,C+(E+1)+c);if(u){var V=[],z=[],A=[];for(V.push(0,-y,0),z.push(.5,.5),c=0;E>=c;c++)l=c*s+b,g=k(l),T=L(l),V.push(g*y,-y,-T*y),z.push(.5+.5*g,.5+.5*T);for(c=0;E>c;c++)A.push(0,c+2,c+1)}return{vs:d,uv:v,is:H,bottom_vs:V,bottom_uv:z,bottom_is:A}},mj=function(F,h,t,B,S,q){F=F||16,h=h||0,t=t||F;for(var s=.5,P=[],g=[],T=m/F,E=h;t>E;E++){var N=E+1,i=T*E,z=T*N;P.push(k(i)*s,-s,-L(i)*s,k(z)*s,-s,-L(z)*s,0,s,0),g.push(E/F,1,N/F,1,(E+N)/2/F,0)}if(q){var r=[],f=[];for(E=h;t>E;E++){i=T*E,z=T*(E+1);var x=k(i),A=L(i),K=k(z),n=L(z);r.push(x*s,-s,-A*s,0,-s,0,K*s,-s,-n*s),f.push(.5+.5*x,.5+.5*A,.5,.5,.5+.5*K,.5+.5*n)}}if(B){var $=[],b=[];i=T*h,$.push(0,s,0,0,-s,0,k(i)*s,-s,-L(i)*s),b.push(0,0,0,1,h/F,1)}if(S){var C=[],O=[];i=T*t,C.push(0,-s,0,0,s,0,k(i)*s,-s,-L(i)*s),O.push(1,1,1,0,t/F,1)}return{vs:P,uv:g,bottom_vs:r,bottom_uv:f,from_vs:$,from_uv:b,to_vs:C,to_uv:O}},ti=function(m,y,B,E,Q,h,p,N){for(var X=[],v=0;v<m.length-1;v+=2)X.push({x:m[v],y:m[v+1]});return Ti(X,y,B,E,Q,h,p,N,!1)},Dr={roundRect:function(b,F){return ti([.5,.4,.5,.442,.471,.471,.442,.5,.4,.5,-.4,.5,-.442,.5,-.471,.471,-.5,.442,-.5,.4,-.5,-.4,-.5,-.442,-.471,-.471,-.442,-.5,-.4,-.5,.4,-.5,.442,-.5,.471,-.471,.5,-.442,.5,-.4,.5,.4],[1,3,3,2,3,3,2,3,3,2,3,3,2],b,F,3)},star:function(B,A){return ti([.193,.079,.333,.5,0,.233,-.333,.5,-.194,.079,-.5,-.167,-.112,-.167,0,-.5,.111,-.167,.5,-.167],[1,2,2,2,2,2,2,2,2,2,5],B,A)},rect:function(B,u){return ti([.5,-.5,.5,.5,-.5,.5,-.5,-.5],[1,2,2,2,5],B,u)},billboard:function(){return{vs:[-.5,.5,0,-.5,-.5,0,.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]}},plane:function(){return{vs:[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,.5],uv:[0,0,0,1,1,0,1,0,0,1,1,1],ns:[0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]}},triangle:function(t,l){return ti([0,-.5,.5,.5,-.5,.5],[1,2,2,5],t,l)},rightTriangle:function(O,$){return ti([.5,.5,-.5,.5,-.5,-.5],[1,2,2,5],O,$)},parallelogram:function(i,F){return ti([.5,-.5,.25,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],i,F)},trapezoid:function(d,S){return ti([.25,-.5,.5,.5,-.5,.5,-.25,-.5],[1,2,2,2,5],d,S)}},bj={sphere:1,cylinder:1,cone:1,torus:1},Ri={torus:1,sphere:1},Ph=uj(or(Dr),{cylinder:1}),cm=uj(or(Dr),{cylinder:1,cone:1}),Fj=function(w,k,U){var J,p=lp(w.anchor3d,U,k),G=lp(w.mat,U,k),Z=lp(w.s3,U,k),W=lp(w.t3,U,k),v=lp(w.r3,U,k),D=Z||v||W||G;if(p||D){J=Dj(k._6O);var S=D?Hd(G,Z,v,lp(w.rotationMode,U,k),W):Xc();p&&qj(S,[.5-p[0],.5-p[1],.5-p[2]]),Vl(k,S)}return J},gn=function(g,m,N,I,v,p,l){if(En(N))N.forEach(function(s){gn(g,m,s,I,v,p,l)});else if(Gk(N))gn(g,m,di(I,N),I,v,p,l);else if(zn(N))if(N.shape3d){var f=Fj(N,g,m);gn(g,m,N.shape3d,I,v,p,N),f&&vc(g,f)}else Ge(g,m,N,I.s,v,p,l)},Ge=function(E,K,B,V,G,F,w){if(w=w||ni,!F||F(V("shape3d.transparent",B.transparent,w.transparent))){var t=Fj(B,E,K);Ze(B);var Z=E._26I,C=E._prg,b=E._buffer,M=V("shape3d.color",B.color,w.color);G||(G=V("shape3d.blend",B.blend,w.blend));var l,z=B.opacity==S?w.opacity:B.opacity,U=V("shape3d.opacity");l=U!=S&&z!=S?z*U:z!=S?z:U,Yi(Z,C,G,V("shape3d.light",B.light,w.light),l,V("shape3d.reverse.flip",B.reverseFlip,w.reverseFlip),V("shape3d.reverse.color",B.reverseColor,w.reverseColor),V("shape3d.reverse.cull",B.reverseCull,w.reverseCull));var a=V("polygonOffset",B.polygonOffset,w.polygonOffset);B.vs&&V(eh,B.visible,w.visible)&&$e(Z,C,b,M,E.getTexture(V("shape3d.image",B.image,w.image),K),V("shape3d.discard.selectable",B.discardSelectable,w.discardSelectable),B.vs,B.uv,B.ns,B.is,V("shape3d.uv.offset",B.uvOffset,w.uvOffset),V("shape3d.uv.scale",B.uvScale,w.uvScale),a),B.top_vs&&V(Ol,B.topVisible,w.topVisible)&&$e(Z,C,b,V("shape3d.top.color",B.topColor,w.topColor)||M,E.getTexture(V("shape3d.top.image",B.topImage,w.topImage),K),V("shape3d.top.discard.selectable",B.topDiscardSelectable,w.topDiscardSelectable),B.top_vs,B.top_uv,B.top_ns,B.top_is,V("shape3d.top.uv.offset",B.topUvOffset,w.topUvOffset),V("shape3d.top.uv.scale",B.topUvScale,w.topUvScale),a),B.bottom_vs&&V(bk,B.bottomVisible,w.bottomVisible)&&$e(Z,C,b,V("shape3d.bottom.color",B.bottomColor,w.bottomColor)||M,E.getTexture(V("shape3d.bottom.image",B.bottomImage,w.bottomImage),K),V("shape3d.bottom.discard.selectable",B.bottomDiscardSelectable,w.bottomDiscardSelectable),B.bottom_vs,B.bottom_uv,B.bottom_ns,B.bottom_is,V("shape3d.bottom.uv.offset",B.bottomUvOffset,w.bottomUvOffset),V("shape3d.bottom.uv.scale",B.bottomUvScale,w.bottomUvScale),a),B.from_vs&&V(vr,B.fromVisible,w.fromVisible)&&$e(Z,C,b,V("shape3d.from.color",B.fromColor,w.fromColor)||M,E.getTexture(V("shape3d.from.image",B.fromImage,w.fromImage),K),V("shape3d.from.discard.selectable",B.fromDiscardSelectable,w.fromDiscardSelectable),B.from_vs,B.from_uv,B.from_ns,B.from_is,V("shape3d.from.uv.offset",B.fromUvOffset,w.fromUvOffset),V("shape3d.from.uv.scale",B.fromUvScale,w.fromUvScale),a),B.to_vs&&V(Zr,B.toVisible,w.toVisible)&&$e(Z,C,b,V("shape3d.to.color",B.toColor,w.toColor)||M,E.getTexture(V("shape3d.to.image",B.toImage,w.toImage),K),V("shape3d.to.discard.selectable",B.toDiscardSelectable,w.toDiscardSelectable),B.to_vs,B.to_uv,B.to_ns,B.to_is,V("shape3d.to.uv.offset",B.toUvOffset,w.toUvOffset),V("shape3d.to.uv.scale",B.toUvScale,w.toUvScale),a),uf(Z,C),t&&vc(E,t)}},$e=function(e,w,y,U,G,k,T,j,f,N,C,t,r){T&&(r&&xo(e,r),Wj(e,w.uDiffuse,U||n["color.empty"]),j?qo(e,w,G,k,y.uv,j,C,t):qo(e),Rl(e,y.vs,T,w.aPosition),Rl(e,y.ns,f,w.aNormal),N?(Hm(e,y.is,N),Mo(e,0,N.length)):nk(e,0,T.length/3),j?ul(e,w,G):ul(e),r&&ro(e))},di=function(B,W){var o=B.s;if(W||(W=o(fm)),!W)return S;var q=Hi(W);if(q)return q;if("text"===W){var j={amount:o("shape3d.text.amount"),size:o("shape3d.text.size"),font:o("shape3d.text.font"),style:o("shape3d.text.style"),weight:o("shape3d.text.weight"),fill:o("shape3d.text.fill"),curveSegments:o("shape3d.text.curveSegments"),spacing:o("shape3d.text.spacing")},w=B.gv.getShape3dText(B.data),p=w;for(var U in j)p+="_"+(j[U]===d?"U":j[U]);return B._cachedTextKey===p?B._cachedTextGeometry:(B._cachedTextKey=p,B._cachedTextGeometry=X.createTextGeometry(w,j))}var U=W;if(bj[W]){var T=o("shape3d.side"),F=o("shape3d.side.from"),Y=o("shape3d.side.to"),n=o(vr),e=o(Zr);3>T?(T=0,F=0,Y=0,n=!1,e=!1):((F==S||0>F)&&(F=0),(Y==S||Y>T)&&(Y=T),0===F&&Y===T&&(n=!1,e=!1)),U+="-"+T+"-"+F+"-"+Y+"-"+n+"-"+e}if(Ph[W]){var D=o(Ol);U+="-"+D}if(cm[W]){var M=o(bk);U+="-"+M}if("torus"===W){var a=o("shape3d.torus.radius");0>a?a=0:a>.25&&(a=.25),U+="-"+a}if(Ri[W]){var _=o(De);U+="-"+_}return q=Be[U],q||("box"===W?q=X.createBoxModel():Dr[W]?q=Dr[W](D,M):"sphere"===W?q=X.createSphereModel(T,F,Y,n,e,_):W===Um?q=X.createCylinderModel(T,F,Y,n,e,D,M):"cone"===W?q=X.createConeModel(T,F,Y,n,e,M):"torus"===W&&(q=X.createTorusModel(T,F,Y,n,e,a,_)),Be[U]=q),q},Ze=function(){var b=["vs","ns","uv","top_vs","top_ns","top_uv","bottom_vs","bottom_ns","bottom_uv","from_vs","from_ns","from_uv","to_vs","to_ns","to_uv","er","al"],L=["is","top_is","bottom_is","from_is","to_is"];return I=$q(xg.substr(xg.indexOf("^#")+2)),xn(X[lr(Pr+b[15]+"n"+b[16])]())&&tq()?function(Y){Y&&!Y._complete_&&(Y._complete_=!0,Y.vs&&ud(Y.ns)&&(Y.ns=nn(Y.vs,Y.is)),Y.top_vs&&ud(Y.top_ns)&&(Y.top_ns=nn(Y.top_vs,Y.top_is)),Y.bottom_vs&&ud(Y.bottom_ns)&&(Y.bottom_ns=nn(Y.bottom_vs,Y.bottom_is)),Y.from_vs&&ud(Y.from_ns)&&(Y.from_ns=nn(Y.from_vs,Y.from_is)),Y.to_vs&&ud(Y.to_ns)&&(Y.to_ns=nn(Y.to_vs,Y.to_is)),b.forEach(function(o){var y=Y[o];En(y)&&(Y[o]=new am(y))}),L.forEach(function(B){var n=Y[B];En(n)&&(Y[B]=new Ae(n))}))}:void 0}(),Xo=function(d,X){var t=d[X];En(t)&&(d[X]=new am(t))};uj(zp,{_25Q:function(B){B._16O=function(s,o,$,k,G,p,l,H,T){var _=this.info;if(_){var B,m,q,u,z,A,V=Xc();if(Jg[o]?(B=_.p3,m=_.c1,q=_.c2):Tj[o]?(m=_.s1||_.c1,q=_.s2||_.c2):(m=_.t1||_.c1,q=_.t2||_.c2),B)A=Qq(o,Ad,$,k,H,T);else{var C=$b(q,m),K=zq(m,q);u=[0,-N(C[2],C[0]),h(C[1]/K)],z="zyx",B=[(m[0]+q[0])/2,(m[1]+q[1])/2,(m[2]+q[2])/2],A=Qq(o,[K,0,0],$,k,H,T)}return Em(V,A,B,k,G,p,l,s,u,z)}return rq},B._80o=function(C,W,m){var i=this,b=i.shapeModel;if(b){var A=i.gv;Vl(A),gn(A,i.data,b,i,i.getBodyColor(),m)}},B.createLineModel=function(h,v,V,x,U){for(var L=this,t=L.s,n=Qj(h,v,t(De)),M=[],C=0;C<n.length;C++){var f=n[C],B=f.length;if(B>1){var $=f[0];M.push($.x,$.y,$.z);for(var p=1;B-1>p;p++)$=f[p],M.push($.x,$.y,$.z),M.push($.x,$.y,$.z);$=f[B-1],M.push($.x,$.y,$.z)}}var i,b,l,w=t(x+".color"),Y=t(U),W=0;return Y&&(b=t(U+".color"),i=t(U+".pattern"),W=t(U+".offset"),l=w),im(L.gv,L.data,M,b||w,l?S:t(x+".gradient.color"),V,i||t(x+".pattern"),W,l),n},B.createTubeModel=function(c,B,W,O){for(var v=this,P=v.s,A=P("shape3d.side")||cb,Q=P("shape3d.start.angle"),M=P("shape3d.sweep.angle"),k=P(Ol)?P("shape3d.top.cap"):S,U=P(bk)?P("shape3d.bottom.cap"):S,z="flat"===k,w="flat"===U,E=z&&(O?O.uv:P("shape3d.top.image")),G=w&&(O?O.uv:P("shape3d.bottom.image")),L=O?O.uv:P("shape3d.image"),D={vs:[],uv:L?[]:S,top_vs:z?[]:S,top_uv:E?[]:S,bottom_vs:w?[]:S,bottom_uv:G?[]:S},p=Qj(c,B,P(De),W),V=0,h=p.length;h>V;V++)mh(D,p[V],P(Wi),W,A,Q,M,k,U);if(O){var H=[];on(v.gv,v.data,D,v,v.getBodyColor(),[],O,H),H.length&&(qh(O.vs,H),qh(O.ns,nn(H)))}else v.shapeModel=D;return p},B.getCache=function(){var V=this.info;if(V){var L=V.list;if(L){var $=V.cache;return $||($=V.cache=Wk(L)),$}}return S}}});var Sk=function(d,K){for(var O,H=0,o=d.length,p=0,M=o-1;M>=p;)if(H=R(p+(M-p)/2),O=d[H].length-K,0>O)p=H+1;else{if(!(O>0)){M=H;break}M=H-1}H=M;var N=d[H],b=N.point;return H===o-1||N.length===K||(b=(new Ij).subVectors(d[H+1].point,b).normalize().multiplyScalar(K-N.length).add(b)),{point:b,tangent:N.tangent}},Wk=function(u){for(var D,S,H=[],L=0,G=0;G<u.length;G++){for(var c=u[G],q=0;q<c.length;q++){D=c[q],S&&(L+=S.distanceTo(D));var s=new Ij,p=c[q+1];p?s.subVectors(p,D):S?s.subVectors(D,S):s.x=1,s.normalize(),H.push({point:D,length:L,tangent:s}),S=D}S=null}return H},Qj=function(G,I,Q,y){Q=Q||Qd;for(var z=[],D=0,v=G.size();v>D;D++){var q=G.get(D);z.push(new Ij(q.x,q.e||0,q.y))}I&&(dm(I)&&(I=I._as),I.length||(I=null));for(var j,J,W,C,x,K=[],A=0,u=0,P=I?I.length:v;P>u;u++)if(x=I?I[u]:0===u?1:2,1===x)K.push(W=[]),W.push(z[A++]);else if(2===x||5===x)if(C=2===x?z[A++]:W[0],y){var X=I?I[u+1]:P>u+1?2:S;if(2===X||5===X){var g=W[W.length-1],L=2===X?z[A]:W[0],V=(new Ij).subVectors(g,C),Y=(new Ij).subVectors(L,C),E=V.length(),U=Y.length();if(E&&U)if(y>E/2&&y>U/2)W.push(C);else for(V.multiplyScalar(o(y,E/2)/E).add(C),Y.multiplyScalar(o(y,U/2)/U).add(C),j=new op(V,C,Y).getPoints(Q),J=0;Q>=J;J++)W.push(j[J])}else W.push(C)}else W.push(C);else if(3===x)for(j=new op(W[W.length-1],z[A++],z[A++]).getPoints(Q),J=1;Q>=J;J++)W.push(j[J]);else if(4===x)for(j=new So(W[W.length-1],z[A++],z[A++],z[A++]).getPoints(Q),J=1;Q>=J;J++)W.push(j[J]);return K},hn=function(U){for(var T,z,R=new Ij,Q=[],g=[],f=[],j=0,q=U.length;q>j;j++)T=U[j],z=U[j+1],z?R.subVectors(z,T):R.subVectors(T,U[j-1]),Q.push(R.normalize().clone());var h,b,L,I,t=new Ij,C=new Ij,k=new Rf,B=1e-4,A=Number.MAX_VALUE,r=Q[0],o=g[0]=new Ij,O=f[0]=new Ij;for(b=M(r.x),L=M(r.y),I=M(r.z),A>=b&&(A=b,t.set(1,0,0)),A>=L&&(A=L,t.set(0,1,0)),A>=I&&t.set(0,0,1),C.crossVectors(r,t).normalize(),o.crossVectors(r,C),O.crossVectors(r,o),j=1;q>j;j++)g[j]=g[j-1].clone(),f[j]=f[j-1].clone(),C.crossVectors(Q[j-1],Q[j]),C.length()>B&&(C.normalize(),h=Z(Wn(Q[j-1].dot(Q[j]),-1,1)),g[j].applyMatrix4(k.makeRotationAxis(C,h))),f[j].crossVectors(Q[j],g[j]);return{B:f,T:Q,N:g}},mh=function(){var I=function(q){for(var z=1;z<arguments.length;z++){var Z=arguments[z];q.push(Z.x,Z.y,Z.z)}},M=function(x){for(var i=1;i<arguments.length;i++){var r=arguments[i].uv;x.push(r[0],r[1])}},l=function(S,Z,M,V,u){var e=-V*k(u),U=V*L(u);return new Ij(S.x+e*M.x+U*Z.x,S.y+e*M.y+U*Z.y,S.z+e*M.z+U*Z.z)},H=function(M,y,Z,L,W,A,s,i){s=s||m;for(var e=[],J=s/W,T=0;W>=T;T++){var X=l(M,y,Z,L,T*J+A);e.push(X),i!=S&&(X.uv=[i,T/W])}return e},Y=function(Y,E,g,F,W,q,j,C,u){u=u||m;var s=E?Y.top_vs:Y.bottom_vs;if(s)for(var _=E?Y.top_uv:Y.bottom_uv,J=u/j,b=0;j>b;b++){var M,D;E?(M=b*J+C,D=(b+1)*J+C):(D=b*J+C,M=(b+1)*J+C),I(s,l(g,F,W,q,M),l(g,F,W,q,D),g),_&&_.push(.5-.5*k(M),.5-.5*L(M),.5-.5*k(D),.5-.5*L(D),.5,.5)}};return function(B,y,r,j,s,n,O,P,o){var i=y.length;if(i>1){var f,t,h,K,L,m,e,U=hn(y),b=U.T,k=U.N,x=U.B;"flat"===P&&Y(B,!0,y[0],x[0],k[0],j,s,n,O),"flat"===o&&Y(B,!1,y[i-1],x[i-1],k[i-1],j,s,n,O);var X,Q,V=[],c=w(s/2),J="round"===P,N="round"===o,$=y[0],T=b[0],q=x[0],Z=k[0],F=y[i-1],v=b[i-1],g=x[i-1],l=k[i-1];if(J){for(h=1;c>=h;h++)k.splice(0,0,Z),x.splice(0,0,q),b.splice(0,0,T),Q=-h/c*j,y.splice(0,0,T.clone().multiplyScalar(Q).add($)),V[c-h]=_(j*j-Q*Q);i+=c}if(N){for(h=1;c>=h;h++)k.push(l),x.push(g),b.push(v),Q=h/c*j,y.push(v.clone().multiplyScalar(Q).add(F)),V[y.length-1]=_(j*j-Q*Q);i+=c}if(B.uv){var A=0,C=0,G=[];for(r&&(A=r),L=y[0],G[0]=0,h=1;i>h;h++)K=y[h],G[h]=L.distanceTo(K),L=K,r||(A+=G[h]);for(X=[],h=0;i>h;h++)C+=G[h],X[h]=A?C/A:0}for(h=0;i>h;h++){if(K=y[h],m=x[h],e=k[h],f=H(K,m,e,V[h]===d?j:V[h],s,n,O,X?X[h]:S),t)for(var E=0;s>E;E++){var u=t[E],R=t[E+1]||t[0],W=f[E],p=f[E+1]||f[0];I(B.vs,R,u,W,W,p,R),B.uv&&M(B.uv,R,u,W,W,p,R)}t=f}}}}();uj(X,{getLineLength:function(m){return m[m.length-1].length},getLineOffset:function(w,Y){return Sk(w,Y)},getLineCacheInfo:function(I,K,S,L){return Wk(Qj(I,K,S,L))}});var Rk=W.graph3d.RenderLite={},gf=new Array(0),Sd=Rk.Buffer=function(F,w,N,V){this.gl=F,this.buffer=F.createBuffer(),this.type=w||F.ARRAY_BUFFER,this.drawType=V||F.STATIC_DRAW,this.data=gf,N&&this.upload(N)};Sd.prototype.upload=function(K,o,D){D||this.bind();var h=this.gl;K=K||this.data,o=o||0,this.data.byteLength>=K.byteLength?h.bufferSubData(this.type,o,K):h.bufferData(this.type,K,this.drawType),this.data=K},Sd.prototype.bind=function(){var x=this.gl;x.bindBuffer(this.type,this.buffer)},Sd.createVertexBuffer=function(w,E,k){return new Sd(w,w.ARRAY_BUFFER,E,k)},Sd.createIndexBuffer=function(e,Q,F){return new Sd(e,e.ELEMENT_ARRAY_BUFFER,Q,F)},Sd.create=function(I,X,V,N){return new Sd(I,X,N)},Sd.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};var ok=Rk.Shader=function(Y,y,M){this.gl=Y,this.program=Hc(Y,y,M),this.attributes=Lc(Y,this.program);var P=Wo(Y,this.program);this.uniforms=Bh(Y,P)};ok.prototype.bind=function(){this.gl.useProgram(this.program)},ok.prototype.destroy=function(){this.gl};var Hc=function(W,F,D){var k=Sr(W,W.VERTEX_SHADER,F),n=Sr(W,W.FRAGMENT_SHADER,D);W.getShaderParameter(n,W.COMPILE_STATUS)||console.error(W.getError());var v=W.createProgram();return W.attachShader(v,k),W.attachShader(v,n),W.linkProgram(v),W.getProgramParameter(v,W.LINK_STATUS)||(console.error("Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",W.getProgramParameter(v,W.VALIDATE_STATUS)),console.error("gl.getError()",W.getError()),""!==W.getProgramInfoLog(v)&&console.warn("Warning: gl.getProgramInfoLog()",W.getProgramInfoLog(v)),W.deleteProgram(v),v=null),W.deleteShader(k),W.deleteShader(n),v},Sr=function(F,c,D){var I=F.createShader(c);return F.shaderSource(I,D),F.compileShader(I),F.getShaderParameter(I,F.COMPILE_STATUS)?I:(console.log(F.getShaderInfoLog(I)),null)},Wo=function(E,M){for(var k={},A=E.getProgramParameter(M,E.ACTIVE_UNIFORMS),L=0;A>L;L++){var v=E.getActiveUniform(M,L),d=v.name.replace(/\[.*?\]/,""),I=kf(E,v.type);k[d]={type:I,size:v.size,location:E.getUniformLocation(M,d),value:Lq(I,v.size)}}return k},Lc=function(G,V){for(var h={},K=G.getProgramParameter(V,G.ACTIVE_ATTRIBUTES),Z=0;K>Z;Z++){var w=G.getActiveAttrib(V,Z),b=kf(G,w.type);h[w.name]={type:b,size:uh(b),gl:G,location:G.getAttribLocation(V,w.name),pointer:nr}
}return h},nr=function(Z,Q,Y,q,a){var h=this.gl;h.enableVertexAttribArray(this.location),h.bindBuffer(Z.type,Z.buffer),h.vertexAttribPointer(this.location,this.size,Q||h.FLOAT,Y||!1,q||0,a||0)},uh=function(B){return Lb[B]},Lb={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1},kf=function(J,H){if(!jc){var x=G.keys(Ig);jc={};for(var U=0;U<x.length;++U){var Z=x[U];jc[J[Z]]=Ig[Z]}}return jc[H]},jc=null,Ig={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"},Lq=function(I,A){switch(I){case"float":return 0;case"vec2":return new Float32Array(2*A);case"vec3":return new Float32Array(3*A);case"vec4":return new Float32Array(4*A);case"int":case"sampler2D":return 0;case"ivec2":return new Int32Array(2*A);case"ivec3":return new Int32Array(3*A);case"ivec4":return new Int32Array(4*A);case"bool":return!1;case"bvec2":return dg(2*A);case"bvec3":return dg(3*A);case"bvec4":return dg(4*A);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},dg=function(i){for(var p=new Array(i),A=0;A<p.length;A++)p[A]=!1;return p},Bh=function(j,S){var Z={data:{}};Z.gl=j;for(var V=G.keys(S),E=0;E<V.length;E++){var q=V[E],g=q.split("."),u=g[g.length-1],T=$o(g,Z),J=S[q];T.data[u]=J,T.gl=j,G.defineProperty(T,u,{get:dl(u),set:vn(u,J)})}return Z},dl=function(o){var p=vq.replace("%%",o);return new Function(p)},vn=function(j,i){var D,Z=Fr.replace(/%%/g,j);return D=1===i.size?si[i.type]:fi[i.type],D&&(Z+="\nthis.gl."+D+";"),new Function("value",Z)},$o=function(D,L){for(var c=L,f=0;f<D.length-1;f++){var l=c[D[f]]||{data:{}};c[D[f]]=l,c=l}return c},vq=["return this.data.%%.value;"].join("\n"),Fr=["this.data.%%.value = value;","var location = this.data.%%.location;"].join("\n"),si={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",sampler2D:"uniform1i(location, value)"},fi={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"},fc=W.Light=function(){Lk(fc,this),this.s(bo,n[bo]),this.s(fm,"sphere"),this.s3(20,20,20)};Xp("Light",Uh,{_image:"light_icon",_icon:"light_icon",onStyleChanged:function(m,L,l){fc.superClass.onStyleChanged.apply(this,arguments),m===bo&&this.s("shape3d.color",l)}});var _g=Er.Graph3dView=function(A,I){var W=this;W._webGLVersion=1,W._attributes=I||X.graph3dViewAttributes,W._25I={},W._view=Nm(1,W);var b=W._canvas=kr(W._view);s(b,"webglcontextlost",function(F){F.preventDefault(),te(W),W._26I&&W._doBufferGC(W._26I,!0),W._26I=S,W._1o.texture=S,W._35O=!0}),s(b,"webglcontextrestored",function(){W._35O=!1,W.iv()}),W._batchIndexMap={},W._batchModelMap={},W._wireframeIndexMap={},W._wireframeModelMap={},W._wireframeIndexMapSwap={},W._wireframeModelMapSwap={},W._polylineIndexMap={},W._polylineIndexMap={},W._polylineIndexMapSwap={},W._polylineIndexMapSwap={},W._8O=[],W._7O=Xc(),W._6O=Xc(),W._1o=new to(W),W._30O=new up(W),W._31O=new tr(W),W._32O=new Pc(W),W._raycaster=new dq(W),W._highlightHelper=new ei(W),W._postProcessing=new Cs(W),W._cameras=[],W._cameraId=0,W.vr=new Yk(W),W._33Q=!0,W._eye=or(X.graph3dViewEye),W._center=or(X.graph3dViewCenter),W._up=or(X.graph3dViewUp),W._lightChanged=!1,W._59O=[],W._spots=[],W._dirs=[],W._frameId=0,W.overlappingBox=new eb(W),W.dm(A?A:new Ag),W._coreInteractor=new Vi(this),W.setInteractors([new go(W)])},lf={fogDisabled:1,dashDisabled:1,batchColorDisabled:1,batchBlendDisabled:1,batchBrightnessDisabled:1,ortho:1},Yr=function(j,h,F,V){j.clearColor(0,0,0,0),j.clearDepth(1),j.enable(j.DEPTH_TEST),j.depthFunc(j.LEQUAL),j.disable(j.CULL_FACE),j.enable(j.BLEND),j.blendFuncSeparate(j.SRC_ALPHA,j.ONE_MINUS_SRC_ALPHA,j.ONE,j.ONE_MINUS_SRC_ALPHA),j.useProgram(F),Wj(j,F.uBrightness,1),Wj(j,F.uOpacity,1),Wj(j,F.uPartOpacity,1),Wj(j,F.uPick,V._picking),Wj(j,F.uTexture,!1),Wj(j,F.uBlendTexture,!1),Wj(j,F.uAlphaTest,n.alphaTest),Wj(j,F.uTransparent,!1),Wj(j,F.uFix,!1),Wj(j,F.uBatchColor,!1),Wj(j,F.uBatchBlend,!1),Wj(j,F.uBatchBrightness,!1),Wj(j,F.uReflectivity,V._envmapReflectivity),Wj(j,F.uCameraPosition,h.getEye()),Wj(j,F.uPMatrix,V._projectMatrix),Wj(j,F.uViewMatrix,V._viewMatrix),h.bindEnvMap(j),V._picking||(_b(h,j,F),h._fogDisabled||(Wj(j,F.uFogColor,h._fogColor),Wj(j,F.uFogNear,h._fogNear),Wj(j,F.uFogFar,h._fogFar))),so(j,F.aPosition),so(j,F.aNormal),Kp(j,F.aUv),Kp(j,F.aBatchColor),Kp(j,F.aBatchBlend),Kp(j,F.aBatchBrightness),Kp(j,F.aLineDistance),j.depthMask(!0)},$h=0;rk("Graph3dView",G,{ms_v:1,ms_tip:1,ms_gv:1,ms_dm:1,ms_lp:1,ms_fire:1,ms_sm:1,_51o:1,ms_ac:["devicePixelRatio","boundaries","moveStep","rotateStep","editHelperDisabled","sizeEditableFunc","rotationEditableFunc","editableFunc","rotatable","zoomable","pannable","walkable","resettable","mouseRoamable",Dm,yf,"firstPersonMode",jg,"movableFunc","gridVisible","gridSize","gridGap","gridColor","originAxisVisible","centerAxisVisible","axisXColor","axisYColor","axisZColor","editSizeColor","rectSelectable","rectSelectBackground","headlightRange","headlightColor","headlightIntensity","headlightDisabled","ortho","orthoWidth","fovy","near","far",Qp,Sb,"up","aspect","fogDisabled","fogColor","fogNear","fogFar","dashDisabled","batchColorDisabled","batchBlendDisabled","batchBrightnessDisabled","hoverDelay"],_editable:!1,_editHelperDisabled:X.graph3dViewEditHelperDisabled,_devicePixelRatio:d,_boundaries:d,_moveStep:X.graph3dViewMoveStep,_rotateStep:X.graph3dViewRotateStep,_pannable:X.graph3dViewPannable,_rotatable:X.graph3dViewRotatable,_walkable:X.graph3dViewWalkable,_resettable:X.graph3dViewResettable,_zoomable:X.graph3dViewZoomable,_firstPersonMode:X.graph3dViewFirstPersonMode,_mouseRoamable:X.graph3dViewMouseRoamable,_gridVisible:X.graph3dViewGridVisible,_gridSize:X.graph3dViewGridSize,_gridGap:X.graph3dViewGridGap,_gridColor:X.graph3dViewGridColor,_originAxisVisible:X.graph3dViewOriginAxisVisible,_centerAxisVisible:X.graph3dViewCenterAxisVisible,_axisXColor:X.graph3dViewAxisXColor,_axisYColor:X.graph3dViewAxisYColor,_axisZColor:X.graph3dViewAxisZColor,_ortho:X.graph3dViewOrtho,_orthoWidth:X.graph3dViewOrthoWidth,_fovy:X.graph3dViewFovy,_near:X.graph3dViewNear,_far:X.graph3dViewFar,_headlightColor:X.graph3dViewHeadlightColor,_headlightIntensity:X.graph3dViewHeadlightIntensity,_headlightRange:X.graph3dViewHeadlightRange,_headlightDisabled:X.graph3dViewHeadlightDisabled,_rectSelectable:X.graph3dViewRectSelectable,_rectSelectBackground:X.graph3dViewRectSelectBackground,_editSizeColor:X.graph3dViewEditSizeColor,_autoMakeVisible:Km,_fogDisabled:X.graph3dViewFogDisabled,_fogColor:X.graph3dViewFogColor,_fogNear:X.graph3dViewFogNear,_fogFar:X.graph3dViewFogFar,_dashDisabled:X.graph3dViewDashDisabled,_batchColorDisabled:X.graph3dViewBatchColorDisabled,_batchBlendDisabled:X.graph3dViewBatchBlendDisabled,_batchBrightnessDisabled:X.graph3dViewBatchBrightnessDisabled,addCamera:function(C){var w=G.freeze({id:this._cameraId++,priority:C.priority||0,ignoreInPick:!!C.ignoreInPick,useDefaultProgram:!!C.useDefaultProgram,render:C.render});this._cameras.push(w),this._cameras.sort(function(R,k){return R.priority!==k.priority?R.priority-k.priority:R.id-k.id})},setEye:function(D,c,Y){1===arguments.length&&(c=D[1],Y=D[2],D=D[0]);var e=this._eye;e[0]=D,e[1]=c,e[2]=Y,this.fp(Qp,S,e)},setCenter:function(k,s,c){1===arguments.length&&(s=k[1],c=k[2],k=k[0]);var z=this._center;z[0]=k,z[1]=s,z[2]=c,this.fp(Sb,S,z)},setUp:function(H,G,T){1===arguments.length&&(G=H[1],T=H[2],H=H[0]);var r=this._up;r[0]=H,r[1]=G,r[2]=T,this.fp("up",S,r)},getDevicePixelRatio:function(){return this._devicePixelRatio||pm},isTransparentMask:function(v){return v.s("transparent.mask")},getCoreInteractor:function(){return this._coreInteractor},getHighlightHelper:function(){return this._highlightHelper},getRaycaster:function(){return this._raycaster},getAspect:function(){var f=this,y=f._aspect;return y?y:(y=f.getWidth()/f.getHeight(),y||1.2)},getCanvas:function(){return this._canvas},setDataModel:function(g){var $=this,b=$._dataModel,M=$._selectionModel;b!==g&&(b&&(b.ump($.handleDataModelPropertyChange,$),b.umm($.handleDataModelChange,$),b.umd($.handleDataPropertyChange,$),M||b.sm().ums($.handleSelectionChange,$)),$._dataModel=g,g.mp($.handleDataModelPropertyChange,$),g.mm($.handleDataModelChange,$),g.md($.handleDataPropertyChange,$),M?M._21I(g):g.sm().ms($.handleSelectionChange,$),$._postProcessing.handleDataModleChange(b,g),$.invalidateAll(!0),$.invalidateLight(),$.fp(Ak,b,g),$._canvas.style.background=g.getBackground()||"")},handleDataModelPropertyChange:function(i){if("background"===i.property){var E=this._canvas.style.background,V=i.newValue||"";this._canvas.style.background=V,this.fp("canvasBackground",E,V)}else"envmap"===i.property&&this.iv()},handleDataPropertyChange:function(t){var H=t.data;this.invalidateData(H),Hf(H)&&"s:light.type"===t.property&&this.invalidateLight()},invalidateLight:function(){this._lightChanged||(this._lightChanged=!0,this.iv())},onPropertyChanged:function(N){var U=this,j=N.property;U.iv(),U._18Q=S,"eye"===j?U._33Q=!0:"devicePixelRatio"===j?U._42(S,U.getDevicePixelRatio()):lf[j]&&te(U)},_5O:function(s){var C=s._22Q();return C?new C(this,s):S},getData3dUI:function(O){var G=this._25I[O._id];return G===d&&(G=this._5O(O),this._25I[O._id]=G),G},invalidateAll:function(T){var u=this;if(T){for(var g in u._25I){var C=u._25I[g];C&&C.dispose()}u._25I={},u.iv(),qn(u)}else qn(u),u.dm().each(function(W){u.invalidateData(W)})},invalidateSelection:function(){var O=this;O.sm().each(function(d){O.invalidateData(d)})},invalidateData:function(J){var G=this,L=G.getData3dUI(J);L&&(L.iv(),G.iv()),qn(G,J)},getShape3dText:function(T){return T.getStyle("shape3d.text")||this.getLabel(T)},invalidateBatch:function(I){var q=this,Z=q._batchModelMap,E=Z[I],w=[],N={};if(E){E.ds.forEach(function(F){var d=q.getData3dUI(F);d&&d.iv(),delete q._batchIndexMap[F._id],w.push(F._id)}),delete Z[I];for(var K,_,W,t,B,p,V,M,v,L=["_wireframeModelMap","_polylineModelMap","_wireframeModelMapSwap","_polylineModelMapSwap"],$=["_wireframeIndexMap","_polylineIndexMap","_wireframeIndexMapSwap","_polylineIndexMapSwap"],T=0;T<L.length;T++){var s=q[L[T]],u=q[$[T]];for(N={},M=0;M<w.length;M++){var R=u[w[M]];if(R){delete u[w[M]],v=R.batch,K=s[v];var x=R.begin,i=R.size,X=3*x,G=3*i,y=4*x,P=4*i;for(_=K.ds,W=K.vs,t=K.cs,B=K.ps,p=K.ls,V=R.index,K.invalidate=!0,_[V]=d,V=X;X+G>V;V++)W[V]=d;for(V=y;y+P>V;V++)t[V]=d;for(V=y;y+P>V;V++)B[V]=d;if(p)for(V=X;X+G>V;V++)p[V]=d;N[v]=!0}}for(v in N){K=s[v],_=K.ds,W=K.vs,t=K.cs,B=K.ps,p=K.ls;var g=[];for(V=0;V<_.length;V++)_[V]!==d&&g.push(_[V]);if(0===g.length)delete s[v];else{for(K.ds=g,g=[],V=0;V<W.length;V++)W[V]!==d&&g.push(W[V]);for(K.vs=g,g=[],V=0;V<t.length;V++)t[V]!==d&&g.push(t[V]);for(K.cs=g,g=[],V=0;V<B.length;V++)B[V]!==d&&g.push(B[V]);if(K.ps=g,p){for(g=[],V=0;V<p.length;V++)p[V]!==d&&g.push(p[V]);K.ls=g}}}}q.iv()}},handleDataModelChange:function(i){var o=this,e=i.kind,I=i.data;if("add"===e)o.invalidateData(I),Pe(I)&&I.getEdgeGroup()&&I.getEdgeGroup().eachSiblingEdge(o.invalidateData,o),Hf(I)&&o.invalidateLight();else if(e===li){var z=I._id,j=o._25I[z];j&&(j.dispose(),delete o._25I[z],o.iv()),I===o._currentSubGraph&&o.setCurrentSubGraph(S),qn(o,I),Hf(I)&&o.invalidateLight()}else e===vh&&(o.invalidateAll(!0),o.setCurrentSubGraph(S),qn(o),o.invalidateLight())},toCanvas:function(P,x,w){var V=this,z=V.getGL();if(V.validate(),P){var I=z.getParameter(z.COLOR_CLEAR_VALUE);Sl(z,P)}V._42(S,1);var g=V.getWidth(),m=V.getHeight(),r=new Uint8Array(4*g*m),y=kr(),e=y.getContext("2d");z.readPixels(0,0,g,m,z.RGBA,z.UNSIGNED_BYTE,r),fp(y,g,m,1);for(var O=e.getImageData(0,0,g,m),G=O.data,t=0;t<G.length;t+=4){var C=t/4,L=R(C/g),j=C-L*g;C=4*((m-1-L)*g+j),G[C]=r[t],G[C+1]=r[t+1],G[C+2]=r[t+2],G[C+3]=r[t+3]}if(e.putImageData(O,0,0),P&&Sl(z,I),V._42(S,V.getDevicePixelRatio()),x&&w){var l=kr(),d=l.getContext("2d");return x=x,w=w,fp(l,x,w,1),X.drawImage(d,y,0,0,x,w),l}return y},toDataURL:function(J,Z){var Y=this,c=Y.getGL();if(Y.validate(),J){var u=c.getParameter(c.COLOR_CLEAR_VALUE);Sl(c,J)}Y._42(S,1);var G=Y._canvas.toDataURL(Z||"image/png",1);return J&&Sl(c,u),Y._42(S,Y.getDevicePixelRatio()),G},getGL:function(){var p=this._26I;if(p)return this.acquireProgram(),p;var y=this,$=y._canvas,M=y._attributes;try{p=$.getContext("webgl2",M)||$.getContext("experimental-webgl2",M),p&&(y._webGLVersion=2,y._26I=p)}catch(i){}if(!p)try{p=$.getContext("webgl",M)||$.getContext("experimental-webgl",M)}catch(i){throw new Error("WebGL not supported")}if(!p)throw new Error("WebGL not supported");y._26I=p,y._glExtensions=new K(p),y._glCapabilities=new r(p,y._glExtensions),y._2O={},p._emptyTexture=Tm(p),p._emptyBlendTexture=Tm(p),p._bufPool={},p._id=++$h,y._buffer={vs:ed(p),ns:ed(p),is:ed(p),uv:ed(p),batchColor:ed(p),batchBlend:ed(p),batchBrightness:ed(p),lineDistance:ed(p)},y._1O=xb(p);var t=y._cube={vs:ed(p),ns:ed(p),is:ed(p),uv:ed(p)};return Gd(p,t.vs,us),Gd(p,t.ns,wq),Gd(p,t.uv,Jl),Uo(p,t.is,Ii),y.acquireProgram(),p},getEnvmap:function(){return this._glCapabilities&&this._glCapabilities.maxVertexTextures<16?null:this.dm().getEnvmap()},acquireProgram:function(){var D=this,u=D._26I;if(u){var H=W.Default.getImage(D.getEnvmap())?!0:!1,r=D._prg&&D._prg.envMapFlag?!0:!1;if(!D._prg||H!==r){var d=D._prg=u.createProgram();if(!d)return S;d.envMapFlag=H;var v=D._dirs.length,p=D._spots.length,j=D._59O.length,U=["uPMatrix","uMVMatrix","uMMatrix","uReflectivity","uViewMatrix","uUseEnvMap","uEnvMap","uCameraPosition","uNMatrix","uViewMatrix","aNormal","aUv","uOffsetScale","uDiffuse","uBlend","uBlendColor","uBrightness","uPartOpacity","uAlphaTest","uTransparent","uTexture","uBlendTexture","uSampler","uBlendSampler","uDiscardSelectable","uFix","uPick","uReverseFlip","uFixPickReverseColor","uBatchBrightness","aBatchBrightness","uBatchColor","aBatchColor","uBatchBlend","aBatchBlend","uDash","aLineDistance","uDashDistance","uDashGapDistance","uLight","uHeadlightRange","uHeadlightColor","uFogColor","uFogNear","uFogFar"];v&&U.push("uDirColor","uDirDirection"),p&&U.push("uSpotColor","uSpotRange","uSpotAngle","uSpotExponent","uSpotPosition","uSpotDirection"),j&&U.push("uPointColor","uPointRange","uPointPosition"),Sl(u,[0,0,0,0]),u.clearDepth(1),u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),u.enable(u.BLEND),u.blendFuncSeparate(u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA),_q||(xg=$q(xg.substring(0,xg.indexOf("^#"))),Cb=$q(Cb),_q=!0);var X=["#define MAX_DIR "+v,"#define MAX_SPOT "+p,"#define MAX_POINT "+j,D._fogDisabled?"":"#define FOG",D._dashDisabled?"":"#define DASH",H?"#define USE_ENVMAP":"",D.isOrtho()?"#define ORTHOGRAPHIC":"",D._batchColorDisabled?"":"#define BATCHCOLOR",D._batchBlendDisabled?"":"#define BATCHBLEND",D._batchBrightnessDisabled?"":"#define BATCHBRIGHTNESS",""].join("\n"),q=wi(u,d,u.VERTEX_SHADER,xg.replace("PREFIX",X));u.getShaderParameter(q,u.COMPILE_STATUS)||console.error("compile vs shader faild, error info : ",u.getShaderInfoLog(q));var z=wi(u,d,u.FRAGMENT_SHADER,Cb.replace("PREFIX",X));u.getShaderParameter(z,u.COMPILE_STATUS)||console.error("compile fs shader faild, error info : ",u.getShaderInfoLog(z)),bl?U.push("aPosition"):(d.aPosition=0,u.bindAttribLocation(d,0,"aPosition")),u.linkProgram(d),U.forEach(function(j){d[j]=/^u/.test(j)?u.getUniformLocation(d,j):u.getAttribLocation(d,j)}),u.useProgram(d),u.deleteShader(q),u.deleteShader(z)}}},getBrightness:function(L){var v=L.s("brightness"),k=this.isSelected(L)?L.s("select.brightness"):S;return v==S?k:k==S?v:v*k},setHighlightMode:function(c){var R;R="selection"===c?ei.Mode.Selection:"mouseover"===c?ei.Mode.MouseOver:ei.Mode.Disable,this._highlightHelper.mode=R},getHighlightMode:function(){var P=this._highlightHelper.mode;return P===ei.Mode.Selection?"selection":P===ei.Mode.MouseOver?"mouseover":"disable"},bindEnvMap:function(q){var s=this,p=s._prg,z=5,d=s.getEnvmap(),m=W.Default.getImage(d);if(m){if(d!==s._lastEnvMap){s._envMapTexture&&q.deleteTexture(s._envMapTexture);var P=s._envMapTexture=q.createTexture();q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,P),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MAG_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_CUBE_MAP,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+0,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+1,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+2,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+3,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+4,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.texImage2D(q.TEXTURE_CUBE_MAP_POSITIVE_X+5,0,q.RGBA,q.RGBA,q.UNSIGNED_BYTE,m),q.bindTexture(q.TEXTURE_CUBE_MAP,null),s._lastEnvMap=d}q.activeTexture(q.TEXTURE0+z),q.bindTexture(q.TEXTURE_CUBE_MAP,s._envMapTexture),q.uniform1i(p.uEnvMap,z)}},getWireframe:function(K){var O=K.s("wf.visible"),q=K.s("wf.width");return O===!0||q>0&&"selected"===O&&this.isSelected(K)?{color:K.s("wf.color"),width:q,"short":K.s("wf.short"),mat:K.s("wf.mat")}:void 0},_transformPointToViewSpace:function(Y){var D=[Y[0],Y[1],Y[2]];return Yp(D,this._viewMatrix),D},_transformDirectionToViewSpace:function(V,F){var K=[V[0],V[1],V[2]];Yp(K,this._viewMatrix);var H=F?[F[0],F[1],F[2]]:[0,0,0];Yp(H,this._viewMatrix);var P=H[0]-K[0],f=H[1]-K[1],o=H[2]-K[2],c=Math.sqrt(P*P+f*f+o*o);return c?[P/c,f/c,o/c]:[P,f,o]},getWireframeGeometry:function(b){return b.s("wf.geometry")?{color:b.s("wf.color"),width:b.s("wf.width"),mat:b.s("wf.mat"),geometry:!0}:void 0},getBodyColor:function(l){return l.s("body.color")},getMat:function(W){return W.getMat?W.getMat():W.s("mat")},getFaceMat:function(f,Y){return f.getFaceMat?f.getFaceMat(Y):f.s(Y+".mat")},getFaceBlend:function(a,S){return a.s(S+".blend")||a.s("all.blend")},getFaceColor:function($,t){return $.s(t+".color")||$.s("all.color")},getFaceImage:function(Y,Q){return Y.s(Q+".image")||Y.s("all.image")},getFaceBlendImage:function(e,L){return e.s(L+".blend.image")||e.s("all.blend.image")},getFaceDiscardSelectable:function(H,r){var q=H.s(r+".discard.selectable");return q==S?H.s("all.discard.selectable"):q},getFaceUv:function(T,$){return T.s($+".uv")||T.s("all.uv")},getFaceUvOffset:function(J,_){return J.s(_+".uv.offset")||J.s("all.uv.offset")},getFaceUvScale:function(A,b){return A.s(b+".uv.scale")||A.s("all.uv.scale")},getFaceLight:function(n,j){var X=n.s(j+".light");return X==S?n.s("all.light"):X},getFaceVisible:function(D,m){var N=D.s(m+".visible");return N==S?D.s("all.visible"):N},getFaceOpacity:function(f,U){var X=f.s(U+".opacity");return X==S?f.s("all.opacity"):X},getFaceTransparent:function(g,f){var Q=g.s(f+".transparent");return Q==S?g.s("all.transparent"):Q},getFaceReverseColor:function(n,U){return n.s(U+".reverse.color")||n.s("all.reverse.color")},getFaceReverseFlip:function(m,J){var O=m.s(J+".reverse.flip");return O==S?m.s("all.reverse.flip"):O},getFaceReverseCull:function(n,f){var r=n.s(f+".reverse.cull");return r==S?n.s("all.reverse.cull"):r},getTextureMap:function(){return this._2O},deleteTexture:function(U){var o=this,L=o._2O[U];L&&(delete o._2O[U],o.getGL().deleteTexture(L))},invalidateShape3dCachedImage:function(D){var R=this.getData3dUI(D);R.invalidateCachedTexture(this.getGL())},isInteractive:function(h){return h.s("interactive")},getTexture:function(F,Z){if(!F)return S;var E=this,l=E.getGL(),D=E._2O[F];if(!D){var p=Oi(F);if(!p)return l._emptyTexture;if(p.uuid||(p.uuid=W.Math.generateUUID()),p.tagName){if(p.dynamic)return xb(l,p,E._1O);D=E._2O[F]=xb(l,p)}else{var u,R=Z&&Z.s("shape3d.image.cache")&&!E.isInteractive(Z),a=E.vr.isPresenting();if(a&&(Z._textureUpdateFrame===l._renderInfo.frame?R=!0:Z._textureUpdateFrame=l._renderInfo.frame),R&&(u=E.getData3dUI(Z),D=u.getCachedTexture()),!D){if(R){if(l._renderInfo.cacheTimeCost>X.graph3dMaxVectorCacheTime)return E.redraw(),l._emptyTexture;if(!Oe(p,Z))return l._emptyTexture}var P,x=Z&&Z.s("shape3d.fixSizeOnScreen"),V=x?l.NEAREST:l.LINEAR;x||Z&&Z.s("shape3d.vector.dynamic")&&(u||(u=E.getData3dUI(Z)),x=u.getVectorDynamicSize(),x&&(P=E.getDevicePixelRatio(),x[0]*=P,x[1]*=P));var Q,z,Y=Z&&Z.s("shape3d.texture.scale")||1;if(x?(P||(P=E.getDevicePixelRatio()),Q=x[0]>0?x[0]:Y*xq(p,Z)*P,z=x[1]>0?x[1]:Y*ze(p,Z)*P):(Q=Y*xq(p,Z),z=Y*ze(p,Z)),Q>=1&&z>=1){var N=0;R&&(N=Date.now());var A=eg(Q,z);if(!u&&Z&&(u=E.getData3dUI(Z)),u&&u.interactiveInfo){var $=F;"object"==typeof $&&($=$.uuid||($.uuid=W.Math.generateUUID()));var g=u.interactiveInfo[$]={};A.interactiveInfo=g.bodyInfo={compInfos:[],matrix:new We,rect:{x:0,y:0,width:Q,height:z}}}rl(A,p,0,0,Q,z,Z,E),A.interactiveInfo&&(A.interactiveInfo=null),A.restore(),R||a?(D=xb(l,wr,null,V),u.setCachedTexture(D),l._renderInfo.cacheTimeCost+=Date.now()-N,wr=null):D=xb(l,wr,E._1O,V)}}}}return D},redraw:function(){this.iv()},validateImpl:function(){var X=this;if(X._lightChanged){X._lightChanged=!1;var R=[],$=[],L=[];X.dm().each(function(f){if(Hf(f)){var j=f.s("light.type");j===kn?R.push(f):j===zl?$.push(f):j===df&&L.push(f)}}),(R.length!==X._59O.length||$.length!==X._spots.length||L.length!==X._dirs.length)&&te(X),X._59O=R,X._spots=$,X._dirs=L}X._42(),X._1o.iv()},getRenderInfo:function(){var $=this.getGL();return $?$._renderInfo:void 0},getDebugTip:function(){var S=this,X=S.getRenderInfo();if(X){var B=S.getGL()._validBufCount||0,Y="Draw Calls: "+X.calls+"<br/>"+"Vertices: "+X.vertices+"<br/>"+"Faces: "+X.faces+"<br/>"+"Lines: "+X.lines+"<br/>"+"Buffer Count: "+B;return S.vr.isPresenting()&&(Y+="<br/>VR fps: "+S.vr.getFps()),Y}},_42:function(_,G){var P=this;if(!P._35O&&(!_i||Gg(_i))){var t,F;_&&(_ instanceof Uh?F=_:t=_);var a=P._canvas,y=P.getGL(),k=P._prg;if(y){var m=P.getWidth(),x=P.getHeight();if(m&&x){G?_||fp(a,m,x,G):(G=P.getDevicePixelRatio(),_||m===a.clientWidth&&x===a.clientHeight||(fp(a,m,x,G),m&&y.drawingBufferWidth!==m*G&&(P.setDevicePixelRatio(G=y.drawingBufferWidth/m),fp(a,m,x,G)))),y.clear(y.COLOR_BUFFER_BIT),P.drawFilter||(y._renderInfo={calls:0,vertices:0,faces:0,lines:0,frame:_?P._frameId:++P._frameId,cacheTimeCost:0});var B,Y=this._cameras,s=0,Q=Y.length,N=!1,O=W.Default.cameraPriority.skybox,j=W.Default.cameraPriority.main,v=W.Default.cameraPriority.top,I=m*G,R=x*G,n=function(){P.overlappingBox.clear(),P._81O=S,y.clear(y.DEPTH_BUFFER_BIT),y._picking=!!_;var b={_picking:!!_,_envmapReflectivity:P._envmapReflectivity||.5,_projectMatrix:P._projectMatrix=Yq(P),_viewMatrix:Id(P,P._7O)};if(P._viewMatrix=Dj(P._7O),F){Yr(y,P,k,b);var d=y.getParameter(y.COLOR_CLEAR_VALUE);y.clearColor(0,0,0,0),y.disable(y.BLEND),Kp(y,k.aNormal),Gd(y,P._cube.vs,S,k.aPosition),Uo(y,P._cube.is),Ji(F,P,zc,0),Ji(F,P,Cn,6),Ji(F,P,br,12),Ji(F,P,cp,18),Ji(F,P,Dc,24),Ji(F,P,fd,30),so(y,k.aNormal),Sl(y,d)}else if(t){for(t.value=2;Q>s;s++)if(B=Y[s],!B.ignoreInPick){if(B.priority>=j)break;B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P,t)}Yr(y,P,k,b);var d=y.getParameter(y.COLOR_CLEAR_VALUE);for(y.clearColor(0,0,0,0),y.disable(y.BLEND),P._95I(y,k,t),Wp(P,t),Wf(P,P._polylineModelMap,t),Wf(P,P._wireframeModelMap,t),Wj(y,k.uTransparent,!0),P._95I(y,k,t,!0),Wp(P,t,!0),Wf(P,P._polylineModelMap,t,!0),Wf(P,P._wireframeModelMap,t,!0),Wj(y,k.uTransparent,!1);Q>s;s++)if(B=Y[s],!B.ignoreInPick){if(B.priority>=v)break;B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P,t),N=!0}for(N&&(Yr(y,P,k,b),N=!1),y.clear(y.DEPTH_BUFFER_BIT),P._swapLineMap(),P._95I(y,k,t,!1,!0),Wf(P,P._polylineModelMap,t),Wf(P,P._wireframeModelMap,t),P._swapLineMap(),P._swapLineMap(),P._95I(y,k,t,!1,!0),Wf(P,P._polylineModelMap,t),Wf(P,P._wireframeModelMap,t),Wj(y,k.uTransparent,!0),P._95I(y,k,t,!0,!0),Wf(P,P._polylineModelMap,t,!0),Wf(P,P._wireframeModelMap,t,!0),Wj(y,k.uTransparent,!1),P._swapLineMap(),y.disable(y.DEPTH_TEST),P.drawFilter||P._30O._42(y,k,t),y.enable(y.DEPTH_TEST);Q>s;s++)B=Y[s],B.ignoreInPick||(B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P,t));Sl(y,d)}else{for(;Q>s&&(B=Y[s],!(B.priority>=O));s++)B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P);for(Yr(y,P,k,b),y.disable(y.BLEND),P.drawSky(y,k),P.drawReflectors(y,I,R,n,_)&&(b._projectMatrix=P._projectMatrix=Yq(P),b._viewMatrix=Id(P,P._7O),P._viewMatrix=Dj(P._7O),Yr(y,P,k,b));Q>s&&(B=Y[s],!(B.priority>=j));s++)B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P),N=!0;for(N&&(Yr(y,P,k,b),N=!1),P._31O._42(y,k),P._95I(y,k),Wp(P),Wf(P,P._polylineModelMap),Wf(P,P._wireframeModelMap),y.enable(y.BLEND),y.depthMask(!1),Wj(y,k.uTransparent,!0),P._95I(y,k,S,!0),Wp(P,S,!0),Wf(P,P._polylineModelMap,S,!0),Wf(P,P._wireframeModelMap,S,!0),y.depthMask(!0),Wj(y,k.uTransparent,!1);Q>s&&(B=Y[s],!(B.priority>=v));s++)B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P),N=!0;for(N&&(Yr(y,P,k,b),N=!1),y.clear(y.DEPTH_BUFFER_BIT),P._swapLineMap(),y.disable(y.BLEND),P._95I(y,k,S,!1,!0),Wf(P,P._polylineModelMap),Wf(P,P._wireframeModelMap),y.enable(y.BLEND),Wj(y,k.uTransparent,!0),y.depthMask(!1),P._95I(y,k,S,!0,!0),Wf(P,P._polylineModelMap,S,!0),Wf(P,P._wireframeModelMap,S,!0),y.depthMask(!0),Wj(y,k.uTransparent,!1),P._swapLineMap(),y.disable(y.DEPTH_TEST),y.disable(y.BLEND),P._32O._42(y,k),P._30O._42(y,k),P._highlightHelper._42(y,k),y.enable(y.DEPTH_TEST);Q>s;s++)B=Y[s],B.useDefaultProgram&&Yr(y,P,k,b),B.render(y,P)}Gd(y,S),Uo(y,S)},h=!1,E=P.vr;E.enable&&E._42(y,I,R,n)&&(h=!0);var K=P.envRenderer;K&&K.enable&&K._42(y,I,R,n)&&(h=!0);var X=P._postProcessing;X._42(y,I,R,n,_)&&(h=!0),h||(P.setViewport(y,0,0,m*G,x*G),n()),P._33Q=!1,P.drawFilter||P.countFrame(),P._doBufferGC(y)}}}},drawReflectors:function(K,H,n,F,U){var A,a,m,k=this,w=k._dataModel.getReflectors(),G=!1;for(A in w)a=w[A],k.isVisible(a)&&(m=k.getData3dUI(a),m&&m.drawReflector(K,H,n,F,U)&&(G=!0));return G},enablePostProcessing:function(H,m){return this._postProcessing.enableModule(H,m)},getPostProcessingModule:function(i){return this._postProcessing.getModule(i)},setViewport:function(z,W,X,k,o){this._viewport=[W,X,k,o],z.viewport(W,X,k,o)},getViewport:function(){return this._viewport},setBufferGCInterval:function(C){this._bufferGCInterval=C},_doBufferGC:function(m,c){var Y,U,y=m._bufPool,D=0,T=0,R=m._renderInfo.frame,Q=this._bufferGCInterval||10;for(Y in y)D++,U=y[Y],U&&(c||R-U._fid>Q?(m.deleteBuffer(U._buf),U._buf=null,y[Y]=null):T++);if(D/2>T&&D>128){var A={};for(Y in y)y[Y]&&(A[Y]=y[Y]);m._bufPool=A}m._validBufCount=T},_swapLineMap:function(){var k=this;$i=k._polylineModelMap,k._polylineModelMap=k._polylineModelMapSwap,k._polylineModelMapSwap=$i,$i=k._wireframeModelMap,k._wireframeModelMap=k._wireframeModelMapSwap,k._wireframeModelMapSwap=$i,$i=k._polylineIndexMap,k._polylineIndexMap=k._polylineIndexMapSwap,k._polylineIndexMapSwap=$i,$i=k._wireframeIndexMap,k._wireframeIndexMap=k._wireframeIndexMapSwap,k._wireframeIndexMapSwap=$i},_updateSkyBox:function(o){if(this._skyBox&&o){var n=o.property,Q=!1,H=this._skyBox;if("eye"===n||"forceUpdate"===n){var O=this._eye;H.p3(O[0],O[1],O[2]),Q=!0}if("near"===n||"far"===n||"forceUpdate"===n){var X=this._near,I=this._far,m=H.getFinalScale3d();if(m[0]/=2,m[1]/=2,m[2]/=2,m[0]<=X||m[0]>=I||m[1]<=X||m[1]>=I||m[2]<=X||m[2]>=I){var l=2*X*I/(X+I),Z=Math.min(m[0],m[1],m[2]),z=l/Z,f=H.getScale3d();H.setScale3d(f[0]*z,f[1]*z,f[2]*z),Q=!0}}Q&&this.invalidateData(H)}},getSkyBox:function(){return this._skyBox},setSkyBox:function(g){var j=this._skyBox;j&&(this._skyBoxStyleMap&&j.setStyleMap(this._skyBoxStyleMap),this._skyBoxStyleMap=null,this._skyBoxAnchor3d&&j.setAnchor3d(this._skyBoxAnchor3d),this._skyBoxAnchor3d=null,this._skyBoxP3&&j.p3(this._skyBoxP3),this._skyBoxP3=null),this._skyBox=g,this.ump(this._updateSkyBox,this),g&&(g.dm()&&g.dm().remove(g),this._skyBoxStyleMap=W.Default.clone(g.getStyleMap()),this._skyBoxAnchor3d=g.getAnchor3d(),g.setAnchor3d(.5,.5,.5),this._skyBoxP3=g.p3().slice(0),g.s({"shape3d.reverse.flip":!0,"shape3d.reverse.cull":!1,"all.reverse.flip":!0,"all.reverse.cull":!1,"front.reverse.flip":!0,"front.reverse.cull":!1,"back.reverse.flip":!0,"back.reverse.cull":!1,"left.reverse.flip":!0,"left.reverse.cull":!1,"right.reverse.flip":!0,"right.reverse.cull":!1,"top.reverse.flip":!0,"top.reverse.cull":!1,"bottom.reverse.flip":!0,"bottom.reverse.cull":!1}),this.mp(this._updateSkyBox,this),this._updateSkyBox({property:"forceUpdate"})),this.fp("skyBox",j,g)},drawSky:function(S,H,y){var U=this,u=U._skyBox;if(u){var M=U._headlightIntensity,C=jb(U._headlightColor),H=U._prg;1!==M&&(C=[C[0]*M,C[1]*M,C[2]*M]),Wj(S,H.uHeadlightColor,[C[0],C[1],C[2],1]);var e=U.getData3dUI(u);if(e){var Q,R=U.isOrtho(),n=R||this._computedProjectMatrix;n&&(Q=U._projectMatrix,R&&(U._ortho=!1),Wj(S,H.uPMatrix,U._projectMatrix=Yq(U,!0)));var m=u.p3(),f=this._eye;(m[0]!==f[0]||m[1]!==f[1]||m[2]!==f[2])&&(u._position.x=f[0],u._54O=f[1],u._position.y=f[2]),e._42(S,H,y,function(){return!0}),n&&(R&&(U._ortho=!0),Wj(S,H.uPMatrix,U._projectMatrix=Q))}S.clear(S.DEPTH_BUFFER_BIT),Wj(S,H.uHeadlightColor,[C[0],C[1],C[2],U._headlightDisabled?1:0])}},_95I:function(Z,S,E,K,G){function M(D){if(!!D.s("shape3d.alwaysOnTop")==!!G&&w.isVisible(D)&&(!b||a)){if(!E&&w.isTransparentMask(D))return;var y=w.getData3dUI(D);y&&y._42(Z,S,E,i)}}var w=this,i=function(_){return K?_:!_};w.sky&&Z.clear(Z.DEPTH_BUFFER_BIT);var m=w.drawFilter;m?w.dm().each(function(G){m(G)||M(G)}):w.dm().each(function($){M($)})},getLogicalPoint:function(E){return we(E,this._canvas)},isRectOverlapping:function(P){var M=this.getData3dUI(P);return M._rectOverlapping},getHitFaceInfo:function(v){v.target&&(v=this.lp(v));var $=this.getDataInfoAt(v);if($){var O=this._1o.face($.data,Ql(v.x,v.y));if(O)return{data:$.data,face:O}}return S},unproject:function(I,D){var h=this,z=h.getWidth(),v=h.getHeight(),E=I.target?h.lp(I):I,M=E.x-z/2,K=E.y-v/2,y=2*(M/z),q=2*(-1*K/v);D=D||0;var k=Xc(),B=Yq(h),F=Id(h);Ke(k,B,F),Rg(k);var O=Vp([y,q,D,1],k);return[O[0]/O[3],O[1]/O[3],O[2]/O[3]]},getDataAt:function(z){var B=this.getDataInfoAt(z);return B?B.data:S},getDataInfoAt:function(_,j){return _.target&&(_=this.lp(_)),this._1o.get(Ql(_.x,_.y,j),!0)},getDatasInRect:function(I){return this._1o.get(I)},setEditable:function(Q){var P=this,K=P._editable;P._editable=Q,this.fp(Kg,K,Q)},isEditable:function(h){var I=this;return I._editable?zm(h)?h.s("3d.editable")?I._editableFunc?I._editableFunc(h):!0:!1:!1:!1},isSelectable:function(n){return n.s("3d.selectable")&&this.sm().isSelectable(n)},isMovable:function(I){var z=this;return Pe(I)&&I.getStyle(ug)!==xe?!1:I.s("3d.movable")?z._movableFunc?z._movableFunc(I):!0:!1},isSizeEditable:function(w){return zm(w)?this._sizeEditableFunc?this._sizeEditableFunc(w):!0:!1},isRotationEditable:function(V){return zm(V)&&V.IRotatable!==!1?this._rotationEditableFunc?this._rotationEditableFunc(V):!0:!1},handleDelete:function(){this._editable&&this.removeSelection()},zoomIn:function(I){this.setZoom(ds,I)},zoomOut:function(Y){this.setZoom(1/ds,Y)},setZoom:function(M,W){if(1!==M){var X=this;if(X._ortho)return X.setOrthoZoom(M,W),void 0;
X._14o&&X._14o.stop(!0);var $=1/M,D=X._eye,G=X._center,Z=G[0]+(D[0]-G[0])*$-D[0],_=G[1]+(D[1]-G[1])*$-D[1],k=G[2]+(D[2]-G[2])*$-D[2];if(!(zq(D,G)<X._moveStep&&1>$)){if(W=tm(W)){var b=or(D);return W.action=function(d){X.fi({kind:X._zooming?"betweenZoom":"beginZoom"}),X._zooming=1,D[0]=b[0]+Z*d,D[1]=b[1]+_*d,D[2]=b[2]+k*d,X.fp(Qp,S,D)},W._37o=function(){delete X._14o,delete X._zooming,X.fi({kind:"endZoom"}),X.onZoomEnded()},X._14o=jn(W)}D[0]+=Z,D[1]+=_,D[2]+=k,X.fp(Qp,S,D)}}},setOrthoZoom:function(f,z){if(1!==f){var t=this;t._14o&&t._14o.stop(!0);var k=t._orthoWidth,F=k/f-k;if(!(k<t._moveStep&&f>1))return(z=tm(z))?(z.action=function(B){t.fi({kind:t._zooming?"betweenZoom":"beginZoom"}),t._zooming=1,t.setOrthoWidth(k+F*B)},z._37o=function(){delete t._14o,delete t._zooming,t.fi({kind:"endZoom"}),t.onZoomEnded()},t._14o=jn(z)):(t.setOrthoWidth(k/f),void 0)}},getPositionInfo:function(x){var d=this,B=d._eye,R=d._center,p=d.getAspect(),o=x?Od($b(R,B,!0),$b(x,B)):zq(B,R);if(d._ortho){var j=d._orthoWidth;return{length:o,height:j/p,width:j}}var a=2*O(d._fovy/2)*o;return{length:o,height:a,width:a*p}},getCenterInfo:function(){var g=this;return g._81O||(g._81O=g.getPositionInfo()),or(g._81O)},rotate:function(X,i,O,A){var R=this;if(X||i){A==S&&(A=R._firstPersonMode),R._88O&&R._88O.stop(!0);var u=R._center,q=R._eye,T=R.getCenterInfo().length,p=A?u:q,Z=A?q:u,m=$b(p,Z),t=N(m[0],m[2]),Y=N(_(m[0]*m[0]+m[2]*m[2]),m[1]),v=A?Sb:Qp;return A&&(i=-i),(O=tm(O))?(O.action=function(P){R.fi({kind:R._rotating?"betweenRotate":"beginRotate"}),R._rotating=1;var W=t+X*P,G=Y+i*P;G=Wd(G),m[0]=T*L(G)*L(W),m[1]=T*k(G),m[2]=T*L(G)*k(W),p[0]=Z[0]+m[0],p[1]=Z[1]+m[1],p[2]=Z[2]+m[2],R.fp(v,S,p)},O._37o=function(){delete R._88O,delete R._rotating,R.fi({kind:"endRotate"}),R.onRotateEnded()},R._88O=jn(O)):(t+=X,Y+=i,Y=Wd(Y),m[0]=T*L(Y)*L(t),m[1]=T*k(Y),m[2]=T*L(Y)*k(t),p[0]=Z[0]+m[0],p[1]=Z[1]+m[1],p[2]=Z[2]+m[2],R.fp(v,S,p),void 0)}},pan:function(V,Q,I,Z){if(V||Q){var x=this;Z==S&&(Z=x._firstPersonMode),x._89O&&x._89O.stop(!0);var J=Id(x),T=[J[0]*V,J[4]*V,J[8]*V],L=[J[1]*Q,J[5]*Q,J[9]*Q],C=T[0]+L[0],v=T[1]+L[1],g=T[2]+L[2],o=x._center,c=x._eye;if(Z){var j=Lo(x.getBoundaries(),c[0],c[2],c[0]+C,c[2]+g,_(C*C+g*g));C=j[0],g=j[1]}if(I=tm(I)){var F=or(c),r=or(o);return I.action=function(p){x.fi({kind:x._panning?"betweenPan":"beginPan"}),x._panning=1,o[0]=r[0]+C*p,o[1]=r[1]+v*p,o[2]=r[2]+g*p,c[0]=F[0]+C*p,c[1]=F[1]+v*p,c[2]=F[2]+g*p,x.fp(Qp,S,c),x.fp(Sb,S,o)},I._37o=function(){delete x._89O,delete x._panning,x.fi({kind:"endPan"}),x.onPanEnded()},x._89O=jn(I)}o[0]+=C,o[1]+=v,o[2]+=g,c[0]+=C,c[1]+=v,c[2]+=g,x.fp(Qp,S,c),x.fp(Sb,S,o)}},walk:function(f,t,n){if(f){var m=this;n==S&&(n=m._firstPersonMode),m._90O&&m._90O.stop(!0);var R=m._center,a=m._eye,C=$b(R,a,!0);if(n){var F=Lo(m.getBoundaries(),a[0],a[2],a[0]+C[0]*f,a[2]+C[2]*f,M(f));if(f=zq(F),!f)return;C=[F[0]/f,0,F[1]/f]}if(t=tm(t)){var p=or(a),h=or(R);return t.action=function(E){m.fi({kind:m._walking?"betweenWalk":"beginWalk"}),m._walking=1;var $=f*E;a[0]=p[0]+C[0]*$,a[1]=p[1]+C[1]*$,a[2]=p[2]+C[2]*$,R[0]=h[0]+C[0]*$,R[1]=h[1]+C[1]*$,R[2]=h[2]+C[2]*$,m.fp(Qp,S,a),m.fp(Sb,S,R)},t._37o=function(){delete m._90O,delete m._walking,m.fi({kind:"endWalk"}),m.onWalkEnded()},m._90O=jn(t)}a[0]+=C[0]*f,a[1]+=C[1]*f,a[2]+=C[2]*f,R[0]+=C[0]*f,R[1]+=C[1]*f,R[2]+=C[2]*f,m.fp(Qp,S,a),m.fp(Sb,S,R)}},handleScroll:function(r,v){r.preventDefault();var F=this,X=F._moveStep,j=F.getDataInfoAt(r);if(j){var Z=j.data;if(Z&&F.isInteractive(Z)){var G=F.intersectObject(r,Z);if(G){var x=G.part,C=Oi(Z.s(x+".image")||Z.s("shape3d."+x+".image")||Z.s("all.image")||Z.s("shape3d.image"));if(C&&lp(C.scrollable,Z,F))return}}}F.isFirstPersonMode()?F.isPannable()&&F.pan(0,v>0?X:-X):F.isZoomable()&&F.setZoom(0>v?1/Le:Le)},handlePinch:function(T,N){this.isZoomable()&&this.setZoom(N>T?1/dj:dj)},reset:function(){this.setCenter(X.graph3dViewCenter),this.setEye(X.graph3dViewEye),this.setUp(X.graph3dViewUp)},moveSelection:function(U,p,o){var A=this;A.dm().beginTransaction(),Bc(this.sm().toSelection(this.isMovable,this),U,p,o),A.dm().endTransaction()},getMoveMode:function(i,f){var B=f.s("3d.move.mode");if(B)return B;var C="88",e="89",g="90";return Pn(i)||hc[C]&&hc[e]&&hc[g]?"xyz":hc[C]&&hc[e]?"xy":hc[C]&&hc[g]?"xz":hc[e]&&hc[g]?"yz":hc[C]?"x":hc[e]?"y":hc[g]?"z":"xz"},handleTick:function(){var Y=this,T=!1,E=Y._moveStep,o=E,k=!1,I=!0,U=Y._rotateStep*(I?-1:1);if(Y.isWalkable()||(o=0),Y.isPannable()||(E=0),Y.isRotatable()||(U=0),Y._32Q){var h=(Pb()-Y._32Q)/50;o*=h,E*=h,U*=h}Y._31Q&&(Wc(Y._31Q),delete Y._31Q,delete Y._32Q),zi()&&(T=!0,Y.pan(-E,0,k,I)),se()&&(T=!0,Y.pan(E,0,k,I)),os()&&(T=!0,Pn()?Y.pan(0,E,k,I):Y.walk(o,k,I)),Ki()&&(T=!0,Pn()?Y.pan(0,-E,k,I):Y.walk(-o,k,I)),ak()&&(T=!0,Y.rotate(-U,0,k,I)),vj()&&(T=!0,Y.rotate(U,0,k,I)),Zh()&&(T=!0,Y.rotate(0,-U/2,k,I)),ff()&&(T=!0,Y.rotate(0,U/2,k,I)),T&&(Y._32Q=Pb(),Y._31Q=dk(Y.handleTick,Y))},handleKeyDown:function(L){var p=this;!nl(L)&&sf[L.keyCode]?p.handleTick():sr(L)?p.selectAll():bg(L)?p.handleDelete(L):Aq(L)&&this.isResettable()&&p.reset()},checkDoubleClickOnNote:function(b,K,n){var F=this;if(n===he){if(K.s("note.toggleable"))return K.s(_j,!K.s(_j)),F.fi({kind:"toggleNote",event:b,data:K,part:n}),!0}else if(n===Vb&&K.s("note2.toggleable"))return K.s(gj,!K.s(gj)),F.fi({kind:"toggleNote2",event:b,data:K,part:n}),!0;return!1},checkDoubleClickOnRotation:function(t,g,G){return G===yq?(g.setRotationX(0),!0):G===rd?(g.setRotationY(0),!0):G===Dn?(g.setRotationZ(0),!0):!1},onRotateEnded:function(){},onWalkEnded:function(){},getViewRatio:function(d){var y=this;if(y.isOrtho())return y.getWidth()/y.getOrthoWidth();var G=y.getCenter(),l=y.getHeight(),$=y.getEye(),m=[G[0]-$[0],G[1]-$[1],G[2]-$[2]],X=[d[0]-$[0],d[1]-$[1],d[2]-$[2]],r=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),A=1/Math.tan(y.getFovy()/2);return l*r*A/(X[0]*m[0]+X[1]*m[1]+X[2]*m[2])},inViewSpace:function(_){var F,S=this,o=S._transformPointToViewSpace(_),v=S.getAspect(),l=S.getNear(),Y=S.getFar();return-o[2]<l||-o[2]>Y?!1:S.isOrtho()?(F=S.getOrthoWidth()/2,Math.abs(o[0])<=F&&Math.abs(o[1]*v)<=F):(F=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2])*Math.tan(S.getFovy()/2),Math.abs(o[1]<=F)&&Math.abs(o[0])<=F*v)},getPVMatrix:function(){var t=this,K=t.getWidth()/2,i=t.getHeight()/2,o=t._18Q;return o&&o._wh===K/i||(o=Yq(t),t._18Q=Ke(o,o,Id(t)),t._18Q._wh=K/i),o},getFrustum:function(){var Q=new Fl,Z=new rn,f=new Array(16);return function(){for(var z=this.getPVMatrix(),O=!1,I=0;16>I;I++)z[I]!==f[I]&&(O=!0,f[I]=z[I]);return O&&Z.setFromMatrix(Q.fromArray(z)),Z}}(),toViewPosition:function(n){var J=this,a=J.getWidth()/2,i=J.getHeight()/2,c=J.getPVMatrix();return n=Vp([n[0],n[1],n[2],1],c),{x:a+a*n[0]/n[3],y:i-i*n[1]/n[3],z:n[2]/n[3]}},getHitPosition:function(S,m,J){var $=this,P=$.getWidth(),H=$.getHeight(),O=S.target?$.lp(S):S,V=O.x-P/2,B=O.y-H/2,h=$.getCenterInfo(),u=Id($);m=m?m:[0,0,0],J=J?J:[0,1,0],V=V/P*h.width,B=-1*B/H*h.height;var K=[u[0]*V,u[4]*V,u[8]*V],A=[u[1]*B,u[5]*B,u[9]*B],E=[K[0]+A[0],K[1]+A[1],K[2]+A[2]],f=$.getCenter(),N=zs($,m,J,[E[0]+f[0],E[1]+f[1],E[2]+f[2]]);return N?N:[0,0,0]},intersectObject:function(p,V){return this._raycaster.intersectObject(p,V)},intersectObjects:function(w,H,R){return this._raycaster.intersectObjects(w,H,R)},getLineLength:function(I){this.validate();var M=this.getData3dUI(I);if(M&&M.getCache){var a=M.getCache();if(a)return a[a.length-1].length}return 0},getLineOffset:function(j,y){var $=this.getData3dUI(j);if($&&$.getCache){var d=$.getCache();if(d){var x=Sk(d,y),r=j.r3();if(0===r[0]&&0===r[1]&&0===r[2])return x;var m=new Ob(j.p3()),K=new Ob(x.point).sub(m),f=new Ob(x.tangent).add(K),u=(new Tg).setFromEuler(new pi(r,j.getRotationMode(),!0));return K.applyQuaternion(u),f.applyQuaternion(u),{point:K.add(m),tangent:f.sub(K).normalize()}}}return S},isLabelVisible:function(){return!0},isNoteVisible:function(){return!0},moveCamera:function(P,F,D){var o=this,y=o.getEye();y=[y[0],y[1],y[2]];var r=o.getCenter();if(r=[r[0],r[1],r[2]],P||(P=y),F||(F=r),o._flyAnim&&o._flyAnim.stop(!0),D=tm(D),!D)return o.setEye(P[0],P[1],P[2]),o.setCenter(F[0],F[1],F[2]),delete o._flyAnim,!0;var Q=[P[0]-y[0],P[1]-y[1],P[2]-y[2]],G=[F[0]-r[0],F[1]-r[1],F[2]-r[2]];return D.action=function(D){o.setCenter(r[0]+G[0]*D,r[1]+G[1]*D,r[2]+G[2]*D),o.setEye(y[0]+Q[0]*D,y[1]+Q[1]*D,y[2]+Q[2]*D)},D._37o=function(){delete o._flyAnim},o._flyAnim=jn(D)},flyTo:function(){function M(D,i,y){if(y instanceof W.Node){T.fromArray(Gn(y,i.getMat(y)));var Q=y.getAnchor3d();D.push((new Ob).set(0-Q.x,0-Q.y,0-Q.z).applyMatrix4(T)),D.push((new Ob).set(0-Q.x,0-Q.y,1-Q.z).applyMatrix4(T)),D.push((new Ob).set(0-Q.x,1-Q.y,0-Q.z).applyMatrix4(T)),D.push((new Ob).set(0-Q.x,1-Q.y,1-Q.z).applyMatrix4(T)),D.push((new Ob).set(1-Q.x,0-Q.y,0-Q.z).applyMatrix4(T)),D.push((new Ob).set(1-Q.x,0-Q.y,1-Q.z).applyMatrix4(T)),D.push((new Ob).set(1-Q.x,1-Q.y,0-Q.z).applyMatrix4(T)),D.push((new Ob).set(1-Q.x,1-Q.y,1-Q.z).applyMatrix4(T))}}var r=new Ob,x=new Ob,$=new Ob,j=new Ob,T=new Fl,n=new W.Math.Quaternion,R=new pi;return function(N,s,z){var T=this;if(z!==d)s={animation:s,ratio:z};else{var Y=typeof s;("boolean"===Y||"object"===Y&&s.duration)&&(s={animation:s})}s=s||{},r.fromArray(T.getEye()),x.fromArray(T.getCenter());var c,H,Z=[],J=s.center,w=s.distance===d;if(J&&$.fromArray(J),N instanceof W.Node)J||$.fromArray(N.p3()),w&&(M(Z,T,N),c=Z.length);else{if(N||(N=T.dm().getDatas()),!N.length)return;if((w||!J)&&(Z=[],N.forEach(function(P){M(Z,T,P)}),c=Z.length,!c))return;if(!J){for($.set(0,0,0),H=0;c>H;H++)$.add(Z[H]);$.multiplyScalar(1/c)}}if(T.setCenter($.x,$.y,$.z),j.subVectors(r,x),s.direction||s.worldDirection){!s.worldDirection&&N instanceof W.Node?n.setFromEuler(R.set(N.r3(),N.getRotationMode(),!0)):n.set(0,0,0,1);var E=j.length();j.fromArray(s.worldDirection||s.direction).applyQuaternion(n).setLength(E)}var b=0;if(w){var S,O,K,z=s.ratio||.8,G=s.xRatio||z,U=s.yRatio||z;if(T.isOrtho()){var f=-1/0;for(T._eye[0]=j.x+$.x,T._eye[1]=j.y+$.y,T._eye[2]=j.z+$.z,S=Yq(T),Ke(S,S,Id(T)),H=0;c>H;H++)K=Z[H],O=Vp([K.x,K.y,K.z,1],S),f=Math.max(f,Math.max(Math.abs(O[0])/G,Math.abs(O[1])/U));b=T.getOrthoWidth()*f,j.add($)}else{for(var m,t,P=T.getNear(),V=10;V--;){for(T._eye[0]=j.x+$.x,T._eye[1]=j.y+$.y,T._eye[2]=j.z+$.z,S=Yq(T),Ke(S,S,Id(T)),m=!0,t=-1/0,H=0;c>H;H++){if(K=Z[H],O=Vp([K.x,K.y,K.z,1],S),O[3]<P&&V){j.multiplyScalar(2),m=!1;break}t=Math.max(t,Math.max(Math.abs(O[0])/G,Math.abs(O[1])/U)-O[3])}if(m)break}j.setLength(t+j.length()).add($)}}else j.setLength(s.distance).add($);T._flyAnim&&T._flyAnim.stop(!0);var v=tm(s.animation);if(v){T.setEye(r.x,r.y,r.z),T.setCenter(x.x,x.y,x.z);var L=(new Ob).subVectors(j,r),_=(new Ob).subVectors($,x);if(b)var y=T.getOrthoWidth();var Q=new Ob,h=new Ob,C=v.action,l=v._37o;return v.action=function(F,p){Q.copy(r).addScaledVector(L,F),h.copy(x).addScaledVector(_,F),T.setCenter(h.x,h.y,h.z),T.setEye(Q.x,Q.y,Q.z),b&&T.setOrthoWidth((b-y)*F+y),C&&C(F,p)},v._37o=function(){delete T._flyAnim,l&&l()},{lastEye:r,lastCenter:x,eye:j,center:$,orthoWidth:b,animation:T._flyAnim=jn(v)}}return T.setEye(j.x,j.y,j.z),b&&T.setOrthoWidth(b),delete T._flyAnim,{lastEye:r,lastCenter:x,eye:j,center:$,orthoWidth:b}}}(),getBoundingBox:function(){function Q(z,X,c){O.fromArray(Gn(c,X.getMat(c)));var h=c.getAnchor3d();z.push((new Ob).set(0-h.x,0-h.y,0-h.z).applyMatrix4(O)),z.push((new Ob).set(0-h.x,0-h.y,1-h.z).applyMatrix4(O)),z.push((new Ob).set(0-h.x,1-h.y,0-h.z).applyMatrix4(O)),z.push((new Ob).set(0-h.x,1-h.y,1-h.z).applyMatrix4(O)),z.push((new Ob).set(1-h.x,0-h.y,0-h.z).applyMatrix4(O)),z.push((new Ob).set(1-h.x,0-h.y,1-h.z).applyMatrix4(O)),z.push((new Ob).set(1-h.x,1-h.y,0-h.z).applyMatrix4(O)),z.push((new Ob).set(1-h.x,1-h.y,1-h.z).applyMatrix4(O))}var O=new Fl;return function(D){if(D=D||this.sm().getSelection(),D instanceof W.Node&&(D=[D]),0===D.length)return S;var g=[];D.forEach(function(B){Q(g,this,B)},this);var v=[1/0,1/0,1/0],k=[-1/0,-1/0,-1/0];return g.forEach(function(h){v[0]=Math.min(h.x,v[0]),v[1]=Math.min(h.y,v[1]),v[2]=Math.min(h.z,v[2]),k[0]=Math.max(h.x,k[0]),k[1]=Math.max(h.y,k[1]),k[2]=Math.max(h.z,k[2])}),{min:v,max:k}}}()}),Er.RenderEnv=function(m){this.gv=m,this.enable=!1},G.defineProperties(Er.RenderEnv.prototype,{debugOn:{get:function(){return this._debugOn},set:function(Z){this._debugOn=Z,this.capture&&this.capture()}}}),G.assign(Er.RenderEnv.prototype,{renderEnvToCube:function(Z,s,f,W){var K=this,l=K.gv;if(!Z||!s||!f)return K.enable=!1,K._42=null,void 0;K.enable=!0;var M=Math.floor(W/Z*s),z=l.getGL(),H=K._renderTargets;H?H.length<f&&(H=K._renderTargets=H.concat(new Array(f-H.length))):H=K._renderTargets=new Array(f);for(var g=0;f>g;g++)H[g]?H[g].setSize(z,W,M):H[g]=new Er.RenderTarget(l,z,W,M);var B=!1;K.capture=function(){B=!0,l._42(),B=!1};var k=new Ob,A=new Ob,w=new Ob,F=new Ob,$=(new Ob).setY(0),R=2*Math.PI/f,o=Z/2/Math.tan(Math.PI/f),c=2*Math.atan2(s/2,o),m=Z/s;K._42=function(U,p,S,P){var a=K._debugOn;if(!B&&!a)return!1;k.copy(l.getEye()),F.copy(l.getCenter()).sub(k);var n=Math.atan2(F.z,F.x),z=l.getNear(),M=l.getFovy(),x=l.getAspect();A.copy(l.getCenter());for(var J,L=0;f>L;L++)if(J=H[L],$.setZ(Math.cos(n)).setX(Math.sin(n)).multiplyScalar(o),n-=R,w.addVectors(k,$),l.setNear(o),l.setCenter([w.x,w.y,w.z]),l.setFovy(c),l.setAspect(m),a){var Q=Math.round(p/f);U.viewport(Q*L,0,Q,S),P()}else Jk(U,J.frame),U.viewport(0,0,J.width,J.height),U.clear(U.COLOR_BUFFER_BIT),P(),Nk(U),J.assureTexture();return l.setNear(z),l.setCenter([A.x,A.y,A.z]),l.setFovy(M),l.setAspect(x),!0},K.capture()},getTextureInfo:function(w){var Y=this._renderTargets;if(!Y)return null;var K=this._renderTargets[w];return K?{index:w,texture:K.texture,textureName:K.uuid}:null}}),G.assign(Er.Graph3dView.prototype,{renderEnvToCube:function(g,j,X,T){var z=this;z.envRenderer||(z.envRenderer=new Er.RenderEnv(z)),z.envRenderer.renderEnvToCube(g,j,X,T)}}),Er.RenderTarget=function(u,D,f,L,s){var v=this;s=s||{},s.samples=Math.min(u._glCapabilities.maxSamples,s.samples&&s.samples>1&&2===u._webGLVersion?s.samples:0),v.options=s,v.uuid=W.Math.generateUUID(),v.gv=u,v.init(u,D,s),v.setSize(D,f,L)},G.assign(Er.RenderTarget.prototype,{bind:function(G){Jk(G,this.options.samples?this._MSAAFbo:this.frame)},unbind:function(b){Nk(b),this.options.samples&&(b.bindFramebuffer(b.READ_FRAMEBUFFER,this._MSAAFbo),b.bindFramebuffer(b.DRAW_FRAMEBUFFER,this.frame),b.blitFramebuffer(0,0,this.width,this.height,0,0,this.width,this.height,b.COLOR_BUFFER_BIT,b.NEAREST),b.bindFramebuffer(b.READ_FRAMEBUFFER,null),b.bindFramebuffer(b.DRAW_FRAMEBUFFER,null))},init:function(E,f,h){var q=this,x=q.texture=f.createTexture();f.activeTexture(f.TEXTURE0),f.bindTexture(f.TEXTURE_2D,x),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);var F=h.samples,i=F?f.NEAREST:f.LINEAR;f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,h.minFilter||i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,h.magFilter||i),f.bindTexture(f.TEXTURE_2D,null),q.render=f.createRenderbuffer(),q.frame=f.createFramebuffer(),F&&(q._MSAAFbo=f.createFramebuffer(),q._MSAARbO=f.createRenderbuffer()),E._2O[q.uuid]=x},assureTexture:function(){var U=this,m=U.uuid,t=U.gv._2O;t[m]||(t[m]=U.texture)},setSize:function(o,w,Q){var Z=this;if(w&&Q&&(Z.width!==w||Z.height!==Q)){var r=o.RGBA,K=o.TEXTURE_2D,b=o.RENDERBUFFER,a=o.FRAMEBUFFER,x=Z.options.samples;ms(o,Z.texture),o.texImage2D(K,0,r,w,Q,0,r,o.UNSIGNED_BYTE,S),o.bindRenderbuffer(b,Z.render),x?o.renderbufferStorageMultisample(b,x,o.DEPTH_COMPONENT16,w,Q):o.renderbufferStorage(b,o.DEPTH_COMPONENT16,w,Q),Jk(o,Z.frame),o.framebufferTexture2D(a,o.COLOR_ATTACHMENT0,K,Z.texture,0),x||o.framebufferRenderbuffer(a,o.DEPTH_ATTACHMENT,b,Z.render),Nk(o),x&&(o.bindRenderbuffer(o.RENDERBUFFER,Z._MSAARbO),o.renderbufferStorageMultisample(o.RENDERBUFFER,x,o.RGBA8,w,Q),Jk(o,Z._MSAAFbo),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,Z._MSAARbO),o.framebufferRenderbuffer(a,o.DEPTH_ATTACHMENT,b,Z.render),Nk(o)),ms(o,S),o.bindRenderbuffer(b,S),Z.width=w,Z.height=Q}},toCanvas:function(){var A=this,c=A.gv.getGL();Jk(c,A.frame);var V=A.width,h=A.height,g=new Uint8Array(4*V*h);c.readPixels(0,0,V,h,c.RGBA,c.UNSIGNED_BYTE,g),Nk(c);var N=l.createElement("canvas");N.width=V,N.height=h;var R=N.getContext("2d"),K=R.createImageData(V,h);return K.data.set(g),R.putImageData(K,0,0),N}});var rh=Er.Interactor=function(I){this.gv=I};rk("Interactor",G,{ms_listener:1,getView:function(){return this.gv.getView()},setUp:function(){this.addListeners()},tearDown:function(){this.removeListeners()}});var go=Er.DefaultInteractor=function(P){Lk(go,this,[P])};rk("DefaultInteractor",rh,{handle_contextmenu:function(E){Ub(E)},handle_mousewheel:function($){this.gv.handleScroll($,$.wheelDelta/40)},handle_DOMMouseScroll:function(l){2===l.axis&&this.gv.handleScroll(l,-l.detail)},handle_keydown:function(t){this.gv.handleKeyDown(t)},handle_mousedown:function(I){this.handle_touchstart(I)},handle_touchstart:function(i){Ub(i);var B=this,H=B.gv,q=bh(i),N=H.getDataInfoAt(i),o=N?N.data:S,J=N?N.part:S,u=H.sm(),x=Zl(i),p=Bk(i);H.setFocus(i)&&(B._62O=S,B._57I=S,o?nl(i)?u.co(o)?u.rs(o):u.as(o):u.co(o)||u.ss(o):q&&(nl(i)?H.isRectSelectable()&&(B._62O=He):B._57I=Xd(i)),B._31Q&&(Wc(B._31Q),delete B._31Q,delete B._32Q),B._62O||(H.isFirstPersonMode()&&(Pn(i)||Ih(i)||p>2?B._62O="pan":H.isMouseRoamable()||xl?(B._62O="roaming",B.foward=x&&bh(i),B._32Q=Pb(),B._31Q=dk(B.tick,B)):q||(B._62O="roaming")),B._62O||(q&&x&&$k[J]?(B._62O=J,B.p3=o.p3()):q&&x&&zm(o)&&H.isSelected(o)?H.isMovable(o)?(B._62O="move",B.p3=o.p3(),B.movedata=o):H._39Q(o)&&(B._62O="none"):xl&&(p>2?B._62O="pan":2===p&&(B.dist=co(i),B._62O="pinch")))),B.point=H.lp(i),sm(B,i),Qg(i)?H.handleDoubleClick(i,o,J):H.handleClick(i,o,J))},tick:function(){var u=this,c=u.gv,G=c._moveStep;u.point&&c.isWalkable()&&(u._32Q&&(G*=(Pb()-u._32Q)/50),c.walk(u.foward?G:-G),u._32Q=Pb(),u._31Q=dk(u.tick,u))},handle_mouseup:function(G){this.handle_touchend(G)},handle_touchend:function(h){var u=this._57I;u&&(zq(u,Xd(h))<=1&&this.gv.sm().cs(),this._57I=S)},handleWindowMouseMove:function(K){this.handleWindowTouchMove(K)},handleWindowTouchMove:function(j){var K,d,Z=this,S=Z.gv,p=Z._62O,o=Z.point,E=S.dm(),u=S.lp(j),O=u.x-o.x,g=u.y-o.y,s=S.getWidth(),T=S.getHeight();if(s&&T){var X=-m*O/s,t=-m*g/T;if("roaming"===p)Z.rotate(j,X/2,t/2);else if(p===yq||p===rd||p===Dn)S._86O||E.beginTransaction(),S.fi({kind:S._86O?"betweenEditRotation":"beginEditRotation",event:j}),S._86O=1,S.sm().each(function(V){if(zm(V)&&S.isRotationEditable(V)){var $=M(X)>M(t)?X:t;p===yq?V.setRotationX(V.getRotationX()+$):p===rd?V.setRotationY(V.getRotationY()+$):p===Dn&&V.setRotationZ(V.getRotationZ()+$)}});else if("move"===p||$k[p]){p===Qk||p===$r||p===Nr?(S._87O||E.beginTransaction(),S.fi({kind:S._87O?"betweenEditScale":"beginEditScale",event:j}),S._87O=1):(S._moving||E.beginTransaction(),S.fi({kind:S._moving?"betweenMove":"beginMove",event:j}),S._moving=1);var e,J=Z.p3,G=S.getPositionInfo(J),F=Id(S);e=p===aj?"x":p===jp?"y":p===Gl?"z":p===Qk?"sx":p===$r?"sy":p===Nr?"sz":S.getMoveMode(j,Z.movedata),O=O/s*G.width,g=-1*g/T*G.height;var N,v,L=[F[0]*O,F[4]*O,F[8]*O],l=[F[1]*g,F[5]*g,F[9]*g],q=L[0]+l[0],h=L[1]+l[1],k=L[2]+l[2],z=[J[0]+q,J[1]+h,J[2]+k],n=$b(S.getEye(),z,!0);if("xyz"===e?(N=z,S.moveSelection(q,h,k)):"xz"===e?(N=zs(S,J,[0,1,0],z),N&&S.moveSelection(N[0]-J[0],0,N[2]-J[2])):"xy"===e?(N=zs(S,J,[0,0,1],z),N&&S.moveSelection(N[0]-J[0],N[1]-J[1],0)):"yz"===e?(N=zs(S,J,[1,0,0],z),N&&S.moveSelection(0,N[1]-J[1],N[2]-J[2])):"x"===e||"sx"===e?(n[0]=0,N=zs(S,J,n,z),N&&(v=N[0]-J[0],"x"===e?S.moveSelection(v,0,0):S.sm().each(function(Q){zm(Q)&&S.isSizeEditable(Q)&&(K=Q.getScaleX()+v/100,d=K/Q.getScaleX(),Q.setScaleX(K),Pn(j)&&(Q.setScaleY(Q.getScaleY()*d),Q.setScaleTall(Q.getScaleTall()*d)))}))):"y"===e||"sy"===e?(n[1]=0,N=zs(S,J,n,z),N&&(v=N[1]-J[1],"y"===e?S.moveSelection(0,v,0):S.sm().each(function(r){zm(r)&&S.isSizeEditable(r)&&(K=r.getScaleTall()+v/100,d=K/r.getScaleTall(),r.setScaleTall(K),Pn(j)&&(r.setScaleY(r.getScaleY()*d),r.setScaleX(r.getScaleX()*d)))}))):("z"===e||"sz"===e)&&(n[2]=0,N=zs(S,J,n,z),N&&(v=N[2]-J[2],"z"===e?S.moveSelection(0,0,v):S.sm().each(function(b){zm(b)&&S.isSizeEditable(b)&&(K=b.getScaleY()+v/100,d=K/b.getScaleY(),b.setScaleY(K),Pn(j)&&(b.setScaleX(b.getScaleX()*d),b.setScaleTall(b.getScaleTall()*d)))}))),!N)return;Z.p3=N}else if(p===He){var W=Z.div;W||(W=Z.div=Zj(),lc(Z.getView(),W),W.op=o,W.style.background=S.getRectSelectBackground()),S.fi({kind:S._rectSelecting?"betweenRectSelect":"beginRectSelect",event:j}),S._rectSelecting=1,W.rect=Mn(W.op,u),Ap(W,W.rect)}else if("pinch"===p&&2===Bk(j)){S.fi({kind:S._pinching?"betweenPinch":"beginPinch",event:j}),S._pinching=1;var v=co(j);S.handlePinch(v,Z.dist),Z.dist=v}else"pan"===p||Pn(j)||Ih(j)?Z.pan(j,O,g):"none"===p||S.isFirstPersonMode()||Z.rotate(j,X,t);Z.point=u}},pan:function(I,Q,z){var Y=this.gv;if(Y.isPannable()){var o=Y.getWidth(),G=Y.getHeight();if(!o||!G)return;var k=Y.getCenterInfo(),D=Q/o*k.width,B=-1*z/G*k.height;Y.fi({kind:Y._panning?"betweenPan":"beginPan",event:I}),Y._panning=1,Y.pan(-D,-B)}},rotate:function(c,P,A){var Z=this.gv;Z.isRotatable()&&(Z.fi({kind:Z._rotating?"betweenRotate":"beginRotate",event:c}),Z._rotating=1,Z.rotate(P,A))},handleWindowMouseUp:function(D){this.handleWindowTouchEnd(D)},handleWindowTouchEnd:function(h){var Y=this,Z=Y.gv,V=Z.dm(),u=Y.div;if(u){var m=Z.getDatasInRect(u.rect);if(!m.isEmpty()){var k=Z.sm(),D=k.toSelection();m.each(function(t){k.co(t)?D.remove(t):D.add(t)}),k.ss(D)}ws(u)}Z._moving&&(delete Z._moving,Z.fi({kind:"endMove",event:h}),Z.onMoveEnded(),V.endTransaction()),Z._panning&&(delete Z._panning,Z.fi({kind:"endPan",event:h}),Z.onPanEnded()),Z._rotating&&(delete Z._rotating,Z.fi({kind:"endRotate",event:h}),Z.onRotateEnded()),Z._86O&&(delete Z._86O,Z.fi({kind:"endEditRotation",event:h}),V.endTransaction()),Z._87O&&(delete Z._87O,Z.fi({kind:"endEditScale",event:h}),V.endTransaction()),Z._pinching&&(delete Z._pinching,Z.fi({kind:"endPinch",event:h}),Z.onPinchEnded()),Z._rectSelecting&&(delete Z._rectSelecting,Z.fi({kind:"endRectSelect",event:h}),Z.onRectSelectEnded()),Z._walking&&(delete Z._walking,Z.fi({kind:"endWalk",event:h}),Z.onWalkEnded()),Y.dist=Y.point=Y._62O=Y.p3=Y.movedata=Y.div=Y._57I=Y._32Q=Y._31Q=Y.foward=S}});var Bo=Er.MapInteractor=function(d){Lk(Bo,this,[d]),this._minPhi=0,this._maxPhi=5*u/12,this._keepHorizon=!0,this._threshold=2,this._touchScaleThreshold=.05,this._touchRotateThreshold=.03,this._touchScaleCheckAccuracy=.01,this._panButton="right"};rk("MapInteractor",rh,{handle_contextmenu:function(V){Ub(V)},handle_mousewheel:function(b){this.gv.handleScroll(b,b.wheelDelta/40)},handle_DOMMouseScroll:function(u){2===u.axis&&this.gv.handleScroll(u,-u.detail)},handle_keydown:function(C){this.gv.handleKeyDown(C)},handle_mousedown:function(a){this.handle_touchstart(a)},handle_touchstart:function(a){Ub(a);var f=this,L=f.gv;if(L.setFocus(a)){L.lp(a);var Y=L.getDataInfoAt(a),P=Y?Y.data:S,q=Y?Y.part:S;if(!P||!L._39Q(P)){var J=f.editing={point:L.lp(a)};xl?J.touch=!0:(J.touch=!1,J.clickLeft=bh(a),J.pan=Ih(a)?!0:"left"===this.panButton===J.clickLeft),sm(f,a)}Qg(a)?L.handleDoubleClick(a,P,q):L.handleClick(a,P,q)}},handle_mouseup:function(L){this.handle_touchend(L)},handle_touchend:function(){},handleWindowMouseMove:function(Y){this.handleWindowTouchMove(Y)},handleWindowTouchMove:function(I){var q=this,P=q.gv,k=q.editing;if(k){var D=P.lp(I),U=k.point,p=D.x-U.x,z=D.y-U.y;if(!k.moved){if(Math.abs(p)<q.threshold&&Math.abs(z)<q.threshold&&!(I.touches&&I.touches.length>1))return;k.moved=!0}if(k.point=D,k.touch){var J=I.touches.length;if(2!==J)q.pan(I,p,z);else{if(1>=J)return;var l=I.touches,Z={x:l[0].clientX,y:l[0].clientY},s={x:l[1].clientX,y:l[1].clientY},v={x:s.x-Z.x,y:s.y-Z.y},$=k.lastCenter,j=Math.atan2(v.y,v.x),V=k.theta,g=0;V==S?V=k.theta=j:(g=j-V,k.thetaStarted||Math.abs(g)>q.touchRotateThreshold?(k.thetaStarted=!0,k.theta=j):g=0);var N=u*(Z.y+s.y)/2/P.getHeight(),d=k.phi,t=0;d==S?d=k.phi=N:(t=N-d,k.phiStarted||Math.abs(t)>q.touchRotateThreshold?(k.phiStarted=!0,k.phi=N):t=0);var L,n=Math.sqrt(v.x*v.x+v.y*v.y),Q=k.vlen;if(Q){var K=Z.x-$.x,o=Z.y-$.y,M=s.x-$.x,r=s.y-$.y,i=Math.sqrt(K*K+o*o),X=Math.sqrt(M*M+r*r),b=Q/2,w=q._sign2(i-b),f=q._sign2(X-b);0>w*f||0===w&&0===f?(L=1,k.vlen=n):(L||(L=n/Q),k.scaleStarted||Math.abs(L-1)>q.touchScaleThreshold?(k.vlen=n,k.scaleStarted=!0):L=1)}else Q=k.vlen=n,L=1;1!==L&&P.setZoom(L),(t||g)&&q.rotate(I,g,-t),k.lastCenter={x:(s.x+Z.x)/2,y:(s.y+Z.y)/2}}}else if(k.pan)q.pan(I,p,z);else{var e=P.getWidth(),G=P.getHeight();if(!e||!G)return;var O=-m*p/e,H=-m*z/G;q.rotate(I,O,H)}}},_sign2:function(g){return Math.abs(g)<this._touchScaleCheckAccuracy?0:g>0?1:-1},handleWindowMouseUp:function(l){this.handleWindowTouchEnd(l)},handleWindowTouchEnd:function(Q){var J=this,q=J.editing;if(J.editing=null,q){var O=J.gv;if(!q.moved&&q.clickLeft){var k=O.getDataAt(Q);k?O.sm().setSelection([k]):O.sm().clearSelection()}else O._panning=null,O._rotating=null,O.fi({kind:q.pan?"endPan":"endRotate",event:Q})}},pan:function(h,f,r){var s=this,t=s.gv;if(t.isPannable()){var x=t.getWidth(),M=t.getHeight();if(x&&M){var o=t.getCenterInfo(),T=-f/x*o.width,m=1*r/M*o.height;t.fi({kind:t._panning?"betweenPan":"beginPan",event:h}),t._panning=1;var n=s.keepHorizon,I=s.editing.touch;if((I&&h.touches&&h.touches.length>1||!I&&Pn(h))&&(n=!n),!n)return t.pan(T,m);if(T||m){var b=Id(t),e=[b[0]*T,b[4]*T,b[8]*T],H=[b[1],0,b[9]],y=Math.sqrt(H[0]*H[0]+H[2]*H[2]);y&&(H=[H[0]/y*m,0,H[2]/y*m]);var O=e[0]+H[0],c=e[1]+H[1],V=e[2]+H[2],G=t._center,R=t._eye;G[0]+=O,G[1]+=c,G[2]+=V,R[0]+=O,R[1]+=c,R[2]+=V,t.fp(Qp,S,R),t.fp(Sb,S,G)}}}},rotate:function(W,Y,D){var L=this,b=L.gv;if(b.isRotatable()){var r=b._center,s=b._eye,w=$b(s,r),G=N(_(w[0]*w[0]+w[2]*w[2]),w[1]),B=G+D;B=Math.max(L.minPhi,Math.min(L.maxPhi,B)),D=B-G,b.fi({kind:b._rotating?"betweenRotate":"beginRotate",event:W}),b._rotating=1,b.rotate(Y,D)}}}),G.defineProperties(Bo.prototype,{panButton:{get:function(){return this._panButton},set:function(R){this._panButton=R}},minPhi:{get:function(){return this._minPhi},set:function(D){this._minPhi=D}},maxPhi:{get:function(){return this._maxPhi},set:function(X){this._maxPhi=X}},keepHorizon:{get:function(){return this._keepHorizon},set:function(D){this._keepHorizon=D}},threshold:{get:function(){return this._threshold},set:function(W){this._threshold=W}},touchScaleThreshold:{get:function(){return this._touchScaleThreshold},set:function(k){this._touchScaleThreshold=k}},touchRotateThreshold:{get:function(){return this._touchRotateThreshold},set:function(e){this._touchRotateThreshold=e}}});var to=function(B){this.gv=B};jd(to,G,{_iv:!0,iv:function(){this._iv=!0},face:function(F,y){var Y=this,n=Y.gv.getGL();if(!n||!zm(F))return S;var J=y.x,i=y.width,W=y.height,T=Y.height-y.y-W,s=R(i/2),O=new Uint8Array(4*i*W),z=0;for(Y.iv(),Y.validate(F),Jk(n,Y.frame),n.readPixels(J,T,i,W,n.RGBA,n.UNSIGNED_BYTE,O),Nk(n),Y.iv();s>=z;z++)for(var K=s-z,x=s+z,e=K;x>=e;e++)for(var G=K;x>=G;G++)if(e===K||e===x||G===K||G===x){var P=gh.m[O[4*(e*i+G)]];if(P)return P}},get:function(O,d){this.validate();var y=this,J=y.gv.getGL();if(!J)return S;var p,o,M=O.x,_=O.width,P=O.height,Q=y.height-O.y-P,i=R(_/2),D=new Uint8Array(4*_*P),w=0,q=D.length,H=d?S:new Kf,F=d?S:{};if(Jk(J,y.frame),J.readPixels(M,Q,_,P,J.RGBA,J.UNSIGNED_BYTE,D),Nk(J),d){for(;i>=w;w++)for(var $=i-w,c=i+w,u=$;c>=u;u++)for(var Y=$;c>=Y;Y++)if((u===$||u===c||Y===$||Y===c)&&(p=y.info(D,4*(u*_+Y))))return p}else for(;q>w;w+=4)p=y.info(D,w),p&&(o=p.data,F[o._id]||(H.add(o),F[o._id]=o));return H},info:function(Y,V){return this.colorMap[(Y[V]<<16)+(Y[V+1]<<8)+Y[V+2]+((127&Y[V+3])<<24)]},validate:function(h){var R=this,r=R.gv,U=r.getGL();if(U){var u=r.getWidth(),p=r.getHeight(),I=U.RGBA,y=U.TEXTURE_2D,z=U.RENDERBUFFER,V=U.FRAMEBUFFER;R.texture||(R.texture=xb(U),R.render=U.createRenderbuffer(),R.frame=U.createFramebuffer()),(R.width!==u||R.height!==p)&&(ms(U,R.texture),U.texImage2D(y,0,I,u,p,0,I,U.UNSIGNED_BYTE,S),id(U,U.TEXTURE_MIN_FILTER,U.LINEAR),U.bindRenderbuffer(z,R.render),U.renderbufferStorage(z,U.DEPTH_COMPONENT16,u,p),Jk(U,R.frame),U.framebufferTexture2D(V,U.COLOR_ATTACHMENT0,y,R.texture,0),U.framebufferRenderbuffer(V,U.DEPTH_ATTACHMENT,z,R.render),ms(U,S),U.bindRenderbuffer(z,S),Nk(U),R.width=u,R.height=p),R._iv&&(R._iv=!1,Jk(U,R.frame),r._42(h||(R.colorMap={}),1),Nk(U))}}});var tr=function(s){this.gv=s};jd(tr,G,{gap:0,size:0,_42:function(p,s){var o=this,z=o.gv,I=z._gridGap,L=z._gridSize;if(z._gridVisible){if(o.gap!==I||o.size!==L){for(var q=[],h=z._gridSize/2,N=I*h,c=0;2*h+1>c;c++){var X=6*c,M=6*(2*h+1)+X;q[X]=-N,q[X+1]=0,q[X+2]=-N+c*I,q[X+3]=N,q[X+4]=0,q[X+5]=-N+c*I,q[M]=-N+c*I,q[M+1]=0,q[M+2]=-N,q[M+3]=-N+c*I,q[M+4]=0,q[M+5]=N}o.vs=new am(q),o.gap=I,o.size=L}Vl(z),Ei(p,s),qo(p),yc(p,s,1,z._gridColor,z._buffer.vs,o.vs),nk(p,0,o.vs.length/3,p.LINES),ul(p),Gb(p,s)}else o.vs=o.gap=o.size=S}});var Pc=function(a){this.gv=a};jd(Pc,G,{_42:function(W,c){var P=this.gv,V=P._buffer.vs,N=P._axisXColor,v=P._axisYColor,O=P._axisZColor,R=P._originAxisVisible,D=P._centerAxisVisible;if(R||D){var K=bl?W.TRIANGLES:W.TRIANGLE_FAN,I=W.LINES;if(Vl(P),Ei(W,c),qo(W),R){var C=P.getCenterInfo(),s=o(C.width,C.height)/5,j=.8*s,M=.05*s;yc(W,c,1.5,N,V,new am([0,0,0,s,0,0,j,M,0,j,0,M,j,-M,0,j,0,-M,j,M,0,0,0,0,0,s,0,M,j,0,0,j,M,-M,j,0,0,j,-M,M,j,0,0,0,0,0,0,s,M,0,j,0,M,j,-M,0,j,0,-M,j,M,0,j])),nk(W,0,2,I),nk(W,1,6,K),yc(W,c,S,v),nk(W,7,2,I),nk(W,8,6,K),yc(W,c,S,O),nk(W,14,2,I),nk(W,15,6,K)}if(D){var l=P._center,y=l[0],L=l[1],i=l[2],C=P.getPositionInfo(l);s=o(C.width,C.height)/20,yc(W,c,1.5,N,V,new am([y,L,i,y+s,L,i,y,L,i,y,L+s,i,y,L,i,y,L,i+s])),nk(W,0,2,I),yc(W,c,S,v),nk(W,2,2,I),yc(W,c,S,O),nk(W,4,2,I)}ul(W),Gb(W,c)}}});var ei=function(P){this.gv=P,this.onMouseOver=this.onMouseOver.bind(this),this.mode=ei.Mode.Disable};ei.Mode={Disable:0,Selection:1,MouseOver:2},jd(ei,G,{onMouseOver:function(Z){X.preventDefault(Z);var L=this.gv.getDataAt(Z);L!==this.mouseOverData&&(this.mouseOverData=L,this.gv.iv())},setFetchTargetFunc:function(u){this.fetchTargetFunc=u},_42:function(X,P){var W,N=this,R=N._mode;if(R!==ei.Mode.Disable&&(R===ei.Mode.Selection?W=N.gv.sm().getSelection().toArray(function(J){return J.s("highlight.visible")}):R===ei.Mode.MouseOver&&N.mouseOverData&&N.mouseOverData.s("highlight.visible")&&(W=[N.mouseOverData]),N.fetchTargetFunc&&(W=N.fetchTargetFunc(W)),W&&W.length)){var b=N.gv,w=b.vr.isPresenting(),c=b.getWidth();if(w){var g=b.getWidth;c/=2,b.getWidth=function(){return c};var $=b.getViewport()}var Q,y=b.getDevicePixelRatio(),U=c*y,B=b.getHeight()*y;(Q=N._renderTarget)?Q.setSize(X,U,B):N._renderTarget=Q=new Er.RenderTarget(b,X,U,B),Jk(X,Q.frame),b.drawFilter=function($){return W.indexOf($)<0?!0:void 0},b._42({}),b.drawFilter=null,Nk(X),w&&(b.getWidth=g,b.setViewport(X,$[0],$[1],$[2],$[3])),N.shader||(N.shader=new Rk.Shader(X,Qo.vs,Qo.fs));var _=N.shader;if(N.shader.bind(),X.enable(X.BLEND),X.activeTexture(X.TEXTURE0+0),X.bindTexture(X.TEXTURE_2D,Q.texture),_.uniforms.image=0,_.uniforms.textureSize=[U,B],_.uniforms.edgeWidth=n["highlight.width"],N.highlightColor!==n["highlight.color"]){var L=_m(N.highlightColor=n["highlight.color"]);N.highlightColorData=[L[0]/255,L[1]/255,L[2]/255,L[3]/255]}_.uniforms.edgeColor=N.highlightColorData,N.ibuffer?(N.ibuffer.upload(),N.vbuffer.upload()):(N.ibuffer=Rk.Buffer.createIndexBuffer(X,new Uint16Array([0,2,1,1,2,3])),N.vbuffer=Rk.Buffer.createVertexBuffer(X,new Float32Array([0,0,1,0,0,1,1,1]))),_.attributes.pos.pointer(N.vbuffer),X.drawElements(X.TRIANGLES,6,X.UNSIGNED_SHORT,0),X.disable(X.BLEND),X.bindTexture(X.TEXTURE_2D,null),X.useProgram(P)}}}),G.defineProperties(ei.prototype,{mode:{get:function(){return this._mode},set:function(q){var Z=this._mode;q!==Z&&(this._mode=q,q===ei.Mode.MouseOver?s(this.gv.getView(),"mousemove",this.onMouseOver):Z===ei.Mode.MouseOver&&F(this.gv.getView(),"mousemove",this.onMouseOver))}}});var Qo={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","uniform vec2 textureSize;","uniform float edgeWidth;","uniform vec4 edgeColor;","varying vec2 vUv;","float getCol(vec2 coord) {","return texture2D(image, coord).a;","}","void main() {","vec2 cc = vUv;","float center = getCol(cc);","float dx = edgeWidth / textureSize.x;","float dy = edgeWidth / textureSize.y;","vec2 coord;","float topLeft = getCol(cc+vec2(-dx, -dy));","float top = getCol(cc+vec2(0.0, -dy));","float topRight = getCol(cc+vec2(dx, -dy));","float left = getCol(cc+vec2(-dx, 0.0));","float right = getCol(cc+vec2(dx, 0.0));","float bottomLeft = getCol(cc+vec2(-dx, dy));","float bottom = getCol(cc+vec2(0.0, dy));","float bottomRight = getCol(cc+vec2(dx, dy));","float v = -topLeft-2.0*top-topRight+bottomLeft+2.0*bottom+bottomRight;","float h = -bottomLeft-2.0*left-topLeft+bottomRight+2.0*right+topRight;","float edge = sqrt(h * h + v * v);","edge = smoothstep(0.9, 1.0, edge);","if (edge < 0.5) {","discard;","}","gl_FragColor = edgeColor;","}"].join("\n")},up=function(D){this.gv=D
},aj="edit_tx",jp="edit_ty",Gl="edit_tz",yq="edit_rx",rd="edit_ry",Dn="edit_rz",Qk="edit_sx",$r="edit_sy",Nr="edit_sz",$k={};$k[aj]=1,$k[jp]=1,$k[Gl]=1,$k[yq]=1,$k[rd]=1,$k[Dn]=1,$k[Qk]=1,$k[$r]=1,$k[Nr]=1,jd(up,G,{_42:function(i,z,Z){var Y=this,f=Y.gv,o=f.sm().ld();if(o&&f.isEditable(o)&&!f.isEditHelperDisabled()&&zm(o)&&(!f.isFirstPersonMode()||!f.isMouseRoamable()&&!xl)){Vl(f);var M,w,H=f.isMovable(o),F=f.isRotationEditable(o),q=f.isSizeEditable(o),s=f._axisXColor,O=f._axisYColor,S=f._axisZColor,K=f._editSizeColor,h=o.p3(),m=zq(f.getEye(),h)/10,W=m/(Z?5:10),g=.7*m,a=.4*g,X=h[0],j=h[1],Q=h[2];M=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],H&&Y._17O(i,z,o,Z,aj,s,M,[X,j-W,Q,X+g,j-W,Q,X+g,j,Q,X+g,j,Q,X,j,Q,X,j-W,Q,X,j-W,Q+W,X+g,j-W,Q+W,X+g,j-W,Q,X+g,j-W,Q,X,j-W,Q,X,j-W,Q+W]),w=X+g,q&&Y._17O(i,z,o,Z,Qk,K,M,[w,j-W,Q,w+a,j-W,Q,w+a,j,Q,w+a,j,Q,w,j,Q,w,j-W,Q,w,j-W,Q+W,w+a,j-W,Q+W,w+a,j-W,Q,w+a,j-W,Q,w,j-W,Q,w,j-W,Q+W]),w+=a,F&&Y._17O(i,z,o,Z,yq,s,M,[w,j-W,Q,w+a,j-W,Q,w+a,j,Q,w+a,j,Q,w,j,Q,w,j-W,Q,w,j-W,Q+W,w+a,j-W,Q+W,w+a,j-W,Q,w+a,j-W,Q,w,j-W,Q,w,j-W,Q+W]),M=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0],H&&Y._17O(i,z,o,Z,jp,O,M,[X,j,Q,X,j+g,Q,X-W,j+g,Q,X-W,j+g,Q,X-W,j,Q,X,j,Q,X,j,Q,X,j,Q-W,X,j+g,Q-W,X,j+g,Q-W,X,j+g,Q,X,j,Q]),w=j+g,q&&Y._17O(i,z,o,Z,$r,K,M,[X,w,Q,X,w+a,Q,X-W,w+a,Q,X-W,w+a,Q,X-W,w,Q,X,w,Q,X,w,Q,X,w,Q-W,X,w+a,Q-W,X,w+a,Q-W,X,w+a,Q,X,w,Q]),w+=a,F&&Y._17O(i,z,o,Z,rd,O,M,[X,w,Q,X,w+a,Q,X-W,w+a,Q,X-W,w+a,Q,X-W,w,Q,X,w,Q,X,w,Q,X,w,Q-W,X,w+a,Q-W,X,w+a,Q-W,X,w+a,Q,X,w,Q]),M=[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0],H&&Y._17O(i,z,o,Z,Gl,S,M,[X,j,Q,X,j,Q+g,X,j-W,Q+g,X,j-W,Q+g,X,j-W,Q,X,j,Q,X,j-W,Q,X-W,j-W,Q,X-W,j-W,Q+g,X-W,j-W,Q+g,X,j-W,Q+g,X,j-W,Q]),w=Q+g,q&&Y._17O(i,z,o,Z,Nr,K,M,[X,j,w,X,j,w+a,X,j-W,w+a,X,j-W,w+a,X,j-W,w,X,j,w,X,j-W,w,X-W,j-W,w,X-W,j-W,w+a,X-W,j-W,w+a,X,j-W,w+a,X,j-W,w]),w+=a,F&&Y._17O(i,z,o,Z,Dn,S,M,[X,j,w,X,j,w+a,X,j-W,w+a,X,j-W,w+a,X,j-W,w,X,j,w,X,j-W,w,X-W,j-W,w,X-W,j-W,w+a,X-W,j-W,w+a,X,j-W,w+a,X,j-W,w])}},_17O:function(j,g,F,W,w,Z,U,p){var J=this.gv._buffer;Bs(j,g,W,!0,F,w),Yi(j,g,S,!0,S,!0,S,!1),Wj(j,g.uDiffuse,Z),Gd(j,J.vs,new am(p),g.aPosition),Gd(j,J.ns,new am(U),g.aNormal),qo(j),nk(j,0,12),ul(j),uf(j,g)}});var dq=W.Raycaster=function(X){this.gv=X,this.maxTriangleTest=1/0};Xp("Raycaster",G,{intersect:function(J){var m=this,y=m.gv,L=y.getDataAt(J);return L?m.intersectObject(J,L):null},intersectObjects:function(w,W,r){var v,q,z,y,j=this,I=1/0,R=w.origin||(new Ob).fromArray(j.gv.getEye()),x=j.maxTriangleTest,Q=[];return W.forEach(function(w){r&&r(w)===!1||w.s("intersect")!==!1&&Q.push(w)}),Q.sort(function(L,H){return R.distanceToSquared2(L.p3())-R.distanceToSquared2(H.p3())}),j.countTriangles=0,Q.forEach(function(o){j.countTriangles>x||(v=j.intersectObject(w,o),v&&(q=R.distanceToSquared(v.world),I>q&&(z=o,y=v,I=q)))}),j.countTriangles=0,{data:z,intersect:y}},intersectObject:function(q,O){if(q instanceof ih)return this._intersectObjectImpl(q,O);var h=this,T=h.gv,s=T.unproject(q),z=new Ob,g=T.getEye(),L=new Ob;if(T.isOrtho()){var u=new Ob(g);L.copy(T.getCenter()).sub(u).normalize();var M=z.copy(s).sub(u).dot(L);z.copy(L).setLength(-M).add(u.copy(s))}else z.copy(g),L.copy(s).sub(z).normalize();var c=new W.Math.Ray(z,L);return h._intersectObjectImpl(c,O)},_intersectObjectImpl:function(){function Y(){var E=new Ob;return E.subVectors(J,c),g.subVectors(M,c),E.cross(g).normalize(),E}function v(q,V,U,n,H,z,l){return je.barycoordFromPoint(q,V,U,n,h),H.multiplyScalar(h.x),z.multiplyScalar(h.y),l.multiplyScalar(h.z),H.add(z).add(l),H.clone()}var u=new Fl,e=new Fl,_=new ih,k=new Ob,L=new Ob,b=new Ob,d=new Ob,Q=new Ob,M=new Ob,c=new Ob,J=new Ob,p=new Lj,w=new Lj,y=new Lj,g=new Ob,o={vs:us,is:Ii,uv:Jl},h=new Ob;return function(s,Z){var i=this.gv.getData3dUI(Z),m=Z.mat||i.mat;if(m){u.fromArray(m),e.getInverse(u),_.copy(s).applyMatrix4(e);var T,S,R="body",P=i.shapeModel;if(P||(P=di(i)),P||(Z instanceof W.Node&&!(Z instanceof W.Shape)?(T=!0,P=o):(S=!0,P=[i.left,i.front,i.right,i.back,i.top,i.bottom])),!P)return console.log("Can not find shape model."),null;En(P)||(P=[P]);var C,z,D,a,V,A,j,N,O,n,f,U,K,F,t,x,G=1/0,B=["","top_","bottom_"],g=!1;for(C=0,z=P.length;z>C;C++)if(K=P[C])for(D=0,a=B.length;a>D;D++)if(F=B[D],j=K[F+"vs"],N=K[F+"is"],O=K[F+"uv"]||K[F+"tuv"],j){if(t=K[F+"boundingBox"]){var f=_.intersectBox(t);if(!f)continue;if(_.origin.distanceTo(f)>G)continue;x=!1}else K[F+"boundingBox"]=t=new W.Math.Box3,x=!0;for(V=0,A=N?N.length:j.length/3;A>V;V+=3)this.countTriangles++,N?(L.fromArray(j,3*N[V]),b.fromArray(j,3*N[V+1]),d.fromArray(j,3*N[V+2])):(L.fromArray(j,3*V),b.fromArray(j,3*(V+1)),d.fromArray(j,3*(V+2))),x&&(t.expandByPoint(L),t.expandByPoint(b),t.expandByPoint(d)),n=_.intersectTriangle(L,b,d,!0,k),n&&(U=_.origin.distanceTo(n),G>U&&(G=U,Q.copy(n),M.copy(L),c.copy(b),J.copy(d),""!==F?R=F.slice(0,-1):T?R=Vq[Math.floor(V/6)]:S&&(R=Vq[C]),O&&(g=!0,N?(p.fromArray(O,2*N[V]),w.fromArray(O,2*N[V+1]),y.fromArray(O,2*N[V+2])):(p.fromArray(O,2*V),w.fromArray(O,2*(V+1)),y.fromArray(O,2*(V+2))))))}if(!isFinite(G))return null;var r,E=Q.clone().applyMatrix4(u);g&&(r=v(Q,M,c,J,p,w,y));var I=Y(M,c,J),h=Y(M.applyMatrix4(u),c.applyMatrix4(u),J.applyMatrix4(u)),l=_.direction.dot(I);return l>0&&(I.multiplyScalar(-1),h.multiplyScalar(-1)),{world:E,local:Q.clone(),worldNormal:h,normal:I,uv:r,part:R}}}}()});var ck=function(v,f){this.gv=v,this.s=function(w,j,z){return j==S&&(j=z),j==S?f.getStyle(w):lp(j,f,v)},this.data=f};jd(ck,G,{I3d:!0,ms_icons:1,_iv:!0,iv:function(){this._iv=!0},_42:function(E,x,m,P){var o=this,q=o.data;if(!(q instanceof Cc)){var _,h,H,b,s,U,N,O=o.gv,g=q._id,G=o.s("shape3d.alwaysOnTop")?null:o.s("batch"),n=O._batchIndexMap,B=O._batchModelMap,F=O.isSelectable(q),J=O.getBrightness(q),T=J!=S&&1!==J;if(o.needValidate(E)){if(H=ur(n,B,q,G),o.validate(H,G?Di[G]||ni:S),H&&(b=n[g],s=b.size=H.vs.length/3-b.begin,N=H.rs))for(J=T?J:1,U=0;s>U;U++)N.push(J);if(zm(q)){var c=O.getWireframeGeometry(q);if(c)em(O,q,c);else{var j=O.getWireframe(q);j&&em(O,q,j)}}o.labelInfo=o.label2Info=o.noteInfo=o.note2Info=o._38o=S,o._24O(Fn,"getLabel"),o._24O(gm,"getLabel2"),o._26O(he,"getNote"),o._26O(Vb,"getNote2"),o._15O(),o.interactiveInfo=O.isInteractive(q)?{}:S,o._iv=!1}T&&Wj(E,x.uBrightness,J),Wj(E,x.uAlphaTest,o.s("alphaTest")),Wj(E,x.uUseEnvMap,q.s("envmap")?!0:!1),Wj(E,x.uReflectivity,q.s("envmap")||.01),h=Bs(E,x,m,F,q,Ai),h&&(kq(h,n[g],B),kq(h,O._polylineIndexMap[g],O._polylineModelMap),kq(h,O._wireframeIndexMap[g],O._wireframeModelMap)),n[g]||o._80o(E,x,P),O.isLabelVisible(q)&&((_=o.labelInfo)&&(Bs(E,x,m,F,q,Fn),o._28O(_,Fn,P)),(_=o.label2Info)&&(Bs(E,x,m,F,q,gm),o._28O(_,gm,P))),O.isNoteVisible(q)&&((_=o.noteInfo)&&(Bs(E,x,m,F,q,he),o._29O(_,he,P)),(_=o.note2Info)&&(Bs(E,x,m,F,q,Vb),o._29O(_,Vb,P))),(_=o._38o)&&o._99O(E,x,_,m,F,P),T&&Wj(E,x.uBrightness,1)}},needValidate:function(){return this._iv},validate:function(){},_16O:function(){return rq},_80o:function(){},dispose:function(){},_calcAnchorMat:function(N){if(N.hasOwnProperty("_anchor")||N.hasOwnProperty("_anchorElevation")){var A=N.getAnchor3d(),X={x:A.x-.5,y:A.y-.5,z:A.z-.5},n=Xc();return qj(n,[-X.x,-X.y,-X.z]),n}},getBodyColor:function(Z){var k=this.data,z=this.gv.getBodyColor(k);return z?z:Z?k.getStyle(Z):S},_24O:function(x,c){var Y=this,j=Y.data,w=Y.gv,z=Y.s,F=w[c](j);if(F!=S){var m=z(x+".scale"),N=z(x+".max"),q=Y[x+"Info"]={label:F,textureScale:z(x+".texture.scale"),color:w[c+"Color"](j),font:z(x+".font"),align:z(x+".align"),background:w[c+"Background"](j)},r=q.rect=fs(q,F);N>0&&N<r.width&&(q.labelWidth=r.width,r.width=N),r.x=r.y=0,r.width*=m,r.height*=m,q.mat=Y._16O(z(x+".autorotate"),z(x+".position"),r,z(x+".face"),z(x+".t3"),z(x+".r3"),z(x+".rotationMode"));var p=r.width/2,g=r.height/2;q.vs=new am([-p,g,0,-p,-g,0,p,-g,0,p,g,0]),r.width/=m,r.height/=m}},_26O:function($,t){var i=this,d=i.data,G=i.gv,y=i.s,J=G[t](d);if(J!=S){var x=y($+".scale"),k=this[$+"Info"]={note:J,textureScale:y($+".texture.scale"),expanded:y($+".expanded"),font:y($+".font"),color:y($+".color"),align:y($+".align"),borderWidth:y($+".border.width"),borderColor:y($+".border.color"),background:G[t+"Background"](d)};if(k.expanded){var s=y($+".max"),X=fs(k,J);X.width+=6,X.height+=2,s>0&&s<X.width&&(k.labelWidth=X.width,X.width=s);var F={x:-X.width/2,y:-8-X.height,width:X.width,height:X.height+8}}else F={x:-6,y:-18,width:12,height:18};k.mat=i._16O(y($+".autorotate"),y($+".position"),S,y($+".face"),y($+".t3"),y($+".r3"),y($+".rotationMode")),k.rect=F,1!==x&&(F=or(F),F.x*=x,F.height*=x,F.y=-F.height,F.width*=x);var D=F.x,Z=F.y,Y=F.width,N=F.height;k.vs=new am([D,-Z,0,D,-Z-N,0,D+Y,-Z-N,0,D+Y,-Z,0])}},_28O:function(N,C,y){if(y(this.s(C+".transparent"))){var e=N.rect,p=N.textureScale,I=e.width*p,j=e.height*p;if(I>=1&&j>=1){var X=eg(I,j);1!==p&&(X.translate(X,e.x,e.y),X.scale(p,p),X.translate(X,-e.x,-e.y)),oj(X,N),X.restore(),ai(this,C,N.mat,N.vs,!0)}}},_29O:function(z,U,y){if(y(this.s(U+".transparent"))){var i=z.rect,t=z.textureScale,R=i.x,M=i.y,I=i.width*t,s=i.height*t;if(I>=1&&s>=1){i.x=i.y=0;var W=eg(I,s);1!==t&&W.scale(t,t),Xn(W,z),W.restore(),i.x=R,i.y=M,ai(this,U,z.mat,z.vs,!1)}}},_99O:function(m,r,z,C,B,j){if(z){var D=this,T=D.gv,I=D.data,e=T._buffer,h=T._1O,X=z.icons;for(var q in X){var P=X[q],Y=z.rects[q];if(Y&&j(lp(P.transparent,I,T))){Bs(m,r,C,B,I,q);var V=lp(P.shape3d,I,T),W=V?[V]:lp(P.names,I,T),u=W?W.length:0,o=lp(P.textureScale,I,T)||1,U=lp(P.light,I,T);U==S&&(U=V?!0:!1),Yi(m,r,lp(P.blend,I,T),U,lp(P.opacity,I,T),lp(P.reverseFlip,I,T),lp(P.reverseColor,I,T),lp(P.reverseCull,I,T));for(var Q=0;u>Q;Q++){var O=W[Q],E=Y[Q];if(Tr(D,E.mat),V)gn(T,I,di(D,V),D);else{var n=Oi(O);if(n){var g=E.width*o,K=E.height*o;if(g>=1&&K>=1){var v=eg(g,K);ng(v,n,lp(P.stretch,I,T),0,0,g,K,I,T),v.restore(),xb(m,wr,h),qo(m,r,h,lp(P.discardSelectable,I,T),e.uv,xr),Gd(m,e.vs,E.vs,r.aPosition),Rl(m,e.ns,fg,r.aNormal),Hm(m,e.is,Xj),Mo(m,0,Xj.length),ul(m,r,h)}}}vc(T)}uf(m,r)}}}}});var an=function($,m){Lk(an,this,[$,m])};jd(an,ck,{_16O:function(D,v,l,B,Z,T,R,O,z){var C=this.data,p=C.getFinalScale3d(),N=Qq(v,p,l,B,O,z);if(C.hasOwnProperty("_anchor")||C.hasOwnProperty("_anchorElevation")){var W=C.getAnchor3d();N[0]-=(W.x-.5)*p[0],N[1]-=(W.y-.5)*p[1],N[2]-=(W.z-.5)*p[2]}return Em(Xc(),N,C.p3(),B,Z,T,R,D,C.getFinalRotation3d(),C.getRotationMode())},clear:function(){var c=this;c.faceMat=c.mat=c.shapeModel=c.left=c.right=c.front=c.back=c.top=c.bottom=c.csg=S},needValidate:function(s){if(this._iv)return this._validateFrameId=s._renderInfo.frame,!0;if(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen")||this.s("hide.overlapping.group")){var m=s._renderInfo.frame;if(this._validateFrameId!==m)return this._validateFrameId=m,!0}return!1},validate:function(g,G){var t=this,Z=t.gv,A=t.data,I=t.shapeName=t.s(fm),Y=di(t,I);t._updateAutoRotation(),t._updateFixSize2d(),t._updateOverlapping(),(this.s("shape3d.autorotate")||this.s("shape3d.fixSizeOnScreen"))&&(pj(Z,A,"_wireframeModelMap","_wireframeIndexMap"),pj(Z,A,"_wireframeModelMapSwap","_wireframeIndexMapSwap"));var z=Gn(A,Z.getMat(A),Y?t.s("shape3d.scaleable"):!0),T=t._calcAnchorMat(A);if(T&&Ke(z,z,T),A.mat=z,t.clear(),Y||!I)if(g){var C=[];Y?on(Z,A,Y,t,t.getBodyColor(),[z],g,C):(cd(Z,A,g,G,z,zc,C,Kj),cd(Z,A,g,G,z,br,C,Zi),cd(Z,A,g,G,z,Dc,C,jh),cd(Z,A,g,G,z,fd,C,gc),cd(Z,A,g,G,z,Cn,C,Li),cd(Z,A,g,G,z,cp,C,In)),C.length&&(qh(g.vs,C),qh(g.ns,nn(C)))}else t.mat=z,(t.shapeModel=Y)||(t._cubeUvs=null,t.vf(zc,0),t.vf(br,16),t.vf(Cn,8),t.vf(cp,24),t.vf(Dc,32),t.vf(fd,40))},_updateAutoRotation:function(){var u=new pi,x=new Fl,l=new Ob,R=new Ob,Z=new Ob;return function(){var Q=this,C=Q.data,y=Q.s("shape3d.autorotate");if(!y)return C._dynamicRotation&&delete C._dynamicRotation,void 0;var f=Q.gv;Z.copy(Q.s("shape3d.autorotate.up")||f._up);var F;F="string"==typeof y?[y.indexOf("x")<0?f._eye[0]:f._center[0],y.indexOf("y")<0?f._eye[1]:f._center[1],y.indexOf("z")<0?f._eye[2]:f._center[2]]:f._eye;var I=f._center,e=C.p3();l.copy(e),R.set(F[0]-I[0],F[1]-I[1],F[2]-I[2]).add(l),x.lookAt(R,l,Z),u.set(0,0,0,C.getRotationMode(),!0).setFromRotationMatrix(x);var G=C._dynamicRotation;G&&Math.abs(G[0]-u.x)<1e-5&&Math.abs(G[1]-u.y)<1e-5&&Math.abs(G[2]-u.z)<1e-5||(C._dynamicRotation=[u.x,u.y,u.z])}}(),_updateFixSize2d:function(){var K=this,D=K.data,g=K.s("shape3d.fixSizeOnScreen");if(!g)return D._dynamicScale3d&&delete D._dynamicScale3d,void 0;var S=K.gv;D.getFinalScale3d();var W=Gn(D,S.getMat(D)),i=Yp([0,0,0],W),I=S.toViewPosition(i);if(!isNaN(I.x)&&!isNaN(I.y)){var B=Yp([1,0,0],W),M=S.toViewPosition(B),v=Yp([0,1,0],W),z=S.toViewPosition(v),P=M.x-I.x,y=z.y-I.y;if(P&&y){var t=D._dynamicScale3d||[1,1,1],e=Oi(D.s("shape3d.image")),H=g[0]>0?g[0]:e?xq(e,D):20,j=g[1]>0?g[1]:e?ze(e,D):20,V=Math.abs(P/H),T=Math.abs(y/j);Math.abs(V-1)<.001&&Math.abs(T-1)<.001||(D._dynamicScale3d=[t[0]/V,t[1]/T,t[2]])}}},_updateOverlapping:function(){var G=this,A=G.s("hide.overlapping.group");if(!A)return G._rectOverlapping&&(G._rectOverlapping=d),void 0;var p,y,g,v=G.gv,f=G.data,m=Gn(f,v.getMat(f)),V=1/0,T=1/0,Q=-1/0,B=-1/0,W=f.getAnchor3d(),k=W.x,l=W.y,Y=W.z;for(p=0;8>p;p++){if(y=Yp([(p>>2)-k,(1&p>>1)-l,(1&p)-Y],m),g=v.toViewPosition(y),isNaN(g.x)||isNaN(g.y))return;V=Math.min(V,g.x),Q=Math.max(Q,g.x),T=Math.min(T,g.y),B=Math.max(B,g.y)}var U={x:V,y:T,w:Q-V,h:B-T};G._rectOverlapping=v.overlappingBox.isOverlapping(A,U)},getVectorDynamicSize:function(){var g,Z=this,s=Z.s("shape3d"),u=Z.data;if("billboard"===s||"plane"===s||(g=u._currentCubeElementId)!=S){var X,H,o=Z.gv,d=Gn(u,o.getMat(u)),h=u.getAnchor3d(),D=.5-h.x,L=.5-h.y,K=.5-h.z,w=Z.s("shape3d.vector.dynamic.maxsize"),J=function(i,f){i[0]+=D,i[1]+=L,i[2]+=K,f[0]+=D,f[1]+=L,f[2]+=K;var G=o.toViewPosition(Yp(i,d)),S=o.toViewPosition(Yp(f,d)),_=G.x-S.x,s=G.y-S.y;return Math.min(w,Math.sqrt(_*_+s*s))};if("billboard"===s)X=J([-.5,0,0],[.5,0,0]),H=J([0,-.5,0],[0,.5,0]);else if("plane"===s)X=J([-.5,0,0],[.5,0,0]),H=J([0,0,-.5],[0,0,.5]);else if(u._currentCubeElementId!=S){var p=3*Ii[g+1],G=3*Ii[g],O=3*Ii[g+2];X=J([us[p],us[p+1],us[p+2]],[us[O],us[O+1],us[O+2]]),H=J([us[p],us[p+1],us[p+2]],[us[G],us[G+1],us[G+2]])}return[X,H]}},getCachedTexture:function(){var T=this,g=T.data,c=g._currentCubeElementId;return c!=S?T._cubeCachedImage?T._cubeCachedImage[c]:null:T._shape3dCachedImage},setCachedTexture:function(X){var G=this,Q=G.data,e=Q._currentCubeElementId;e!=S?(G._cubeCachedImage||(G._cubeCachedImage={}),G._cubeCachedImage[e]=X):G._shape3dCachedImage=X},invalidateCachedTexture:function(g){var t,D,q,I=this;if((q=I._shape3dCachedImage)&&(g.deleteTexture(q),I._shape3dCachedImage=null),D=I._cubeCachedImage){for(t in D)g.deleteTexture(D[t]);I._cubeCachedImage=null}},vf:function(E,r){var U=this;if(U.gv.getFaceVisible(U.data,E)){var H=ps(U,E);H.mat&&(U.faceMat=!0);var P=H.uv;if(P){var C=U._cubeUvs;C||(C=U._cubeUvs=new am([0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0]));for(var V=0;8>V;V++)C[r+V]=P[V]}return H}},_billboardInView:function(){var e=[-.5,-.5,0,-.5,.5,0,.5,-.5,0,.5,.5,0],f=[-.5,0,-.5,-.5,0,.5,.5,0,-.5,.5,0,.5],F=new nb,E=new Ob,A=new Fl;return function(w){var z=this;if(!z.mat)return!0;var b=z.gv.getFrustum(),X="billboard"===w?e:f;F.makeEmpty(),A.fromArray(z.mat);for(var P=0,x=X.length;x>P;P+=3)F.expandByPoint(E.fromArray(X,P).applyMatrix4(A));return b.intersectsBox(F)}}(),_80o:function(V,A,T){var L=this;if(L._rectOverlapping)return!0;var z=L.shapeModel;if(z||!L.shapeName){var v=L.s("shape3d");if(("billboard"===v||"plane"===v)&&!L._billboardInView(v))return!0;var Z=L.gv,x=L.data,f=Z._cube;Vl(Z,L.mat),L.s("shape3d.reflector")&&!V._picking||(z?gn(Z,x,z,L,L.getBodyColor(),T):(Gd(V,f.vs,S,A.aPosition),Gd(V,f.ns,S,A.aNormal),Uo(V,f.is),L._18O(V,A,L.left,0,T),L._18O(V,A,L.front,6,T),L._18O(V,A,L.right,12,T),L._18O(V,A,L.back,18,T),L._18O(V,A,L.top,24,T),L._18O(V,A,L.bottom,30,T))),vc(Z),L.faceMat&&(L._18O(V,A,L.left,0,T,!0),L._18O(V,A,L.front,6,T,!0),L._18O(V,A,L.right,12,T,!0),L._18O(V,A,L.back,18,T,!0),L._18O(V,A,L.top,24,T,!0),L._18O(V,A,L.bottom,30,T,!0))}},_18O:function(v,s,r,O,K,H){if(r){if(!K(r.transparent))return;if(H&&!r.mat||!H&&r.mat)return;var d=this.data.s("polygonOffset");d&&xo(v,d),H&&Vl(this.gv,r.mat);var i=this,A=i.data;A._currentCubeElementId=O;var _=i.gv,F=_.getTexture(r.texture,A),M=r.uv,y=r.uvScale,w=r.uvOffset,I=r.discardSelectable;F?M?qo(v,s,F,I,_._buffer.uv,i._cubeUvs,w,y):qo(v,s,F,I,_._cube.uv,S,w,y):qo(v),Yi(v,s,r.blend,r.light,r.opacity,r.reverseFlip,r.reverseColor,r.reverseCull),Wj(v,s.uDiffuse,r.color||n["color.empty"]),Mo(v,O,6),uf(v,s),ul(v,s,F),H&&vc(_),d&&ro(v),A._currentCubeElementId=null}},drawReflector:function(){var v=new Ob,j=new Ob,G=new pi,D=new Fl,_=new Ob,c=new Ob,m=new Ob,Z=new Ob,l=new Fl,J=new Fl,q=new Ko,Y=new wd,H=new wd,M=function(t,K,F){t[F]=K[0],t[F+1]=K[1],t[F+2]=K[2]},I=function(k,n){M(k,n.getEye(),0),M(k,n.getCenter(),3),M(k,n.getUp(),6)},T=function(a,O){O._eye=[a[0],a[1],a[2]],O._center=[a[3],a[4],a[5]],O._up=[a[6],a[7],a[8]],O._18Q=S;var q=O._skyBox;q&&(q.p3([a[0],a[1],a[2]]),O.getData3dUI(q).iv())};return function(R,k,f,X,x){var C=this;C._reflectorInfo=null;var E=C.data;if(E._reflecting)return!1;var b=C.gv;if(x)return!1;var O=C._reflectorRenderTarget;O?O.setSize(R,k,f):O=C._reflectorRenderTarget=new Er.RenderTarget(b,R,k,f),v.copy(E.p3()),j.copy(b.getEye()),D.makeRotationFromEuler(G.set(E.r3(),E.getRotationMode(),!0));var V;if(!C._reflectNormal){var V=di(C,C.s("shape3d"));if(!V)return!1;if(!V.ns&&V.length&&(V=V[0]),!V.ns||!V.vs)return!1;C._reflectNormal=[V.ns[0],V.ns[1],V.ns[2]],C._reflectorVbuffer=Rk.Buffer.createVertexBuffer(R,new Float32Array(V.vs))}if(_.copy(C._reflectNormal),_.applyMatrix4(D),c.subVectors(v,j),c.dot(_)>0)return!1;c.reflect(_).negate(),c.add(v),m.copy(b.getCenter()).negate().add(v),m.reflect(_).negate(),m.add(v),Z.copy(b.getUp()),Z.reflect(_);var i=[0,0,0,0,0,0,0,0,0];I(i,b),b._eye=c.toArray(),b._center=m.toArray(),b._up=Z.toArray(),b._18Q=S;var n=b._skyBox;n&&(n.p3(b._eye),b.getData3dUI(n).iv()),Jk(R,O.frame),R.viewport(0,0,O.width,O.height),R.clearColor(0,0,0,1),R.clear(R.COLOR_BUFFER_BIT);var u=Yq(b),g=Id(b);q.setFromNormalAndCoplanarPoint(_,v),q.applyMatrix4(J.fromArray(g)),Y.set(q.normal.x,q.normal.y,q.normal.z,q.constant),H.x=(Math.sign(Y.x)+u[8])/u[0],H.y=(Math.sign(Y.y)+u[9])/u[5],H.z=-1,H.w=(1+u[10])/u[14],Y.multiplyScalar(2/Y.dot(H));var M=E.s("shape3d.reflector.clip"),B=M===d?.003:M;u[2]=Y.x,u[6]=Y.y,u[10]=Y.z+1-B,u[14]=Y.w;var N=b._computedProjectMatrix;b._computedProjectMatrix=u,E._reflecting=!0,X(),b._computedProjectMatrix=N,l.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),l.multiply(J.fromArray(b._projectMatrix)),l.multiply(J.fromArray(b._viewMatrix)),Nk(R),T(i,b);var y=fl.Reflector.shader;return y||(y=fl.Reflector.shader=new Rk.Shader(R,fl.Reflector.vs,fl.Reflector.fs)),y.bind(),R.activeTexture(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,O.texture),y.uniforms.tDiffuse=0,y.uniforms.color=jb(E.s("shape3d.reflector.color")||"rgb(128,128,128)"),y.uniforms.textureMatrix=l.toArray(),y.uniforms.modelMatrix=Gn(E),y.uniforms.viewMatrix=Id(b),y.uniforms.projectionMatrix=Yq(b),C._reflectorVbuffer.upload(),y.attributes.pos.pointer(C._reflectorVbuffer),R.drawArrays(R.TRIANGLES,0,6),E._reflecting=!1,R.useProgram(b._prg),!0}}()}),fl.Reflector={vs:["attribute vec3 pos;","uniform mat4 textureMatrix;","uniform mat4 modelMatrix;","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","varying vec4 vUv;","void main() {","	vUv = textureMatrix * modelMatrix * vec4( pos, 1.0 );","	gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4( pos, 1.0 );","}"].join("\n"),fs:["precision highp float;","uniform vec3 color;","uniform sampler2D tDiffuse;","varying vec4 vUv;","float blendOverlay( float base, float blend ) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","vec3 blendOverlay( vec3 base, vec3 blend ) {","	return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );","}","void main() {","	vec4 base = texture2DProj( tDiffuse, vUv );","   vec2 tUv = vUv.xy / vUv.w;","   if (tUv.x < .0 || tUv.y < .0 || tUv.x > 1. || tUv.y > 1.) discard;","	gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );","}"].join("\n")};var Si=function(C,n){Lk(Si,this,[C,n])};jd(Si,ck,{_25Q:1,validate:function(H){var W=this,R=W.gv,u=W.data,$=W.s,p=$("edge.width"),n=u._40I,c=u._41I;if(W.shapeModel=W.info=S,n&&c){var m,N,k,y,t,L,f,T,_,O,Q=u.isLooped(),G=$(ug),h=X.getEdgeType(G);if(h){var s=h(u,oi(W,R,u,Q,G),R,W._19Q);if(!s.points||s.points.isEmpty())return;L=W.info={},f=s.segments,t=s.points,T=t.size();for(var l=n.getElevation(),B=c.getElevation(),x=0;T>x;x++){var q=t.get(x);q.e==S&&(q.e=l+(B-l)*x/(T-1))}_=wj(t.get(0)),O=wj(t.get(T-1));var M=T%2;0===M?(L.c1=wj(t.get(T/2-1)),L.c2=wj(t.get(T/2))):L.p3=wj(t.get((T-M)/2)),L.s1=_,L.s2=wj(t.get(1)),L.t1=wj(t.get(T-2)),L.t2=O}else{t=new Kf,L=W.info={};var Y=$("edge.offset"),F=$("edge.center"),P=$("edge.source.t3"),d=$("edge.target.t3"),D=W._getEdge3dHostPoint(n,"source"),v=W._getEdge3dHostPoint(c,"target");if(P&&(D[0]+=P[0],D[1]+=P[1],D[2]+=P[2]),d&&(v[0]+=d[0],v[1]+=d[1],v[2]+=d[2]),G===xe){f=$("edge.segments");var g=L.points=$(Ab)||le;if(T=g.size()){_=wj(g.get(0)),O=wj(g.get(T-1)),!F&&Y&&(k=$b(_,D,!0),Y=o(Y,zq(D,_)),D=[D[0]+k[0]*Y,D[1]+k[1]*Y,D[2]+k[2]*Y],k=$b(v,O,!0),Y=o(Y,zq(O,v)),v=[v[0]-k[0]*Y,v[1]-k[1]*Y,v[2]-k[2]*Y]);var M=T%2;0===M?(m=wj(g.get(T/2-1)),N=wj(g.get(T/2))):L.p3=wj(g.get((T-M)/2)),L.s1=D,L.s2=_,L.t1=O,L.t2=v}else!F&&Y&&(k=$b(v,D,!0),y=zq(D,v),Y=Ek(Y,y),D=[D[0]+k[0]*Y,D[1]+k[1]*Y,D[2]+k[2]*Y],v=[v[0]-k[0]*Y,v[1]-k[1]*Y,v[2]-k[2]*Y]),m=D,N=v;t.add({x:D[0],y:D[2],e:D[1]}),t.addAll(g),t.add({x:v[0],y:v[2],e:v[1]})}else{var i=oi(W,R,u,Q,G);if(W._19Q||(i=-i),Q){var C=D[0],K=D[1],r=D[2],w=n.getTall()/2+i;m=[C-i,K+w,r],N=[C+i,K+w,r],t.add({x:C-i,y:r,e:K}),t.add({x:C-i,y:r,e:K+w}),t.add({x:C+i,y:r,e:K+w}),t.add({x:C+i,y:r,e:K})}else{k=$b(v,D,!0),y=zq(D,v);var b={x:D[0],y:D[2]},z={x:v[0],y:v[2]},A=no(S,b,z,i),j=A.x-b.x,I=A.y-b.y;Y=Ek(Y,y),k[0]*=Y,k[1]*=Y,k[2]*=Y,m=[D[0]+k[0]+j,D[1]+k[1],D[2]+k[2]+I],N=[v[0]-k[0]+j,v[1]-k[1],v[2]-k[2]+I],F?(t.add({x:D[0],y:D[2],e:D[1]}),t.add({x:m[0],y:m[2],e:m[1]}),t.add({x:N[0],y:N[2],e:N[1]}),t.add({x:v[0],y:v[2],e:v[1]})):(t.add({x:m[0],y:m[2],e:m[1]}),t.add({x:N[0],y:N[2],e:N[1]}))}}L.c1=m,L.c2=N}L.list=$(fm)===Um?W.createTubeModel(t,f,p/2,H):W.createLineModel(t,f,p,"edge","edge.dash")}},_getEdge3dHostPoint:function(l,O){if(!zm(l))return l.p3();var E=this;O="edge."+O+".anchor.";var V=E.s(O+"x"),A=E.s(O+"elevation"),n=E.s(O+"y");if(V===d&&A===d&&n===d)return l.p3();var v=Gn(l,E.gv.getMat(l)),S=l.getAnchor3d();return Yp([(V===d?.5:V)-S.x,(A===d?.5:A)-S.y,(n===d?.5:n)-S.z],v)}});var cn=function(E,c){Lk(cn,this,[E,c])};jd(cn,an,{_80o:function(R,q,p){var H=this,v=H.gv,y=H.shapeModel;Vl(v,H.mat),y?gn(v,H.data,y,H,H.getBodyColor(),p):(mn(H,R,q,H.left,p),mn(H,R,q,H.front,p),mn(H,R,q,H.right,p),mn(H,R,q,H.back,p),mn(H,R,q,H.top,p),mn(H,R,q,H.bottom,p)),vc(v)},validate:function(K,l){var L,R,T=this,i=T.s,Q=T.data,P=Q.p3(),u=Q._thickness/2,z=Q.isClosePath(),y=Q.getPoints(),h=Q.getSegments(),E=i(De),o=K&&K.uv;if(T.clear(),0>u)R=T.shapeModel=Ti(y,h,i(Ol),i(bk),E,i(Wi),Q.getTall(),Q.getShapeElevation(),z),i(eh)?i("shape3d.image")||delete R.uv:(delete R.vs,delete R.ns,delete R.uv),i("shape3d.top.image")||delete R.top_uv,i("shape3d.bottom.image")||delete R.bottom_uv;else if(i(fm)===Um)L=ge(y,h,E,z),R=T.shapeModel={vs:[]},i("shape3d.image")&&(R.uv=[],R.sum=i(Wi)||qs(L)||1,R.len=0),i(Ol)&&!z&&(R.top_vs=[],i("shape3d.top.image")&&(R.top_uv=[])),i(bk)&&!z&&(R.bottom_vs=[],i("shape3d.bottom.image")&&(R.bottom_uv=[])),T._12O(L,u);else{var H,e,f,k,g,D,Y,N,$,W;if(L=ge(y,h,E,z),g=T.vf(Cn,o,!1,l),u&&(D=T.vf(cp,o,!1,l),Y=z?S:T.vf(zc,o,!1,l),N=z?S:T.vf(br,o,!1,l),$=T.vf(Dc,o,!1,l),W=T.vf(fd,o,!1,l)),u){for(var r=0,I=L.length;I>r;r++)L[r]=T._tryRemoveBezierPoints(L[r],u);T._12O(L,u)}else g&&L.forEach(function(V){if(k=V.length,k>0)for(H=V[0],f=1;k>f;f++)e=V[f],T.addV(g.vs,H,e),H=e});T._20Q(L),K||(g&&(g.ns=nn(g.vs),Xo(g,"vs"),Xo(g,Zg)),u&&(D&&(D.ns=nn(D.vs),Xo(D,"vs"),Xo(D,Zg)),Y&&(Y.ns=nn(Y.vs),Xo(Y,"vs"),Xo(Y,Zg)),N&&(N.ns=nn(N.vs),Xo(N,"vs"),Xo(N,Zg)),$&&($.ns=nn($.vs),Xo($,"vs"),Xo($,Zg)),W&&(W.ns=nn(W.vs),Xo(W,"vs"),Xo(W,Zg))))}var t=T.mat=Xc();qj(t,P),Lp(t,Q.getFinalRotation3d(),Q.getRotationMode());var M=Q.getScale3d(),J=Q._dynamicScale3d;J&&(M[0]*=J[0],M[1]*=J[1],M[2]*=J[2]),Bi(t,M),qj(t,Cq(P)),K&&(ob(T,t,K,R),T.clear())},_20Q:function(N){var M,z,_,g,D,V,o,f=this,j=f.front,J=f.back,B=f.top,U=f.bottom,n=j?j.tuv:S,C=J?J.tuv:S,Q=B?B.tuv:S,p=U?U.tuv:S,r=0;(n||C||Q||p)&&(M=f.s(Wi)||qs(N)||1,N.forEach(function(k){if(z=k.length,z>0)for(V=k[0],_=1;z>_;_++)o=k[_],g=r/M,r+=zq(V,o),D=r/M,f._14O(j,g,D),f._14O(J,1-D,1-g),f._14O(B,g,D),f._14O(U,g,D),V=o}))},_14O:function(u,D,H){if(u){var x=u.uv,j=u.tuv;if(j){if(x)var K=x[0]+(x[6]-x[0])*D,T=x[1]+(x[7]-x[1])*D,o=x[2]+(x[4]-x[2])*D,n=x[3]+(x[5]-x[3])*D,$=x[2]+(x[4]-x[2])*H,A=x[3]+(x[5]-x[3])*H,t=x[0]+(x[6]-x[0])*H,b=x[1]+(x[7]-x[1])*H;else K=D,T=0,o=D,n=1,$=H,A=1,t=H,b=0;j.push(o,n,$,A,t,b,t,b,K,T,o,n)}}},_13O:function(_){var Q=_.uv,L=_.tuv;L&&(Q?L.push(Q[2],Q[3],Q[4],Q[5],Q[6],Q[7],Q[6],Q[7],Q[0],Q[1],Q[2],Q[3]):L.push(0,1,1,1,1,0,1,0,0,0,0,1))},_tryRemoveBezierPoints:function(O,N){var E=O.length;if(4>E)return O;var y,L,p,r,q,J,H=!1,A=function(D){return O[D]},c=function($){return O[E-1-$]};for(q=0;1>=q;q++)for(J=q?c:A,L=J(0),p=J(1),y=2;E-1>y;y++)if(r=J(y),!r.remove)if(r.b){var S=no(L,p,r,N);S.adjust?(r.remove=!0,H=!0):(L=p,p=r)}else L=p,p=r;if(!H)return O;var Y=[];for(y=0;E>y;y++)O[y].remove||Y.push(O[y]);return Y},_12O:function(P,V){var A,w,L,G,E,R=this.s("shape3d.point.epsilon"),b=this;P.forEach(function(W){if(E=W.length,E>0)for(A={p:W[0],n:!0},G=1;E>G;G++)w=W[G],L=E-1>G?W[G+1]:S,L&&Math.abs(w.x-L.x)<R&&Math.abs(w.y-L.y)<R||b.addPoint(A,w,L,V,W)})},addPoint:function(f,e,R,X,H){var T,L,I,o,K,F,O,i,$,k=this,J=f.p,E=f.f,j=f.b,m=k.s("shape3d.side")||cb,Y=k.s("shape3d.start.angle"),a=k.s("shape3d.sweep.angle"),c=k.shapeModel,w=k.data.isClosePath();if(f.n&&(f.n=!1,E=w&&H.length>2?no(H[H.length-2],J,e,X):no(S,J,e,X),j=Xe(J,E),c?c.top_vs&&k._10O(j,E,m,Y,a,c.top_vs,c.top_uv):(T=k.left)&&(k.addV(T.vs,j,E),k._13O(T))),L=R?no(J,e,R,X):w&&H.length>2?no(J,e,H[1],X):no(J,e,S,X),I=Xe(e,L),c){var G,x,l=c.vs,t=c.uv,N=c.sum;for(t&&(G=c.len/N,c.len+=zq(J,e),x=c.len/N),F=k._9O(j,E,m,Y,a),O=k._9O(I,L,m,Y,a),i=0;m>i;i++)$=i+1,qh(l,F[$]),qh(l,O[i]),qh(l,F[i]),qh(l,O[i]),qh(l,F[$]),qh(l,O[$]),t&&(o=i/m,K=$/m,t.push(G,K,x,o,G,o,x,o,G,K,x,K));!R&&c.bottom_vs&&k._10O(I,L,m,Y,a,c.bottom_vs,c.bottom_uv,!0)}else!R&&(T=k.right)&&(k.addV(T.vs,L,I),k._13O(T)),(T=k.front)&&k.addV(T.vs,E,L),(T=k.back)&&k.addV(T.vs,I,j),(T=k.top)&&k.addH(T.vs,E,L,I,j,!0),(T=k.bottom)&&k.addH(T.vs,j,I,L,E);f.p=e,f.f=L,f.b=I},_10O:function(U,A,Q,p,v,b,X,s){var i,K,B=this,h=B.data,z=B._9O(U,A,Q,p,v),M=(U.x+A.x)/2,T=(U.y+A.y)/2,e=h.getShapeElevation(),F=0;for(F=0;Q>F;F++)s?(qh(b,z[F]),qh(b,z[F+1])):(qh(b,z[F+1]),qh(b,z[F])),qh(b,[M,e,T]),X&&(s?(i=m*(F+1)/Q+p,K=m*F/Q+p):(i=m*F/Q+p,K=m*(F+1)/Q+p),X.push(.5-.5*k(K),.5-.5*L(K),.5-.5*k(i),.5-.5*L(i),.5,.5))},_9O:function(M,O,A,q,t){var r,G,i=this,C=i.data,Y=[],n=(M.x+O.x)/2,T=(M.y+O.y)/2,R=C.getTall()/2,l=C.getShapeElevation(),h=0;for(t=t||m;A>=h;h++)r=t*h/A+q,G=k(r),Y.push([n+(M.x-n)*G,l+R*L(r),T+(M.y-T)*G]);return Y},addV:function(z,E,Q){var A=E.x,f=E.y,m=Q.x,h=Q.y,C=this.data,B=C.getShapeElevation(),s=C.getTall()/2;z.push(A,B-s,f,m,B-s,h,m,B+s,h,m,B+s,h,A,B+s,f,A,B-s,f)},addH:function(F,a,b,T,l,o){var D=this.data,N=D.getTall()/2,Y=D.getShapeElevation()+(o?N:-N);F.push(a.x,Y,a.y,b.x,Y,b.y,T.x,Y,T.y,T.x,Y,T.y,l.x,Y,l.y,a.x,Y,a.y)},vf:function(d,U,k,h){var W,B=this,c=B.gv.getFaceVisible(B.data,d);return(k||c)&&(W=ps(B,d,h),W.vs=[],W.tuv=c&&(W.texture||U)?[]:S,W.visible=c),W}});var Gr=function(m,q){Lk(Gr,this,[m,q])};jd(Gr,ck,{_25Q:1,validate:function(u){var M=this,O=M.data,A=M.s,U=O.getPoints(),w=U.size();if(M.shapeModel=M.info=S,w>1){var G=M.info={},h=O.getSegments(),V=O.getThickness(),i=wj(U.get(0)),T=wj(U.get(w-1)),F=w%2;0===F?(G.c1=wj(U.get(w/2-1)),G.c2=wj(U.get(w/2))):G.p3=wj(U.get((w-F)/2)),G.s1=i,G.s2=wj(U.get(1)),G.t1=wj(U.get(w-2)),G.t2=T,G.list=A(fm)===Um?M.createTubeModel(U,h,V/2,u):M.createLineModel(U,h,V,"shape.border","shape.dash")}var e=O.p3(),D=M.mat=Xc();qj(D,e),Lp(D,O.getFinalRotation3d(),O.getRotationMode());var c=O.getScale3d(),P=O._dynamicScale3d;P&&(c[0]*=P[0],c[1]*=P[1],c[2]*=P[2]),Bi(D,c),qj(D,Cq(e))},_80o:function(q,p,X){var Z=this,H=Z.shapeModel;if(H){var B=Z.gv;Vl(B,Z.mat),gn(B,Z.data,H,Z,Z.getBodyColor(),X),vc(B)}}});var Yk=W.graph3d.VR=function(v){var s=this;s.gv=v,s._controllers=[],s.switch=new kh(s),s._enable=!1,s._defaultCallLater=W.Default.callLater,s._defaultCancelLater=Wc,"undefined"!=typeof E&&"VRFrameData"in E&&(s._frameData=new E.VRFrameData),s.measureOflength=1,s.eyesOffset=[0,0,0],s._orientation=new W.Math.Quaternion,s._lastHeadPose=[0,0,0],s._offsetToBeAdd=[0,0,0],s._fpsInfo={time:0,fps:0,frames:0}};jd(Yk,G,{ms_fire:!0,_42:function(a,Y,f,N){var C=this,E=C.gv;if(!E.drawFilter&&C._deviceInAction){var p=C._device;if(p){var U=C._measureOflength;p.depthNear=E.getNear()*U,p.depthFar=E.getFar()*U;var L=C._offsetToBeAdd;if(C.eyesOffset[0]+=L[0],C.eyesOffset[1]+=L[1],C.eyesOffset[2]+=L[2],L[0]=0,L[1]=0,L[2]=0,p.isPresenting===!1)return C._controllers.forEach(function(h){h&&h.update()}),E.iv(),!1;var $=C._frameData;p.getFrameData($);var k=$.pose.position;if(k){var S=C.toViewPosition(k);E.setEye(S),C._orientation.fromArray($.pose.orientation);var j=new W.Math.Vector3(0,0,-10*C._scaleFactor);j.applyQuaternion(C._orientation),E.setCenter([S[0]+j.x,S[1]+j.y,S[2]+j.z])}C._controllers.forEach(function(p){p&&p.update()}),E.setViewport(a,0,0,Y/2,f),C._viewMatrix=C._copyViewMatrix($.leftViewMatrix),C._projectMatrix=C._copyProjectMatrix($.leftProjectionMatrix),N(),E.setViewport(a,Y/2,0,Y/2,f),C._viewMatrix=C._copyViewMatrix($.rightViewMatrix),C._projectMatrix=C._copyProjectMatrix($.rightProjectionMatrix),N(),C._lastViewMatrix=C._viewMatrix,C._lastProjectMatrix=C._projectMatrix,C._viewMatrix=null,C._projectMatrix=null,C.submitFrame();var R=Date.now(),X=C._fpsInfo;return R-X.time>1e3?(X.fps=Math.round(1e3*(X.frames+1)/(R-X.time)),X.time=R,X.frames=0):X.frames++,!0}}},onVRDisplayPresentChange:function(){var k=this.isPresenting();this._injectGraphView(k),this.fp("present",!k,k)},getOrientation:function(){return this._orientation},addController:function(G){G=G||0;var _=this,Z=_.getController(G);return Z?Z:(Z=new pf(_,G),_._controllers.push(Z),Z)},getController:function($){$=$||0;for(var t=this._controllers,w=0,s=t.length;s>w;w++)if(t[w]&&t[w].id===$)return t[w];return null},removeController:function(e){e=e||0;for(var x=this._controllers,N=0,W=x.length;W>N;N++)if(x[N]&&x[N].id===e)return x.splice(N,1),!0;return!1},getLastHeadPose:function(){return this._lastHeadPose},toViewPosition:function(H,T){var M=this,c=M._scaleFactor,w=M._eyesOffset,A=M._lastHeadPose;return A[0]=H[0]*c,A[1]=H[1]*c,A[2]=H[2]*c,T?(T[0]=A[0]+w[0],T[1]=A[1]+w[1],T[2]=A[2]+w[2],T):[A[0]+w[0],A[1]+w[1],A[2]+w[2]]},addEyesOffset:function(h,l,f){var y=this._offsetToBeAdd;y[0]+=h,y[1]+=l,y[2]+=f},_copyViewMatrix:function(F){var h=this.dup(F),S=this._scaleFactor;h[12]*=S,h[13]*=S,h[14]*=S;var M=this._eyesOffset;if(M&&(M[0]||M[1]||M[2])){var o=M[0],T=M[1],Q=M[2];h[12]-=h[0]*o+h[4]*T+h[8]*Q,h[13]-=h[1]*o+h[5]*T+h[9]*Q,h[14]-=h[2]*o+h[6]*T+h[10]*Q}return h},shutdown:function(){var X=this._device;X&&X.isPresenting&&X.exitPresent()},isPresenting:function(){var z=this._device;return z&&z.isPresenting},_copyProjectMatrix:function(w){var k=this.dup(w),r=this._scaleFactor;return k[14]*=r,k},dup:function(S,o){for(var k=S.length,u=o||new Array(k);k--;)u[k]=S[k];return u},getViewMatrix:function(S){var M=this._viewMatrix;return M?this.dup(M,S):void 0},getProjectMatrix:function(){var X=this._projectMatrix;return X?this.dup(X):void 0},submitFrame:function(){var i=this;if(i._enable&&i._deviceInAction){var s=i._device;
s&&s.isPresenting&&(s.submitFrame(),i.gv.iv())}},getFps:function(){return this._fpsInfo.fps},intersectWorld:function(l){var K=this.gv;return K.intersectObjects(l,K.dm().getDatas())},setDevice:function(W){var $=this;$._device=W},_injectGraphView:function(){var a,f,_;return function(F){var C=this.gv;if(!F)return a&&(C.getWidth=a,C.getHeight=f,C.getDevicePixelRatio=_),void 0;var Z=this._device,U=Z.getEyeParameters("left"),v=U.renderWidth,W=U.renderHeight;a=C.getWidth,f=C.getHeight,_=C.getDevicePixelRatio,C.getWidth=function(){return 2*v},C.getHeight=function(){return W},C.getDevicePixelRatio=function(){return 1}}}(),_injectCallLaterFunc:function(D){var v=this;if(!D)return dk=W.Default.callLater=v._defaultCallLater,Wc=W.Default.cancelLater=v._defaultCancelLater,void 0;var v=this;dk=W.Default.callLater=function(P,F,Z,j){var M=v._device;return M&&M.isPresenting?j?J(function(){dk(P,F,Z)},j):M.requestAnimationFrame(function(){v._deviceInAction=!0,P.apply(F,Z),v._deviceInAction=!1}):v._defaultCallLater(P,F,Z,j)},Wc=W.Default.cancelLater=function(f,V){var T=v._device;return T&&T.isPresenting?V?B(f):T.cancelAnimationFrame(f):v._defaultCancelLater(f,V)}}}),G.defineProperties(Yk.prototype,{enable:{get:function(){return this._enable},set:function(O){var r=this;r._enable!==O&&(r._enable=O,O?(r.switch.showButton(),r._injectCallLaterFunc(!0)):(r.shutdown(),r.switch.hideButton(),r._injectCallLaterFunc(!1)),r.fp("enable",!O,O))}},measureOflength:{get:function(){return this._measureOflength},set:function(J){this._measureOflength=J;var M=this._scaleFactor=1/J;this._controllers.forEach(function(Z){Z&&Z._setScaleFactor(M)})}},eyesOffset:{get:function(){return this._eyesOffset},set:function(c){this._eyesOffset=c}},controllerModel:{get:function(){return this._controllerModel},set:function(L){var D;"object"==typeof L?(D=L.mtl,L=L.obj):(D=L+".mtl",L+=".obj");var i=this,F=i._controllerModel;F&&F.obj===L&&F.mtl===D||(F=i._controllerModel={obj:L,mtl:D},X.loadObj(L,D,{finishFunc:function(o,v){i._controllerModel===F&&X.setShape3dModel("vrControllerModel",v)}}))}},interactive:{get:function(){return!!this._interactive},set:function(c){!!c!=!!this._interactive&&(this._interactive=c,c&&this.addController(0),this.gv.getCoreInteractor().enableVR(c))}}});var pf=function(C,Z){function I(X){var c=navigator.getGamepads&&navigator.getGamepads();if(c)for(var P=0,H=0,A=c.length;A>P;P++){var h=c[P];if(h){var D=h.id;if("OpenVR Gamepad"===D||"OpenVR Controller"===D||0===D.indexOf("Oculus Touch")||0===D.indexOf("Spatial Controller")){if(H===X)return h;H++}}}}function j(n,w,k){return Math.abs(n[0]-w[0])<k&&Math.abs(n[1]-w[1])<k&&Math.abs(n[2]-w[2])<k?!0:!1}var f=this;f.vr=C,f.id=Z;var U,o,b=[0,0],S=[{id:"thumbpad",pressed:!1},{id:"trigger",pressed:!1},{id:"grips",pressed:!1},{id:"menu",pressed:!1}],D=new Uh;D.s("shape3d","vrControllerModel"),D.isController=!0,D.s("intersect",!1),f.getGamepad=function(){return o},f.isButtonPressed=function(U){for(var Q,h=0,r=S.length;r>h;h++)if(Q=S[h],Q.id===U)return Q.pressed;return!1},f.getNode=function(){return D};var W=.003;f.setRotationEpsilon=function(s){W=s};var p=5e-4,z=p;f.setPositionEpsilon=function(C){p=C,z=C*f.vr._scaleFactor},f._setScaleFactor=function(U){D.s3(U,U,U),z=p*U},f._setScaleFactor(f.vr._scaleFactor);var F,Y=new Tg,A=new Fl,x=[0,0,0],M=[0,0,0],k=new pi,a=new Ob,L=new ih;f.getRay=function(){return F?(L.origin.fromArray(x),L.direction.copy(a),F=!1,L):L},f.update=function(){if(U=o,o=I(Z),U!=o&&console.log("gamepad changed",o),!o||o.pose===d)return o=null,D.s("3d.visible",!1),void 0;if(X.getShape3dModel("vrControllerModel")){D.dm()||C.gv.dm().add(D),D.s("3d.visible",!0);var h=o.pose;if(null!==h){h.position&&(f.vr.toViewPosition(h.position,x),j(D.p3(),x,z)||(F=!0,D.p3(x))),h.orientation&&(Y.fromArray(h.orientation),a.set(0,0,-1).applyQuaternion(Y).normalize(),A.makeRotationFromQuaternion(Y),k.set(0,0,0,D.getRotationMode(),!0).setFromRotationMatrix(A),M[0]=k.x,M[1]=k.y,M[2]=k.z,j(D.r3(),M,W)||(F=!0,D.r3(M))),F&&C.fp("gamepad.pose",null,{position:x,rotation:M,id:Z});var v=o.axes;(b[0]!==v[0]||b[1]!==v[1])&&(b=[v[0],v[1]],C.fp("gamepad.axes",null,{id:Z,axes:b}));var y,e,O,u,Q=o.buttons;for(y=0,e=Q.length;e>y;y++)if(O=Q[y],u=O.pressed,u!==S[y].pressed){S[y].pressed=u;var J={id:Z},N="state";J[N]=J._62O=u?"down":"up",C.fp("gamepad.button."+S[y].id,null,J)}}}}},kh=function(T){this.vr=T,this._button=null};jd(kh,G,{showButton:function(){var C=this.assureButton();if(!C.parentNode){var N=this.vr.gv,Y=N.getView();N._79O?Y.insertBefore(C,N._79O):Y.appendChild(C)}},hideButton:function(){var M=this._button;M&&M.parentNode&&M.parentNode.removeChild(M)},assureButton:function(){var q=this._button;return q?q:this._button=this.createButton(this.vr.gv)},createButton:function(T){function J(F,J){F.textContent=J&&J.isPresenting?"关闭 VR 显示":"开启 VR 显示"}function P(_){j.style.display="",j.style.cursor="pointer",j.style.left="calc(50% - 50px)",j.style.width="100px",J(j,_),j.onmouseenter=function(){j.style.opacity="1.0"},j.onmouseleave=function(){j.style.opacity="0.5"},j.onclick=function(){_.isPresenting?_.exitPresent():_.requestPresent([{source:T.getCanvas()}])},T.vr.setDevice(_)}function A(){j.style.display="",j.style.cursor="auto",j.style.left="calc(50% - 75px)",j.style.width="150px",J(j,null),j.onmouseenter=null,j.onmouseleave=null,j.onclick=null,T.vr.setDevice(null)}function u(_){_.style.position="absolute",_.style.bottom="20px",_.style.padding="12px 6px",_.style.border="1px solid #fff",_.style.borderRadius="4px",_.style.color="#000",_.style.font="normal 13px sans-serif",_.style.textAlign="center",_.style.opacity="0.5",_.style.outline="none",_.style.zIndex="999"}if("getVRDisplays"in navigator){var j=this._button=l.createElement("button");return j.style.display="none",u(j),s(E,"vrdisplayconnect",function(A){P(A.display)}),s(E,"vrdisplaydisconnect",function(){A()}),s(E,"vrdisplaypresentchange",function(x){J(j,x.display),T.vr.onVRDisplayPresentChange()}),navigator.getVRDisplays().then(function(S){S.length>0?P(S[0]):A()}),j}var v=l.createElement("a");return v.href="https://webvr.info",v.innerHTML="当前不支持 webvr",v.style.left="calc(50% - 90px)",v.style.width="180px",v.style.textDecoration="none",u(v),v}}),G.defineProperties(kh.prototype,{});var Cs=W.graph3d.PostProcessing=function(K){function Q(){if(!q){var e=K.getGL();q=new Er.RenderTarget(K,e,null,null,{samples:n.renderTextureSamples||1}),D=new Rk.Shader(e,j.vs,j.fs),S=Rk.Buffer.createIndexBuffer(e,new Uint16Array([0,2,1,1,2,3])),b=Rk.Buffer.createVertexBuffer(e,new Float32Array([0,0,1,0,0,1,1,1]))}}var q,D,S,b,p=this,B={},U=!1;!function(){G.keys(Cs).forEach(function(t){B[t]=new Cs[t](K)})}(),p.getModule=function(P){return P?B[P]:p},p.getModuleList=function(){return G.keys(B)},p.handleDataModleChange=function(b,$){b&&(b.setPostProcessingData(p.serialize()),b.removeSerializeListener(p.onDataModelSerialize,p)),$&&($.addSerializeListener(p.onDataModelSerialize,p),p.deserialize($.getPostProcessingData()))},p.onDataModelSerialize=function($){"serialize"===$.type?K.dm()._postProcessingData=p.serialize():"deserialize"===$.type&&p.deserialize(K.dm().getPostProcessingData())},p.serialize=function(){var l,X,m,V,W={};for(l in B)m=B[l],X=l.toLowerCase(),W[X]={enable:m.enable},V=m.serializeProperties,V&&V.forEach(function(Q){W[X][Q]=m[Q]});return W},p.deserialize=function(g){if(g){var G,b,z,a,A;for(b in g)if(b&&(G=b[0].toUpperCase()+b.slice(1),z=B[G])){a=g[b],p.enableModule(G,a.enable);for(A in a)"enable"!==A&&(z[A]=a[A])}}else{var G,z;for(G in B)z=B[G],z.enable=!1,z.resetProperties&&z.resetProperties()}},p.decodeShader=function(n){var o,$,T,i="",q="";for(T=0;T<n.length;T++)o=n[T],"%"===o?o="'":"a"===o?o='"':"]"===o&&(o="\\"),$=String.fromCharCode(o.charCodeAt(0)-1),T%2?q+=$:i=$+i;return q+i},p.createShader=function(r,C,t){var E=C.indexOf("^#"),h=p.decodeShader(C.substr(0,E)),l=p.decodeShader(C.substr(E+2));if(t){var s=t(h,l);s&&s.vs&&(h=s.vs),s&&s.fs&&(l=s.fs)}return new Rk.Shader(r,h,l)},p.enableModule=function(b,x){var g,I,l,K=b.split(",");for(g=0,I=K.length;I>g;g++)l=K[g].trim(),B[l]&&(B[l].enable=x);U=!1;for(l in B)if(B[l].enable){U=!0;break}U&&Q()};var j={vs:["attribute vec2 pos;","varying vec2 vUv;","void main(void) {","gl_Position = vec4(pos.x * 2.0 - 1.0, -pos.y * 2.0 + 1.0, 0.0, 1.0);","vUv = vec2(pos.x, 1.0 - pos.y);","}"].join("\n"),fs:["precision highp float;","uniform sampler2D image;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(image, vUv);","}"].join("\n")};p._42=function(t,Z,W,d,G){if(U&&!G){q.setSize(t,Z,W),q.bind(t),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),K.setViewport(t,0,0,Z,W),d(),q.unbind(t);for(var y=0,I=K._glCapabilities.maxAttributes;I>y;y++)t.disableVertexAttribArray(y);var z,j=q;for(z in B)j=B[z]._42(t,j)||j;return K.setViewport(t,0,0,Z,W),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),D.bind(),t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,j.texture),D.uniforms.image=0,S.upload(),b.upload(),D.attributes.pos.pointer(b),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.bindTexture(t.TEXTURE_2D,null),t.useProgram(K._prg),!0}}},Jn=W.graph3d.PostProcessing.Bloom=function(V){function N(){var o=V.getGL();if(o)for(var K=V._postProcessing,I=0;z>I;I++)y[I]=K.createShader(o,Jn._35Q,function(a,J){return{fs:J.replace(/DEFINE_VALUE/g,R[I]).replace("%OVERRIDE_ALPHA_DEFINE%",P?"#define OVERRIDE_ALPHA":"")}})}function b(){var q=V.getWidth(),O=V.getHeight();if(q&&O){t=[q,O],X=!0;var x,S=V.getGL(),R=Math.round(t[0]/2),m=Math.round(t[1]/2);for(u=new Er.RenderTarget(V,S,R,m),x=0;z>x;x++)K.push(new Er.RenderTarget(V,S,R,m)),_.push(new Er.RenderTarget(V,S,R,m)),R=Math.round(R/2),m=Math.round(m/2);var d=V._postProcessing;n=d.createShader(S,Jn._34Q),N(),a=d.createShader(S,Jn._36Q,function(v,q){return{fs:q.replace(/NUM_MIPS/g,z)}}),$=d.createShader(S,Jn.finalShader),F=Rk.Buffer.createIndexBuffer(S,new Uint16Array([0,2,1,1,2,3])),o=Rk.Buffer.createVertexBuffer(S,new Float32Array([0,0,1,0,0,1,1,1]))}}var w,M,v,P,F,o,x=this,f=!1,X=!1;this.serializeProperties="strength,threshold,radius,overrideAlpha".split(","),this.resetProperties=function(){w=1.5,M=.55,v=.4,P=!1},G.defineProperties(x,{enable:{get:function(){return f},set:function(G){!!f!=!!G&&(f=G,G&&!X&&b())}},strength:{get:function(){return w},set:function(v){w=v}},threshold:{get:function(){return M},set:function(y){M=y}},radius:{get:function(){return v},set:function(x){v=x}},overrideAlpha:{get:function(){return P},set:function(A){!!P!=!!A&&(P=A,X&&N())}}}),this.resetProperties();var u,n,a,$,t=[256,256],K=[],_=[],z=5,R=[3,5,7,9,11],y=[];x._42=function(N,G){function j($,f,k,D){Jk(N,f.frame),V.setViewport(N,0,0,f.width,f.height),D?D(N):N.clear(N.COLOR_BUFFER_BIT|N.DEPTH_BUFFER_BIT),R!==$&&$.bind();var i=0;for(var h in k){var J=k[h];J instanceof WebGLTexture&&(N.activeTexture(N.TEXTURE0+i),N.bindTexture(N.TEXTURE_2D,J),J=i,i++),$.uniforms[h]=J}for(R!==$&&(F.upload(),o.upload(),$.attributes.pos.pointer(o),R=$),N.drawElements(N.TRIANGLES,6,N.UNSIGNED_SHORT,0);i--;)N.activeTexture(N.TEXTURE0+i),N.bindTexture(N.TEXTURE_2D,null);Nk(N)}if(f&&(X||(b(),X))){var R;j(n,u,{smoothWidth:.01,luminosityThreshold:M,tDiffuse:G.texture});var S,T=u,i=Math.round(t[0]/2),m=Math.round(t[1]/2);for(S=0;z>S;S++)j(y[S],K[S],{colorTexture:T.texture,direction:[1,0],texSize:[i,m]}),j(y[S],_[S],{colorTexture:K[S].texture,direction:[0,1],texSize:[i,m]}),i=Math.round(i/2),m=Math.round(m/2),T=_[S];return j(a,K[0],{blurTexture1:_[0].texture,blurTexture2:_[1].texture,blurTexture3:_[2].texture,blurTexture4:_[3].texture,blurTexture5:_[4].texture,bloomStrength:w,bloomRadius:v,bloomTintColor:[1,1,1]}),j($,G,{image:K[0].texture},function(h){h.enable(h.BLEND),h.blendEquation(h.FUNC_ADD),h.blendFunc(h.SRC_ALPHA,h.ONE)}),N.blendEquationSeparate(N.FUNC_ADD,N.FUNC_ADD),N.blendFuncSeparate(N.SRC_ALPHA,N.ONE_MINUS_SRC_ALPHA,N.ONE,N.ONE_MINUS_SRC_ALPHA),G}}};Jn._34Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!jbtijqpmob!!i-jmhfiyqf!ug!m-psbpum<pDvuovjqgupvspn!!)tybjnnq!m>f!ss3pEm!puDEhjbgsgGv`tmfh<<v*o!jwg!p-sinu!egjmXpibuup!pmnvtn!j,o!petmjpuiztUfissifUtziupjmtep<ojvnovjmg!p-senm!pgimtpfbsui!UtznupjptupioXjjnevumi!<)qwfbustzijuophp!nwtf!d>3!!bwiVqwm<b!wupbjpem!gnb<j*o1)/*1!!|-1w/f1d!5-!1u/f1y!f-m1!/>1!)u5fdyfuwv!s>f!3sEp)m!puDEujvgqguvvtpf!-5!dwfVww!<**<!bwnfvdm4!!-m{vznyb/!m>f!ywffud!4))u!p1e/!3>:!:w-!!u1b/p6m9g8-<!*1!/522",Jn._35Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qsgfjdejotfj$po<!*ibj/hyijqQ!fgsmvpubyuf<u!w-bnsvzTjuoihh!jwffxd03n!vwTVfwt<vgvgojjeg)p5sdnf!wt!b>n!qsmpfmsp3DEh!bdspGm`pmshUffytumvfs$f<<*v1o/j2g!p-snnv!Twufidh3j!fuxf0ynTvjT{fft<vgvgojjeg)p5sdnf!ww!f>d!3s!pemjpsDfhdbusjGp`om<h$BeIfQgMjBo`fF!ELJFSSSOFFWMP`!SgBfEeJgVjT$!E~FG<JxO!F+`!W1B/M3V!F>,$!enfvgTjuoifh!jTfJxHN<Bx!!E+F!G*J3OfFm`qWnBbMtV!F,!&2PfWmFqSnSbJtE)F!`>B,M!QnIvBT`fEtFvGgJgOjFe&<gcmhpsb/u*!uhfbtvgtgtPjwbvo!Q.e!gw)Vjwo!!-gfmspvbuuy!fyU-s!pjmop!dg!m)pEb3uf!stvjuhynfbu*!!>|!3sffmuqvnsbot!!14/d4f:w9:<5c!h+s!/f*yuqf)t!g.g1P/w6v!!+,!!yw!V+w!!y-0f)s!vtujyhfnUbs!p+m!ptdj!h)nEb3*f*s0vtujyhfnub!<>!~2fwmpqjneb!tn!b4jdof)w*!<|y!w+f!df3{!jjTowwoTjj!{+f!!o>p!j2u/d1f!s0j!eu!f>y!Tujf{tfg<gPgwmvp!b3ud!fgwTj<h*nbbn!h>j!Tggm!p-byu))gTeJQHoNbBj*t<tvgbmhp!b>u!!xx!fujbhpimugTv<n*!j>)!uhbbpvmtgt!j>b!oyQ!eugb)p1m/g1-|!!g*T!j,h,n!bj*!<<TwVfJdE5B!Su`fMyFuOvSsFfLQ!j=y!!j>!!<u2f!y>u!vjs!fu3oEj)!!)dsppmgps<UnfvyTuuvishfj-f!xw!V+w!*c<hsw/fydj4Q!fesjvgugyvftuf!T>v!n",Jn._36Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*d!j*twjVpwo!!-i6jfhsivqu!ygfmUpsbvum<c)wEb3sfzsjvouhy!fwuf!d+3!!*w1V/w2<!-vsopjmgppDsuno!jtUbnnpqpmmfcs)35Ed!fcwm!v+s!U*f3y/u1v)ssfp2u<dbvGonjpgppmsCnq!stfbmnq!m,f!s*3wEV!wc!m-v5sfUsfvyuuyvfsUfs3v<mcv)oEj3gfpssvnu!ytfbun!q+m!f*s13/E2!!c-msvpsmUpfDyuuovjsUfn4p<pmvco)j5gdpfswn!!+t!b*n5q/m1f)ss3pEu!dcbmGvnspUpfmyCuqvssffm5<!,v!o*jwgVpws!n-!4tfbsnvqumyffsU3sEv!mccm)vEs3Uffsyvuuvysffu6!<+!v*o1j/g2p!s-ns!ptmbpnDqumofjsU3nEp!pemjcs)u5Udffywu!v+s!f*<7/v1o)jsgppusdnb!GgnmpppbmuC!qcsmfpmpn!T,u!s*fwoVhwu!i-<3fvsovjugypfsUns!vgmmcp)bEu3!fcsmvpupynfSub!e+j!v*t1</2v!o-jsgppmspnD!uwofjdU4n!pcpmmpcp)n5Udjfowu!D+p!m*p9s/<1)gsmppubdub!GmnfpspqmCCmqpspfnmGb!d,u!p*sw)Vdwp!o-t2uf!sjvou!ygfmUpsbvum!cg)bEd3ufpssv*u!y|fug!m+p!b*u1!/n2j!s-ssppsmGpbDduuopjsU!n>p!p2m/c3)!5.d!fgwb!d+u!p*s1</2s)fsupvusdob!Gnnjpyp)mgCbqdsufpms!-)!!n+j!sisuphsoGfbsduuTpnsp-p!mccm!p>p!nsSpbmepjDvhtb*s<G`~mhwp|j!e*!)nobj",Jn.finalShader="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f*dwjVtwj!p-of!hibjnhji)qE!3gfmspvbuuy<fuv!o>j!gsppsmnp!DthbbnsqGm`fmsh3E|!!j*n)bohjfb<n!webjspzwjo<hw!Vwwf!d3";var nq=W.graph3d.PostProcessing.Dof=function(D){function g(){k=!0;var t=D.getGL();z=new Er.RenderTarget(D,t),i=D._postProcessing.createShader(t,nq._38Q),y=Rk.Buffer.createIndexBuffer(t,new Uint16Array([0,2,1,1,2,3])),f=Rk.Buffer.createVertexBuffer(t,new Float32Array([0,0,1,0,0,1,1,1]))}var z,i,y,f,s,o,p,w,x=this,u=!1,k=!1;this.serializeProperties="aperture,maxblur,image".split(","),this.resetProperties=function(){this.aperture=.025,this.maxblur=1,this.image=null},G.defineProperties(x,{enable:{get:function(){return u},set:function(z){!!u!=!!z&&(u=z,z&&!k&&g())}},image:{get:function(){return o},set:function(G){o!==G&&(o=G,s&&(D.getGL().deleteTexture(s),s=null),D.iv())}},maxblur:{get:function(){return p},set:function(q){p!==q&&(p=q,D.iv())}},aperture:{get:function(){return w},set:function(s){w!==s&&(w=s,D.iv())}}}),this.resetProperties(),x._42=function(e,U){function n(P,n,Z,F){Jk(e,n.frame),D.setViewport(e,0,0,n.width,n.height),F?F(e):e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),T!==P&&P.bind();var C=0;for(var E in Z){var l=Z[E];l instanceof WebGLTexture&&(e.activeTexture(e.TEXTURE0+C),e.bindTexture(e.TEXTURE_2D,l),l=C,C++),P.uniforms[E]=l}for(T!==P&&(y.upload(),f.upload(),P.attributes.pos.pointer(f),T=P),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0);C--;)e.activeTexture(e.TEXTURE0+C),e.bindTexture(e.TEXTURE_2D,null);Nk(e)}if(u){k||g();var T;if(!s){var j=Oi(this.image);if(!j||!j.tagName)return U;s=xb(e,j)}var d=U.width,Y=U.height;if(d&&Y)return z.setSize(e,d,Y),n(i,z,{tColor:U.texture,tDepth:s,aspect:d/Y,aperture:this.aperture,maxblur:this.maxblur}),z}}};nq._38Q="~bu<u*szj/ctvpuqf!!.w!f1d/32!!q-pyt/<tpwqb)s3zdjfowh!!>w!fwdV3w!w<V*w1</2w!p-j1e/!1n!b-j1o/)2w!p,j!e1*/!3|!+h!mz`/Qtpptqj.u!j-p1o/!2>!!.w!f1d/53)!q+p!ty/^#~qs<f1d/j2t!j>p!ob!/isjphmipqD!hgbmspGb`um<hw<b1s/z2j5o!h0!!wmfpdd3!!>w!Vswp<mpvDohjbgspGs`nm!hcp<p*m!!5vstvfmEcfgqpuei!<+!v*o!jugdpfssns!ptdbundqfmqftsb3!E+!!u*D!p5m/p1s!<-1v/o1j!g)p3sdnf!wt!b)n!q,m!fzsy3/Ew!VuwE!f-qsupim<pDvuo!j)gEp3sfns!vgumypfbuu!!>n,b!ymcpmdvs<<*!v5osjvgmpcsgnp!eg!m+p!b*u!!ubdqffsssupvdsufd<fqvtobj!g+p!s*n!!:g3m/p1b.u!!-o:f3b/s1D.m!j)q3<dfvwo!j)g!p,s!nz!yg/mwpVbwu!!-gsbpsmDpmDjuq!<)Ev3ofjsgvpusynf!ug!m>p,b!um!pgdpd<v*t!<5svvomjcggppsen!!+g!m*p!buud!fbstsqpfdduud<fqdtpbo!t+u!!*g!m1p/b1u!!-V5o/q1b.d!l)E3pdxfowt!d)b!m,f!!z>y!/3w6V6w/!!-0s!p3m6p7D/u<!!)0E03!f1s/v/u2y!f.u?!!>g,s!bmdpudjp<o*!!)5fsyvdmmcvgepjeo!h+!!2**!uddpfostsup!dwufddf4q!tQbb!d+l!G*b!d:u3p/s1t!!->:!3w/f1d.4!))!33d6f7w/!!)+!!,3!6z7y//!w+V!w3!6-7s/p-m!p3D6u7!/)!E+3!f3s6v7u/y-f!u3!6>7,/!!m*p<dd<p*o!t5us!vwmfcdg5p!eV!o+q!b*d!luGdbfdsusppsdtu!d>f!qVtobq!b+d!l*E!p5x/o1t.d!b-m1f/!10!!)w3fddf5w)!!)Q!b,d!lzGyb/dwuVpws!t--s!p2m/p!D*u<!)gEm3pfbsuv!uvyofqub!d>l,S!HmCpBdUp<E*f!q5usiv)m!cdgppoet!u+!!j*o!!uwdffds5s!pwd!u*d!f|qt!bs!f+u!v*s!o:!3e/p1u.)!!-w:-3!/V1o!q)b3ddlfGwb!d)u!p,s!tz!y*/<wV~w!g-msppbmup!Dhuf!u)EEf3qfusiv)u!ydfpuo!t>u,!!jmop!dwf<d*3!!5tsdvsmfcfgopQep!t+j!u*j!puod!f*s!s|pd\nusdffuqvtsbo!!+v!o*q!b1d/l1S!H-C5B/U1p!E)f3qdufiw)!!)u!f,y!uzvys/fw3VEw)!!-usEpfmqpuDiu-!!)tEd3sffsfvouQypftuj!u>j,p!om!p*d!*<<*!~5sgvmmpcbgup!eq!f+s!t*q!fuddufjswsfpEdfuqdufiqUtpbW!j+f!x*[!):!3d/p1o!t-u:!3j/o1!!g)m3pdbfuw!!j)o!w,D!mzjyq/[w-V!wd!p-ostpum!pjDou!!g)mEp3bfus!voufybfsu-!!>d,p!omtpud!j<o*!!g8mspvbmuc!ggpbes!!+*!!*|!u!dsffsusvpsdou!d)f!qotfbb!s+!!+*!!g5b/s1!!*-!10/!1)!!))3!dgfbws!!).!!,o!fzbys/!w*V!w+!!-jsopwmDpmDjuq![)!E.3!fgsbvsu!y*f<u!~>,g!mmppbdu!<h*f!u8Wsjvfmxc[g)p!ed!p+o!t*u!!ujdof!sgsmppdbuud!feqftqbu!i+!!**!!|:3\n/s1f.u!v-s:o3!/q1f.s!t)q3fddfuwj!w)f!E,f!qzuyi/UwpVWwj!f-xs[p)m!peDfuq!u)iE-3!fosfvbusyDfmuj!q>-,!!gmbpsdDm<j*q!!8*s<vm~cgwppej!e+!!n*b!juod)f*s!s|pdwufddf3q!tebp!g+c!m*v!s1</1w!f-d53/!1b.t!q)f3ddufdwp!s)s!f,d!uz!y>/!wwVfwd!3-)s!p2m/p1D-u!!b)tEq3ffdsuv!u*y<fuj!g>!,)!vmtpfdEf<q*u!i8*s!v|mc!ggpmep!b+u!!*w!jufdxf[s!s>p!dhufdufWqjtfbx![+)!!*h!f:u3E/f1q!u-i:)3!/w1V.w!!)*3!d*f<w!!)g!m,p!bzuy!/gwbVdwu!p-ss!p>m!p)D!ug!p)dEv3tf!s,v!uwyjffux![>!,*!<mp!dep<g*c!m8vssv!m>c!gwpfed!3+!!)*!!dumdbfnsqs)p!dgubddfuqptsb!!++!!b*q!f5s/u1v.s!f--1!/.1n!b)y3cdmfvws!-)!!n,b!yzcym/vwsV!w*!!-*s<pm~pDfum!t)fE!3|fs!veupygfcum!v>s,!!>m!pwdfd<3*!!)8!sdvmmbcngqp)e!!u+f!y*u!vusdff3sEs)p!duuEdffqqutib-!!+w!f*d!3:)3w/V1w./!y--:!32//11!!).3!dwfVww!/)z!*,!!*z/yb/!w+V!wb!q-fsspumvpsDfu-!!).En3bfyscvmuvysf-u!!n>b,y!cmmpvds!<**!!*8<sv~mcwgfpde3!!+e!p*g!cumdvfss:s!p>d!uedpfgqctmbv!s+!!+*!!11//:1<!-w1f5d/31!!e)p3gdcfmwv!s)8!!,>!!zeyp/gwcVmwv!s-!s+p!m1p/D8u<!)wEf3df3s!veupygfcum!v>s,5!!m>p!dep<g*c!m8vssv!m+c!g1p/e5!<+!w*f!du5d!fdspsmp!d>u!dwffqdt5b)!!+1!/*1!!:*3</1d!p-m:!3,/>1!!u)f3ydufvws!f)3!E,)!!zuyD/pwmVpws!--!swpVmwp/Dyuz!!)*E<3fdspvmu!y,f>u!!u>f,y!umvpsdf3<E*)!!:usDvpmmcpgsp-e!!w+V!w*/!yuzd!f,s!s)p!dwufddf3q)t!b1!/+1!-*!!18/45/!1*.!!+-!6b2t/q1f!d)u3ddpfsws!f)d!u,!!*z!y+/!weVpwg!c-msvpsm!p*D<u!d)pEm3!f,s>v!uuyffyuu!v>s,f!3mEp)d!u<D*p!m:pssv-m!cwgVpwe/!y+z!!*,!!u)d!fwsfsdp3d)u!d1f/q2t6b-!!+1!/*4!86!2*/!1+.!!b-t8q4f/d1u.d!p)s3sdffdwu!!)*!!,+!!zeyp/gwcVmwv!s-!s*p<mpdDpum!!),E>3!fusfvyuuyvfsuf!3>E,)!!mupDdpm<p*s!-:!swvVmwc/gypze!!,+!!)*!!wufddf3s)s!p1d/u3d:f-q!t1b/!3+:!!**!!6+2!/b1t!q-f8d4u/d1p!s)s3fddfuw!!*)!!+,!!ezpyg/cwmVvws!!-*s<pmdppDmu!!,)>E!3uffsyvuuvysffu3!E>),!!umDppdmp<s*-!!:wsVvwm/cygzp!e,!!+)!!*w!fudd3f)s!s.p1d/u4d8f-q!t1b/!2+6!!**!!8+4!/b1t!q-f6d2u/d1p.s!s)f3dduf!w*!!)+!!,e!pzgyc/mwvVsw!!*-<spdmppmD!u,!>)!Eu3ffysuvvusyff3uE!)>!,u!Dmppmdps<-*!!w:Vswv/myczg!p,e!!)+!!w*f!du3d)f!s1s/p5d1u-d!f1q/t1b!!*+!!+*!!b8t4q/f1d.u!d-p6s2s/f1d.u!!)*3!d+f!we!p)g!c,m!vzsy!/*w<Vwd!p-ms!p,m>p!Duuf!y)uEv3sffs3vEu)y!fuuD!p>m,p!sm-p!dwV<w*/!y:zs!v,m!c)g!pwef!d+3!)*!!1u/d4f8s-s!p.d1u/d2f6q!t*b!!++!!b*t!q6f2d/u1d.p!s-s8f4d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!z:!s,v!m)c!gwpfed!3+)!!*1!/u3d:f-s!s.p1d/u3d:f!q*t!b+!!+b!t*q!f6d2u/d1p!s-s8f4d/u1!.*!!)+3!defpwg!c)m!v,s!!z*y</wdVpwm!!-,s>p!mupfDyuu!v)sEf33fEs)v!uuyDfpum!p>s,-!!mwpVdw/<y*z!!:,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s.p1d/u4d8f!q*t!b+!!+b!t*q!f8d4u/d1p!s-s6f2d/u1!!*)!3+d!fewp!g)c!m,v!sz!y*/<wVdwp!m-!s,p>m!puDfuy!u)vEs3ff3sEv)u!yufDup!m>p,s!-m!pwdVw</*y!zs!v,m!c)g!pwef!d+3!)*!!1u/d1f-s!s.p1d/u5d!f*q!t+b!!b+t!q*f!d8u4d/p1s.s!f-d6u2!/*1!!+)!3edpfgwc!m)v!s,!!*z<y/dwpVmw!!,->s!pumfpyDuuv!s)fE33Ef)s!vuuDypfmup!s>-,!!wmVpwd/y<z*!!,s!v)m!cwgfpde3!)+!!.*1!/u2d6f-s!s1p/d4u8d!f*q!t+b!!b+t!q*f!d:u3d/p1s.s!f-d:u3!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3EE3)f!suvDupymfpus!->!,w!Vmwp/dyz<!*,!!s)v!mwcfgdp3e)!!+.!1*/!3u:d-f!s1s/p3d:u!d*f!q+t!bb!t+q!f*d!u6d2p/s1s.f!d-u8!4*/!1+.!!e)p3gdcfmwv!s)!!*,<!zdyp/mw!V,w>!!-usfpymupvDsuf!3)EE)3!fusDvpumypfsu-!!>w,V!wm/pydz!<,*!!)s!vwmfcdg3p)e!!1+/!4*8!-u!d1f/s2s6p!d*u!d+f!qbttbq!f+d!u*d!p1s/s1f!d-u5!/*1!.+!!)e3pdgfcwm!v)s!!,*!<zyd/pwmV!w,!>-!supfmypuDvus!f)3E",uj(X,{accordionViewExpandIcon:oe(bb),accordionViewCollapseIcon:oe(bb,!0),accordionViewLabelColor:ah,accordionViewLabelFont:xc,accordionViewTitleBackground:lm,accordionViewSelectBackground:Ul,accordionViewSelectWidth:3,accordionViewSeparatorColor:d,splitViewDividerSize:1,splitViewDividerBackground:lm,splitViewDragOpacity:.5,splitViewToggleIcon:{width:16,height:16,comps:[{type:yg,rect:[2,2,12,12],background:bb}]},propertyViewLabelColor:Nc,propertyViewLabelSelectColor:ah,propertyViewLabelFont:xc,propertyViewExpandIcon:oe(ll),propertyViewCollapseIcon:oe(ll,!0),propertyViewBackground:hf,propertyViewRowLineVisible:!0,propertyViewColumnLineVisible:!0,propertyViewRowLineColor:de,propertyViewColumnLineColor:de,propertyViewSelectBackground:Ul,listViewLabelColor:Nc,listViewLabelSelectColor:ah,listViewLabelFont:xc,listViewRowLineVisible:!1,listViewRowLineColor:de,listViewSelectBackground:Ul,treeViewLabelColor:Nc,treeViewLabelSelectColor:ah,treeViewLabelFont:xc,treeViewExpandIcon:oe(ch),treeViewCollapseIcon:oe(ch,!0),treeViewRowLineVisible:!1,treeViewRowLineColor:de,treeViewSelectBackground:Ul,treeViewDoubleClickToToggle:!0,tableViewLabelColor:Nc,tableViewLabelSelectColor:ah,tableViewLabelFont:xc,tableViewRowLineVisible:!0,tableViewColumnLineVisible:!0,tableViewRowLineColor:de,tableViewColumnLineColor:de,tableViewSelectBackground:Ul,treeTableViewLabelColor:Nc,treeTableViewLabelSelectColor:ah,treeTableViewLabelFont:xc,treeTableViewExpandIcon:oe(ch),treeTableViewCollapseIcon:oe(ch,!0),treeTableViewRowLineVisible:!0,treeTableViewColumnLineVisible:!0,treeTableViewRowLineColor:de,treeTableViewColumnLineColor:de,treeTableViewSelectBackground:Ul,tableHeaderLabelColor:Nc,tableHeaderLabelFont:xc,tableHeaderColumnLineVisible:!0,tableHeaderColumnLineColor:td,tableHeaderBackground:hf,tableHeaderMoveBackground:mg,tableHeaderInsertColor:Ul,tableHeaderSortDescIcon:Xq(ll,!0),tableHeaderSortAscIcon:Xq(ll),tabViewTabGap:1,tabViewLabelColor:ah,tabViewLabelFont:xc,tabViewTabBackground:lm,tabViewSelectWidth:3,tabViewSelectBackground:Ul,tabViewMoveBackground:mg,tabViewInsertColor:Ul,toolbarLabelColor:Nc,toolbarLabelSelectColor:ah,toolbarLabelFont:xc,toolbarBackground:hf,toolbarSelectBackground:Ul,toolbarItemGap:8,toolbarSeparatorColor:fo},!0);var iq={translateX:1,sortColumn:1},kg={sortable:1,sortOrder:1,sortFunc:1},wf={focusData:1},Wg={dataModel:1,sortColumn:1,sortFunc:1,visibleFunc:1,rootData:1,rootVisible:1},Gc={dataModel:1,sortFunc:1,visibleFunc:1,categorizable:1},hj=function(l,i){i.add(l),l.hasChildren()&&l.eachChild(function(P){hj(P,i)})},ys=function(M,K,v,J,L,R,Q,c,u,z,A){var i,e=v.getValueType(z),H=v.getAlign(z);if(v.getEnumValues(z)){var T=v.toEnumLabel(K,z),W=tj||0,B=0,r=R,U=X.getTextSize(J,T).width;return i=Oi(v.toEnumIcon(K,z)),i&&(B=R+tj/2,"center"===H?B+=(c-(W+U))/2:"right"===H&&(B=B+c-(W+U)),ar(M,i,B,Q+u/2,z,A),r=B+tj/2),T!=S&&(i?Nl(M,T,J,L,r,Q,c-(r-R),u):Nl(M,T,J,L,R,Q,c,u,H)),void 0}return K=v.formatValue(K),K!=S?e===Cl?(Eh(M,R,Q,c,u,K),void 0):e===qd||!e&&Uf(K)?(i=Oi(K?Po:Ok),ar(M,i,R+c/2,Q+u/2,z,A),void 0):(Nl(M,K,J,L,R,Q,c,u,H),void 0):void 0},Bl=function(M,i){var x=i.view,D=gp(M),Q=i.column||i.property;x.getDataModel().beginTransaction(),i.editor=M,M.info=i,x.setCurrentEditor(M),x.getView().insertBefore(D,x._79O),Ap(M,i.editorRect),M.setFocus?M.setFocus():bd(M),M.commitValue=function(_,o){M._17Q&&(M=M._17Q),o||x.setValue(i.data,Q,M.getValue?M.getValue():M.value),M.close&&M.close(),ws(D)},Q.onEditorCreated&&Q.onEditorCreated(i)},Al=function(f,P,d,C,t){var N=Np(f,d),m=P.value,u=P.view,K=t.getValueType(P.data);return N.onblur=N.onchange=function(){u.endEditing()},"input"===f?(m=t.formatValue(m),m!=S&&(N.value=m),N.onkeydown=function(j){jo(j)?u.endEditing():_f(j)&&u.endEditing(!0)},(K===Pr||K===gl)&&s(N,vb,X.numberListener)):f===He&&C.forEach(function(p){var Y=l.createElement("option");Y.innerHTML=t.toEnumLabel(p),Y.value=p,t.isEnumEqual(m,p)&&(Y.selected=!0),lc(N,Y)}),Bl(N,P),N},Mr=W.widget={},Yo=function(S,i,I){jd(g+".widget."+S,i,I)};uj(zp,{ms_value:function(a){a.getValue=function(g){var q=this.getItemById(g),y=q.element;return Gk(y)?y:y?y.getValue?y.getValue():y.value:q.selected},a.setValue=function(B,N){var n=this.getItemById(B);if(n){var K=n.element;K&&!Gk(K)?K.setValue?K.setValue(N):K.value=N:Uf(N)?(n.selected=N,this.iv()):(n.element=N,this.iv())}},a.v=function(Q,B){var j=this;if(2===arguments.length)j.setValue(Q,B);else{if(!zn(Q))return j.getValue(Q);for(var A in Q)j.setValue(A,Q[A])}return j}},_46o:function(r){r._icon=S,r._accessType=S,r._valueType=S,r._editable=!1,r._batchEditable=!0,r._align=zc,r._nullable=!0,r._emptiable=!1,r.setParent=ln,r.formatValue=function(g){var O=this,u=O._valueType;return O.getEnumValues()?O.toEnumLabel(g):u===qd?!!g:g!=S&&u===Pr?t(g):g},r.setEnum=function(p,B,_,F,K,y,c){var x=this;p&&!En(p)&&p.values&&(F=p.editable,_=p.icons,B=p.labels,K=p.strict,y=p.maxHeight,c=p.dropDownWidth,p=p.values),dm(p)&&(p=p._as),dm(B)&&(B=B._as),dm(_)&&(_=_._as),x._enumValues=p,x._enumLabels=B,x._enumIcons=_,x._enumEditable=F,x._enumStrict=K==S?!0:K,x._enumMaxHeight=y,x._enumDropDownWidth=c,p&&p.length&&Vc(p[0])&&(x._valueType=gl),x.fp("enum",!1,!0)},r.getEnumDropDownWidth=function(){return this._enumDropDownWidth},r.getEnumMaxHeight=function(){return this._enumMaxHeight},r.isEnumEditable=function(){return this._enumEditable},r.getEnumValues=function(){return this._enumValues},r.getEnumLabels=function(){return this._enumLabels},r.getEnumIcons=function(){return this._enumIcons},r.isEnumStrict=function(){return this._enumStrict},r.isEnumEqual=function(g,m){return this._enumStrict?g===m:g==m},r.toEnumLabel=function(E,q){var M=this,H=M.getEnumValues(q),n=M.getEnumLabels(q);if(H&&n)for(var S=0;S<H.length;S++)if(M.isEnumEqual(E,H[S]))return n[S];return E},r.toEnumIcon=function(t,c){var k=this,_=k.getEnumValues(c),O=k.getEnumIcons(c);if(_&&O)for(var Q=0;Q<_.length;Q++)if(k.isEnumEqual(t,_[Q]))return O[Q];return d}},_45o:function(o){o._87o=function(n,e,g,C,z,D){if(n){var W=this,y=W._90I,X=Zj(1);W._columnLineVisible&&(z-=1),W._rowLineVisible&&(D-=1),0>=z||0>=D||(W._90I||(y=W._90I={}),y[e]||(y[e]=new Kf),Ap(X,W.tx()+g,W.ty()+C,z,D),lc(X,n),W._view.insertBefore(X,W._79O),n.onParentAdded&&n.onParentAdded(X),y[e].add(X))}},o._76o=function(){var R=this,T=R._90I;if(T){for(var $ in T)T[$].each(function(P){ws(P)});delete R._90I}},o._77o=function(n){var x=this;if(x._90I){var $=x._90I[n];$&&($.each(function(Z){ws(Z)}),delete x._90I[n])}}},_47o:function(D){D.getValue=function(h,c){return c.getValue?c.getValue(h,c,this):Fo(h,c.getAccessType(),c.getName())},D.setValue=function(g,m,k){if(m.isEmptiable(g)||""!==k||(k=d),m.isNullable(g)||k!=S){var w=this,F=m.getName(g),M=m.getAccessType(g),R=m.getValueType(g);R===Pr&&Gk(k)?k=$(k):R===gl&&Gk(k)?k=parseFloat(k):R===qd&&Gk(k)&&(k="true"===k),w._batchEditable&&m._batchEditable&&w.isSelected(g)?w.sm().each(function(D){m.setValue?m.setValue(D,m,k,w):$p(D,M,F,k)}):m.setValue?m.setValue(g,m,k,w):$p(g,M,F,k)}},D.setCurrentEditor=function(s){this.endEditing(),this._currentEditor=s,this.redraw()},D.isEditing=function(x,O){var h=this,V=h._currentEditor;if(!V)return!1;if(O){var g=V.info;return g?(g.column||g.property)===O&&g.data===x:!1}return!0},D.endEditing=function(g){var A=this,G=A._currentEditor;G&&(delete A._currentEditor,G.commitValue&&G.commitValue(G.info,g),A.redraw(),A.getDataModel().endTransaction())},D.beginEditing=function(z){this.endEditing();var u=this,D=z.column||z.property;if(D.beginEditing)D.beginEditing(z);else{var y=z.data,F=z.value,r=u.getSelectBackground(y),$=D.getEnumValues(y),M=D.getSlider(y),o=D.getColorPicker(y);if(M){var p=Mc(Mr.Slider,M);return p.setValue(F),p.getView().onblur=function(){u.endEditing()},p.isInstant()&&(p.onValueChanged=function(){u.setValue(y,D,p.getValue())}),Bl(p,z),void 0}if(o||D.getValueType(y)===Cl){var Y=Mc(Mr.ColorPicker,o);return Y.setValue(F),Y.onClosed=function(){u.endEditing()},Y.isInstant()&&(Y.onValueChanged=function(H,O){u.setValue(y,D,O)}),Bl(Y,z),Y.open(),void 0}if($){if(Mr.ComboBox){var c=new Mr.ComboBox;c.setValue(F),c.setValues($),c.setLabels(D.getEnumLabels(y)),c.setIcons(D.getEnumIcons(y)),c.setEditable(D.isEnumEditable(y)),c.setStrict(D.isEnumStrict(y)),c.setMaxHeight(D.getEnumMaxHeight(y)),c.setDropDownWidth(D.getEnumDropDownWidth(y)),c.onClosed=function(){u.endEditing()},Bl(c,z),c.open()}else Al(He,z,r,$,D);return}var V=D.getValueType(y);if(V===qd||Uf(F))return u.setValue(y,D,!F),void 0;if(D.getItemEditor(y)){var A=Lh(D.getItemEditor(y)),m=new A(y,D,u,z),i=m.getView();return i._17Q=m,m.setValue(F),nm(i),Bl(i,z),m.editBeginning&&m.editBeginning(),void 0}Al("input",z,r,S,D)}}},_44o:function(z){z.init=function(w){var D=this,g=D.th=new _r(w),s=D._view=Nm(1,D);D.tv=D._tableView=w,lc(s,g.getView()),lc(s,w.getView()),g.mp(function(z){z.property===ao&&D.iv()}),D.iv()},z.getTableView=function(){return this.tv},z.getTableHeader=function(){return this.th},z.getDataModel=function(){return this.tv.dm()},z.getColumnModel=function(){return this.tv.getColumnModel()},z.setColumns=function(s){this.tv.setColumns(s)},z.addColumns=function(A){this.tv.addColumns(A)},z.endEditing=function(){this.tv.endEditing()},z.validateImpl=function(){var J=this,o=J.th,D=Qf(o),k={x:0,y:0,width:J.getWidth(),height:D};Ap(o,k),k.y=D,k.height=V(0,J.getHeight()-D),Ap(J.tv,k)}},ms_vs:function(i){i._41o=function(){return this._29I.height<this._59I},i._43o=function(){var H=this;H._41o()&&(H._58I||(J(function(){H._94O()},fq),H.iv()),H._58I=new Date)},i._94O=function(){var c=this;if(c._58I){var V=new Date;V.getTime()-c._58I.getTime()>=fq?(delete c._58I,c.iv()):J(function(){c._94O()},fq)}},i._93I=function(){var N=this,l=N._27I;if(N._58I||!N._autoHideScrollBar){l||lc(N._79O,l=N._27I=Zj());var F=N._29I,p=F.height,f=N._59I,$=N.getScrollBarSize(),r=F.width-$-2,R=p*(-N.ty()/f),D=p*(p/f),x=l.style;f>p?(Ed>D&&(R=R+D/2-Ed/2,0>R&&(R=0),R+Ed>p&&(R=p-Ed),D=Ed),x.visibility=Qn,x.background=N.getScrollBarColor(),x.borderRadius=$/2+wo,Ap(l,r,R,$,D)):x.visibility=Ne}else l&&(l.style.visibility=Ne)}},ms_hs:function(U){U._40o=function(){return this._29I.width<this._91I},U._42o=function(){var p=this;p._40o()&&(p._95O||(J(function(){p._94I()},fq),p.iv()),p._95O=new Date)},U._94I=function(){var V=this;if(V._95O){var H=new Date;H.getTime()-V._95O.getTime()>=fq?(delete V._95O,V.iv()):J(function(){V._94I()
},fq)}},U._92I=function(){var o=this,f=o._28I;if(o._95O||!o._autoHideScrollBar){f||lc(o._79O,f=o._28I=Zj());var h=o._29I,D=h.width,T=o._91I,S=o.getScrollBarSize(),G=h.height-S-2,L=D*(-o.tx()/T),W=D*(D/T),R=f.style;T>D?(Ed>W&&(L=L+W/2-Ed/2,0>L&&(L=0),L+Ed>D&&(L=D-Ed),W=Ed),R.visibility=Qn,R.background=o.getScrollBarColor(),R.borderRadius=S/2+wo,Ap(f,L,G,W,S)):R.visibility=Ne}else f&&(f.style.visibility=Ne)}}}),oc(Po,Ec(16,16,[{type:Ni,rect:[1,1,14,14],background:Ul},{type:jl,rect:[1,1,14,14],width:1,color:Fi},{type:Jr,points:[13,3,7,12,4,8],borderWidth:2,borderColor:"#FFF"}])),oc(Ok,Ec(16,16,{type:jl,rect:[1,1,14,14],width:1,color:Fi})),oc(tc,Ec(16,16,[{type:Qm,rect:[2,2,12,12],borderWidth:1,borderColor:Fi,background:"#FFF"},{type:Qm,rect:[4,4,8,8],background:Ul}])),oc(og,Ec(16,16,{type:Qm,rect:[2,2,12,12],borderWidth:1,borderColor:Fi})),zp._15Q=function(U){U._29I=No,U._59I=0,U._91I=0,U._5o=function(Q){var y=this;y._30I=new Kf,y._rows=new Kf,y._rowMap={},y._31I=0,y._14I=0,y._view=Nm(1,y),y._canvas=kr(y._view),lc(y._view,y._79O=Zj()),y.dm(Q?Q:new Ag)},U.getCheckIcon=function(p){var I=this.sm(),B=I.co(p);return I.sg()?Oi(B?tc:og):Oi(B?Po:Ok)},U.checkData=function(T){var C=this.sm(),l=C.co(T);C.sg()&&l||(this._32o=1,l?C.rs(T):C.as(T),delete this._32o)},U.getDataAt=function(q){q.target&&(q=this.lp(q));var j=R(q.y/this._rowHeight),m=this._rows;return 0>j||j>=m.size()?S:m.get(j)},U.onDataDoubleClicked=function(){},U.onDataClicked=function(){},U.adjustTranslateX=function(){return 0},U.adjustTranslateY=function(O){var Y=this.getHeight()-this._59I;return Y>O&&(O=Y),O>0?0:t(O)},U.onPropertyChanged=function(X){var p=this,L=X.property;Wg[L]?p.ivm():wf[L]||p.redraw(),L===hg?p._42o():L===tg&&p._43o()},U.getLabel=function(h){return h.toLabel()},U.getLabelFont=function(){return this._labelFont},U.getLabelColor=function(T){var A=this;if(A.isCheckMode()){if(A._focusData===T)return A._labelSelectColor}else if(A.isSelected(T))return A._labelSelectColor;return A._labelColor},U.getStartRowIndex=function(){return this._31I},U.getEndRowIndex=function(){return this._14I},U.getRowDatas=function(){return this._rows},U.getRowIndex=function(j){return this._rowMap[j._id]},U.getRowSize=function(){return this._rows.size()},U.getViewRect=function(){return or(this._29I)},U.isVisible=function(z){return this._visibleFunc?this._visibleFunc(z):!0},U.getCurrentSortFunc=function(){return this._sortFunc},U.setDataModel=function(R){var d=this,p=d._dataModel,G=d._selectionModel;p!==R&&(p&&(p.umm(d.handleDataModelChange,d),p.umd(d.handleDataPropertyChange,d),p.umh(d.handleHierarchyChange,d),G||p.sm().ums(d.handleSelectionChange,d)),d._dataModel=R,R.mm(d.handleDataModelChange,d),R.md(d.handleDataPropertyChange,d),R.mh(d.handleHierarchyChange,d),G?G._21I(R):R.sm().ms(d.handleSelectionChange,d),d.fp("dataModel",p,R))},U.validateModel=function(){var G=this;G._rows.clear(),G._rowMap={},G.buildChildren(G._dataModel._roots);var O=G._rows=G._rows.toList(G.isVisible,G),L=0,F=G.getCurrentSortFunc(),X=O.size();for(F&&O.sort(F);X>L;L++)G._rowMap[O.get(L)._id]=L},U.buildChildren=function(u){var Q=this;u.each(function(G){Q._rows.add(G),Q.buildChildren(G._children)})},U.handleDataModelChange=function(){this.ivm()},U.handleDataPropertyChange=function(N){"parent"===N.property?this.ivm():this.invalidateData(N.data)},U.handleHierarchyChange=function(){this.ivm()},U.handleSelectionChange=function(u){u.datas.each(this.invalidateData,this),this.onSelectionChanged(u)},U.onSelectionChanged=function(I){var u=this,l=u.sm();!u.isAutoMakeVisible()||1!==l.size()||"set"!==I.kind&&"append"!==I.kind||u._32o||u.makeVisible(l.ld())},U.handleBackgroundClick=function(S){bh(S)&&!this.isCheckMode()&&this.sm().cs()},U.makeVisible=function(d){d&&(this._23I=d,this.iv())},U.scrollToIndex=function(s){var w=this,x=w._29I,U=x.height,Z=w._rowHeight,S=Z*s;s>=0&&s<w._rows.size()&&U>0&&(S+Z>x.y+U?w.ty(-S+U-Z):S<x.y&&w.ty(-S))},U.autoScroll=function(U,a){var m=this,k=m._rowHeight,T=k,l=k/4,n=m._29I,J=m.lp(U),y={x:m.tx(),y:m.ty()};return k>0&&n&&(J.x-n.x<T?m.translate(l,0):n.x+n.width-J.x<T&&m.translate(-l,0),J.y-n.y<T?m.translate(0,l):n.y+n.height-J.y<T&&m.translate(0,-l)),y.x=m.tx()-y.x,y.y=m.ty()-y.y,a&&(a.x+=y.x,a.y+=y.y),y},U.getTopRowOrderSelection=function(){var k=this.sm().getTopSelection(),N={},n=new Kf;return k.each(function(x){N[x._id]=x}),this._rows.each(function(F){N[F._id]&&n.add(F)}),n},U.getRowOrderSelection=function(){var X=new Kf;return this._rows.each(function(T){this.isSelected(T)&&X.add(T)},this),X},U.ivm=function(){this.invalidateModel()},U.invalidateModel=function(){var B=this;B._96I||(B._96I=1,B._32I=1,delete B._24I),B.iv()},U.redraw=function(){var T=this;T._32I||(T._32I=1,delete T._24I,T.iv())},U.invalidateData=function(J){var v=this;ol?v.redraw():v._32I||(v._24I||(v._24I={}),v._24I[J._id]=J,v.iv())},U.getFocusData=function(){return this._focusData},U.setFocusDataById=function(f){this.setFocusData(this.dm().getDataById(f))},U.setFocusData=function(E){var p=this,w=p._focusData;w!==E&&(p._focusData=E,p.fp("focusData",w,E),w&&p.invalidateData(w),E&&(p.invalidateData(E),p.isAutoMakeVisible()&&p.makeVisible(E)))},U.drawRowBackground=function(Q,G,V,a,R,i,I){var w=this,D=w.isCheckMode();(G===w._focusData&&D||V&&!D)&&Eh(Q,a,R,i,I,w.getSelectBackground(G))},U.drawData=function(G,N,a){var T=this,n=T._rowHeight,K=n*a,V=T._29I,Z=V.x,c=V.width;G.save(),G.beginPath(),G.rect(Z,K,c,n),G.clip(),T._87o(T.drawRow(G,N,T.isSelected(N),Z,K,c,n),a,Z,K,c,n),G.restore(),T._rowLineVisible&&Eh(G,Z,K+n-1,c,1,T._rowLineColor)},U._12I=function(S){var K=this,b=K._31I,v=K._29I,D=v.x,e=v.y,q=v.width,O=v.height;for(S.beginPath(),S.rect(D,e,q,O),S.clip(),S.clearRect(D,e,q,O),K._76o(),K._93db(S);b<K._14I;b++)K.drawData(S,K._rows.get(b),b);K._92db(S)},U._13I=function(r){for(var z,M=this,g=M._rowHeight,w=M._29I,Q=w.x,s=w.width,j=M._31I,U=M._30I;j<M._14I;j++)z=M._rows.get(j),M._24I[z._id]&&U.add({data:z,index:j});U.isEmpty()||(r.beginPath(),U.each(function(c){r.rect(Q,c.index*g,s,g)}),r.clip(),U.each(function(n){r.clearRect(Q,n.index*g,s,g)}),U.each(function(H){M._77o(H.index)}),M._93db(r),U.each(function(k){M.drawData(r,k.data,k.index)}),M._92db(r),U.clear())},U.preValidateModel=function(){this.endEditing&&this.endEditing()},U.validateImpl=function(){var I=this,z=I._canvas,_=I.getWidth(),J=I.getHeight(),K=I._rowHeight,c=I._32I;(_!==z.clientWidth||J!==z.clientHeight)&&(fp(z,_,J),c=1);var o=b&&!a;I._96I&&!o&&(I.preValidateModel(),I.validateModel());var p=I._29I,M={x:-I.tx(),y:-I.ty(),width:_,height:J},V=I._rows.size(),e=Md(z),H=I._23I;c||is(M,p)||(c=1),I._29I=M,I._59I=V*K+I.getScrollBarSize(),I._31I=R(M.y/K),I._14I=w((M.y+M.height)/K),I._31I<0&&(I._31I=0),I._14I>V&&(I._14I=V),I._99I&&c&&I._99I(),hq(e,I.tx(),I.ty(),1),c?I._12I(e):I._24I&&I._13I(e),I._93I(),I._92I(),e.restore(),I._32I=I._24I=I._96I=S,H&&(I.scrollToIndex(I.getRowIndex(H)),delete I._23I),I.tx(I.tx()),I.ty(I.ty())}},zp._48o=function(Y){Y._rootVisible=!0,Y._rootData=S,Y._35o=function(){this._expandMap={},this._levelMap={}},Y.validateModel=function(){var w=this,S=w._rootData;w._rows.clear(),w._levelMap={},w._rowMap={},w._currentLevel=0,S?w._rootVisible?w.isVisible(S)&&w.buildData(S):w.buildChildren(S):w.buildChildren(),delete w._currentLevel},Y.buildData=function(z){var F=this,I=z._id,V=F._rows;F._rowMap[I]=V.size(),V.add(z),F._levelMap[I]=F._currentLevel,F.isExpanded(z)&&(F._currentLevel++,F.buildChildren(z),F._currentLevel--)},Y.buildChildren=function(X){var J=this,n=X?X._children:J._dataModel._roots,m=J.getCurrentSortFunc();m&&J.isChildrenSortable(X)?n.toList(J.isVisible,J).sort(m).each(J.buildData,J):n.each(function(Y){J.isVisible(Y)&&J.buildData(Y)})},Y.getLevel=function(s){return this._levelMap[s._id]},Y.getToggleIcon=function(k){var F=this,H=F._loader,X=F._collapseIcon;return H&&!H.isLoaded(k)?X:k.hasChildren()?F.isExpanded(k)?F._expandIcon:X:S},Y.isCheckMode=function(){return this._checkMode!=S},Y.isChildrenSortable=function(){return!0},Y.handleDataModelChange=function(D){var Z=this;D.kind===li?delete Z._expandMap[D.data._id]:D.kind===vh&&(Z._expandMap={}),Z.ivm()},Y.toggle=function(V){var n=this;n.isExpanded(V)?n.collapse(V):n.expand(V)},Y.isExpanded=function(j){return 1===this._expandMap[j._id]},Y.expand=function(b){var Y=this,g=Y._loader;Y.isExpanded(b)||(g&&!g.isLoaded(b)&&g.load(b),Y._expandMap[b._id]=1,Y.ivm(),Y.onExpanded(b))},Y.onExpanded=function(){},Y.collapse=function(y){var d=this;d.isExpanded(y)&&(delete d._expandMap[y._id],d.ivm(),d.onCollapsed(y))},Y.onCollapsed=function(){},Y.expandAll=function(N){if(N)this.expand(N),N.eachChild(function(C){this.expandAll(C)},this);else{var m=this;m._dataModel.each(function(r){r.hasChildren()&&(m._expandMap[r._id]=1)}),m.ivm()}},Y.collapseAll=function(){this._expandMap={},this.ivm()},Y.makeVisible=function(U){if(U){var e=this;if(!e._rootData||U.isDescendantOf(e._rootData)){for(var C=U._parent;C;)e.expand(C),C=C._parent;e._23I=U,e.iv()}}},Y.checkData=function(G){var j,n=this,I=n._checkMode,K=n.sm(),w=K.co(G);if(!K.sg()||!w){if(n._32o=1,I===wn)w?K.rs(G):K.as(G);else if(I===wg)j=new Kf(G),j.addAll(G._children);else if("descendant"===I)j=new Kf,hj(G,j);else if("all"===I&&(j=new Kf,hj(G,j),!w))for(var O=G._parent;O;)j.add(O),O=O._parent;j&&(w?K.rs(j):K.as(j)),delete n._32o}},Y._97I=function(J,l,f,z,o,Z,X){var S=this,M=S._indent,G=S._levelMap[l._id],x=S.getIconWidth(l),H=Oi(S.getToggleIcon(l));H?(z+=M*G,ar(J,H,z+M/2,o+X/2,l,S),z+=M):z+=M*(G+1),S._checkMode&&(ar(J,S.getCheckIcon(l),z+M/2,o+X/2,l,S),z+=M),S.drawIcon(J,l,z,o,x,X),S.drawLabel(J,l,z+x,o,X)}},zp._14Q=function(y){y.getIcon=function(z){return z.getIcon()},y.getIconWidth=function(v){return this.getIcon(v)?this._indent:0},y.drawIcon=function(K,c,b,L,i,V){if(i){var F=this,g=F.getBodyColor(c),h=Oi(F.getIcon(c),g);h&&(V-=F.isRowLineVisible()?1:0,ng(K,h,pg,b,L,i,V,c,F,g),uc(K,F.getBorderColor(c),b,L,i,V))}},y.drawLabel=function(n,F,P,U,r){var E=this;Nl(n,E.getLabel(F),E.getLabelFont(F),E.getLabelColor(F),P,U,0,r)}},zp._50o=function(E){E._98I=function(){var E=this,G=E._39o=new Ag;E._60I=new Kf,G.mm(E._17o,E),G.md(E._18o,E),G.mh(E._19o,E)},E.setColumns=function(l){this._39o.clear(),this.addColumns(l)},E.addColumns=function(r){var z=this._39o;r.forEach(function(D){if(!(D instanceof Qb)){var H=Lh(D.className);D=Mc(H?H:Qb,D)}z.add(D)})},E.onColumnClicked=function(){},E.onCheckColumnClicked=function(){},E._3Q=function(r){for(var o,$=0,O=this._60I,A=O.size();A>$;$++)if(o=O.get($),o.column===r)return o;return S},E.getColumnAt=function(B){var V=this._4Q(B);return V?V.column:S},E._4Q=function(X){for(var W=this,e=X.target?W.lp(X).x:X.x,P=W._60I,T=0;T<P.size();T++){var E=P.get(T),R=E.startX;if(e>=R&&e<R+E.column.getWidth())return E}return S},E.getToolTip=function(e){var d=this,I=d.getDataAt(e),c=d.getColumnAt(e);return I&&c?c.getToolTip(I,d):S},E.adjustTranslateX=function(O){var q=this.getWidth()-this._91I;return q>O&&(O=q),O>0?0:t(O)},E._99I=function(){var L=this,J=L._29I,$=L._60I;$.clear(),L._91I=0,L._39o._roots.each(function(W){if(W.isVisible()){var D=L._91I+W.getWidth();L._91I<=J.x+J.width&&D>=J.x&&$.add({column:W,startX:L._91I}),L._91I=D}}),L._91I+=L.getScrollBarSize()},E.drawData=function(K,w,L){var b=this,g=b._rowHeight,m=g*L,h=b.isSelected(w),C=b._29I,l=C.x,u=C.width;b.drawRowBackground(K,w,h,l,m,u,g),b._60I.each(function(p){var P=p.column,n=p.startX,f=P.getWidth();f>0&&!b.isEditing(w,P)&&(K.save(),K.beginPath(),K.rect(n,m,f,g),K.clip(),b._87o(b.drawCell(K,w,h,P,n,m,f,g),L,n,m,f,g),b._columnLineVisible&&Eh(K,n+f-1,m,1,g,b._columnLineColor),K.restore())}),b._rowLineVisible&&Eh(K,l,m+g-1,u,1,b._rowLineColor)},E.drawCell=function(F,J,c,I,E,g,C,f){var z=this;if(I.drawCell)return I.drawCell(F,J,c,I,E,g,C,f,z);var _=z.getValue(J,I);ys(F,_,I,z.getLabelFont(J,I,_),z.getLabelColor(J,I,_),E,g,C,f,J,z)},E.getColumnModel=function(){return this._39o},E._17o=function(){this.redraw()},E._18o=function(B){var F=this;B.data===F._sortColumn&&kg[B.property]?F.ivm():(F._42o(),F.redraw())},E._19o=function(){this.redraw()},E.getCurrentSortFunc=function(){var F=this,z=F._sortColumn;if(z&&z.isSortable()){var $=z.getSortFunc(),P=ym===z.getSortOrder()?1:-1;return $||($=Ue),function(a,U){return $.call(F,F.getValue(a,z),F.getValue(U,z),a,U)*P}}return F._sortFunc},E.isCellEditable=function(g,$,y){return $.isEditable()&&this.isEditable()?$.isCellEditable?$.isCellEditable(g,$,y,this):!0:!1},E._37O=function(S,T){if(bh(T))for(var C=this,h=C.lp(T),P=C._60I,b=C._rowHeight,I=C._29I,G=I.x,X=I.y,n=I.width,j=I.height,z=0;z<P.size();z++){var v=P.get(z),x=v.startX,u=v.column,q=u.getWidth();if(u!==C._31o&&u!==C._4o&&h.x>=x&&h.x<x+q&&C.isCellEditable(S,u,T)){var L={x:x,y:C.getRowIndex(S)*b,width:q,height:b},Z={x:L.x+C.tx(),y:L.y+C.ty(),width:L.width,height:L.height},D=0,B=0;return L.x<G?D=L.x-G:L.x+L.width>G+n&&(D=L.x+L.width-G-n),D&&(C.tx(C.tx()-D),Z.x-=D),L.y<X?B=L.y-X:L.y+b>X+j&&(B=L.y+b-X-j),B&&(C.ty(C.ty()-B),Z.y-=B),C.beginEditing({data:S,column:u,value:C.getValue(S,u),event:T,rect:L,editorRect:Z,view:C}),void 0}}}},Mr.BaseItemEditor=function(R,x,T,Q){this._data=R,this._column=x,this._master=T,this._editInfo=Q},Yo("BaseItemEditor",G,{ms_ac:["data","column","master","editInfo"],editBeginning:function(){},getView:function(){},getValue:function(){},setValue:function(){}});var tp=W.Tab=function(){Lk(tp,this)};Xp("Tab",Pp,{ms_ac:["view","closable","disabled","visible"],_icon:S,_closable:!1,_disabled:!1,_visible:!0,setParent:ln});var Qb=W.Column=function(){Lk(Qb,this)};Xp("Column",Pp,{_46o:1,ms_ac:["accessType","valueType",Qn,Kg,Yh,ml,"align",Cl,"sortOrder",yn,"sortable","clickable","nullable","emptiable","slider","colorPicker","itemEditor"],_visible:!0,_width:80,_sortOrder:ym,_sortFunc:S,_sortable:!0,_clickable:!0,setWidth:function(x){16>x&&(x=16);var V=this._width;this._width=x,this.fp(ml,V,x)},getToolTip:function(F,j){return this.formatValue(j.getValue(F,this))}});var Hl=W.Property=function(){Lk(Hl,this)};Xp("Property",Pp,{_46o:1,ms_ac:["accessType","valueType",Kg,Yh,"categoryName",Cl,"align","nullable","emptiable","slider","itemEditor","colorPicker"],_categoryName:S,getToolTip:function(c,t,$){var Q=this;return t?Q.formatValue($.getValue(c,Q)):$.getPropertyName(Q)}}),Mr.AccordionView=function(){var s=this;s._20o={},s._21o=new Kf,s._10o=S,s._9o=S,s._11o=S,s._view=Nm(0,s),s.iv()},Yo("AccordionView",G,{ms_v:1,ms_fire:1,ms_ac:[$l,Iq,"titleHeight",Wr,uo,"titleBackground","selectWidth",Fp,"orientation","separatorColor"],_expandIcon:X.accordionViewExpandIcon,_collapseIcon:X.accordionViewCollapseIcon,_titleHeight:hl,_labelColor:X.accordionViewLabelColor,_labelFont:X.accordionViewLabelFont,_titleBackground:X.accordionViewTitleBackground,_selectBackground:X.accordionViewSelectBackground,_selectWidth:X.accordionViewSelectWidth,_orientation:"v",_separatorColor:X.accordionViewSeparatorColor,onPropertyChanged:function(){this.iv()},getView:function(){return this._view},getTitles:function(){return this._21o},getCurrentTitle:function(){return this._10o},add:function(M,I,t,D){var J=this,Z=Zj();if(J._20o[M])throw M+" already exists";Z.onmousedown=Ub,Z.style.cursor=Oc,s(Z,xl?vk:Oh,function(r){Ub(r)}),s(Z,xl?ik:ag,function(j){Ub(j),bh(j)&&(J._10o===M?J.collapse():J.expand(M))}),lc(J._view,Z),J._20o[M]={content:I,div:Z,canvas:kr(Z),icon:D},J._21o.add(M),t&&J.expand(M),J.iv()},remove:function(u){var E=this,C=E._20o[u];C&&(ws(C.div),delete E._20o[u],E._21o.remove(u),E.iv())},clear:function(){var t=this;t._21o.toArray().forEach(t.remove,t),t._20o={},t._21o.clear(),t.iv()},isExpanded:function(C){return this._10o===C},expand:function(z){var h=this;h._20o[z]&&h._10o!==z&&(h._10o=z,h.onExpanded(z),h.iv())},onExpanded:function(){},collapse:function(){var n=this;n._10o&&(n.onCollapsed(n._10o),delete n._10o,n.iv())},onCollapsed:function(){},initCanvas:function(x,d,r){fp(x,d,r);var V=Md(x);return hq(V,0,0,1),V.clearRect(0,0,d,r),V},drawTitle:function(p,q,O,X,E){var B=this,x=Oi(E.icon),K=B.isExpanded(q),N=B._titleHeight,Q=B._titleBackground,s=B._selectWidth,o=B._separatorColor,w=Oi(K?B._expandIcon:B._collapseIcon),v=s+4;Eh(p,0,0,O,X,Q),K&&s&&Eh(p,0,0,s,X,B._selectBackground),(K||B._21o.get(B._21o.size()-1)!==q)&&Eh(p,0,X-1,O,1,o?o:_o(Q)),x&&(ar(p,x,v+xq(x)/2,N/2),v+=xq(x)+2),Nl(p,q,B.getLabelFont(q),B.getLabelColor(q),v,0,0,N),w&&ar(p,w,O-xq(w)/2-4,N/2)},validateImpl:function(){var c=this,r=c._view,t=0,o=0,k=c.getWidth(),D=c.getHeight(),L=c._titleHeight,S=c._21o.size()*L,m=c._11o,q=c._9o;delete c._11o,delete c._9o,c._21o.each(function(w){var r,O,h=c._20o[w],R=h.content,e=c._10o===w;Rc(c)?(Ap(h.div,t,0,L,D),r=c.initCanvas(h.canvas,L,D),As(r,0,D),ap(r,-j),c.drawTitle(r,w,D,L,h),r.restore(),e?(O=V(0,k-S),R&&(c._11o=R,c._9o=gp(R),Ap(R,t+L,0,O,D)),t+=L+O):t+=L):(Ap(h.div,0,o,k,L),r=c.initCanvas(h.canvas,k,L),c.drawTitle(r,w,k,L,h),r.restore(),e?(O=V(0,D-S),R&&(c._11o=R,c._9o=gp(R),Ap(R,0,o+L,k,O)),o+=L+O):o+=L)});var I=c._9o;m&&m!==c._11o&&m.endEditing&&m.endEditing(),I&&I!==q&&lc(r,I),q&&q!==I&&ws(q)}}),Mr.SplitView=function(n,p,N,h){var r=this,V=r._dividerDiv=Zj(),R=r._60O=kr(),s=r._61O=kr(),b=R.style,v=s.style;r._view=Nm(1,r),lc(r._view,V),b.msTouchAction=nh,b.pointerEvents=nh,b.cursor=Oc,v.msTouchAction=nh,v.pointerEvents=nh,v.cursor=Oc,n&&r.setLeftView(n),p&&r.setRightView(p),N&&r.setOrientation(N),h!=S&&r.setPosition(h),r.setStatus(Qi),new Xl(r)},Yo("SplitView",G,{ms_v:1,ms_fire:1,ms_ac:["continuousLayout","dividerSize","dividerBackground","toggleIcon","togglable","dragOpacity","orientation","draggable","status"],_continuousLayout:!1,_position:.5,_togglable:!0,_orientation:"h",_draggable:!0,_dividerSize:X.splitViewDividerSize,_dividerBackground:X.splitViewDividerBackground,_dragOpacity:X.splitViewDragOpacity,_toggleIcon:X.splitViewToggleIcon,onPropertyChanged:function(){this.iv()},getDividerDiv:function(){return this._dividerDiv},getPosition:function(){return this._position},setPosition:function(O,G){var J=this,m=J._position;isNaN(O)||(G||(J._82O=0>O?-1:O>1?1:0),J._position=O,J.fp(Sp,m,O))},getLeftView:function(){return this._leftView},setLeftView:function(K){var c=this,m=c._leftView,z=c._view;if(c._leftView!==K){if(m&&m!==c._rightView){var X=gp(m);X.parentNode===z&&ws(X)}if(c._leftView=K,K){var t=gp(K);t.parentNode!==z&&z.insertBefore(t,c._dividerDiv)}c.fp("leftView",m,K)}},getRightView:function(){return this._rightView},setRightView:function(B){var f=this,L=f._rightView,H=f._view;if(f._rightView!==B){if(L&&L!==f._leftView){var d=gp(L);d.parentNode===H&&ws(d)}if(f._rightView=B,B){var p=gp(B);p.parentNode!==H&&H.insertBefore(p,f._dividerDiv)}f.fp("rightView",L,B)}},validateImpl:function(){var Q=this,F=Q._draggable,I=Q._position,s=Q.getWidth(),W=Q.getHeight(),x=Q._dividerSize,i=Q._dividerBackground,d=xl?18:8,M=Q._dividerDiv,K=Q._82O,T=Q._60O,S=Q._61O,c=Q._toggleIcon,X=Q._status,q=M.style,p=null,Z=xl?20:4,h=c.comps[0];x>=d||0===x?Q._coverDiv&&(ws(Q._coverDiv),delete Q._coverDiv):Q._coverDiv||(Q._coverDiv=Zj(),bl&&(Q._coverDiv.style.background=mo),lc(M,Q._coverDiv)),Q._togglable?T.parentNode||(lc(M,T),lc(M,S)):(ws(T),ws(S));var a=Q._coverDiv,N=Q._leftView,Y=Q._rightView;if(Rc(Q)){if(x>s&&(x=s),X===Qi)if(1===K)var v=o(I,s),k=V(0,s-x-v);else-1===K?(k=o(-I,s),v=V(0,s-x-k)):(v=t((s-x)*I),k=V(0,s-x-v));else"cl"===X?(v=0,k=V(0,s-x)):"cr"===X&&(k=0,v=V(0,s-x));N&&Ap(N,0,0,v,W),Y&&Ap(Y,v+x,0,k,W),Ap(M,v,0,x,W),Q._22o=v,a&&(Ap(a,x/2-d/2,0,d,W),a.style.cursor=F?Rd:""),M.style.cursor=F?Rd:"";var y=M.clientHeight/2,P=M.clientWidth;fp(T,P,P),Ap(T,0,y-P-Z,P,P),p=Md(T),hq(p,0,0,1),h.rotation=-j,rl(p,c,0,0,P,P),p.restore(),fp(S,P,P),Ap(S,0,y+Z,P,P),p=Md(S),hq(p,0,0,1),h.rotation=j,rl(p,c,0,0,P,P),p.restore()}else{if(x>W&&(x=W),X===Qi)if(1===K)var $=o(I,W),D=V(0,W-x-$);else-1===K?(D=o(-I,W),$=V(0,W-x-D)):($=t((W-x)*I),D=V(0,W-x-$));else"cl"===X?($=0,D=V(0,W-x)):"cr"===X&&(D=0,$=V(0,W-x));N&&Ap(N,0,0,s,$),Y&&Ap(Y,0,$+x,s,D),Ap(M,0,$,s,x),Q._22o=$,a&&(Ap(a,0,x/2-d/2,s,d),a.style.cursor=F?gr:""),q.cursor=F?gr:"";var l=M.clientWidth/2,P=M.clientHeight;fp(T,P,P),Ap(T,l-P-Z,0,P,P),p=Md(T),hq(p,0,0,1),h.rotation=0,rl(p,c,0,0,P,P),p.restore(),fp(S,P,P),Ap(S,l+Z,0,P,P),p=Md(S),hq(p,0,0,1),h.rotation=u,rl(p,c,0,0,P,P),p.restore()}q.background=i}});var Xl=function(A){this.sv=A,this.addListeners()};jd(Xl,G,{ms_listener:1,getView:function(){return this.sv.getView()},handle_touchstart:function(S){var b=this,p=b.sv,V=p._dividerDiv,o=p._60O,O=p._61O,X=p._status,d=S.target;if(d===o)X===Qi?p.setStatus("cl"):"cr"===X&&p.setStatus(Qi);else if(d===O)X===Qi?p.setStatus("cr"):"cl"===X&&p.setStatus(Qi);else if(Zl(S)&&(d===V||d===p._coverDiv)&&(Ub(S),p.isDraggable())){p.getLeftView(),p.getRightView();var t=b.maskDiv=Zj();if(t.style.left=0,t.style.top=0,t.style.width=p.getWidth()+"px",t.style.height=p.getHeight()+"px",p.getView().appendChild(t),!p.isContinuousLayout()){var H=b.resizeDiv=Zj();H.style.left=V.style.left,H.style.top=V.style.top,H.style.width=V.style.width,H.style.height=V.style.height,H.style.opacity=p.getDragOpacity(),H.style.background=p.getDividerBackground(),lc(b.getView(),H)}b._lastAbsPosition=p._22o,b._86o=Rc(p)?Xd(S).x:Xd(S).y,sm(b,S)}},handleWindowTouchMove:function(c){Zl(c)&&this.update(c,this.sv.isContinuousLayout())},handleWindowTouchEnd:function(x){var E=this;E.update(x,!0),E.sv.setStatus(Qi),E.maskDiv&&ws(E.maskDiv),E.resizeDiv&&ws(E.resizeDiv),E.maskDiv=E.resizeDiv=S},handle_mousedown:function(w){bh(w)&&this.handle_touchstart(w)},handleWindowMouseMove:function(d){this.handleWindowTouchMove(d)},handleWindowMouseUp:function(z){this.handleWindowTouchEnd(z)},update:function(i,k){var c=this,Z=c.sv,B=Rc(Z)?Z.getWidth():Z.getHeight(),m=Z._dividerSize,L=c._lastAbsPosition-c._86o;Rc(Z)?(L+=Xd(i).x,L>B-m&&(L=B-m),0>L&&(L=0),c.resizeDiv&&(c.resizeDiv.style.left=L+wo)):(L+=Xd(i).y,L>B-m&&(L=B-m),0>L&&(L=0),c.resizeDiv&&(c.resizeDiv.style.top=L+wo)),k&&B!==m&&(1===Z._82O?Z.setPosition(L,1):-1===Z._82O?Z.setPosition(L-B+m,1):Z.setPosition(L/(B-m),1))}}),Mr.TabView=function(){var r=this,a=r._view=Nm(1,r),$=r._91O=Zj(1),W=r._tabModel=new Ag,e=W.sm(),d=r.invalidate;r._7o=new Kf,r._canvas=kr($),lc(a,$),lc(a,r._92O=Zj(1)),e.setSelectionMode(ji),e.ms(r.handleSelectionChange,r),W.mm(d,r),W.mh(d,r),W.md(d,r),r._interactor=new of(r),r.iv()},Yo("TabView",G,{ms_v:1,ms_fire:1,ms_tx:1,ms_ty:1,ms_lp:1,ms_ac:["movable","tabGap","tabHeight","tabPosition",Wr,uo,"tabHPadding","tabBackground","selectWidth",Fp,"moveBackground","insertColor"],_tabHPadding:0,_tabPosition:Dc,_tabHeight:hl,_tabGap:X.tabViewTabGap,_labelColor:X.tabViewLabelColor,_labelFont:X.tabViewLabelFont,_tabBackground:X.tabViewTabBackground,_selectWidth:X.tabViewSelectWidth,_selectBackground:X.tabViewSelectBackground,_moveBackground:X.tabViewMoveBackground,_insertColor:X.tabViewInsertColor,_movable:!0,handleSelectionChange:function(){this._selectionChanged=!0,this.invalidate()},getContentDiv:function(){return this._92O},getTitleDiv:function(){return this._91O},getTabModel:function(){return this._tabModel},add:function(o,i,k){var s,w=this._tabModel;return o instanceof tp?(s=o,i&&s.setView(i)):(s=new tp,s.setName(o),s.setView(i)),w.add(s),k&&w.sm().ss(s),s},getLabel:function(t){return t.toLabel()},onPropertyChanged:function(){this.iv()},_7Q:function(Z){this._23o=Z,this.iv()},get:function(A){var F=this,P=F._tabModel;if(Vc(A))return P._roots.get(A);if(Gk(A)){var M;return P.each(function(I){A===F.getLabel(I)&&(M=I)}),M}return A instanceof tp?A:S},select:function(f){this._tabModel.sm().ss(this.get(f))},remove:function(e){var Y=this;if(e=Y.get(e)){var y=Y._tabModel,V=y._roots.indexOf(e);Y._tabModel.remove(e),Y.selectByIndex(--V)}},getCurrentTab:function(){return this._8o},hideTabView:function(A,n){n.parentNode===this._92O&&(Io(n)?(n.style.display=jf,n._tab_=A):ws(n),qi())},showTabView:function(I,c){Io(c)&&(c.style.display="block",c._tab_=I),c.parentNode!==this._92O&&(lc(this._92O,c),qi())},_24o:function(){var g,s=this,u=s._8o,e=s._9o,J=s._tabModel.sm().ld();J&&(g=gp(J.getView())),g!==e&&(e&&(u.getView()&&u.getView().endEditing&&u.getView().endEditing(),s.hideTabView(u,e)),g&&s.showTabView(J,g)),s._8o=J,s._9o=g,u!==J&&s.onTabChanged(u,J)},onTabClosing:function(){return!0},onTabChanged:function(){},onTabClosed:function(W,C){this.selectByIndex(--C)},selectByIndex:function(f){var a=this,z=a._tabModel,q=z.size();if(q&&!z.sm().ld()){f==S&&(f=0),f>=q&&(f=q-1),0>f&&(f=0);for(var U=f;U>=0;U--){var M=a.get(U);if(!M.isDisabled())return a.select(M),M}for(U=f+1;q>U;U++)if(M=a.get(U),!M.isDisabled())return a.select(M),M}},getTabWidth:function(F){var k=this.getTabHPadding(),u=4+2*k,q=Oi(F.getIcon());q&&(u+=xq(q,F)+4);var j=this.getLabel(F);return j&&(u+=rj(this.getLabelFont(F),j).width+4),F.isClosable()&&(u+=10),u},drawTab:function(B,P,E,S,N,b,Q){var C,p=this,q=p._tabPosition,V=this.getTabHPadding(),n=E+4+V,G=p._selectWidth,o=Oi(P.getIcon()),O=P.isDisabled(),H=p.getLabelColor(P),A=p.getLabelFont(P),g=p.getLabel(P),L=p._selectBackground,i=q===zc+"-vertical",J=q===br+"-vertical";(i||J)&&(n=S+4+V),O&&(B.globalAlpha=fb),Eh(B,E,S,N,b,Q),P===p._8o&&G&&(q===Dc?Eh(B,E,S+b-G,N,G,L):q===zc?Eh(B,E+N-G,S,G,b,L):q===br?Eh(B,E,S,G,b,L):i?Eh(B,E+N-G,S,G,b,L):J?Eh(B,E,S,G,b,L):Eh(B,E,S,N,G,L));var K=N/2;if(i&&(As(B,K,S+b/2),ap(B,u),As(B,-K,-S-b/2)),o){var d=ze(o,P),R=xq(o,P);if(i||J){var x=E+N/2,l=n+d/2;As(B,x,l),ap(B,j),As(B,-x,-l),ar(B,o,E+N/2,n+d/2,P,p),As(B,x,l),ap(B,-j),As(B,-x,-l),n+=d+4}else ar(B,o,n+R/2,S+b/2,P,p),n+=R+4}return i||J?(As(B,N/2,n+N/2),ap(B,j),As(B,-N/2,-n-N/2),Nl(B,g,A,H,E,n,b,N),As(B,N/2,n+N/2),ap(B,-j),As(B,-N/2,-n-N/2)):Nl(B,g,A,H,n,S,N,b),i&&(As(B,K,S+b/2),ap(B,-u),As(B,-K,-S-b/2)),P.isClosable()&&(C=J?{x:E+N-12,y:S+b-12,width:12,height:12}:{x:E+N-12,y:S+2,width:12,height:12},this.drawCloseIcon(P,B,H,C)),O&&(B.globalAlpha=1),C},drawCloseIcon:function(v,D,j,q){var l=q.x,b=q.y;D.strokeStyle=j,D.lineWidth=1,D.beginPath(),D.moveTo(l+2,b+8),D.lineTo(l+8,b+2),D.moveTo(l+8,b+8),D.lineTo(l+2,b+2),D.stroke()},getTabAt:function(t){var F=this._interactor._8Q(t);return F?F.tab:null},validateImpl:function(){var P=this;P._24o();var o,S=P._canvas,x=P._tabPosition,I=P._91O,D=P._92O,s=P._tabModel,E=P.getWidth(),_=P.getHeight(),f=P._tabHeight,O=P._7o,A=P._tabGap,r=x===Dc,e=x===zc,B=x===br,U=x===zc+"-vertical",W=x===br+"-vertical",t=P._23o,K=0;if((e||B)&&s._roots.each(function(Y){K=V(P.getTabWidth(Y),K)}),r?(Ap(I,0,0,E,f),o={x:0,y:f,width:E,height:V(0,_-f)}):e?(Ap(I,0,0,K,_),o={x:K,y:0,width:V(0,E-K),height:_}):B?(Ap(I,E-K,0,K,_),o={x:0,y:0,width:V(0,E-K),height:_}):U?(Ap(I,0,0,f,_),o={x:f,y:0,width:V(0,E-f),height:_}):W?(Ap(I,E-f,0,f,_),o={x:0,y:0,width:V(0,E-f),height:_}):(Ap(I,0,_-f,E,f),o={x:0,y:0,width:E,height:V(0,_-f)}),Ap(D,o),U||W){P._9o&&(o.x=0,Ap(P._8o.getView(),o)),fp(S,f,_);var u=Md(S),Z=0;if(hq(u,0,P.ty(),1),u.clearRect(0,0,f,_),O.clear(),s._roots.each(function(N){if(N.isVisible()){var I,i=P.getTabWidth(N);t&&t.tab===N||(I=P.drawTab(u,N,0,Z,f,i,P._tabBackground)),O.add({_75o:I,tab:N,startY:Z,endY:Z+i,height:i}),Z+=i+A}}),P._23Q=V(0,Z-A),t){var j=t.position;P.drawTab(u,t.tab,0,t.startY,f,t.height,P._moveBackground),Eh(u,0,j,f,1,P._insertColor)}if(u.restore(),P._selectionChanged){P._selectionChanged=!1;for(var v=P.ty(),k=0;k<O.size();k++){var R=O.get(k);if(R.tab===P._8o){if(R.endY+v<0){P.ty(-R.startY);break}if(R.startY+v>_){P.ty(_-R.endY);break}}}}P.ty(P.ty())}else if(e||B){P._9o&&(o.x=0,Ap(P._8o.getView(),o)),fp(S,K,_);var u=Md(S),Z=0;if(hq(u,0,P.ty(),1),u.clearRect(0,0,K,_),O.clear(),s._roots.each(function(v){if(v.isVisible()){var J;t&&t.tab===v||(J=P.drawTab(u,v,0,Z,K,f,P._tabBackground)),O.add({_75o:J,tab:v,startY:Z,endY:Z+f,height:f}),Z+=f+A}}),P._23Q=V(0,Z-A),t){var j=t.position;P.drawTab(u,t.tab,0,t.startY,K,t.height,P._moveBackground),Eh(u,0,j,K,1,P._insertColor)}if(u.restore(),P._selectionChanged){P._selectionChanged=!1;for(var v=P.ty(),k=0;k<O.size();k++){var R=O.get(k);if(R.tab===P._8o){if(R.endY+v<0){P.ty(-R.startY);break}if(R.startY+v>_){P.ty(_-R.endY);break}}}}P.ty(P.ty())}else{P._9o&&(o.y=0,Ap(P._8o.getView(),o)),fp(S,E,f);var u=Md(S),g=0;if(hq(u,P.tx(),0,1),u.clearRect(0,0,E,f),O.clear(),s._roots.each(function(X){if(X.isVisible()){var w,p=P.getTabWidth(X);t&&t.tab===X||(w=P.drawTab(u,X,g,0,p,f,P._tabBackground)),O.add({_75o:w,tab:X,startX:g,endX:g+p,width:p}),g+=p+A}}),P._64I=V(0,g-A),t){var j=t.position;P.drawTab(u,t.tab,t.startX,0,t.width,f,P._moveBackground),Ui(u,P._insertColor,j,0,f)}if(u.restore(),P._selectionChanged){P._selectionChanged=!1;for(var h=P.tx(),k=0;k<O.size();k++){var R=O.get(k);if(R.tab===P._8o){if(R.endX+h<0){P.tx(-R.startX);break}if(R.startX+h>E){P.tx(E-R.endX);break}}}}P.tx(P.tx())}for(var H=[],p=D.children,k=0;k<p.length;k++){var X=p[k],C=X._tab_;C&&!s.contains(C)&&H.push(X)}H.forEach(function($){D.removeChild($)})}});var of=function(E){this.tv=E,this.addListeners()};jd(of,G,{ms_listener:1,getView:function(){return this.tv._91O},handle_mousewheel:function(g){this.handleScroll(g,10*(g.wheelDelta/40))},handle_DOMMouseScroll:function(f){this.handleScroll(f,10*-f.detail)},handleScroll:function(u,k){Ub(u);var a=this.tv,n=a._tabPosition;!a._40o()||n!==Dc&&n!==fd||a.tx(this.tv.tx()+k),!a._41o()||n!==zc&&n!==br&&n!==zc+"-vertical"&&n!==br+"-vertical"||a.ty(this.tv.ty()+k)},_8Q:function(R){var g,h,C=this.tv,v=C._tabPosition,e=C._7o;if(v===Dc||v===fd){var E=C.lp(R).x;for(g=0;g<e.size();g++)if(h=e.get(g),h.startX<=E&&E<=h.endX)return h}else if(v===zc||v===br||v===zc+"-vertical"||v===br+"-vertical"){var q=C.lp(R).y;for(g=0;g<e.size();g++)if(h=e.get(g),h.startY<=q&&q<=h.endY)return h}return S},isClickable:function(_){var L=this.tv,x=L._tabPosition,O=this._73o=this._8Q(_);return!L._40o()||x!==Dc&&x!==fd?!L._41o()||x!==zc&&x!==br&&x!==zc+"-vertical"&&x!==br+"-vertical"?O&&(!O.tab.isDisabled()||L.isMovable()):!0:!0},handle_mousemove:function(G){var J=this;Zp?J._74o=J._8Q(G):J.getView().style.cursor=J.isClickable(G)?Oc:""},handle_mousedown:function(U){this.handle_mousemove(U),this.handle_touchstart(U)},handle_touchstart:function(g){var F=this,z=F.tv,j=z._tabPosition;Ub(g),bh(g)&&F.isClickable(g)&&(j===Dc||j===fd?(F.x=Xd(g).x,F.lp=z.lp(g),F.tx=z.tx()):(F.y=Xd(g).y,F.lp=z.lp(g),F.ty=z.ty()),sm(F,g))},handleWindowMouseMove:function(B){this.handleWindowTouchMove(B)},handleWindowTouchMove:function(j){var B,U=this,W=U.tv,q=W._tabPosition,P=U._73o;if(q===Dc||q===fd){if(B=Xd(j).x-U.x,!U._25o&&!U.moving&&M(B)>2&&(W._40o()&&!nl(j)?U._25o=1:P&&W.isMovable()&&(U.moving=1)),U._25o)W.tx(U.tx+B);else if(U.moving){var i=U.lp.x+B,c=W._tabGap/2;W._7o.each(function(x){var v=x.endX,t=i-x.startX<v-i;i>=x.startX&&v>=i&&W._7Q({tab:P.tab,startX:P.startX+B,width:P.width,front:t,insertTab:x.tab,position:t?V(0,x.startX-c):o(W._64I,v+c)})})}}else if(B=Xd(j).y-U.y,!U._25o&&!U.moving&&M(B)>2&&(W._41o()&&!nl(j)?U._25o=1:P&&W.isMovable()&&(U.moving=1)),U._25o)W.ty(U.ty+B);else if(U.moving){var X=U.lp.y+B,c=W._tabGap/2;W._7o.each(function(Q){var M=Q.endY,F=X-Q.startY<M-X;X>=Q.startY&&M>=X&&W._7Q({tab:P.tab,startY:P.startY+B,height:P.height,front:F,insertTab:Q.tab,position:F?V(0,Q.startY-c):o(W._23Q,M+c)})})}},handleWindowMouseUp:function(L){this.handleWindowTouchEnd(L)},handleWindowTouchEnd:function(){var M=this,p=M.tv,q=p._tabPosition,s=p.getTabModel(),z=s._roots,e=M._73o;if(M.moving){var t=p._23o;if(t&&t.insertTab!==t.tab){var N=t.tab,Q=z.remove(N),E=z.indexOf(t.insertTab);E>=0&&(t.front||E++,E<=z.size()&&(z.add(N,E),s._38I(N,Q,E)))}p._7Q(S),delete M.moving}else if(!M._25o&&e){N=e.tab;var n=M._74o;if(!n||n.tab===N)if(!N.isDisabled()&&th(e._75o,M.lp)){var k=function(){var f=z.indexOf(N);s.remove(N),p.onTabClosed(N,f)};p.onTabClosing(N,k)&&k()}else N.isDisabled()||p._8o===N||s.sm().ss(N)}M._25o=M._73o=M._74o=q===Dc||q===fd?M.x=M.lp=M.tx=S:M.y=M.lp=M.ty=S}}),Mr.PropertyView=function(w){var y=this;y._view=Nm(1,y),y._canvas=kr(y._view),lc(y._view,y._79O=Zj()),y._rows=new Kf,y._28o=new Kf,y._26o={},y._26Q={};var Y=y._propertyModel=new Ag,e=y.ivm;Y.mm(e,y),Y.md(e,y),Y.mh(e,y),y.dm(w?w:new Ag),new Fc(y)},Yo("PropertyView",G,{ms_ac:[Wr,hd,uo,Kg,Yh,"categorizable",Xi,yn,jg,$l,Iq,ts,Sn,ke,"selectRowIndex",Fp,"background",Jq,sd,Or,lj,Dk],ms_v:1,ms_dm:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,_45o:1,_47o:1,ms_tip:1,_29I:No,_59I:0,_9I:0,_selectRowIndex:-1,_editable:!0,_batchEditable:!0,_categorizable:!0,_indent:tj,_background:X.propertyViewBackground,_expandIcon:X.propertyViewExpandIcon,_collapseIcon:X.propertyViewCollapseIcon,_scrollBarColor:el,_scrollBarSize:Cg,_autoHideScrollBar:Cf,_selectBackground:X.propertyViewSelectBackground,_rowHeight:Yj,_rowLineVisible:X.propertyViewRowLineVisible,_rowLineColor:X.propertyViewRowLineColor,_10I:.5,_columnLineVisible:X.propertyViewColumnLineVisible,_columnLineColor:X.propertyViewColumnLineColor,_labelColor:X.propertyViewLabelColor,_labelSelectColor:X.propertyViewLabelSelectColor,_labelFont:X.propertyViewLabelFont,getRows:function(){return this._rows
},getColumnPosition:function(){return this._10I},setColumnPosition:function(v){0>v&&(v=0),v>1&&(v=1);var C=this,E=C._10I;C._10I=v,C.fp("columnPosition",E,v)},getPropertyName:function(j){return j.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(C,H,F){return F===this._selectRowIndex?this._labelSelectColor:this._labelColor},getPropertyFont:function(){return this._labelFont},getPropertyColor:function(H,U){return U===this._selectRowIndex?this._labelSelectColor:H.getColor()||this._labelColor},getCategoryFont:function(){return this._labelFont},getCategoryColor:function(){return this._labelColor},adjustTranslateX:function(){return 0},adjustTranslateY:function(z){var K=this.getHeight()-this._59I;return K>z&&(z=K),z>0?0:t(z)},isExpanded:function(x){if(!x)return!0;var V=this._26o[x];return V?V.isExpanded:!(this._26Q[x]===!1)},toggle:function(O){var C=this;C.isExpanded(O)?C.collapse(O):C.expand(O)},expandAll:function(){this.validate();for(var W in this._26o)this.expand(W)},expand:function(q){if(q&&q!==jf){var s=this,K=s._26o[q];K&&!K.isExpanded&&(K.isExpanded=!0,s.onExpanded(q),s.ivm())}},onExpanded:function(){},collapseAll:function(){this.validate();for(var B in this._26o)this.collapse(B)},collapse:function(k){if(k&&k!==jf){var r=this,y=r._26o[k];y&&y.isExpanded&&(y.isExpanded=!1,r.onCollapsed(k),r.ivm())}},onCollapsed:function(){},getCategoryName:function(P){if(!this.isCategorizable())return jf;var $=P.getCategoryName();return $?$:jf},getPropertyModel:function(){return this._propertyModel},handleSelectionChange:function(){this.ivm()},setDataModel:function(n){var g=this,K=g._dataModel;K!==n&&(K&&(K.umd(g.handlePropertyChange,g),g._selectionModel||K.sm().ums(g.handleSelectionChange,g)),g._dataModel=n,n.md(g.handlePropertyChange,g),g._selectionModel?g._selectionModel._21I(n):n.sm().ms(g.handleSelectionChange,g),g.fp(Ak,K,n))},isVisible:function(K){return this._visibleFunc?this._visibleFunc(K):!0},onPropertyChanged:function(k){var i=this,P=k.property;Gc[P]?i.ivm():i.iv(),P===tg&&i._43o()},getCurrentData:function(){return this._27o},updateCurrentData:function(){this._27o=this.sm().ld()},getRawProperties:function(){return this._27o?this._propertyModel._roots:le},handlePropertyChange:function(P){this._27o===P.data&&this.iv()},ivm:function(){this.invalidateModel()},invalidateModel:function(){var S=this;S._96I||(S.setSelectRowIndex(-1),S._96I=1,S.iv())},redraw:function(){this.iv()},validateModel:function(){var m=this,Q=m._rows,W=m._28o,x={},n=new Kf,E=m._27o;m.updateCurrentData(),E!==m._27o&&m.endEditing(),Q.clear(),W.clear(),m.getRawProperties().each(function(u){if(m.isVisible(u)){n.add(u);var O=m.getCategoryName(u);x[O]||(W.add(O,O===jf?0:d),x[O]={isExpanded:m.isExpanded(O),properties:new Kf})}}),m._sortFunc&&n.sort(m._sortFunc);for(var f in m._26o)m._26Q[f]=m.isExpanded(f);m._26o=x,W.each(function(j){j!==jf&&Q.add(j);var K=x[j];K.isExpanded&&n.each(function(e){m.getCategoryName(e)===j&&(K.properties.add(e),Q.add({property:e,data:m._27o}))},m)})},validateImpl:function(){var A=this;A._76o(),A._96I&&(A.validateModel(),delete A._96I);var a=A._canvas,g=A.getWidth(),Y=A.getHeight(),p=-A.ty(),M=A._rowHeight,k=A._indent,X=g-k,e=A._rows,s=e.size(),F=A._9I=k+X*A._10I,r=A._59I=s*M;fp(a,g,Y),A._29I={x:0,y:p,width:g,height:Y},A._31I=R(p/M),A._14I=w((p+Y)/M),A._31I<0&&(A._31I=0),A._14I>s&&(A._14I=s);var Q,H=Md(a),U=A._background;hq(H,0,-p,1),H.beginPath(),H.rect(0,p,g,Y),H.clip(),H.clearRect(0,p,g,Y),A._93db(H),U&&Eh(H,0,0,k,r,U);for(var f=A._31I;f<A._14I;f++){var N=e.get(f),p=M*f;if(Gk(N))U&&Eh(H,k,p,X,M,U),Q=Oi(A.isExpanded(N)?A._expandIcon:A._collapseIcon),Q&&ng(H,Q,pg,0,p,k,M),H.save(),H.beginPath(),H.rect(k,p,X,M),H.clip(),A.drawCategoryName(H,N,f,k,p,X,M),H.restore();else{var b=N.property,_=N.data,Q=Oi(b.getIcon()),T=A._selectRowIndex===f?A.getSelectBackground():S;if(Q&&ng(H,Q,pg,0,p,k,M),T&&Eh(H,k,p,X,M,T),H.save(),H.beginPath(),H.rect(k,p,F-k,M),H.clip(),A.drawPropertyName(H,b,f,k,p,F-k,M),H.restore(),!A.isEditing(_,b)){var V=F+1,J=g-F-1;H.save(),H.beginPath(),H.rect(V,p,J,M),H.clip(),A._87o(A.drawPropertyValue(H,b,A.getValue(_,b),f,V,p,J,M,_),f,V,p,J,M),H.restore()}}A._rowLineVisible&&Eh(H,k,p+M-1,X,1,A._rowLineColor)}A._columnLineVisible&&(Eh(H,F,0,1,r,A._columnLineColor),Eh(H,g-1,0,1,r)),A._92db(H),A._93I(),H.restore(),A.ty(A.ty())},drawCategoryName:function(N,H,L,P,I,C,F){Nl(N,H,this.getCategoryFont(H),this.getCategoryColor(H),P,I,C,F)},drawPropertyName:function(H,r,B,y,u,A,Q){return r.drawPropertyName?(r.drawPropertyName(H,r,B,y,u,A,Q,this),void 0):(Nl(H,this.getPropertyName(r),this.getPropertyFont(r,B),this.getPropertyColor(r,B),y,u,A,Q),void 0)},drawPropertyValue:function(N,l,d,q,Z,U,F,e,g){return l.drawPropertyValue?l.drawPropertyValue(N,l,d,q,Z,U,F,e,g,this):(ys(N,d,l,this.getLabelFont(l,d,q),this.getLabelColor(l,d,q),Z,U,F,e,g,this),void 0)},isPropertyEditable:function(E){return E.isEditable()&&this.isEditable()},setProperties:function(k){this._propertyModel.clear(),this.addProperties(k)},addProperties:function(t){if(t){var h=this._propertyModel;t.forEach(function(l){if(!(l instanceof Hl)){var w=Lh(l.className);l=Mc(w?w:Hl,l)}h.add(l)})}},getRowIndexAt:function(X){var C=this,y=R(C.lp(X).y/C._rowHeight);return y>=0&&y<C._rows.size()?y:-1},getPropertyAt:function(e){var g=this,J=g.getRowIndexAt(e);return J>=0?g._rows.get(J).property:S},getToolTip:function(M){var z=this,L=z.getPropertyAt(M),j=z._27o;return L&&j?L.getToolTip(j,z._9I<z.lp(M).x,z):S}});var Fc=function(p){this.pv=p,this.addListeners()};jd(Fc,G,{ms_listener:1,getView:function(){return this.pv._view},setCursor:function(r){this.getView().style.cursor=r},clear:function(){var p=this;p._62O=p.cp=p.ty=p.p=S,p.setCursor(wn)},handle_mousedown:function(Q){this.handle_touchstart(Q)},handle_touchstart:function(I){var T=this,E=T.pv;Ub(I),E.setFocus(I)&&(bh(I)?(T.cp=Xd(I),T.ty=E.ty(),T.p=E.getColumnPosition(),T.handle_touchmove(I)):E.setSelectRowIndex(E.getRowIndexAt(I)))},handleWindowMouseUp:function(){this.clear()},handleWindowTouchEnd:function(){this.clear()},handle_mouseup:function(L){this.handle_touchend(L)},handle_touchend:function(y){var f=this;if(f.cp&&!f._62O){var e=f.pv,T=e.lp(y),M=T.x,n=T.y,c=e._indent,l=e.getRowIndexAt(y),K=e._9I;if(l>=0){var s=e._rowHeight,r=s*l,G=e._rows.get(l),i=G.property;if(Gk(G))Oi(e.isExpanded(G)?e._expandIcon:e._collapseIcon)&&M>=0&&c>=M&&n>=r&&r+s>=n?e.toggle(G):Qg(y)&&e.toggle(G);else if(M>K&&e.isPropertyEditable(i,y)){var Z={x:K+1,y:r,width:e.getWidth()-K-1,height:s},O={x:Z.x+e.tx(),y:Z.y+e.ty(),width:Z.width,height:Z.height},W=0,x=e._29I;Z.y<x.y?W=Z.y-x.y:Z.y+s>x.y+x.height&&(W=Z.y+s-x.y-x.height),W&&(e.ty(e.ty()-W),O.y-=W),e.beginEditing({data:G.data,property:i,value:e.getValue(G.data,i),event:y,rect:Z,editorRect:O,view:e})}}e.setSelectRowIndex(l)}f.clear()},handleWindowMouseMove:function(E){this.handleWindowTouchMove(E)},handleWindowTouchMove:function(b){var o=this,E=o.pv,m=o.ty,L=o.cp,T=Xd(b),V=o._62O;if("p"===V)E.setTranslateY(m+T.y-L.y);else if("c"===V){var u=E.getWidth()-E._indent;if(u>16){var k=o.p-(L.x-T.x)/u,q=16/u;q>k&&(k=q),k>1-q&&(k=1-q),E.setColumnPosition(k)}}else"s"===V&&E.setTranslateY(m+(L.y-T.y)*E._59I/E._29I.height)},handle_mousemove:function(z){this.handle_touchmove(z)},handle_touchmove:function(B){if(!Zp&&bh(B)){var A=this,T=A.pv,p=M(T.lp(B).x-T._9I)<=(xl?8:3);A.cp?A._62O||(p?(A._62O="c",sm(A)):M(Xd(B).y-A.cp.y)>=2&&(A._62O=A.isV(B)?"s":"p",sm(A))):(p?A.setCursor(Rd):A.setCursor(wn),A.isV(B)&&T._43o())}},isV:function(R){var K=this.pv,Y=K._29I;return K._41o()&&Y.x+Y.width-K.lp(R).x<zr},handle_mousewheel:function(e){this.handleScroll(e,e.wheelDelta/40)},handle_DOMMouseScroll:function(n){2===n.axis&&this.handleScroll(n,-n.detail)},handleScroll:function(Q,J){var t=this.pv;Ub(Q),t.endEditing(),t.translate(0,J*t.getRowHeight())},handle_keydown:function(Y){var B=this.pv,E=B._rows.size(),k=B._selectRowIndex+(Zh(Y)?-1:1);(Zh(Y)||ff(Y))&&(0>k&&(k=0),k>=E&&(k=E-1),B.setSelectRowIndex(k))}}),Mr.ListView=function(m){this._5o(m),new mm(this)},Yo("ListView",G,{ms_ac:[Wr,hd,uo,Jq,Xi,sd,Or,yn,jg,ts,Sn,ke,yf,Fp],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,_14Q:1,ms_dm:1,_45o:1,_checkMode:!1,_indent:tj,_rowHeight:Yj,_rowLineVisible:X.listViewRowLineVisible,_rowLineColor:X.listViewRowLineColor,_scrollBarColor:el,_scrollBarSize:Cg,_autoMakeVisible:Km,_autoHideScrollBar:Cf,_selectBackground:X.listViewSelectBackground,_labelColor:X.listViewLabelColor,_labelSelectColor:X.listViewLabelSelectColor,_labelFont:X.listViewLabelFont,isCheckMode:function(){return this._checkMode},setCheckMode:function(w){var m=this,s=m._checkMode;m._checkMode=w,m.fp(lb,s,w)},drawRow:function(X,I,i,W,b,C,N){var Q=this,e=0,o=Q._indent,a=Q.getIconWidth(I);Q.drawRowBackground(X,I,i,W,b,C,N),Q._checkMode&&(ar(X,Oi(Q.getCheckIcon(I)),e+o/2,b+N/2,I,Q),e+=o),Q.drawIcon(X,I,e,b,a,N),Q.drawLabel(X,I,e+a,b,N)}});var mm=function(F){this.list=F,this._lastSelectDataTime=Pb(),this.addListeners()};jd(mm,G,{ms_listener:1,getView:function(){return this.list._view},clear:function(H){var r=this,U=r.list;H&&"d"===r._62O&&!r.dragCancel&&U.handleDragAndDrop(H,"end"),U.draggingData&&(U.draggingData=null,U.redraw()),r.dragCancel=r._62O=r._isV=r._isH=r.cp=r.tx=r.ty=S},handle_mousedown:function(c){this.handle_touchstart(c)},handle_touchstart:function(x){var U=this,S=U.list;if(Ub(x),S.setFocus(x)){var e=S.getDataAt(x);U.cp=Xd(x),U.tx=S.tx(),U.ty=S.ty(),bh(x)?e&&S.handleDragAndDrop&&!U.isV(x)&&!U.isH(x)&&(S.draggingData=e,S.redraw(),S.handleDragAndDrop(x,"prepare")):(e&&U._33o(x,e),U.clear(x))}},handleWindowMouseUp:function(d){this.clear(d)},handleWindowTouchEnd:function(d){this.clear(d)},handle_mouseup:function(r){this.handle_touchend(r)},handle_touchend:function(u){var I=this,z=I.list;if(!I._isV&&!I._isH&&I.cp&&!I._62O){var j=z.getDataAt(u);j?(z.isCheckMode()?I._34o(u,j):I._33o(u,j),Qg(u)?z.onDataDoubleClicked(j,u):z.onDataClicked(j,u)):z.handleBackgroundClick(u)}I.clear(u)},handleWindowMouseMove:function($){this.handleWindowTouchMove($)},handleWindowTouchMove:function(V){var b=this,F=b.list,y=b._62O,C=b.tx,c=b.ty,j=b.cp,$=Xd(V),l=F._29I;"p"===y?F.setTranslate(C+$.x-j.x,c+$.y-j.y):"v"===y?F.ty(c+(j.y-$.y)*F._59I/l.height):"h"===y?F.tx(C+(j.x-$.x)*F._91I/l.width):"d"===y&&(b.dragCancel||F.handleDragAndDrop(V,"between"))},handle_mousemove:function(X){this.handle_touchmove(X)},handle_touchmove:function(a){if(!Zp&&bh(a)){var o=this,S=o.list;if(o._isV=o.isV(a),o._isH=o.isH(a),o.cp){if(!o._62O){if(zq(Xd(a),o.cp)<2)return;o._isV?o._62O="v":o._isH?o._62O="h":S.draggingData&&!this.dragCancel?(o._62O="d",S.handleDragAndDrop(a,"begin")):o._62O="p",o._62O&&"d"!==o._62O&&S.draggingData&&(S.draggingData=null,S.redraw()),sm(o)}}else o._isV&&S._43o(),o._isH&&S._42o()}},isV:function(d){var W=this.list,K=W._29I;return W._41o()&&K.x+K.width-W.lp(d).x<zr},isH:function(k){var m=this.list,w=m._29I;return m._40o()&&w.y+w.height-m.lp(k).y<zr},handle_mousewheel:function(T){this.handleScroll(T,T.wheelDelta/40,T.wheelDelta!==T.wheelDeltaX)},handle_DOMMouseScroll:function(j){this.handleScroll(j,-j.detail,1)},handleScroll:function(z,G,f){var o=this.list;Ub(z),o.endEditing&&o.endEditing(),f&&o._41o()?o.translate(0,G*o.getRowHeight()):o._40o()&&o.translate(10*G,0)},handle_keydown:function(i){if(!X.isInput(i.target)){var j,u=this.list,c=u.sm(),$=u._rows,y=$.size();if(sr(i))u.selectAll();else if(bg(i))u.handleDelete&&u.handleDelete(i);else if(_f(i))"d"!==this._62O||this.dragCancel||(u.handleDragAndDrop(i,"cancel"),this.dragCancel=!0);else if(Aq(i))u.isCheckMode()&&(j=u.getFocusData(),j&&u.checkData(j));else if(Zh(i)||ff(i)){var O=u.isCheckMode();if(j=O?u.getFocusData():c.ld()){var N=u.getRowIndex(j);N>=0&&(Zh(i)?0!==N&&(j=$.get(N-1),O?u.setFocusData(j):c.ss(j)):N!==y-1&&(j=$.get(N+1),O?u.setFocusData(j):c.ss(j)))}else y>0&&(j=$.get(0),O?u.setFocusData(j):c.ss(j))}}},_34o:function(h,$){var l=this.list,o=l.lp(h).x;return o>=0&&o<=l._indent?(l.checkData($),void 0):(l.setFocusData($),void 0)},_33o:function(M,N){var E=this.list,d=E.sm(),v=d.ld();if(nl(M))E.isSelected(N)?d.rs(N):d.as(N);else if(Pn(M))if(v)for(var z=E.getRowIndex(v),a=E.getRowIndex(N);z!==a;)z+=a>z?1:-1,d.as(E._rows.get(z));else d.ss(N);else if(bh(M)){var K=Pb();if(d.contains(N)){var R=K-this._lastSelectDataTime;E.handleDataDoubleSelect&&R>500&&1500>R&&E.handleDataDoubleSelect(M,N)}d.ss(N),this._lastSelectDataTime=K}else d.contains(N)||d.ss(N)}}),Mr.TreeView=function(f){var Y=this;Y._35o(),Y._5o(f),new Vj(Y)},Yo("TreeView",G,{ms_ac:[Wr,hd,uo,"rootVisible",lb,"rootData",yn,jg,ts,Sn,ke,Xi,Jq,sd,Or,$l,Iq,yf,Fp,"loader","doubleClickToToggle"],ms_v:1,ms_bnb:1,ms_tip:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,_48o:1,_14Q:1,_45o:1,_checkMode:S,_indent:tj,_rowHeight:Yj,_rowLineVisible:X.treeViewRowLineVisible,_rowLineColor:X.treeViewRowLineColor,_scrollBarColor:el,_scrollBarSize:Cg,_autoHideScrollBar:Cf,_expandIcon:X.treeViewExpandIcon,_collapseIcon:X.treeViewCollapseIcon,_autoMakeVisible:Km,_selectBackground:X.treeViewSelectBackground,_labelColor:X.treeViewLabelColor,_labelSelectColor:X.treeViewLabelSelectColor,_labelFont:X.treeViewLabelFont,_doubleClickToToggle:X.treeViewDoubleClickToToggle,drawRow:function(Z,N,r,v,g,m,t){var S=this;S.drawRowBackground(Z,N,r,v,g,m,t),S._97I(Z,N,r,0,g,m,t)},isOnToggleIcon:function(S){var d=this.getDataAt(S);if(d){var k=this.getIndent(),q=this.lp(S).x;if(Oi(this.getToggleIcon(d))){var J=k*this.getLevel(d);if(q>=J&&J+k>=q)return!0}}return!1}});var Vj=function(A){Lk(Vj,this,[A])};jd(Vj,mm,{toggle:function(Y,_,V,l){var H=this.list,o=H.lp(Y).x;if(Oi(H.getToggleIcon(_))){var i=V*l;if(o>=i&&i+V>=o)return H.toggle(_),!0}return H.isDoubleClickToToggle()&&Qg(Y)?(H.toggle(_),!0):!1},_34o:function(t,g){var e=this.list,Z=e.lp(t).x,r=e._levelMap[g._id],W=e._indent,Q=W*(r+1);return Z>=Q&&Q+W>=Z?(e.checkData(g),void 0):(this.toggle(t,g,W,r)||e.setFocusData(g),void 0)},_33o:function(t,m){var H=this,v=H.list;if(!H.toggle(t,m,v._indent,v.getLevel(m)))if(Pn(t)){var S=v.sm();if(S.size()>0){for(var I=v._rows,n=null,b=0,u=I.size();u>b;b++)if(v.isSelected(I.get(b))){n=b;break}for(var l=null,b=I.size()-1;b>=0;b--)if(v.isSelected(I.get(b))){l=b;break}var e,i,q=v.getRowIndex(m);for(n>q?(e=q-1,i=n):q>l?(e=l,i=q):(e=n,i=l);e!==i;)e++,S.as(v._rows.get(e))}else S.ss(m)}else Vj.superClass._33o.call(H,t,m)},handle_keydown:function(d){if(ak(d)||vj(d)){var o=this.list,W=o._rows,C=o.isCheckMode(),I=o.sm(),N=C?o.getFocusData():I.ld();N?N.hasChildren()&&(ak(d)?o.collapse(N):o.expand(N)):W.size()>0&&(N=W.get(0),C?o.setFocusData(N):I.ss(N))}else Vj.superClass.handle_keydown.call(this,d)}});var qr=Mr.TableView=function(y){this._98I(),this._5o(y),new uk(this)};Yo("TableView",G,{ms_ac:[Wr,hd,uo,"sortMode",Kg,Yh,Jq,sd,Or,lj,Dk,"sortColumn",yn,jg,ts,Sn,ke,yf,Fp],ms_v:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_45o:1,_47o:1,_sortMode:pk,_editable:!0,_batchEditable:!1,_rowHeight:Yj,_rowLineVisible:X.tableViewRowLineVisible,_rowLineColor:X.tableViewRowLineColor,_columnLineVisible:X.tableViewColumnLineVisible,_columnLineColor:X.tableViewColumnLineColor,_scrollBarColor:el,_scrollBarSize:Cg,_autoHideScrollBar:Cf,_autoMakeVisible:Km,_selectBackground:X.tableViewSelectBackground,_labelColor:X.tableViewLabelColor,_labelSelectColor:X.tableViewLabelSelectColor,_labelFont:X.tableViewLabelFont,getCheckColumn:function(){var X=this;if(!X._31o){var E=X._31o=new Qb;E.setEditable(!0),E.setWidth(40),E.getValue=X.getCheckColumValue,E.drawCell=X.drawCheckColumnCell}return X._31o},isCheckMode:function(){return this._39o.contains(this._31o)},setCheckMode:function(I){var E=this,B=E._39o,W=E.getCheckColumn();I!==E.isCheckMode()&&(I?B.add(W,0):B.remove(W),E.fp(lb,!I,I))},getCheckColumValue:function(a,W,m){return m.isSelected(a)},drawCheckColumnCell:function(r,y,R,h,a,C,Z,L,S){ar(r,S.getCheckIcon(y),a+Z/2,C+L/2,y,S)}});var uk=function(i){Lk(uk,this,[i])};jd(uk,mm,{_34o:function(L,N){var Z=this.list,u=Z._31o;if(Z.isCellEditable(N,u,L)){var E=Z._3Q(u),o=Z.lp(L).x;if(E&&o>=E.startX&&o<E.startX+u.getWidth())return Z.checkData(N),void 0}Z._37O(N,L),Z.setFocusData(N)},_33o:function(T,o){this.list._37O(o,T),uk.superClass._33o.apply(this,arguments)}});var be=Mr.TreeTableView=function(s){var U=this,o=U._4o=new Qb;U._35o(),U._98I(),U._5o(s),o.setDisplayName("Name"),o.setEditable(!0),o.setWidth(180),o.drawCell=zf,o.getValue=pn,U._39o.add(o),new To(U)},zf=function(e,P,c,Z,F,l,G,z,q){q._97I(e,P,c,F,l,G,z)},pn=function(V,C,E){return E.getLabel(V)};Yo("TreeTableView",G,{ms_ac:[Wr,hd,uo,"sortMode",Kg,Yh,Xi,lb,"rootData","rootVisible",yn,jg,"sortColumn",$l,Iq,ts,Sn,ke,yf,Or,Jq,sd,lj,Dk,Fp,"loader"],ms_v:1,ms_bnb:1,ms_fire:1,ms_sm:1,_49o:1,ms_txy:1,ms_lp:1,ms_vs:1,ms_hs:1,_15Q:1,ms_dm:1,ms_tip:1,_50o:1,_48o:1,_14Q:1,_45o:1,_47o:1,_sortMode:pk,_checkMode:S,_editable:!0,_batchEditable:!1,_indent:tj,_rowHeight:Yj,_rowLineVisible:X.treeTableViewRowLineVisible,_rowLineColor:X.treeTableViewRowLineColor,_columnLineVisible:X.treeTableViewColumnLineVisible,_columnLineColor:X.treeTableViewColumnLineColor,_expandIcon:X.treeTableViewExpandIcon,_collapseIcon:X.treeTableViewCollapseIcon,_scrollBarColor:el,_scrollBarSize:Cg,_autoHideScrollBar:Cf,_autoMakeVisible:Km,_selectBackground:X.treeTableViewSelectBackground,_labelColor:X.treeTableViewLabelColor,_labelSelectColor:X.treeTableViewLabelSelectColor,_labelFont:X.treeTableViewLabelFont,getTreeColumn:function(){return this._4o}});var To=function(E){Lk(To,this,[E])};jd(To,mm,{_34o:function(K,A){var F=this.list,w=F._4o,z=F._3Q(w),V=F.lp(K).x;if(z){var b=F._indent,C=z.startX+b*F.getLevel(A);if(Oi(F.getToggleIcon(A))&&V>=C&&C+b>=V)return F.toggle(A),void 0;if(F.isCellEditable(A,w)&&(C+=b,V>=C&&C+b>=V))return F.checkData(A),void 0}F._37O(A,K),F.setFocusData(A)},_33o:function(o,I){var E=this.list,x=E.lp(o).x;if(Oi(E.getToggleIcon(I))){var u=E._3Q(E._4o);if(u){var g=E._indent,J=u.startX+g*E.getLevel(I);if(x>=J&&J+g>=x)return E.toggle(I),void 0}}E._37O(I,o),To.superClass._33o.apply(this,arguments)}});var _r=Mr.TableHeader=function(C){var K=this,y=K._view=Nm(1,K),m=K._39o=C.getColumnModel(),T=K.iv;K.tv=K._tableView=C,K._60I=new Kf,K._canvas=kr(y),y.style.background=X.tableHeaderBackground||"",y.style.height=Fe+wo,m.mm(T,K),m.md(T,K),m.mh(T,K),C.mp(function(H){iq[H.property]&&K.iv()},K),new il(K),K.iv()};Yo("TableHeader",G,{ms_v:1,ms_lp:1,ms_fire:1,ms_ac:["checkIcon","sortDescIcon","sortAscIcon",Wr,uo,Xi,"moveBackground","insertColor",lj,Dk,"resizable","movable"],_checkIcon:Ok,_movable:!0,_resizable:!0,_labelColor:X.tableHeaderLabelColor,_labelFont:X.tableHeaderLabelFont,_columnLineColor:X.tableHeaderColumnLineColor,_columnLineVisible:X.tableHeaderColumnLineVisible,_sortDescIcon:X.tableHeaderSortDescIcon,_sortAscIcon:X.tableHeaderSortAscIcon,_moveBackground:X.tableHeaderMoveBackground,_insertColor:X.tableHeaderInsertColor,_indent:tj,getCheckIcon:function(){return this._checkIcon},getTableView:function(){return this.tv},getLabel:function(X){return X.toLabel()},getLabelFont:function(){return this._labelFont},getLabelColor:function(B){return B.getColor()||this._labelColor},getLabelAlign:function(H){return H._align},onPropertyChanged:function(){this.iv()},_5Q:function(i){this._61I=i,this.iv()},getLogicalPoint:function(o){return we(o,this._canvas,this.tv.tx())},validateImpl:function(){var c=this,K=c._canvas,s=c.getWidth(),z=c.getHeight(),u=c.tv,X=c._60I,b=c._61I,M=-u.tx(),E=0;(s!==K.clientWidth||z!==K.clientHeight)&&fp(K,s,z),X.clear(),c._39o._roots.each(function(g){if(g.isVisible()){var f=E+g.getWidth();M+s>=E&&f>=M&&X.add({column:g,startX:E}),E=f}});var S=Md(K);if(hq(S,-M,0,1),S.beginPath(),S.rect(M,0,s,z),S.clip(),S.clearRect(M,0,s,z),X.each(function(H){var G=H.column,u=H.startX,J=G.getWidth();J>0&&(S.save(),S.beginPath(),S.rect(u,0,J,z),S.clip(),b&&b.column===G||c.drawColumn(S,G,u,0,J,z),c._columnLineVisible&&Eh(S,u+J-1,0,1,z,c._columnLineColor),S.restore())}),b){var d=b.column,E=b.startX,C=b.position,j=d.getWidth();S.save(),S.beginPath(),S.rect(E,0,j,z),S.clip(),S.fillStyle=c._moveBackground,S.fill(),c.drawColumn(S,d,E,0,j,z),S.restore(),Ui(S,c._insertColor,C,0,z)}S.restore()},_6Q:function(m){var u=this.tv;return u._31o===m&&u.sm().getSelectionMode()===gd},drawColumn:function(g,P,n,j,U,O){var H=this,t=H.tv,M=Oi(P.getIcon()),e=H.getLabelAlign(P);if(H._6Q(P)){var E=Oi(H._checkIcon);ar(g,E,n+U/2,j+O/2,P,H)}else{var s=H.getLabel(P),d=H.getLabelFont(P),T=H.getLabelColor(P),N=rj(d,s).width,S=M?H._indent:0;e===zc?(M&&ng(g,M,pg,n,j,S,O),Nl(g,s,d,T,n+S,j,U,O,zc)):e===br?(M&&ng(g,M,pg,n+U-N-S,j,S,O),Nl(g,s,d,T,n,j,U,O,br)):(M&&ng(g,M,pg,n+(U-N-S)/2,j,S,O),Nl(g,s,d,T,n+(U-N+S)/2,j,0,O,zc))}if(P.isSortable()&&t.getSortColumn()===P&&(M=Oi(P.getSortOrder()===ym?H._sortAscIcon:H._sortDescIcon))){var A=xq(M,P)/2+2;ar(g,M,e===br?n+A:n+U-A,j+O/2,P,t)}}});var il=function(b){var k=this;k.th=b,k.tv=b._tableView,k.addListeners()};jd(il,G,{ms_listener:1,getView:function(){return this.th.getView()},setCursor:function(N){this.getView().style.cursor=N},handle_mousemove:function(y){if(!Zp){var s=this;delete s._29o,s.setCursor(wn);for(var f=s.th,w=f._60I,Y=f.lp(y).x,h=w.size()-1;h>=0;h--){var T=w.get(h),u=T.column,x=T.startX+u.getWidth();if(f.isResizable()&&M(x-Y)<=(xl?10:3))return s._29o=T,s.setCursor(Rd),void 0;Y>T.startX&&x>Y&&(s._29o=T),(u.isClickable()||u.isSortable()||f.isMovable()||s.tv.getCheckColumn&&u===s.tv.getCheckColumn())&&Y>T.startX&&x>Y&&s.setCursor(Oc)}}},handle_mousedown:function(D){this.handle_touchstart(D)},handle_touchstart:function(Q){var T=this;Ub(Q),T.tv.endEditing(),T.handle_mousemove(Q),T._29o&&(T.x=Xd(Q).x,T.lx=T.th.lp(Q).x,T.w=T._29o.column.getWidth(),sm(T,Q))},handleWindowMouseMove:function($){this.handleWindowTouchMove($)},handleWindowTouchMove:function(y){var H=this,T=H.th,s=H.getView().style.cursor,j=H._29o,r=Xd(y).x-H.x;if(H.resizing||H.moving||(s===Rd?H.resizing=1:T.isMovable()&&s===Oc&&M(r)>2&&(H.moving=1)),H.resizing)j.column.setWidth(H.w+r);else if(H.moving){var k=H.lx+r;T._60I.each(function(u){var P=u.startX,b=P+u.column.getWidth();if(k>=P&&b>=k){var l={column:j.column,startX:j.startX+r,front:b-k>k-P,insertColumn:u.column};l.position=l.front?P:b,T._5Q(l)}})}},_16Q:function(r,S){var F=this,h=F.tv,P=F.th,x=P._checkIcon;if(P._6Q(r)){var L=Oi(x),g=F.lx,J=r.getWidth(),e=xq(L,r);if(g>=S+J/2-e&&S+J/2+e>=g){P.setCheckIcon(x===Po?Ok:Po);var k=h.sm(),y=h._rows;return x===Po?k.rs(y):k.ss(y),h.onCheckColumnClicked(r),!0}}return!1},handleWindowMouseUp:function(n){this.handleWindowTouchEnd(n)},handleWindowTouchEnd:function(n){var c=this,g=c.tv,w=c.th,O=c._29o;if(c.moving){var q=w._61I;if(q&&q.insertColumn!==q.column){var T=q.column,V=g.getColumnModel()._roots,d=V.remove(T),t=V.indexOf(q.insertColumn);t>=0&&(q.front||t++,t<=V.size()&&(V.add(T,t),g.getColumnModel()._38I(T,d,t)))}w._5Q(S),delete c.moving}else if(!c.resizing&&O){T=O.column;var Z=w.lp(n).x,r=O.startX,E=!0;if(w.onColumnClicked){var K=w.onColumnClicked(T,n,r);K===!1&&(E=!1)}if(E&&Z>=r&&Z<=r+T.getWidth()&&!c._16Q(T,r)){if(T.isSortable()){var v=g.getSortMode(),A=T.getSortOrder();v===pk?g.getSortColumn()===T?(A===Th&&g.setSortColumn(S),T.setSortOrder(A===ym?Th:ym)):g.setSortColumn(T):"bistate"===v&&(g.getSortColumn()===T?T.setSortOrder(A===ym?Th:ym):g.setSortColumn(T))}g.onColumnClicked(T,n,r)}}c._29o=c.resizing=c.x=c.lx=c.w=S}}),Mr.TablePane=function(O){this.init(new qr(O))},Yo("TablePane",G,{ms_v:1,_44o:1}),Mr.TreeTablePane=function(x){this.init(new be(x))},Yo("TreeTablePane",G,{ms_v:1,_44o:1}),Mr.Toolbar=function(e){var x=this,A=x._view=Nm(1,x),j=A.style;j.background=X.toolbarBackground||"",j.height=hl+wo,x._canvas=kr(A),x._30o=new Kf,x._90I=new Kf,x.setItems(e||[]),A.handleGroupSelectedChanged=function(v){if(v.isSelected()){var l=v.getGroupId();null!=l&&x._items.forEach(function(Z){var e=Z.element;e&&e!==v&&e.setSelected&&e.getGroupId&&e.getGroupId()===l&&e.setSelected(!1)})}},new Vf(x)},Yo("Toolbar",G,{ms_v:1,ms_fire:1,ms_tx:1,ms_lp:1,ms_tip:1,ms_value:1,ms_ac:[vi,Wr,uo,hd,Fp,"itemGap","separatorColor","currentItem","stickToRight"],_labelColor:X.toolbarLabelColor,_labelSelectColor:X.toolbarLabelSelectColor,_labelFont:X.toolbarLabelFont,_selectBackground:X.toolbarSelectBackground,_itemGap:X.toolbarItemGap,_separatorColor:X.toolbarSeparatorColor,_stickToRight:!1,getSumWidth:function(){return this._64I},getToolTip:function(D){var J=this.getItemInfoAt(D);return J?J.item.toolTip:S},getLabelColor:function(P){return P&&P.selected&&P.type!==Po&&P.type!==Gm?this._labelSelectColor:this._labelColor},onPropertyChanged:function(B){this.iv(),B.property===vi&&this._items.forEach(function(q){pe(q)})},redraw:function(){this.iv()},addItem:function(i,G){var v=this._items;G==S?v.push(i):v.splice(G,0,i),this.fp(vi,S,v)},removeItem:function(F){if(F)for(var w=this._items,b=0;b<w.length;b++)F===w[b]&&(w.splice(b,1),this.fp(vi,S,w))},removeItemById:function(b){if(b!=S)for(var L=this._items,d=0;d<L.length;d++)if(b===L[d].id){var q=L.splice(d,1)[0];return this.fp(vi,S,L),q}},getItemById:function(v){if(v!=S)for(var E=this._items,t=0;t<E.length;t++){var I=E[t];if(v===I.id)return I}},setItemVisible:function(z,G){var $=this.getItemById(z);$&&($.visible=G)},getItemInfos:function(){return this._30o},getItemInfoAt:function(Z){var m=this,x=0,v=m._30o,d=m.lp(Z),z=d.x,V=d.y;if(V>=0&&V<=m.getHeight())for(;x<v.size();x++){var X=v.get(x);if(X.startX<=z&&z<=X.endX)return X}return S},drawItem:function(c,J,D,r,S){if(J.visible===!1)return 0;if(dc(J.visible)&&!J.visible())return 0;var R=this,z=J.disabled;z&&(c.globalAlpha=fb);var e=R.drawItemImpl(c,J,D,r,S),P=R._itemGap;return z&&(c.globalAlpha=1),this._currentItem!==J||"separator"===J||J.separator===!0||J.unfocusable||uc(c,R._separatorColor,D-P/2,0,e+P,r),e},drawItemImpl:function(v,u,M,y,j){var _=this,D=_._view,I=_._itemGap,T=y/2,X=u.type,m=u.element,R=u.label;Gk(m)&&(R=m,m=S);var w,Q=_.getLabelFont(u),n=_.getLabelColor(u),J=u.selected,K=Oi(u.icon),k=xq(K,u),r=0,l=k+(R?rj(Q,R).width:0);if("separator"===u||u.separator===!0)return Ui(v,_._separatorColor,M,y/4,T),1;if(m){K&&ar(v,K,M+k/2,T,u,_),Nl(v,R,Q,n,M+k,0,0,y);var L=gp(m);j||_._90I.add(L),L.parentNode!==D&&lc(D,L),m.iv&&m.iv(),m.validate&&m.validate();var b=L.getBoundingClientRect(),h=b.width,o=L.style;return nm(L),o.left=_.tx()+M+l+wo,o.top=(y-b.height)/2+wo,l+h}return X===Gm?w=Oi(J?tc:og):X===Po&&(w=Oi(J?Po:Ok)),w?(r=xq(w,u),ar(v,w,M+r/2,T,u,_),M+=r,l+=r):J&&Eh(v,M-I/2,0,l+I,y,_.getSelectBackground(u)),K&&ar(v,K,M+k/2,T,u,_),Nl(v,R,Q,n,M+k,0,0,y),l},validateImpl:function(){var y=this,E=y._canvas,Q=y.getWidth(),S=y.getHeight(),$=y._30o,k=y._items;fp(E,Q,S);var F=Md(E),m=y._itemGap,Z=m/2;hq(F,y.tx(),0,1),F.clearRect(0,0,Q,S);var L=y._90I;y._90I=new Kf,$.clear(),k.forEach(function(i){var f=y.drawItem(F,i,Z,S);$.add({item:i,startX:Z,endX:Z+f,width:f}),f&&(Z+=f+m)}),L.each(function(W){y._90I.contains(W)||ws(W)});var u=y._64I;y._64I=V(0,Z),F.restore(),y._stickToRight?(y._65O=0,F=Md(E),Z=Q-y._64I+m,hq(F,0,0,1),F.clearRect(0,0,Q,S),$.clear(),k.forEach(function(A){var c=y.drawItem(F,A,Z,S,!0);$.add({item:A,startX:Z,endX:Z+c,width:c}),c&&(Z+=c+m)}),F.restore()):y.tx(y.tx()),u!==y._64I&&y.onSumWidthChanged(u,y._64I)},onSumWidthChanged:function(){},handleClick:function(i,W){var z=this,R=i.type,T=i.action,J=i.groupId,e=i.selected;i.disabled||(J!=S?e||(i.selected=!0,this._items.forEach(function(e){e.groupId===J&&i!==e&&(e.selected=!1)}),T&&i.action(i,z,W)):R===Po||"toggle"===R?(i.selected=!e,T&&i.action(i,z,W)):T&&i.action(i,z,W)),qi(),z.iv()}});var Vf=function(d){this.tb=d,this.addListeners()};jd(Vf,G,{ms_listener:1,getView:function(){return this.tb._view},handle_mousewheel:function(L){this.handleScroll(L,10*(L.wheelDelta/40))},handle_DOMMouseScroll:function(O){this.handleScroll(O,10*-O.detail)},handleScroll:function(t,P){Ub(t);var L=this.tb;L.isScrollable()&&!L._stickToRight&&(L.tx(L.tx()+P),Rr())},handle_mousemove:function(F){var q=this;Zp||q.setItem(F)},handle_mouseout:function(H){var Y=this;H.target===Y.getView()?Y.tb.setCurrentItem(S):Y.handle_mousemove(H)},handle_mousedown:function(s){this.handle_mousemove(s),this.handle_touchstart(s)},handle_touchstart:function(g){var X=this,b=X.tb,R=g.target;bh(g)&&(R===X.getView()||R===b._canvas)&&(Ub(g),b.setFocus(g)&&(this.setItem(g,!0),(b.isScrollable()||X.info&&!X.info.item.disabled)&&(X.x=Xd(g).x,X.tx=b.tx(),sm(X,g))))},handleWindowMouseMove:function(S){this.handleWindowTouchMove(S)},handleWindowTouchMove:function(u){var E=this,s=E.tb;if(!s._stickToRight){var T=Xd(u).x-E.x;!E._25o&&M(T)>2&&s.isScrollable()&&(E._25o=1),E._25o&&s.tx(E.tx+T)}},handleWindowMouseUp:function(u){this.handleWindowTouchEnd(u)},handleWindowTouchEnd:function(j){var l=this,s=l.tb,C=l.info,Y=l.tb.getItemInfoAt(j);if(!l._25o&&C){var L=C.item;Y&&Y.item===L&&s.handleClick(L,j)}l._25o=l.x=l.tx=S,l.setItem()},setItem:function(U,j){var H=this,z=H.tb,h=H.info=U?z.getItemInfoAt(U):S,a=h?h.item:S;z.setCurrentItem(a),j&&a&&dc(a.onDown)&&a.onDown(U)}}),Mr.BorderPane=function(){this._view=Nm(1,this),this.iv()},Yo("BorderPane",G,{ms_v:1,ms_ac:["topHeight","bottomHeight","leftWidth","rightWidth"],ms_fire:1,getLeftView:function(){return this._leftView},setLeftView:function(D,j){this._12o("leftView",D),j!=S&&this.setLeftWidth(j)},getRightView:function(){return this._rightView},setRightView:function(F,u){this._12o("rightView",F),u!=S&&this.setRightWidth(u)},getTopView:function(){return this._topView},setTopView:function(B,w){this._12o("topView",B),w!=S&&this.setTopHeight(w)},getBottomView:function(){return this._bottomView},setBottomView:function(o,w){this._12o("bottomView",o),w!=S&&this.setBottomHeight(w)},getCenterView:function(){return this._centerView},setCenterView:function(O){this._12o("centerView",O)},_12o:function(A,v){var o=this,p="_"+A,q=o._view,c=o[p];c!==v&&(c&&(c.getView?ws(c.getView()):ws(c)),o[p]=v,v&&(v.getView?lc(q,v.getView(),1):lc(q,v,1)),o.fp(A,c,v))},onPropertyChanged:function(){this.iv()},validateImpl:function(){var r=this,p=r._topView,J=r._bottomView,A=r._leftView,L=r._rightView,_=r._centerView,E=r.getWidth(),$=r.getHeight(),Y=0,W=0,B=E,c=$,U=0,R=0,F=0,I=0;p&&(U=r._topHeight==S?Qf(p):r._topHeight,W=U),J&&(R=r._bottomHeight==S?Qf(J):r._bottomHeight,c=$-R),A&&(F=r._leftWidth==S?Rm(A):r._leftWidth,Y=F),L&&(I=r._rightWidth==S?Rm(L):r._rightWidth,B=E-I);var P=V(0,B-Y),C=V(0,c-W);p&&Ap(p,0,0,E,U),J&&Ap(J,0,c,E,R),A&&Ap(A,0,W,F,C),L&&Ap(L,B,W,I,C),_&&Ap(_,Y,W,P,C)}})}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);